<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="鹤翔万里（TonyCrane）的笔记本" name="description"/>
<link href="https://note.tonycrane.cc/cs/pl/rust/basic/" rel="canonical"/>
<link href="../" rel="prev"/>
<link href="../misc/" rel="next"/>
<link href="../../../../feed_rss_created.xml" rel="alternate" title="RSS 订阅" type="application/rss+xml"/>
<link href="../../../../feed_rss_updated.xml" rel="alternate" title="已更新内容的 RSS 订阅" type="application/rss+xml"/>
<link href="../../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.16" name="generator"/>
<title>Rust 基础语法 - 鹤翔万里的笔记本</title>
<link href="../../../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link href="../../../../css/counter.css" rel="stylesheet"/>
<link href="../../../../css/heti.css" rel="stylesheet"/>
<link href="../../../../css/timeline.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/utils/katex.min.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css" rel="stylesheet"/>
<link href="../../../../css/tasklist.css" rel="stylesheet"/>
<link href="../../../../css/custom.css" rel="stylesheet"/>
<link href="../../../../css/card.css" rel="stylesheet"/>
<link href="../../../../css/flink.css" rel="stylesheet"/>
<link href="../../../../css/changelog_extra.css" rel="stylesheet"/>
<link href="../../../../css/toc_extra.css" rel="stylesheet"/>
<link href="../../../../css/svg_extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c273de7f67d992cb6aef08c3ddf09bb2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DYETCPM289"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-DYETCPM289",{page_path:e.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DYETCPM289"></script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
<link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#rust">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="鹤翔万里的笔记本" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="鹤翔万里的笔记本">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            鹤翔万里的笔记本
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Rust 基础语法
            
          </span>
</div>
</div>
</div>
<div class="md-header__options">
<div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon">
<a class="light-mode" href="javascript:toggleScheme();" title="Light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</a>
<a class="dark-mode" href="javascript:toggleScheme();" title="Dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</a>
<a class="system-mode" href="javascript:toggleScheme();" title="System preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07zm-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13zm-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87zM19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35zm4.33-2.7 1.15-2.77 2.2 2.54zm1.15-4.96-1.14-2.78 3.34.24zM9.63 18.93l2.77 1.15-2.53 2.19z"></path></svg>
</a>
<a class="unknown-mode" href="javascript:toggleScheme();" title="Unknown scheme">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10"></path></svg>
</a>
</div>
</div>
<script src="../../../../js/scheme.js" type="text/javascript"></script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/TonyCrane/note/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4" fill="currentColor"></path></svg>
</div>
<div class="md-source__repository">
    TonyCrane/note
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
          
  
  
    
  
  Home

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../../">
          
  
  
    
  
  Computer Science

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../sec/">
          
  
  
    
  
  Security

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../devops/">
          
  
  
    
  
  DevOps

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../ctf/">
          
  
  
    
  
  CTF

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../writeups/">
          
  
  
    
  
  Writeups

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../others/">
          
  
  
    
  
  Others

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="鹤翔万里的笔记本" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="鹤翔万里的笔记本">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"></path></svg>
</a>
    鹤翔万里的笔记本
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/TonyCrane/note/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4" fill="currentColor"></path></svg>
</div>
<div class="md-source__repository">
    TonyCrane/note
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Home
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../changelog/">
<span class="md-ellipsis">
    更新记录
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../links/">
<span class="md-ellipsis">
    友链
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../">
<span class="md-ellipsis">
    Computer Science
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Computer Science
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    编程语言 &amp; ISA
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
            编程语言 &amp; ISA
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
<span class="md-ellipsis">
    C/C++
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_2">
<span class="md-nav__icon md-icon"></span>
            C/C++
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../c_cpp/c/">
<span class="md-ellipsis">
    C 语言杂项
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../c_cpp/oop/">
<span class="md-ellipsis">
    C++ 面向对象
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../python/">
<span class="md-ellipsis">
    Python
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2_3" id="__nav_2_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_3">
<span class="md-nav__icon md-icon"></span>
            Python
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../python/basic/">
<span class="md-ellipsis">
    Python 基础语法
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../python/numpy/">
<span class="md-ellipsis">
    NumPy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../python/pil/">
<span class="md-ellipsis">
    PIL
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Rust
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_2_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_4">
<span class="md-nav__icon md-icon"></span>
            Rust
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Rust 基础语法
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Rust 基础语法
    
  </span>
</a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      变量
    </span>
</a>
<nav aria-label="变量" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      标识符命名
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      变量绑定与可变性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      变量解构
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      常量
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      变量遮蔽
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      基本类型
    </span>
</a>
<nav aria-label="基本类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      整型
    </span>
</a>
<nav aria-label="整型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      布尔类型
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      浮点型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      运算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      序列
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      字符类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      单元类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      语句与表达式
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      函数
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      所有权与借用
    </span>
</a>
<nav aria-label="所有权与借用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      所有权
    </span>
</a>
<nav aria-label="所有权" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#string">
<span class="md-ellipsis">
      String 类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      所有权转移
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
<span class="md-ellipsis">
      函数传值与返回
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
<span class="md-ellipsis">
      引用与借用
    </span>
</a>
<nav aria-label="引用与借用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
<span class="md-ellipsis">
      避免悬垂引用
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
<span class="md-ellipsis">
      复合类型
    </span>
</a>
<nav aria-label="复合类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
<span class="md-ellipsis">
      字符串
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
<span class="md-ellipsis">
      元组
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
<span class="md-ellipsis">
      结构体
    </span>
</a>
<nav aria-label="结构体" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
<span class="md-ellipsis">
      简化创建
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
<span class="md-ellipsis">
      更新结构体
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
<span class="md-ellipsis">
      元组结构体
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
<span class="md-ellipsis">
      单元结构体
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
<span class="md-ellipsis">
      打印结构体
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
<span class="md-ellipsis">
      枚举
    </span>
</a>
<nav aria-label="枚举" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#option">
<span class="md-ellipsis">
      Option
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
<span class="md-ellipsis">
      数组
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
<span class="md-ellipsis">
      流程控制
    </span>
</a>
<nav aria-label="流程控制" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_35">
<span class="md-ellipsis">
      分支
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_36">
<span class="md-ellipsis">
      循环
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_37">
<span class="md-ellipsis">
      模式匹配
    </span>
</a>
<nav aria-label="模式匹配" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#match">
<span class="md-ellipsis">
      match 语句
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#if-let-while-let">
<span class="md-ellipsis">
      if let / while let
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#matches">
<span class="md-ellipsis">
      matches! 宏
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_38">
<span class="md-ellipsis">
      方法
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generics">
<span class="md-ellipsis">
      泛型 Generics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trait">
<span class="md-ellipsis">
      特征 Trait
    </span>
</a>
<nav aria-label="特征 Trait" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_39">
<span class="md-ellipsis">
      特征对象
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_40">
<span class="md-ellipsis">
      关联类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_41">
<span class="md-ellipsis">
      默认泛型类型参数
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_42">
<span class="md-ellipsis">
      同名方法调用
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trait-trait">
<span class="md-ellipsis">
      trait 定义中的 trait 约束
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_43">
<span class="md-ellipsis">
      绕过孤儿规则
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_44">
<span class="md-ellipsis">
      集合类型
    </span>
</a>
<nav aria-label="集合类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#vector">
<span class="md-ellipsis">
      Vector
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hashmap">
<span class="md-ellipsis">
      HashMap
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_45">
<span class="md-ellipsis">
      类型转换
    </span>
</a>
<nav aria-label="类型转换" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_46">
<span class="md-ellipsis">
      方法调用时的强制类型转换
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_47">
<span class="md-ellipsis">
      返回值与错误处理
    </span>
</a>
<nav aria-label="返回值与错误处理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#panic">
<span class="md-ellipsis">
      panic
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#result">
<span class="md-ellipsis">
      Result
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_48">
<span class="md-ellipsis">
      包和模块
    </span>
</a>
<nav aria-label="包和模块" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#crate-package">
<span class="md-ellipsis">
      crate 与 package
    </span>
</a>
<nav aria-label="crate 与 package" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#package">
<span class="md-ellipsis">
      典型 package 结构
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#module">
<span class="md-ellipsis">
      模块 Module
    </span>
</a>
<nav aria-label="模块 Module" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_49">
<span class="md-ellipsis">
      代码可见性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use">
<span class="md-ellipsis">
      use 引入
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_50">
<span class="md-ellipsis">
      使用第三方包
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_51">
<span class="md-ellipsis">
      受限可见性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_52">
<span class="md-ellipsis">
      三种模块目录组织方式
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_53">
<span class="md-ellipsis">
      注释与文档
    </span>
</a>
<nav aria-label="注释与文档" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_54">
<span class="md-ellipsis">
      文档注释
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_55">
<span class="md-ellipsis">
      格式化输出
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_56">
<span class="md-ellipsis">
      生命周期
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_57">
<span class="md-ellipsis">
      闭包和迭代器
    </span>
</a>
<nav aria-label="闭包和迭代器" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_58">
<span class="md-ellipsis">
      闭包
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_59">
<span class="md-ellipsis">
      迭代器
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_60">
<span class="md-ellipsis">
      深入类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_61">
<span class="md-ellipsis">
      智能指针
    </span>
</a>
<nav aria-label="智能指针" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#deref-trait">
<span class="md-ellipsis">
      Deref trait
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#drop-trait">
<span class="md-ellipsis">
      Drop trait
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#box">
<span class="md-ellipsis">
      Box
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rc-arc">
<span class="md-ellipsis">
      Rc 与 Arc
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cell-refcell">
<span class="md-ellipsis">
      Cell 与 RefCell
    </span>
</a>
<nav aria-label="Cell 与 RefCell" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#cell">
<span class="md-ellipsis">
      Cell
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#refcell">
<span class="md-ellipsis">
      RefCell
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#weak">
<span class="md-ellipsis">
      Weak 弱引用
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_62">
<span class="md-ellipsis">
      多线程并发编程
    </span>
</a>
<nav aria-label="多线程并发编程" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_63">
<span class="md-ellipsis">
      使用线程
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_64">
<span class="md-ellipsis">
      全局变量
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_65">
<span class="md-ellipsis">
      错误处理
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe">
<span class="md-ellipsis">
      unsafe
    </span>
</a>
<nav aria-label="unsafe" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_66">
<span class="md-ellipsis">
      解引用裸指针
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe_1">
<span class="md-ellipsis">
      调用 unsafe 或外部函数
    </span>
</a>
<nav aria-label="调用 unsafe 或外部函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe_2">
<span class="md-ellipsis">
      unsafe 函数
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ffi">
<span class="md-ellipsis">
      FFI
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe-trait">
<span class="md-ellipsis">
      实现 unsafe trait
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#union">
<span class="md-ellipsis">
      访问 union 中字段
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#macro">
<span class="md-ellipsis">
      macro 宏编程
    </span>
</a>
<nav aria-label="macro 宏编程" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_67">
<span class="md-ellipsis">
      声明式宏
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_68">
<span class="md-ellipsis">
      过程宏
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_69">
<span class="md-ellipsis">
      测试
    </span>
</a>
<nav aria-label="测试" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_70">
<span class="md-ellipsis">
      断言
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_71">
<span class="md-ellipsis">
      编写测试
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../misc/">
<span class="md-ellipsis">
    Rust 杂项随记
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../haskell/">
<span class="md-ellipsis">
    Haskell
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../chisel/">
<span class="md-ellipsis">
    Chisel
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../asm/">
<span class="md-ellipsis">
    x86 汇编语言
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../riscv/">
<span class="md-ellipsis">
    RISC-V ISA
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2_8" id="__nav_2_2_8_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_8_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_8">
<span class="md-nav__icon md-icon"></span>
            RISC-V ISA
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../riscv/unprivileged/">
<span class="md-ellipsis">
    RISC-V 非特权级 ISA
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../riscv/privileged/">
<span class="md-ellipsis">
    RISC-V 特权级 ISA
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../riscv/paging/">
<span class="md-ellipsis">
    RISC-V 页表相关
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../riscv/spike/">
<span class="md-ellipsis">
    Spike 工具链相关
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../ppl/">
<span class="md-ellipsis">
    编程语言原理
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2_9" id="__nav_2_2_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_9_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_9">
<span class="md-nav__icon md-icon"></span>
            编程语言原理
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ppl/topic1/">
<span class="md-ellipsis">
    Lambda 演算
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ppl/topic2/">
<span class="md-ellipsis">
    抽象语法树与归纳法
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ppl/topic3/">
<span class="md-ellipsis">
    静态语义与动态语义
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ppl/topic4/">
<span class="md-ellipsis">
    函数与递归
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ppl/topic5/">
<span class="md-ellipsis">
    数据类型
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ppl/topic6/">
<span class="md-ellipsis">
    递归系统 PCF
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_2_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../compiler/">
<span class="md-ellipsis">
    编译原理
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_2_10" id="__nav_2_2_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_2_10_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_10">
<span class="md-nav__icon md-icon"></span>
            编译原理
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../compiler/topic1/">
<span class="md-ellipsis">
    词法分析与语法分析
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../system/">
<span class="md-ellipsis">
    计算机系统
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
            计算机系统
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../system/cs1/">
<span class="md-ellipsis">
    计算机系统 I
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3_2" id="__nav_2_3_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_2">
<span class="md-nav__icon md-icon"></span>
            计算机系统 I
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/topic1/">
<span class="md-ellipsis">
    数据的表示
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/topic2/">
<span class="md-ellipsis">
    数字逻辑电路基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/topic3/">
<span class="md-ellipsis">
    组合逻辑电路设计
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/topic4/">
<span class="md-ellipsis">
    时序逻辑电路设计
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/topic5/">
<span class="md-ellipsis">
    指令集体系结构
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/topic6/">
<span class="md-ellipsis">
    处理器
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3_2_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_2_8" id="__nav_2_3_2_8_label" tabindex="0">
<span class="md-ellipsis">
    系统 I 实验部分
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_2_8_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_3_2_8">
<span class="md-nav__icon md-icon"></span>
            系统 I 实验部分
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab1-1/">
<span class="md-ellipsis">
    系统 I lab1-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab1-2/">
<span class="md-ellipsis">
    系统 I lab1-2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab2-1/">
<span class="md-ellipsis">
    系统 I lab2-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab2-2/">
<span class="md-ellipsis">
    系统 I lab2-2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab3/">
<span class="md-ellipsis">
    系统 I lab3
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab4-1/">
<span class="md-ellipsis">
    系统 I lab4-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab4-2/">
<span class="md-ellipsis">
    系统 I lab4-2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab5-1/">
<span class="md-ellipsis">
    系统 I lab5-1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs1/lab5-2/">
<span class="md-ellipsis">
    系统 I lab5-2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../system/cs2/">
<span class="md-ellipsis">
    计算机系统 II
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_3">
<span class="md-nav__icon md-icon"></span>
            计算机系统 II
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/topic1/">
<span class="md-ellipsis">
    流水线 CPU
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/topic2/">
<span class="md-ellipsis">
    操作系统简介
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/topic3/">
<span class="md-ellipsis">
    操作系统结构及系统调用
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/topic4/">
<span class="md-ellipsis">
    进程与线程
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/topic5/">
<span class="md-ellipsis">
    CPU 调度
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/topic6/">
<span class="md-ellipsis">
    进程同步
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3_3_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_3_8" id="__nav_2_3_3_8_label" tabindex="0">
<span class="md-ellipsis">
    系统 II 实验部分
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_3_8_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_3_3_8">
<span class="md-nav__icon md-icon"></span>
            系统 II 实验部分
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/lab1/">
<span class="md-ellipsis">
    系统 II lab1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/lab2/">
<span class="md-ellipsis">
    系统 II lab2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs2/lab7/">
<span class="md-ellipsis">
    系统 II lab7
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../system/cs3/">
<span class="md-ellipsis">
    计算机系统 III
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_3_4" id="__nav_2_3_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_4">
<span class="md-nav__icon md-icon"></span>
            计算机系统 III
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs3/topic1/">
<span class="md-ellipsis">
    系统量化研究方法
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_3_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_4_3" id="__nav_2_3_4_3_label" tabindex="0">
<span class="md-ellipsis">
    系统 III 实验部分
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_3_4_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_3_4_3">
<span class="md-nav__icon md-icon"></span>
            系统 III 实验部分
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs3/lab1/">
<span class="md-ellipsis">
    系统 III lab1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/cs3/lab2/">
<span class="md-ellipsis">
    系统 III lab2
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../system/pa/">
<span class="md-ellipsis">
    ICS PA 实验纪实
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
<span class="md-ellipsis">
    算法相关
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
            算法相关
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_4_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../algorithm/ds/">
<span class="md-ellipsis">
    数据结构基础
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_4_1" id="__nav_2_4_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_4_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_4_1">
<span class="md-nav__icon md-icon"></span>
            数据结构基础
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../algorithm/ds/topic1/">
<span class="md-ellipsis">
    算法分析基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../algorithm/ds/summary1/">
<span class="md-ellipsis">
    基础数据结构
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../algorithm/ds/summary2/">
<span class="md-ellipsis">
    排序与哈希
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
<span class="md-ellipsis">
    人工智能相关
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
            人工智能相关
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ai/basic/">
<span class="md-ellipsis">
    人工智能基础
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
<span class="md-ellipsis">
    高性能计算相关
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
            高性能计算相关
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_6_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../hpc/hpc101/">
<span class="md-ellipsis">
    HPC 101 超算小学期
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_6_1" id="__nav_2_6_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_6_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_6_1">
<span class="md-nav__icon md-icon"></span>
            HPC 101 超算小学期
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hpc/hpc101/vectorized/">
<span class="md-ellipsis">
    向量化计算
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hpc/hpc101/gpu/">
<span class="md-ellipsis">
    GPU 编程
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hpc/hpc101/openmp/">
<span class="md-ellipsis">
    OpenMP 基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hpc/hpc101/mpi/">
<span class="md-ellipsis">
    MPI 基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../hpc/hpc101/ml/">
<span class="md-ellipsis">
    机器学习基础
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
<span class="md-ellipsis">
    理论计算机相关
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
            理论计算机相关
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_7_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../tcs/toc/">
<span class="md-ellipsis">
    计算理论
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_7_1" id="__nav_2_7_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_7_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_7_1">
<span class="md-nav__icon md-icon"></span>
            计算理论
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tcs/toc/topic1/">
<span class="md-ellipsis">
    语言、自动机与正则表达式
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tcs/toc/topic2/">
<span class="md-ellipsis">
    上下文无关语言
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tcs/toc/topic3/">
<span class="md-ellipsis">
    图灵机理论基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tcs/toc/topic4/">
<span class="md-ellipsis">
    判定问题
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tcs/toc/topic5/">
<span class="md-ellipsis">
    函数可计算性
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tcs/toc/topic6/">
<span class="md-ellipsis">
    复杂度理论
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
<span class="md-ellipsis">
    零散知识点
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_8_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
            零散知识点
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../regex/">
<span class="md-ellipsis">
    正则表达式
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../unicode/">
<span class="md-ellipsis">
    Unicode
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_9" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../analysis/">
<span class="md-ellipsis">
    源码剖析
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_9_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_9">
<span class="md-nav__icon md-icon"></span>
            源码剖析
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../analysis/mkdocs/">
<span class="md-ellipsis">
    mkdocs 源码剖析
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_10" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../tools/">
<span class="md-ellipsis">
    工具相关
    
  </span>
</a>
<label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_2_10_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_10">
<span class="md-nav__icon md-icon"></span>
            工具相关
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tools/toolbox/">
<span class="md-ellipsis">
    工具收集
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2_10_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_10_3" id="__nav_2_10_3_label" tabindex="0">
<span class="md-ellipsis">
    站点生成工具
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_10_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_10_3">
<span class="md-nav__icon md-icon"></span>
            站点生成工具
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tools/mkdocs/">
<span class="md-ellipsis">
    mkdocs 使用记录
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tools/hexo/">
<span class="md-ellipsis">
    hexo 使用记录
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tools/sphinx/">
<span class="md-ellipsis">
    sphinx 使用记录
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec/">
<span class="md-ellipsis">
    Security
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Security
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec/crypto/">
<span class="md-ellipsis">
    密码学
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            密码学
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec/softsec/">
<span class="md-ellipsis">
    软件安全
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            软件安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/softsec/lab1/">
<span class="md-ellipsis">
    软件安全 lab1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/softsec/lab2/">
<span class="md-ellipsis">
    软件安全 lab2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/softsec/lab3/">
<span class="md-ellipsis">
    软件安全 lab3
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/softsec/lab4/">
<span class="md-ellipsis">
    软件安全 lab4
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/softsec/final/">
<span class="md-ellipsis">
    软件安全 final lab
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec/netsec/">
<span class="md-ellipsis">
    网络安全
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            网络安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/netsec/lab1/">
<span class="md-ellipsis">
    网络安全 lab1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/netsec/lab2/">
<span class="md-ellipsis">
    网络安全 lab2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/netsec/lab3/">
<span class="md-ellipsis">
    网络安全 lab3
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/netsec/hw/">
<span class="md-ellipsis">
    网络安全理论作业
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec/syssec/">
<span class="md-ellipsis">
    系统安全
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
            系统安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/syssec/lab1/">
<span class="md-ellipsis">
    系统安全 lab1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/syssec/lab2/">
<span class="md-ellipsis">
    系统安全 lab2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/syssec/lab3/">
<span class="md-ellipsis">
    系统安全 lab3
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/syssec/project/">
<span class="md-ellipsis">
    eBPF 简介与漏洞分析
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../sec/iotsec/">
<span class="md-ellipsis">
    无线与物联网安全
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
            无线与物联网安全
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/iotsec/lab1/">
<span class="md-ellipsis">
    物联网安全 lab1
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/iotsec/lab2/">
<span class="md-ellipsis">
    物联网安全 lab2
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/iotsec/lab3/">
<span class="md-ellipsis">
    物联网安全 lab3
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
<span class="md-ellipsis">
    漏洞复现
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_7">
<span class="md-nav__icon md-icon"></span>
            漏洞复现
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../sec/vulns/log4j/">
<span class="md-ellipsis">
    log4j 漏洞复现
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../devops/">
<span class="md-ellipsis">
    DevOps
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../devops/system/">
<span class="md-ellipsis">
    系统运维
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            系统运维
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/shell/">
<span class="md-ellipsis">
    命令行 shell 配置
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/git/">
<span class="md-ellipsis">
    Git 相关使用与配置
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/docker/">
<span class="md-ellipsis">
    Docker 相关配置与技术
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/gdb/">
<span class="md-ellipsis">
    gdb 相关使用备忘
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/action/">
<span class="md-ellipsis">
    GitHub Action 基础与运用
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/kvm/">
<span class="md-ellipsis">
    KVM 虚拟机基本用法
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/system/nas/">
<span class="md-ellipsis">
    NAS 配置记录
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../devops/network/">
<span class="md-ellipsis">
    网络运维
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            网络运维
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/network/basic/">
<span class="md-ellipsis">
    基本配置与工具
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/network/clash/">
<span class="md-ellipsis">
    Clash 代理配置
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/network/tunnel/">
<span class="md-ellipsis">
    内网穿透与代理
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/network/server/">
<span class="md-ellipsis">
    Web 服务器相关
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../devops/protocol/">
<span class="md-ellipsis">
    网络协议
    
  </span>
</a>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            网络协议
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/protocol/vmess/">
<span class="md-ellipsis">
    VMess
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
<span class="md-ellipsis">
    前端技术
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            前端技术
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/frontend/css/">
<span class="md-ellipsis">
    CSS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/frontend/svg/">
<span class="md-ellipsis">
    SVG
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    排版写作规范
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            排版写作规范
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/typesetting/clreq/">
<span class="md-ellipsis">
    中文排版需求
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../devops/typesetting/tech/">
<span class="md-ellipsis">
    中文技术文档风格指南
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/">
<span class="md-ellipsis">
    CTF
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            CTF
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested md-nav__item--section">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    misc
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            misc
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/misc/steg/">
<span class="md-ellipsis">
    隐写术
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2_1" id="__nav_5_2_1_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_1">
<span class="md-nav__icon md-icon"></span>
            隐写术
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/steg/image/">
<span class="md-ellipsis">
    图片隐写
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/steg/audio/">
<span class="md-ellipsis">
    音频隐写
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/misc/escapes/">
<span class="md-ellipsis">
    沙箱逃逸
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2_2" id="__nav_5_2_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_2">
<span class="md-nav__icon md-icon"></span>
            沙箱逃逸
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/escapes/pysandbox/">
<span class="md-ellipsis">
    Python 沙箱逃逸
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/misc/forensics/">
<span class="md-ellipsis">
    取证
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2_3" id="__nav_5_2_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_3_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_3">
<span class="md-nav__icon md-icon"></span>
            取证
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/forensics/mem/">
<span class="md-ellipsis">
    内存取证
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2_4" id="__nav_5_2_4_label" tabindex="0">
<span class="md-ellipsis">
    编码/密码类
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_4">
<span class="md-nav__icon md-icon"></span>
            编码/密码类
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/coding/">
<span class="md-ellipsis">
    编码及古典密码
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/qrcode/">
<span class="md-ellipsis">
    QRCode
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/misc/esolang/">
<span class="md-ellipsis">
    Esolang
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/blockchain/">
<span class="md-ellipsis">
    Blockchain
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2_5" id="__nav_5_2_5_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_5_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_2_5">
<span class="md-nav__icon md-icon"></span>
            Blockchain
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/">
<span class="md-ellipsis">
    Ethereum
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2_5_2" id="__nav_5_2_5_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_5_2_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_2_5_2">
<span class="md-nav__icon md-icon"></span>
            Ethereum
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/basic/">
<span class="md-ellipsis">
    以太坊基础
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/evm/">
<span class="md-ellipsis">
    以太坊虚拟机
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/solidity/">
<span class="md-ellipsis">
    Solidity 语言
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/yul/">
<span class="md-ellipsis">
    Yul 语言
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/vuln/">
<span class="md-ellipsis">
    常见合约漏洞攻击手段
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/erc/">
<span class="md-ellipsis">
    ERC 标准
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../ctf/blockchain/eth/eip/">
<span class="md-ellipsis">
    其余重要 EIPs
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/blockchain/solana/">
<span class="md-ellipsis">
    Solana
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_5_3_label" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_5_2_5_3">
<span class="md-nav__icon md-icon"></span>
            Solana
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested md-nav__item--section">
<input class="md-nav__toggle md-toggle" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    pwn
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            pwn
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3_1" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/pwn/stack/">
<span class="md-ellipsis">
    栈漏洞利用
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_1_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_3_1">
<span class="md-nav__icon md-icon"></span>
            栈漏洞利用
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_3_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../ctf/pwn/heap/">
<span class="md-ellipsis">
    堆漏洞利用
    
  </span>
</a>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_2_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_3_2">
<span class="md-nav__icon md-icon"></span>
            堆漏洞利用
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../writeups/">
<span class="md-ellipsis">
    Writeups
    
  </span>
</a>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Writeups
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
<span class="md-ellipsis">
    Training
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
            Training
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/ethernaut/">
<span class="md-ellipsis">
    Ethernaut
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/SecurityInnovation/">
<span class="md-ellipsis">
    Security Innovation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/sadservers/">
<span class="md-ellipsis">
    SadServers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/AAA/">
<span class="md-ellipsis">
    🔒 AAA School Bus
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
<span class="md-ellipsis">
    2021
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
            2021
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/sysu_msc_puzzle/">
<span class="md-ellipsis">
    SYSU MSC Puzzle 2021
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/hackergame2021/">
<span class="md-ellipsis">
    USTC Hackergame 2021
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/d0g3/">
<span class="md-ellipsis">
    第四届“安洵杯”
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/bytectf2021_final/">
<span class="md-ellipsis">
    ByteCTF 2021 Final
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/sctf2021/">
<span class="md-ellipsis">
    SCTF 2021
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
<span class="md-ellipsis">
    2022
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
            2022
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/vnctf2022/">
<span class="md-ellipsis">
    VNCTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/tqlctf2022/">
<span class="md-ellipsis">
    TQLCTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/susctf2022/">
<span class="md-ellipsis">
    SUSCTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/d3ctf2022/">
<span class="md-ellipsis">
    D3CTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/%2Actf2022/">
<span class="md-ellipsis">
    *CTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/mrctf2022/">
<span class="md-ellipsis">
    MRCTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/qwb2022/">
<span class="md-ellipsis">
    强网杯 2022 Quals
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/tctf2022/">
<span class="md-ellipsis">
    TCTF/0CTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/hackergame2022/">
<span class="md-ellipsis">
    USTC Hackergame 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/n1ctf2022/">
<span class="md-ellipsis">
    N1CTF 2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/seccon2022/">
<span class="md-ellipsis">
    SECCON 2022 Quals
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/rctf2022/">
<span class="md-ellipsis">
    RCTF 2022
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
<span class="md-ellipsis">
    2023
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_5">
<span class="md-nav__icon md-icon"></span>
            2023
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/seccon2022final/">
<span class="md-ellipsis">
    SECCON 2022 Final
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/xctf2022final/">
<span class="md-ellipsis">
    XCTF 2022 Final
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/midnight2023/">
<span class="md-ellipsis">
    MidnightSun 2023 Quals
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/aliyunctf2023/">
<span class="md-ellipsis">
    AliyunCTF 2023
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/ciscn2023/">
<span class="md-ellipsis">
    CISCN 2023 Quals
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/seccon2023/">
<span class="md-ellipsis">
    SECCON 2023 Quals
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../writeups/tpctf2023/">
<span class="md-ellipsis">
    TPCTF 2023
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../others/">
<span class="md-ellipsis">
    Others
    
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Others
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/notes/">
<span class="md-ellipsis">
    课程笔记
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../others/subs/">
<span class="md-ellipsis">
    字幕制作系列
    
  </span>
</a>
<label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
            字幕制作系列
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/subs/ass/">
<span class="md-ellipsis">
    ass 标签
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/subs/aegisub/automation/">
<span class="md-ellipsis">
    Aegisub 自动化
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/subs/aegisub/karaoke/">
<span class="md-ellipsis">
    Aegisub 卡拉 OK 模板
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/subs/ffmpeg/">
<span class="md-ellipsis">
    ffmpeg 套件杂记
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../../others/troubleshooting/">
<span class="md-ellipsis">
    TroubleShooting
    
  </span>
</a>
<label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_7_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_4">
<span class="md-nav__icon md-icon"></span>
            TroubleShooting
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../others/troubleshooting/mac/">
<span class="md-ellipsis">
    macOS TroubleShooting
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      目录
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
<span class="md-ellipsis">
      变量
    </span>
</a>
<nav aria-label="变量" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
<span class="md-ellipsis">
      标识符命名
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
<span class="md-ellipsis">
      变量绑定与可变性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
<span class="md-ellipsis">
      变量解构
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
<span class="md-ellipsis">
      常量
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
<span class="md-ellipsis">
      变量遮蔽
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
<span class="md-ellipsis">
      基本类型
    </span>
</a>
<nav aria-label="基本类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
<span class="md-ellipsis">
      整型
    </span>
</a>
<nav aria-label="整型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
<span class="md-ellipsis">
      布尔类型
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
<span class="md-ellipsis">
      浮点型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
<span class="md-ellipsis">
      运算
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
<span class="md-ellipsis">
      序列
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
<span class="md-ellipsis">
      字符类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
<span class="md-ellipsis">
      单元类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
<span class="md-ellipsis">
      语句与表达式
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
<span class="md-ellipsis">
      函数
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
<span class="md-ellipsis">
      所有权与借用
    </span>
</a>
<nav aria-label="所有权与借用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
<span class="md-ellipsis">
      所有权
    </span>
</a>
<nav aria-label="所有权" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#string">
<span class="md-ellipsis">
      String 类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
<span class="md-ellipsis">
      所有权转移
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
<span class="md-ellipsis">
      函数传值与返回
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
<span class="md-ellipsis">
      引用与借用
    </span>
</a>
<nav aria-label="引用与借用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
<span class="md-ellipsis">
      避免悬垂引用
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
<span class="md-ellipsis">
      复合类型
    </span>
</a>
<nav aria-label="复合类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
<span class="md-ellipsis">
      字符串
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
<span class="md-ellipsis">
      元组
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
<span class="md-ellipsis">
      结构体
    </span>
</a>
<nav aria-label="结构体" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
<span class="md-ellipsis">
      简化创建
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
<span class="md-ellipsis">
      更新结构体
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
<span class="md-ellipsis">
      元组结构体
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
<span class="md-ellipsis">
      单元结构体
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
<span class="md-ellipsis">
      打印结构体
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
<span class="md-ellipsis">
      枚举
    </span>
</a>
<nav aria-label="枚举" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#option">
<span class="md-ellipsis">
      Option
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
<span class="md-ellipsis">
      数组
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
<span class="md-ellipsis">
      流程控制
    </span>
</a>
<nav aria-label="流程控制" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_35">
<span class="md-ellipsis">
      分支
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_36">
<span class="md-ellipsis">
      循环
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_37">
<span class="md-ellipsis">
      模式匹配
    </span>
</a>
<nav aria-label="模式匹配" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#match">
<span class="md-ellipsis">
      match 语句
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#if-let-while-let">
<span class="md-ellipsis">
      if let / while let
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#matches">
<span class="md-ellipsis">
      matches! 宏
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_38">
<span class="md-ellipsis">
      方法
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generics">
<span class="md-ellipsis">
      泛型 Generics
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trait">
<span class="md-ellipsis">
      特征 Trait
    </span>
</a>
<nav aria-label="特征 Trait" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_39">
<span class="md-ellipsis">
      特征对象
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_40">
<span class="md-ellipsis">
      关联类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_41">
<span class="md-ellipsis">
      默认泛型类型参数
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_42">
<span class="md-ellipsis">
      同名方法调用
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#trait-trait">
<span class="md-ellipsis">
      trait 定义中的 trait 约束
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_43">
<span class="md-ellipsis">
      绕过孤儿规则
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_44">
<span class="md-ellipsis">
      集合类型
    </span>
</a>
<nav aria-label="集合类型" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#vector">
<span class="md-ellipsis">
      Vector
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#hashmap">
<span class="md-ellipsis">
      HashMap
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_45">
<span class="md-ellipsis">
      类型转换
    </span>
</a>
<nav aria-label="类型转换" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_46">
<span class="md-ellipsis">
      方法调用时的强制类型转换
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_47">
<span class="md-ellipsis">
      返回值与错误处理
    </span>
</a>
<nav aria-label="返回值与错误处理" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#panic">
<span class="md-ellipsis">
      panic
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#result">
<span class="md-ellipsis">
      Result
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_48">
<span class="md-ellipsis">
      包和模块
    </span>
</a>
<nav aria-label="包和模块" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#crate-package">
<span class="md-ellipsis">
      crate 与 package
    </span>
</a>
<nav aria-label="crate 与 package" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#package">
<span class="md-ellipsis">
      典型 package 结构
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#module">
<span class="md-ellipsis">
      模块 Module
    </span>
</a>
<nav aria-label="模块 Module" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_49">
<span class="md-ellipsis">
      代码可见性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use">
<span class="md-ellipsis">
      use 引入
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_50">
<span class="md-ellipsis">
      使用第三方包
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_51">
<span class="md-ellipsis">
      受限可见性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_52">
<span class="md-ellipsis">
      三种模块目录组织方式
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_53">
<span class="md-ellipsis">
      注释与文档
    </span>
</a>
<nav aria-label="注释与文档" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_54">
<span class="md-ellipsis">
      文档注释
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_55">
<span class="md-ellipsis">
      格式化输出
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_56">
<span class="md-ellipsis">
      生命周期
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_57">
<span class="md-ellipsis">
      闭包和迭代器
    </span>
</a>
<nav aria-label="闭包和迭代器" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_58">
<span class="md-ellipsis">
      闭包
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_59">
<span class="md-ellipsis">
      迭代器
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_60">
<span class="md-ellipsis">
      深入类型
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_61">
<span class="md-ellipsis">
      智能指针
    </span>
</a>
<nav aria-label="智能指针" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#deref-trait">
<span class="md-ellipsis">
      Deref trait
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#drop-trait">
<span class="md-ellipsis">
      Drop trait
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#box">
<span class="md-ellipsis">
      Box
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rc-arc">
<span class="md-ellipsis">
      Rc 与 Arc
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cell-refcell">
<span class="md-ellipsis">
      Cell 与 RefCell
    </span>
</a>
<nav aria-label="Cell 与 RefCell" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#cell">
<span class="md-ellipsis">
      Cell
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#refcell">
<span class="md-ellipsis">
      RefCell
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#weak">
<span class="md-ellipsis">
      Weak 弱引用
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_62">
<span class="md-ellipsis">
      多线程并发编程
    </span>
</a>
<nav aria-label="多线程并发编程" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_63">
<span class="md-ellipsis">
      使用线程
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_64">
<span class="md-ellipsis">
      全局变量
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_65">
<span class="md-ellipsis">
      错误处理
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe">
<span class="md-ellipsis">
      unsafe
    </span>
</a>
<nav aria-label="unsafe" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_66">
<span class="md-ellipsis">
      解引用裸指针
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe_1">
<span class="md-ellipsis">
      调用 unsafe 或外部函数
    </span>
</a>
<nav aria-label="调用 unsafe 或外部函数" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe_2">
<span class="md-ellipsis">
      unsafe 函数
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ffi">
<span class="md-ellipsis">
      FFI
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#unsafe-trait">
<span class="md-ellipsis">
      实现 unsafe trait
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#union">
<span class="md-ellipsis">
      访问 union 中字段
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#macro">
<span class="md-ellipsis">
      macro 宏编程
    </span>
</a>
<nav aria-label="macro 宏编程" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_67">
<span class="md-ellipsis">
      声明式宏
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_68">
<span class="md-ellipsis">
      过程宏
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_69">
<span class="md-ellipsis">
      测试
    </span>
</a>
<nav aria-label="测试" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_70">
<span class="md-ellipsis">
      断言
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_71">
<span class="md-ellipsis">
      编写测试
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<script defer="" src="/js/toc.js"></script>
<link href="/css/fold_toc.css" rel="stylesheet"/>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="rust"><span>Rust<span class="heti-spacing"> </span></span>语法基础<a class="headerlink" href="#rust" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约<span class="heti-skip"><span class="heti-spacing"> </span>15382<span class="heti-spacing"> </span></span>个字 <span class="twemoji"><svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M360.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m64.6 136.1c-12.5 12.5-12.5 32.8 0 45.3l73.4 73.4-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0zm-274.7 0c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l73.3-73.4c12.5-12.5 12.5-32.8 0-45.3z" fill="currentColor"></path></svg></span> <span>1059<span class="heti-spacing"> </span></span>行代码 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间<span class="heti-skip"><span class="heti-spacing"> </span>65<span class="heti-spacing"> </span></span>分钟</p>
</div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>基础语法，第二遍学的时候做了点笔记</p>
<p>参考：</p>
<ul>
<li><span>Rust<span class="heti-spacing"> </span></span>圣经，<a href="https://course.rs/">course.rs</a></li>
<li>The Rust Programming Language，<a href="https://doc.rust-lang.org/book/">https://doc.rust-lang.org/book/</a></li>
</ul>
</div>
<h2 id="_1">变量<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_2">标识符命名<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>原生标识符（raw identifiers）<ul>
<li>关键字不能作为标识符名称</li>
<li>加上 <code class="highlight"><span class="n">r</span><span class="p">#</span></code> 前缀后可以使用，比如 <code class="highlight"><span class="n">r</span><span class="p">#</span><span class="k">match</span></code></li>
</ul>
</li>
<li>命名规范：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">类型</th>
<th style="text-align: left;">惯例方式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">模块<span><span class="heti-spacing"> </span>Modules</span></td>
<td style="text-align: left;"><code>snake_case</code></td>
</tr>
<tr>
<td style="text-align: left;">类型<span><span class="heti-spacing"> </span>Types</span></td>
<td style="text-align: left;"><code>UpperCamelCase</code></td>
</tr>
<tr>
<td style="text-align: left;">特征<span><span class="heti-spacing"> </span>Traits</span></td>
<td style="text-align: left;"><code>UpperCamelCase</code></td>
</tr>
<tr>
<td style="text-align: left;">枚举<span><span class="heti-spacing"> </span>Enumerations</span></td>
<td style="text-align: left;"><code>UpperCamelCase</code></td>
</tr>
<tr>
<td style="text-align: left;">结构体<span><span class="heti-spacing"> </span>Structs</span></td>
<td style="text-align: left;"><code>UpperCamelCase</code></td>
</tr>
<tr>
<td style="text-align: left;">函数<span><span class="heti-spacing"> </span>Functions</span></td>
<td style="text-align: left;"><code>snake_case</code></td>
</tr>
<tr>
<td style="text-align: left;">方法<span><span class="heti-spacing"> </span>Methods</span></td>
<td style="text-align: left;"><code>snake_case</code></td>
</tr>
<tr>
<td style="text-align: left;">通用构造器<span><span class="heti-spacing"> </span>General constructors</span></td>
<td style="text-align: left;"><code>new</code> or <code>with_more_details</code></td>
</tr>
<tr>
<td style="text-align: left;">转换构造器<span><span class="heti-spacing"> </span>Conversion constructors</span></td>
<td style="text-align: left;"><code>from_some_other_type</code></td>
</tr>
<tr>
<td style="text-align: left;">宏<span><span class="heti-spacing"> </span>Macros</span></td>
<td style="text-align: left;"><code>snake_case!</code></td>
</tr>
<tr>
<td style="text-align: left;">局部变量<span><span class="heti-spacing"> </span>Local variables</span></td>
<td style="text-align: left;"><code>snake_case</code></td>
</tr>
<tr>
<td style="text-align: left;">静态类型<span><span class="heti-spacing"> </span>Statics</span></td>
<td style="text-align: left;"><code>SCREAMING_SNAKE_CASE</code></td>
</tr>
<tr>
<td style="text-align: left;">常量<span><span class="heti-spacing"> </span>Constants</span></td>
<td style="text-align: left;"><code>SCREAMING_SNAKE_CASE</code></td>
</tr>
<tr>
<td style="text-align: left;">类型参数<span><span class="heti-spacing"> </span>Type parameters</span></td>
<td style="text-align: left;"><code>UpperCamelCase</code>，通常使用一个大写字母<span><span class="heti-spacing"> </span>: T</span></td>
</tr>
<tr>
<td style="text-align: left;">生命周期<span><span class="heti-spacing"> </span>Lifetimes</span></td>
<td style="text-align: left;">通常使用小写字母<span><span class="heti-spacing"> </span>: 'a</span>，'de，'src</td>
</tr>
</tbody>
</table>
<h3 id="_3">变量绑定与可变性<a class="headerlink" href="#_3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>rust<span class="heti-spacing"> </span></span>使用<span class="heti-skip"><span class="heti-spacing"> </span>let<span class="heti-spacing"> </span></span>关键字来进行变量绑定，即 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></code></p>
<p>而<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>的变量默认是不可变（immutable）的，使之变成可变的需要在<span class="heti-skip"><span class="heti-spacing"> </span>let<span class="heti-spacing"> </span></span>后面加上<span><span class="heti-spacing"> </span>mut</span>，如果后面不会改变的变量被声明为了<span class="heti-skip"><span class="heti-spacing"> </span>mutable<span class="heti-spacing"> </span></span>的，编译器会给出警告</p>
<p>存在没有使用的变量的话编译器也会给出警告，在变量名前加上单下划线即可忽略</p>
<h3 id="_4">变量解构<a class="headerlink" href="#_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>类似于<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>的元素解包
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">b</span><span class="p">):</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">);</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="p">[</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">];</span><span class="w"> </span><span class="c1">// c = 1, d = 4</span>
</code></pre></div>
<h3 id="_5">常量<a class="headerlink" href="#_5" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>常量使用<span class="heti-skip"><span class="heti-spacing"> </span>const<span class="heti-spacing"> </span></span>关键字来定义，且必须指定类型，命名通常为蛇形全大写，<span>const<span class="heti-spacing"> </span></span>后面也不允许使用<span><span class="heti-spacing"> </span>mut</span>，可以在任意作用域内声明
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">const</span><span class="w"> </span><span class="n">MAX_VALUE</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100_000</span><span class="p">;</span>
</code></pre></div>
<h3 id="_6">变量遮蔽<a class="headerlink" href="#_6" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>rust<span class="heti-spacing"> </span></span>中可以重复声明同一名称的变量，这会再次分配内存，并完全遮蔽掉前面的同名变量</p>
<h2 id="_7">基本类型<a class="headerlink" href="#_7" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_8">整型<a class="headerlink" href="#_8" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>i<em>长度</em>（有符号<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>、u<em>长度</em>（无符号）</p>
<ul>
<li>i8、i16、i32、i64、i128、u8、u16、u32、u64、u128</li>
<li>isize、<span>usize<span class="heti-spacing"> </span></span>长度由<span class="heti-skip"><span class="heti-spacing"> </span>CPU<span class="heti-spacing"> </span></span>决定，<span>32<span class="heti-spacing"> </span></span>位<span class="heti-skip"><span class="heti-spacing"> </span>CPU<span class="heti-spacing"> </span></span>则是<span class="heti-skip"><span class="heti-spacing"> </span>32<span class="heti-spacing"> </span></span>位，<span>64<span class="heti-spacing"> </span></span>位<span class="heti-skip"><span class="heti-spacing"> </span>CPU<span class="heti-spacing"> </span></span>则是<span class="heti-skip"><span class="heti-spacing"> </span>64<span class="heti-spacing"> </span></span>位</li>
<li>整型字面量中间可以插入<span><span class="heti-spacing"> </span>_</span></li>
<li>字面量结尾可以接类型，例如 <code class="highlight"><span class="mi">10</span><span class="k">i32</span><span class="p">,</span><span class="w"> </span><span class="mi">10_</span><span class="k">i32</span></code></li>
<li>字面量，十六进制<span><span class="heti-spacing"> </span>0x...</span>、八进制<span><span class="heti-spacing"> </span>0o...</span>、二进制<span><span class="heti-spacing"> </span>0b...</span>、字节（仅<span><span class="heti-spacing"> </span>u8</span>）b'A'</li>
<li>整型默认使用<span class="heti-skip"><span class="heti-spacing"> </span>i32<span class="heti-spacing"> </span></span>类型</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>as<span class="heti-spacing"> </span></span>来转换类型，例如 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1_</span><span class="k">u8</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u16</span><span class="p">;</span></code></li>
</ul>
<p><span>debug<span class="heti-spacing"> </span></span>模式编译时产生溢出会<span><span class="heti-spacing"> </span>panic</span>，而在<span class="heti-skip"><span class="heti-spacing"> </span>release<span class="heti-spacing"> </span></span>模式下则不会<span><span class="heti-spacing"> </span>panic</span>，按照补码循环溢出。但不能依赖这种行为，想要这样的效果应该标准库的一些方法：</p>
<ul>
<li>wrapping_<em>*</em> 方法，按照补码循环溢出，例如 <code class="highlight"><span class="n">a</span><span class="p">.</span><span class="n">wrapping_add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></code></li>
<li>checked_<em>*</em> 方法，如果产生溢出了，则会返回<span><span class="heti-spacing"> </span>None</span></li>
<li>overflowing_<em>*</em> 方法，返回结果以及指示是否溢出的布尔值</li>
<li>saturating_<em>*</em> 方法，如果会溢出则保持在最大<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>最小值上</li>
</ul>
<h4 id="_9">布尔类型<a class="headerlink" href="#_9" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>类型名为<span><span class="heti-spacing"> </span>bool</span>，值为<span class="heti-skip"><span class="heti-spacing"> </span>true<span class="heti-spacing"> </span></span>或<span><span class="heti-spacing"> </span>false</span>，占用<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>字节内存</p>
<h3 id="_10">浮点型<a class="headerlink" href="#_10" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>f32<span class="heti-spacing"> </span></span>单精度浮点型、<span>f64<span class="heti-spacing"> </span></span>双精度浮点型，默认情况下为<span><span class="heti-spacing"> </span>f64</span></li>
<li>应该避免判断浮点数相等</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>.is_nan()<span class="heti-spacing"> </span></span>方法来判断一个数值是否是<span><span class="heti-spacing"> </span>NaN</span></li>
<li>数值上也可以使用方法，比如 <code class="highlight"><span class="mf">3.14_</span><span class="k">f32</span><span class="p">.</span><span class="n">round</span><span class="p">()</span></code></li>
</ul>
<h3 id="_11">运算<a class="headerlink" href="#_11" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><code>+ - * / %</code>：加减乘除取模</li>
<li><code>&amp; | ^ ! &lt;&lt; &gt;&gt;</code>：位运算</li>
<li>同样类型才能进行计算、类型转换必须是显式的</li>
<li>其它运算可以通过方法实现，<span>.pow()<span class="heti-spacing"> </span></span>计算指数，<span>.log()<span class="heti-spacing"> </span></span>取对数、<span>.div_euclid()<span class="heti-spacing"> </span></span>整除、<span>.div_floor()<span class="heti-spacing"> </span></span>等等</li>
</ul>
<h3 id="_12">序列<a class="headerlink" href="#_12" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>在<span class="heti-skip"><span class="heti-spacing"> </span>for<span class="heti-spacing"> </span></span>循环中常用，用来生成连续的数值，仅可以使用整数、字符等连续的类型，例如：</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="o">..</span><span class="p">.;</span><span class="w"> </span><span class="c1">// i = 1, 2, 3, 4</span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="p">}</span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sc">'a'</span><span class="o">..=</span><span class="sc">'d'</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="o">..</span><span class="p">.;</span><span class="w"> </span><span class="c1">// i = 'a', 'b', 'c', 'd'</span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="p">}</span>
</code></pre></div>
<h3 id="_13">字符类型<a class="headerlink" href="#_13" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>rust<span class="heti-spacing"> </span></span>中的字符类型是<span><span class="heti-spacing"> </span>char</span>，字面量写法为单引号（双引号表示字符串）</p>
<ul>
<li>一个<span class="heti-skip"><span class="heti-spacing"> </span>char<span class="heti-spacing"> </span></span>占四个字节（而不是<span class="heti-skip"><span class="heti-spacing"> </span>C/C++<span class="heti-spacing"> </span></span>中的一个字节）</li>
<li>所有<span class="heti-skip"><span class="heti-spacing"> </span>unicode<span class="heti-spacing"> </span></span>码元都是一个字符</li>
<li>直接存储<span class="heti-skip"><span class="heti-spacing"> </span>unicode<span class="heti-spacing"> </span></span>值（即<span><span class="heti-spacing"> </span>UCS-4</span><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，而不使用<span class="heti-skip"><span class="heti-spacing"> </span>UTF-8<span class="heti-spacing"> </span></span>编码</li>
</ul>
<h3 id="_14">单元类型<a class="headerlink" href="#_14" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>单元类型就是<span><span class="heti-spacing"> </span>()</span>，唯一的值也是<span><span class="heti-spacing"> </span>()</span>，不占内存</li>
<li><span>main<span class="heti-spacing"> </span></span>函数返回的就是单元类型<span><span class="heti-spacing"> </span>()</span></li>
</ul>
<h3 id="_15">语句与表达式<a class="headerlink" href="#_15" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>简单理解就是，带分号的是一个语句，不带分号的是一个表达式，能返回值的就是表达式</li>
<li>表达式可以是语句的一部分，比如 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span></code> 中<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>就是一个表达式，而整体是一个语句</li>
<li>函数调用是表达式，因为会有返回值，即使“无”返回值也会返回单元类型</li>
<li>用大括号包裹的返回一个值的语句块也是表达式：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
<h3 id="_16">函数<a class="headerlink" href="#_16" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="w">  </span><span class="c1">// 不带分号，返回值；带分号了会返回 ()</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>定义函数使用关键字<span><span class="heti-spacing"> </span>fn</span></li>
<li>函数名、参数名使用蛇形命名</li>
<li>必须显式指定参数类型，除了返回<span class="heti-skip"><span class="heti-spacing"> </span>()<span class="heti-spacing"> </span></span>外要显式指定返回值类型</li>
<li>中途返回使用<span class="heti-skip"><span class="heti-spacing"> </span>return<span class="heti-spacing"> </span></span>关键字（带不带分号均可）</li>
<li>永不返回的函数类型为<span><span class="heti-spacing"> </span>!</span>（相当于<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>类型标注中的<span><span class="heti-spacing"> </span>NoReturn</span><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，一般用于一定会抛出<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>的函数或者无限循环：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">dead_end</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="fm">panic!</span><span class="p">(</span><span class="s">"..."</span><span class="p">);</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="p">}</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="k">fn</span><span class="w"> </span><span class="nf">forever</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
<h2 id="_17">所有权与借用<a class="headerlink" href="#_17" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_18">所有权<a class="headerlink" href="#_18" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ol>
<li><span>Rust<span class="heti-spacing"> </span></span>中每一个值都被一个变量所拥有，该变量被称为值的所有者</li>
<li>一个值同时只能被一个变量所拥有，或者说一个值只能拥有一个所有者</li>
<li>当所有者（变量）离开作用域范围时，这个值将被丢弃（drop）</li>
</ol>
<p>其中作用域的概念和其他语言类似</p>
<h4 id="string"><span>String<span class="heti-spacing"> </span></span>类型<a class="headerlink" href="#string" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p><code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"abc"</span></code> 中<span class="heti-skip"><span class="heti-spacing"> </span>s<span class="heti-spacing"> </span></span>的类型为 <code class="highlight"><span class="o">&amp;</span><span class="kt">str</span></code>，并不是<span><span class="heti-spacing"> </span>String</span>，<span>"abc"<span class="heti-spacing"> </span></span>是被硬编码的不可变的字面量。存储的时候是一个指针和字符串长度</p>
<p>而<span class="heti-skip"><span class="heti-spacing"> </span>String<span class="heti-spacing"> </span></span>则是通过堆来动态分配内存。比如 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">)</span></code>，调用<span class="heti-skip"><span class="heti-spacing"> </span>String<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>from<span class="heti-spacing"> </span></span>方法来创建一个<span><span class="heti-spacing"> </span>String</span></p>
<p>如果<span class="heti-skip"><span class="heti-spacing"> </span>s<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>mut<span class="heti-spacing"> </span></span>的，则可以通过 <code class="highlight"><span class="n">s</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span></code> 来追加字面量</p>
<h4 id="_19">所有权转移<a class="headerlink" href="#_19" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p></p><div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div>
因为 i32 存储在栈上，所以可以直接拷贝，x 和 y 都为 1，但
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div>
String 存储在堆上，为 y 赋值本应拷贝地址作浅复制，但这样同一个 String 就有了两个所有者（x 和 y），这是所有权规则不允许的。因此这时 x 会失效，也就是将 String 的所有权转移给 y，后面无法再使用 x 变量。这种操作叫做移动（move）而非拷贝
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"abc"</span><span class="p">;</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div>
这种情况，因为使用的是 &amp;str 而不是 String，所以 x 仅引用了存储在内存中的字符串，并不对它持有所有权，因此 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span></code> 时对存在栈上的引用进行了拷贝，而不需要移动。所以这之后 x 和 y 均可用
<ul>
<li><span>rust<span class="heti-spacing"> </span></span>永远不会自动创建数据的深拷贝</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>.clone()<span class="heti-spacing"> </span></span>可以深拷贝存在堆上的数据，但性能降低
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w"> </span><span class="c1">// 后面 x、y 均可用，因为是所有的是不同数据</span>
</code></pre></div></li>
</ul>
<h4 id="_20">函数传值与返回<a class="headerlink" href="#_20" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>向函数中传值也会发生移动或者复制
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="c1">// 这里 s 将不能使用</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="p">}</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="k">fn</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">);</span><span class="w"> </span><span class="c1">// s 的所有权到这里</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="p">}</span><span class="w"> </span><span class="c1">// string 被释放</span>
</code></pre></div>
从上面的例子可以看出，s 对于 String 的所有权在函数传值调用时被移动给了 print 函数的 string 变量。然后随着 print 函数的结束，string 作用域结束，这个值内存被 drop。并且由于在调用时 s 被移动了，所以在调用后 s 将不能被使用。若想在调用后继续使用 s，一种方法是将 s.clone() 传给 print，另一种方法则是利用返回：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// 这里 s 可用</span>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="p">}</span>
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="k">fn</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">);</span>
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="n">string</span>
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="p">}</span>
</code></pre></div>
函数在返回的时候也会移动所有权，比如上面例子中，print 函数结束后，将 string 移动了出去，赋值给了 s，这时 s 就拿到了返回值的所有权，后面仍可以继续使用。但这要求 s 是 mut 的（因为发生了变化），或者使用变量遮蔽（<code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code>）
<h3 id="_21">引用与借用<a class="headerlink" href="#_21" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>rust<span class="heti-spacing"> </span></span>中也有引用的概念，获取一个变量的引用也称为借用（borrowing<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，使用<span class="heti-skip"><span class="heti-spacing"> </span>&amp;<span class="heti-spacing"> </span></span>来进行引用，<span>*<span class="heti-spacing"> </span></span>来解引用：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// 引用类型</span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
</code></pre></div>
也可以通过借用来进行函数调用，从而维持参数的所有权：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span><span class="w">    </span><span class="c1">// 创建 s 的引用，并传入</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{} {}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">);</span><span class="w"> </span><span class="c1">// s 仍可用</span>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="p">}</span>
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 接收引用</span>
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="n">string</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w">  </span><span class="c1">// 直接调用方法</span>
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span><span class="w"> </span><span class="c1">// string 离开作用域，但它并不拥有任何值，所以不会发生什么</span>
</code></pre></div>
但是此时的引用是不可变引用，也就是说，不能在 func 函数中进行 <code class="highlight"><span class="n">string</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span></code>
<p>使用<span class="heti-skip"><span class="heti-spacing"> </span>&amp;mut<span class="heti-spacing"> </span></span>可以创建可变引用，例如：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="n">func</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// 创建 s 的可变引用</span>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="c1">// 输出 abc...</span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="p">}</span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 接收可变引用</span>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="n">string</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span><span class="w">  </span><span class="c1">// 可以进行更改</span>
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="p">}</span>
</code></pre></div>
但是对于可变引用，rust 有一些限制：
<ul>
<li>在同一个作用域内，一个数据只能有一个可变引用</li>
<li>可变引用和不可变引用不能同时存在</li>
</ul>
<p>这样做的目的是避免产生数据竞争，以及防止不可变引用的值被可变引用所改变</p>
<p>以及如果存在引用，且后面用到了这个引用，则被引用的即使是<span class="heti-skip"><span class="heti-spacing"> </span>mut<span class="heti-spacing"> </span></span>的，也不能被修改，例如：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">//borrow later used here</span>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}, {}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="c1">// assignment to borrowed `x` occurs here</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}, {}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// borrow later used here</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="p">}</span>
</code></pre></div>
则会产生如上注释中的错误，而如果在 <code class="highlight"><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span></code> 后面没有再用到 y，则是可以通过编译正常更改 x 的
<p>以及如下代码也会编译错误：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}, {}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// cannot borrow `x` as immutable because it is also borrowed as mutable</span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="p">}</span>
</code></pre></div>
因为在传入宏时，实际上对 x 进行了借用，因此同时存在了可变和不可变的引用，导致报错
<h4 id="_22">避免悬垂引用<a class="headerlink" href="#_22" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>悬垂引用（dangling references）也称悬垂指针，意思是指针指向的值被释放掉了，导致指针指的位置不存在期望的内容。<span>rust<span class="heti-spacing"> </span></span>不会允许这种情况发生，比如
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">dangle</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nb">String</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">);</span>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="o">&amp;</span><span class="n">s</span>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="p">}</span>
</code></pre></div>
这里返回了 s 的引用，但是在函数结束后 s 离开了作用域，被释放掉了，所以返回的其实是悬垂引用，rust 编译器将不会通过
<h2 id="_23">复合类型<a class="headerlink" href="#_23" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_24">字符串<a class="headerlink" href="#_24" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>&amp;str<span class="heti-spacing"> </span></span>与<span class="heti-skip"><span class="heti-spacing"> </span>String<span class="heti-spacing"> </span></span>是两个不同的类型</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>&amp;s[a..b]<span class="heti-spacing"> </span></span>的方式来获取切片的引用，切片使用的是前面的<span class="heti-skip"><span class="heti-spacing"> </span>range<span class="heti-spacing"> </span></span>类型，语法和<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>的切片类似，同样可以省略头尾<ul>
<li>对一个<span class="heti-skip"><span class="heti-spacing"> </span>String<span class="heti-spacing"> </span></span>使用切片获得的引用类型也是<span><span class="heti-spacing"> </span>&amp;str</span></li>
<li>切片是按字节进行的，需要精确切到字符边界。例如对中文字符串进行切片，<span>&amp;s[0..3]<span class="heti-spacing"> </span></span>会切出一个汉字字符，而<span class="heti-skip"><span class="heti-spacing"> </span>&amp;s[0..2]<span class="heti-spacing"> </span></span>没切完整会导致<span><span class="heti-spacing"> </span>panic</span></li>
</ul>
</li>
<li>字符是<span class="heti-skip"><span class="heti-spacing"> </span>UCS-4<span class="heti-spacing"> </span></span>编码，字符串是<span class="heti-skip"><span class="heti-spacing"> </span>UTF-8<span class="heti-spacing"> </span></span>编码（每个字符字节数不定）</li>
<li><span>String<span class="heti-spacing"> </span></span>与<span class="heti-skip"><span class="heti-spacing"> </span>&amp;str<span class="heti-spacing"> </span></span>转换<ul>
<li>&amp;str -&gt; String<ul>
<li>String::from("...")</li>
<li>"...".to_string()</li>
</ul>
</li>
<li>String -&gt; &amp;str<ul>
<li>&amp;s / &amp;s[..]</li>
<li>s.as_str()</li>
</ul>
</li>
</ul>
</li>
<li><span>String<span class="heti-spacing"> </span></span>操作<ul>
<li><span>.push('a')<span class="heti-spacing"> </span></span>追加字符<span class="heti-skip"><span class="heti-spacing"> </span>/ .push_str("...")<span class="heti-spacing"> </span></span>追加字符串</li>
<li><span>.insert(n, 'a')<span class="heti-spacing"> </span></span>在索引<span class="heti-skip"><span class="heti-spacing"> </span>n<span class="heti-spacing"> </span></span>的位置插入字符<span class="heti-skip"><span class="heti-spacing"> </span>/ .insert(n, "...")<span class="heti-spacing"> </span></span>同理插入字符串</li>
<li><span>.replace("aaa", "AAA")<span class="heti-spacing"> </span></span>全局替换所有<span class="heti-skip"><span class="heti-spacing"> </span>"aaa"<span class="heti-spacing"> </span></span>到<span><span class="heti-spacing"> </span>"AAA"</span>，返回替换后的新字符串，原字符串不变</li>
<li><span>.replacen("aaa", "AAA")<span class="heti-spacing"> </span></span>同上，但只替换<span class="heti-skip"><span class="heti-spacing"> </span>n<span class="heti-spacing"> </span></span>次</li>
<li><span>.replace_range(a..b, "...")<span class="heti-spacing"> </span></span>将索引<span class="heti-skip"><span class="heti-spacing"> </span>a..b<span class="heti-spacing"> </span></span>的范围替换为新字符串<span><span class="heti-spacing"> </span>"..."</span>，直接操作原字符串</li>
<li><span>.pop()<span class="heti-spacing"> </span></span>删除并返回最后一个字符，返回值为一个<span><span class="heti-spacing"> </span>Option</span>，若字符串为空则返回<span><span class="heti-spacing"> </span>None</span></li>
<li><span>.remove(n)<span class="heti-spacing"> </span></span>删除以索引<span class="heti-skip"><span class="heti-spacing"> </span>n<span class="heti-spacing"> </span></span>开头的一个字符</li>
<li><span>.truncate(n)<span class="heti-spacing"> </span></span>删除索引<span class="heti-skip"><span class="heti-spacing"> </span>n<span class="heti-spacing"> </span></span>开头及之后的所有字符</li>
<li><span>.clear()<span class="heti-spacing"> </span></span>清空字符串</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>+<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>+=<span class="heti-spacing"> </span></span>连接一个<span class="heti-skip"><span class="heti-spacing"> </span>&amp;str<span class="heti-spacing"> </span></span>字符串（不能是<span><span class="heti-spacing"> </span>String</span>）<ul>
<li><span>+<span class="heti-spacing"> </span></span>运算符左侧的变量将失效，因为所有权转移到了<span class="heti-skip"><span class="heti-spacing"> </span>.add()<span class="heti-spacing"> </span></span>方法中然后被释放</li>
</ul>
</li>
<li>可以使用 <code>let s = format!("{} {}", s1, s2)</code> 来连接创建新的字符串</li>
</ul>
</li>
<li>字符串转义<ul>
<li><span>"\x.."<span class="heti-spacing"> </span></span>十六进制表示，必须在<span class="heti-skip"><span class="heti-spacing"> </span>\x00<span class="heti-spacing"> </span></span>到<span class="heti-skip"><span class="heti-spacing"> </span>\x7f<span class="heti-spacing"> </span></span>之间</li>
<li><span>"\u{....}"<span class="heti-spacing"> </span></span>用<span class="heti-skip"><span class="heti-spacing"> </span>codepoint<span class="heti-spacing"> </span></span>表示一个<span class="heti-skip"><span class="heti-spacing"> </span>unicode<span class="heti-spacing"> </span></span>字符</li>
<li>可以直接换行，但从下一行行首开始就记录文本（也就是不当作缩进忽略<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，行尾加  不换行，且下一行行首空格忽略</li>
<li>其它转义和其它语言均类似</li>
<li><span>r"..."<span class="heti-spacing"> </span></span>中的  不参与转义（和<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>类似）</li>
<li><span>r#"..."#<span class="heti-spacing"> </span></span>中的双引号不会提前结束字符串（也就相当于不需要转义双引号）</li>
<li><span>r##"..."##<span class="heti-spacing"> </span></span>中的<span class="heti-skip"><span class="heti-spacing"> </span>"#<span class="heti-spacing"> </span></span>也不会提前结束字符串（双引号前后的井号加多少都可以，只需要匹配即可）</li>
</ul>
</li>
<li>操作<span class="heti-skip"><span class="heti-spacing"> </span>UTF-8<span class="heti-spacing"> </span></span>字符串<ul>
<li>循环遍历字符可以使用 <code class="highlight"><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s">"..."</span><span class="p">.</span><span class="n">chars</span><span class="p">()</span></code></li>
<li>循环遍历字节可以使用 <code class="highlight"><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s">"..."</span><span class="p">.</span><span class="n">bytes</span><span class="p">()</span></code></li>
<li>其它操作标准库中没有，需要通过别的<span><span class="heti-spacing"> </span>crates</span></li>
</ul>
</li>
</ul>
<h3 id="_25">元组<a class="headerlink" href="#_25" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>长度固定，元素顺序及类型固定的复合类型，例如 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">t</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">f64</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">1.1</span><span class="p">);</span></code></li>
<li>使用模式匹配获取元组中的值：<code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span></code></li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>.<span class="heti-spacing"> </span></span>来访问元组内容：<code>t.0 == 1</code></li>
</ul>
<h3 id="_26">结构体<a class="headerlink" href="#_26" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>使用<span class="heti-skip"><span class="heti-spacing"> </span>struct<span class="heti-spacing"> </span></span>关键字来定义结构体，指明字段名与类型：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="p">}</span>
</code></pre></div>
创建结构体实例时每个字段都需要初始化，且顺序可以打乱：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">user1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="mi">19_</span><span class="k">u32</span><span class="p">,</span>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"TonyCrane"</span><span class="p">),</span>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"tonycrane@foxmail.com"</span><span class="p">),</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="p">};</span>
</code></pre></div>
访问结构体字段直接使用 . 就可以。修改某一字段需要将整个结构体标记为 mut，无法将某一字段单独标记为 mut
<p>另外，在结构体中使用引用类型需要用到生命周期</p>
<h4 id="_27">简化创建<a class="headerlink" href="#_27" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p></p><div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">build_user</span><span class="p">(</span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">        </span><span class="n">name</span><span class="p">,</span><span class="w">  </span><span class="c1">// name: name 缩写</span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">        </span><span class="n">age</span><span class="p">,</span><span class="w">   </span><span class="c1">// age: age 缩写</span>
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">        </span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">""</span><span class="p">),</span>
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="p">}</span>
</code></pre></div>
当参数名和字段名相同的时候可以省略掉内容
<h4 id="_28">更新结构体<a class="headerlink" href="#_28" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>通过已有结构体实例创建新实例：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">user2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="n">email</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"another@example.com"</span><span class="p">),</span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="o">..</span><span class="n">user1</span><span class="w"> </span><span class="c1">// 必须写在后面</span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="p">};</span>
</code></pre></div>
将 user1 除了 email 之外的字段<strong>移动</strong>到<span class="heti-skip"><span class="heti-spacing"> </span>user2<span class="heti-spacing"> </span></span>中。因为这是移动，所以发生了所有权的转移，导致<span class="heti-skip"><span class="heti-spacing"> </span>user1.name<span class="heti-spacing"> </span></span>后面不能被使用。但因为<span class="heti-skip"><span class="heti-spacing"> </span>u32<span class="heti-spacing"> </span></span>实现了<span><span class="heti-spacing"> </span>Copy trait</span>，所以<span class="heti-skip"><span class="heti-spacing"> </span>user1.age<span class="heti-spacing"> </span></span>仍可以使用。并且<span class="heti-skip"><span class="heti-spacing"> </span>user1.email<span class="heti-spacing"> </span></span>所有权并没有转移，仍然可以使用
<h4 id="_29">元组结构体<a class="headerlink" href="#_29" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>可以定义像元组一样没有字段名的结构体：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">);</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<h4 id="_30">单元结构体<a class="headerlink" href="#_30" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>像单元类型一样，没有任何字段和属性的结构体。作用上来看就是不关心数据，但关心行为（后面<span class="heti-skip"><span class="heti-spacing"> </span>impl<span class="heti-spacing"> </span></span>之类的）
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">UnitLikeStruct</span><span class="p">;</span>
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UnitLikeStruct</span><span class="p">;</span>
</code></pre></div>
<h4 id="_31">打印结构体<a class="headerlink" href="#_31" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>结构体不能直接被放在<span class="heti-skip"><span class="heti-spacing"> </span>{}<span class="heti-spacing"> </span></span>中打印，因为没有实现<span><span class="heti-spacing"> </span>Display trait</span></p>
<p>一种方便的输出方式是利用 <code class="highlight"><span class="cp">#[derive(Debug)]</span></code> 来自动实现<span class="heti-skip"><span class="heti-spacing"> </span>Debug trait<span class="heti-spacing"> </span></span>来利用<span class="heti-skip"><span class="heti-spacing"> </span>{:?}<span class="heti-spacing"> </span></span>格式化或<span class="heti-skip"><span class="heti-spacing"> </span>dbg!<span class="heti-spacing"> </span></span>宏进行<span class="heti-skip"><span class="heti-spacing"> </span>debug<span class="heti-spacing"> </span></span>打印：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="cp">#[derive(Debug)]</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Rectangle</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="p">}</span>
<a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a>
<a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">rect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rectangle</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">width</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">rect</span><span class="p">);</span>
<a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">    </span><span class="fm">dbg!</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span><span class="w"> </span><span class="c1">// 输出到 stderr 流中</span>
<a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="p">}</span>
</code></pre></div>
输出为：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>Rectangle { width: 30, height: 50 }
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>[src/main.rs:10] rect = Rectangle {
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>    width: 30,
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a>    height: 50,
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a>}
</code></pre></div>
<h3 id="_32">枚举<a class="headerlink" href="#_32" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>使用<span class="heti-skip"><span class="heti-spacing"> </span>enum<span class="heti-spacing"> </span></span>关键字来定义枚举类型，用<span class="heti-skip"><span class="heti-spacing"> </span>::<span class="heti-spacing"> </span></span>来访问成员，可以包含值：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Message</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">    </span><span class="n">Quit</span><span class="p">,</span>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="n">Move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">},</span>
<a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="n">Write</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
<a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="n">ChangeColor</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">),</span>
<a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="p">}</span>
<a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">::</span><span class="n">Quit</span><span class="p">;</span>
<a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">::</span><span class="n">Move</span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">m3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">::</span><span class="n">ChangeColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="p">}</span>
</code></pre></div>
<h4 id="option">Option<a class="headerlink" href="#option" title="Permanent link">¶</a></h4>
<p>类似<span class="heti-skip"><span class="heti-spacing"> </span>Haskell<span class="heti-spacing"> </span></span>中的<span><span class="heti-spacing"> </span>Maybe</span>，定义是：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="k">enum</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="nb">None</span><span class="p">,</span>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="p">}</span>
</code></pre></div>
使用时无需添加 Option:: 前缀，提取值可以使用模式匹配
<h3 id="_33">数组<a class="headerlink" href="#_33" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>rust<span class="heti-spacing"> </span></span>中数组长度固定，必须有相同类型，存储线性排列在栈上，速度快</li>
<li>一个数组的类型是<span><span class="heti-spacing"> </span>[</span><em>元素类型</em>; <em>元素个数</em>]，例如 <code class="highlight"><span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span></code> 表示包含<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>i32<span class="heti-spacing"> </span></span>的数组</li>
<li>使用同一个重复元素初始化数组，例 <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="mi">5</span><span class="p">]</span></code> 即<span class="heti-skip"><span class="heti-spacing"> </span>a<span class="heti-spacing"> </span></span>为包含<span class="heti-skip"><span class="heti-spacing"> </span>5<span class="heti-spacing"> </span></span>个<span class="heti-skip"><span class="heti-spacing"> </span>3<span class="heti-spacing"> </span></span>的数组</li>
<li>索引使用<span><span class="heti-spacing"> </span>[]</span>，与其它语言相同</li>
<li>越界访问会触发<span><span class="heti-spacing"> </span>panic</span></li>
<li>和字符串一样可以创建切片引用</li>
</ul>
<h2 id="_34">流程控制<a class="headerlink" href="#_34" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_35">分支<a class="headerlink" href="#_35" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>if - else if - else<span class="heti-spacing"> </span></span>结构</li>
<li>条件不需要加括号</li>
<li><span>if<span class="heti-spacing"> </span></span>语句块是表达式，可以用来赋值</li>
</ul>
<h3 id="_36">循环<a class="headerlink" href="#_36" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>for<span class="heti-spacing"> </span></span>循环<ul>
<li><span>for ... in ...<span class="heti-spacing"> </span></span>结构</li>
<li><span>in<span class="heti-spacing"> </span></span>后面的集合一般需要使用引用，否则会将所有权移至<span class="heti-skip"><span class="heti-spacing"> </span>for<span class="heti-spacing"> </span></span>块内（实现了<span class="heti-skip"><span class="heti-spacing"> </span>Copy trait<span class="heti-spacing"> </span></span>的除外）</li>
<li>循环中修改元素的话一般需要使用可变引用</li>
<li>带索引循环
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">    </span><span class="c1">// ...</span>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="p">}</span>
</code></pre></div></li>
<li>仅循环多少次：<code class="highlight"><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">10</span></code> 循环<span class="heti-skip"><span class="heti-spacing"> </span>10<span class="heti-spacing"> </span></span>次</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>continue<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>break<span class="heti-spacing"> </span></span>控制循环</li>
</ul>
</li>
<li><span>while<span class="heti-spacing"> </span></span>循环<ul>
<li>没什么特别的</li>
</ul>
</li>
<li><span>loop<span class="heti-spacing"> </span></span>循环<ul>
<li>不会自动停止，需要靠<span><span class="heti-spacing"> </span>break</span></li>
<li>是一个表达式，可以利用<span class="heti-skip"><span class="heti-spacing"> </span>break<span class="heti-spacing"> </span></span>来返回一个值
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">    </span><span class="n">cnt</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">        </span><span class="k">break</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<p><span>rust<span class="heti-spacing"> </span></span>中可以使用<span class="heti-skip"><span class="heti-spacing"> </span>label<span class="heti-spacing"> </span></span>来指定多重循环中<span class="heti-skip"><span class="heti-spacing"> </span>break<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>continue<span class="heti-spacing"> </span></span>哪一层循环：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="o">'</span><span class="na">outer</span><span class="p">:</span><span class="w"> </span><span class="nc">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Outer: #i = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">    </span><span class="o">'</span><span class="na">inner</span><span class="p">:</span><span class="w"> </span><span class="nc">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Inner: #j = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="nl">'outer</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="nl">'outer</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="nl">'inner</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"..."</span><span class="p">);</span>
<a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="p">}</span>
</code></pre></div>
<h2 id="_37">模式匹配<a class="headerlink" href="#_37" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>rust<span class="heti-spacing"> </span></span>中有很多模式匹配，比如<span class="heti-skip"><span class="heti-spacing"> </span>let<span class="heti-spacing"> </span></span>语句、<span>for<span class="heti-spacing"> </span></span>循环本身就相当于模式匹配：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
以及函数参数：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">):</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="w">    </span><span class="c1">// x 和 y 会从这一个参数中匹配出来</span>
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="p">}</span>
</code></pre></div>
除此之外还有一些专门利用模式匹配的语法：
<h3 id="match"><span>match<span class="heti-spacing"> </span></span>语句<a class="headerlink" href="#match" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>类似<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>match-case<span class="heti-spacing"> </span></span>语句，以及<span class="heti-skip"><span class="heti-spacing"> </span>Haskell<span class="heti-spacing"> </span></span>的模式匹配以及守卫语法
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="k">match</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">    </span><span class="n">pattern1</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">expression1</span><span class="p">,</span>
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="n">pattern2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">        </span><span class="n">statements1</span><span class="p">;</span>
<a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">        </span><span class="n">statements2</span><span class="p">;</span>
<a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">        </span><span class="n">expression2</span>
<a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">    </span><span class="n">pattern3</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">pattern4</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">expression3</span><span class="p">,</span>
<a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">expression4</span><span class="p">,</span>
<a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>整个<span class="heti-skip"><span class="heti-spacing"> </span>match<span class="heti-spacing"> </span></span>语句块是一个表达式</li>
<li><span>match<span class="heti-spacing"> </span></span>必须穷举出所有模式，未列出的剩余部分使用通配符<span class="heti-skip"><span class="heti-spacing"> </span>_<span class="heti-spacing"> </span></span>表示其它所有可能性<ul>
<li><span>_<span class="heti-spacing"> </span></span>不会被绑定，可以多次使用，其匹配到的值都会被忽略</li>
</ul>
</li>
<li><span>match<span class="heti-spacing"> </span></span>的每一个分支都必须是一个表达式，且所有分支的表达式返回值类型需要相同</li>
<li><span>|<span class="heti-spacing"> </span></span>表示或，即匹配二者中的一个即可</li>
<li>可以利用模式匹配来绑定新变量</li>
<li>序列也可以作为模式，比如<span class="heti-skip"><span class="heti-spacing"> </span>x = 5<span class="heti-spacing"> </span></span>就可以匹配模式<span><span class="heti-spacing"> </span>1..=5</span></li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>..<span class="heti-spacing"> </span></span>来忽略剩余值
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="k">match</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="w">    </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"x is {}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="p">}</span>
<a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="k">match</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="w">    </span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Some numbers: {}, {}"</span><span class="p">,</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">),</span>
<a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="p">}</span>
</code></pre></div></li>
<li>可以在模式后面增加额外的<span class="heti-skip"><span class="heti-spacing"> </span>if<span class="heti-spacing"> </span></span>条件，称为匹配守卫（match guard）
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="k">match</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"less than five: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">    </span><span class="nb">None</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span>
<a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="p">}</span>
</code></pre></div><ul>
<li>在有<span class="heti-skip"><span class="heti-spacing"> </span>|<span class="heti-spacing"> </span></span>的情况下，<span>if<span class="heti-spacing"> </span></span>语句的条件会作用于所有的模式，而不是最后一个</li>
</ul>
</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>@<span class="heti-spacing"> </span></span>来为字段绑定变量，比如上面的例子里第一个匹配可以写为 <code class="highlight"><span class="nb">Some</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="p">)</span></code><ul>
<li><span>Rust 1.53<span class="heti-spacing"> </span></span>新语法：如 <code class="highlight"><span class="n">num</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span></code> 将<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>绑定到<span class="heti-skip"><span class="heti-spacing"> </span>num<span class="heti-spacing"> </span></span>变量上</li>
<li><span>Rust 1.56<span class="heti-spacing"> </span></span>新语法：和<span class="heti-skip"><span class="heti-spacing"> </span>Haskell<span class="heti-spacing"> </span></span>中<span class="heti-skip"><span class="heti-spacing"> </span>@<span class="heti-spacing"> </span></span>用法类似，在解构的同时保留原值，如
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">px</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">py</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">};</span>
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="c1">// p = Point {x: 10, y: 20}, px = 10, py = 20</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="if-let-while-let">if let / while let<a class="headerlink" href="#if-let-while-let" title="Permanent link">¶</a></h3>
<p>只需要匹配一个模式、忽略其它模式时，可以使用<span class="heti-skip"><span class="heti-spacing"> </span>if let<span class="heti-spacing"> </span></span>语句来简化，比如下面代码
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="k">match</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"!"</span><span class="p">),</span>
<a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(),</span>
<a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="p">}</span>
</code></pre></div>
可以写为
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 是一个等号，不是双等号</span>
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"!"</span><span class="p">);</span>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="p">}</span>
</code></pre></div>
与之相似的是 while let 语句，只要匹配就一直进行循环，例如：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="c1">// ...</span>
<a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">top</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"pop {}"</span><span class="p">,</span><span class="w"> </span><span class="n">top</span><span class="p">);</span>
<a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="p">}</span>
</code></pre></div>
<h3 id="matches"><span>matches!<span class="heti-spacing"> </span></span>宏<a class="headerlink" href="#matches" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>仅仅需要判断一个值是否和一个模式匹配的话可以使用<span class="heti-skip"><span class="heti-spacing"> </span>matches!<span class="heti-spacing"> </span></span>宏：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="fm">matches!</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">pattern</span><span class="p">)</span>
</code></pre></div>
如果匹配则返回 true，否则返回 false
<h2 id="_38">方法<a class="headerlink" href="#_38" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>Rust<span class="heti-spacing"> </span></span>中使用<span class="heti-skip"><span class="heti-spacing"> </span>impl<span class="heti-spacing"> </span></span>块来为结构体定义方法，可以当作，<span>struct<span class="heti-spacing"> </span></span>定义“类”的属性，<span>impl<span class="heti-spacing"> </span></span>块中定义“类”的方法
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="k">impl</span><span class="w"> </span><span class="n">StructName</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">StructName</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">        </span><span class="n">StructName</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="w">            </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">        </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>一个方法的第一个参数为<span class="heti-skip"><span class="heti-spacing"> </span>self<span class="heti-spacing"> </span></span>等，表示自身，且服从所有权规则<ul>
<li>self：将调用者的所有权转移到方法中，少用（类型为 <code class="highlight"><span class="bp">Self</span></code>，表示结构体自身类型）</li>
<li>&amp;self：在方法中使用调用者的不可变借用，常用（实际上是 <code class="highlight"><span class="bp">self</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Self</span></code> 的语法糖）</li>
<li>&amp;mut self：在方法中使用调用者的可变借用，常用</li>
</ul>
</li>
<li>方法名可以与字段名相同（一般用来实现<span><span class="heti-spacing"> </span>getter</span>）</li>
<li><span>rust<span class="heti-spacing"> </span></span>会为<span class="heti-skip"><span class="heti-spacing"> </span>&amp;self<span class="heti-spacing"> </span></span>等自动引用与解引用</li>
<li><span>impl<span class="heti-spacing"> </span></span>块中没有<span class="heti-skip"><span class="heti-spacing"> </span>self<span class="heti-spacing"> </span></span>参数的函数称为关联函数（如上面的<span><span class="heti-spacing"> </span>new</span>）<ul>
<li>不能使用<span class="heti-skip"><span class="heti-spacing"> </span>.<span class="heti-spacing"> </span></span>来以方法的形式调用</li>
<li>应该使用<span class="heti-skip"><span class="heti-spacing"> </span>::<span class="heti-spacing"> </span></span>来调用（相当于调用这个结构体命名空间中的函数）</li>
<li><span>new<span class="heti-spacing"> </span></span>一般用来作为构造器，即从参数返回一个结构体</li>
</ul>
</li>
<li>可以在多个<span class="heti-skip"><span class="heti-spacing"> </span>impl<span class="heti-spacing"> </span></span>块中为同一个结构体定义方法</li>
<li><span>impl<span class="heti-spacing"> </span></span>也可以为枚举类型定义方法</li>
</ul>
<h2 id="generics">泛型<span><span class="heti-spacing"> </span>Generics</span><a class="headerlink" href="#generics" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">T</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">         </span><span class="c1">// ^ 保证可以 T 相加并得到 T 类型的结果</span>
<a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><code class="highlight"><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span></code> 为一个函数规定一个泛型<span><span class="heti-spacing"> </span>T</span>，冒号后面接需要的<span class="heti-skip"><span class="heti-spacing"> </span>trait<span class="heti-spacing"> </span></span>来添加限制</li>
<li>可以通识定义多个泛型，用逗号隔开即可</li>
<li>结构体、枚举等都可以使用泛型
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="w">    </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="p">}</span>
<a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-44-6" id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">    </span><span class="c1">//... 这里可以使用 T</span>
<a href="#__codelineno-44-7" id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="p">}</span>
<a href="#__codelineno-44-8" id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="k">enum</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-44-9" id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">    </span><span class="nb">Some</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
<a href="#__codelineno-44-10" id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="w">    </span><span class="nb">None</span><span class="p">,</span>
<a href="#__codelineno-44-11" id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="p">}</span>
</code></pre></div></li>
<li>可以为带泛型的结构体针对某一具体类型实现方法：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="k">impl</span><span class="w"> </span><span class="n">Point</span><span class="o">&lt;</span><span class="kt">f32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="c1">// only for Point&lt;f32&gt;</span>
<a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="p">}</span>
</code></pre></div></li>
<li>调用泛型函数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SGen</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="nc">SGen</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">}</span>
<a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">    </span><span class="n">func</span><span class="p">(</span><span class="n">SGen</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span><span class="w">         </span><span class="c1">// 隐式指定类型参数 T 为 char</span>
<a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="w">    </span><span class="n">func</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">SGen</span><span class="p">(</span><span class="sc">'a'</span><span class="p">));</span><span class="w"> </span><span class="c1">// 显式指定类型参数 T 为 char</span>
<a href="#__codelineno-46-6" id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="p">}</span>
</code></pre></div></li>
<li><span>const<span class="heti-spacing"> </span></span>泛型，定义一个基于值的泛型参数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">..</span><span class="p">.,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">N</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="n">N</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="w">    </span><span class="c1">// ...</span>
<a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="p">}</span>
</code></pre></div><ul>
<li><span>const<span class="heti-spacing"> </span></span>泛型参数只能接受不带其它泛型参数的实参</li>
</ul>
</li>
</ul>
<h2 id="trait">特征<span><span class="heti-spacing"> </span>Trait</span><a class="headerlink" href="#trait" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p>特征类似于<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>中的抽象基类，规定一些必须有的方法，但差别还是很大</p>
<ul>
<li>定义<span><span class="heti-spacing"> </span>trait</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func1</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span><span class="w"> </span><span class="c1">// 分号结尾，不用写函数内容</span>
<a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func2</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">        </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="c1">// 提供默认实现</span>
<a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="p">}</span>
</code></pre></div><ul>
<li><span>pub<span class="heti-spacing"> </span></span>关键字使之可以从外部导入</li>
<li><span>trait<span class="heti-spacing"> </span></span>块中对于需要实现的方法可以只写签名，也可以将函数写完整来提供一个默认实现</li>
</ul>
</li>
<li>为类型实现特征
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">impl</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyType</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func1</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">        </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="p">}</span>
</code></pre></div><ul>
<li>孤儿规则：为<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>类型实现特征<span><span class="heti-spacing"> </span>T</span>，则<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>中至少有一个在当前作用域中定义，例如不可以为标准库中的类型实现其它标准库中的特征。确保某一库中的代码不会被在被使用的时候破坏</li>
<li>如果一个特征的方法都有默认实现，则花括号内可以不写任何东西</li>
</ul>
</li>
<li>特征约束<ul>
<li>参数里直接写特征是泛型的一个语法糖，以下两行代码效果一样
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">MyTrait</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">MyTrait</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></li>
<li>参数里有特征时不会强制所有这样的参数为同一类型，比如以下三行代码<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>等价、和<span class="heti-skip"><span class="heti-spacing"> </span>3<span class="heti-spacing"> </span></span>不等价
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">MyTrait</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">impl</span><span class="w"> </span><span class="n">MyTrait</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">MyTrait</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">:</span><span class="w"> </span><span class="nc">MyTrait</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">MyTrait</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></li>
<li>多重约束
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">(</span><span class="k">impl</span><span class="w"> </span><span class="n">Trait1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Trait2</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">Trait1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Trait2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></li>
<li><span>where<span class="heti-spacing"> </span></span>约束
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">Trait1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Trait2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Trait3</span><span class="p">,</span>
<a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="w">          </span><span class="n">U</span><span class="p">:</span><span class="w"> </span><span class="nc">Trait4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Trait5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Trait6</span>
<a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="p">{}</span>
</code></pre></div></li>
<li>函数返回值可以只说实现了某个特征的类型，而不明确规定
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="n">MyTrait</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></li>
</ul>
</li>
<li><span>derive<span class="heti-spacing"> </span></span>可以派生特征，使用默认实现，如前面写过的 <code class="highlight"><span class="cp">#[derive(Debug)]</span></code><ul>
<li>Debug、PartialEq、Eq、PartialOrd、Ord、Clone、Copy、Hash、Default</li>
<li>多个的话中间逗号分隔</li>
</ul>
</li>
<li>调用实现了某一特征的类型的方法时需要先用<span class="heti-skip"><span class="heti-spacing"> </span>use<span class="heti-spacing"> </span></span>将特征引入</li>
<li>例子<ul>
<li>为<span class="heti-skip"><span class="heti-spacing"> </span>Point<span class="heti-spacing"> </span></span>实现加法
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">Add</span><span class="p">;</span>
<a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="cp">#[derive(Debug)]</span>
<a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">Add</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="w">    </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="w">    </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<a href="#__codelineno-55-6" id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="p">}</span>
<a href="#__codelineno-55-7" id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">Add</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-55-8" id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="c1">// 关联类型</span>
<a href="#__codelineno-55-9" id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="nc">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Point</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-55-10" id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-55-11" id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="w">            </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
<a href="#__codelineno-55-12" id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="w">            </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<a href="#__codelineno-55-13" id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-55-14" id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-55-15" id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="p">}</span>
</code></pre></div></li>
<li>为<span class="heti-skip"><span class="heti-spacing"> </span>Point<span class="heti-spacing"> </span></span>实现格式化输出
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">;</span>
<a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="p">;</span>
<a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="k">impl</span><span class="w"> </span><span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="w">        </span><span class="fm">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">"({}, {})"</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
<a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="_39">特征对象<a class="headerlink" href="#_39" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>比如使用一个<span class="heti-skip"><span class="heti-spacing"> </span>Vec<span class="heti-spacing"> </span></span>来存储实现同一个特征的不同类型的时候，就需要用到特征对象，例如 <code class="highlight"><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">MyTrait</span><span class="o">&gt;&gt;</span></code></p>
<ul>
<li>使用泛型来代替的话，<span>Vec<span class="heti-spacing"> </span></span>中的所有值类型必须一致</li>
<li>只能使用<span class="heti-skip"><span class="heti-spacing"> </span>&amp;<span class="heti-spacing"> </span></span>引用或者使用<span class="heti-skip"><span class="heti-spacing"> </span>Box<span class="heti-spacing"> </span></span>智能指针来创建特征对象<ul>
<li><code>&amp;dyn MyTrait</code> 在用的时候需要用<span class="heti-skip"><span class="heti-spacing"> </span>&amp;<span class="heti-spacing"> </span></span>借用</li>
<li><code>Box&lt;dyn MyTrait&gt;</code> 在用的时候需要通过<span class="heti-skip"><span class="heti-spacing"> </span>Box::new(...)<span class="heti-spacing"> </span></span>来基于某个值创建智能指针</li>
<li>创建的时候不需要加<span><span class="heti-spacing"> </span>dyn</span></li>
<li>不使用这两种方法的话，大小会未知，但<span class="heti-skip"><span class="heti-spacing"> </span>&amp;dyn<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Box&lt;dyn&gt;<span class="heti-spacing"> </span></span>大小都已知</li>
<li><span>dyn<span class="heti-spacing"> </span></span>代表动态分发（dynamic dispatch）</li>
</ul>
</li>
<li>特征对象的限制：只有对象安全的特征才能创建特征对象<ul>
<li>对象安全：<ul>
<li>方法的返回类型不能是<span><span class="heti-spacing"> </span>Self</span></li>
<li>方法没有任何泛型参数</li>
</ul>
</li>
<li><span>Clone<span class="heti-spacing"> </span></span>特征的<span class="heti-skip"><span class="heti-spacing"> </span>clone<span class="heti-spacing"> </span></span>方法返回的就是<span><span class="heti-spacing"> </span>Self</span>，因此它不是对象安全的。<code class="highlight"><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="nb">Clone</span><span class="o">&gt;</span></code> 的写法会报错</li>
</ul>
</li>
</ul>
<h3 id="_40">关联类型<a class="headerlink" href="#_40" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>关联类型定义<span class="heti-skip"><span class="heti-spacing"> </span>trait<span class="heti-spacing"> </span></span>块中，可以在后续的方法中使用该类型。例如<span class="heti-skip"><span class="heti-spacing"> </span>Iterator<span class="heti-spacing"> </span></span>的定义：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Iterator</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Item</span><span class="p">;</span>
<a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">::</span><span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span>
<a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="p">}</span>
</code></pre></div>
<p>这种写法比为<span class="heti-skip"><span class="heti-spacing"> </span>Iterator<span class="heti-spacing"> </span></span>增加一个泛型更有可读性，而且写起来也简便</p>
<h3 id="_41">默认泛型类型参数<a class="headerlink" href="#_41" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>例如<span class="heti-skip"><span class="heti-spacing"> </span>Add<span class="heti-spacing"> </span></span>这个<span><span class="heti-spacing"> </span>trait</span>：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">RHS</span><span class="o">=</span><span class="bp">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Output</span><span class="p">;</span>
<a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span><span class="p">:</span><span class="w"> </span><span class="nc">RHS</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">;</span>
<a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="p">}</span>
</code></pre></div>
<p><span>Add<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>RHS<span class="heti-spacing"> </span></span>泛型参数带有一个默认值<span><span class="heti-spacing"> </span>Self</span>，也就是说，在<span class="heti-skip"><span class="heti-spacing"> </span>impl<span class="heti-spacing"> </span></span>的时候，如果不为<span class="heti-skip"><span class="heti-spacing"> </span>Add<span class="heti-spacing"> </span></span>指定类型，则默认<span class="heti-skip"><span class="heti-spacing"> </span>RHS<span class="heti-spacing"> </span></span>是<span><span class="heti-spacing"> </span>Self</span>，即要加的东西类型和被加的东西类型一致。例如：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="w">    </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="w">    </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<a href="#__codelineno-59-4" id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="p">}</span>
<a href="#__codelineno-59-5" id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 默认就是要加 Point</span>
<a href="#__codelineno-59-6" id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span>
<a href="#__codelineno-59-7" id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">:</span><span class="w"> </span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-59-8" id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="w">        </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-59-9" id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-59-10" id="__codelineno-59-10" name="__codelineno-59-10"></a><span class="p">}</span>
</code></pre></div>
<h3 id="_42">同名方法调用<a class="headerlink" href="#_42" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>当一个类型的方法与它实现的<span class="heti-skip"><span class="heti-spacing"> </span>trait<span class="heti-spacing"> </span></span>的方法名重名时，直接调用会调用类型上的方法。想要调用<span class="heti-skip"><span class="heti-spacing"> </span>trait<span class="heti-spacing"> </span></span>上的方法时需要使用<span class="heti-skip"><span class="heti-spacing"> </span>::<span class="heti-spacing"> </span></span>来显式调用，如：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="k">trait</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">C</span><span class="p">;</span>
<a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a>
<a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="k">impl</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"A"</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="p">}</span>
<a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="k">impl</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-9" id="__codelineno-60-9" name="__codelineno-60-9"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"B"</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-60-10" id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="p">}</span>
<a href="#__codelineno-60-11" id="__codelineno-60-11" name="__codelineno-60-11"></a><span class="k">impl</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-12" id="__codelineno-60-12" name="__codelineno-60-12"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"C"</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-60-13" id="__codelineno-60-13" name="__codelineno-60-13"></a><span class="p">}</span>
<a href="#__codelineno-60-14" id="__codelineno-60-14" name="__codelineno-60-14"></a>
<a href="#__codelineno-60-15" id="__codelineno-60-15" name="__codelineno-60-15"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-60-16" id="__codelineno-60-16" name="__codelineno-60-16"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">;</span>
<a href="#__codelineno-60-17" id="__codelineno-60-17" name="__codelineno-60-17"></a><span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="n">func</span><span class="p">();</span><span class="w">       </span><span class="c1">// C</span>
<a href="#__codelineno-60-18" id="__codelineno-60-18" name="__codelineno-60-18"></a><span class="w">    </span><span class="n">A</span><span class="p">::</span><span class="n">func</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span><span class="w">    </span><span class="c1">// A</span>
<a href="#__codelineno-60-19" id="__codelineno-60-19" name="__codelineno-60-19"></a><span class="w">    </span><span class="n">B</span><span class="p">::</span><span class="n">func</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span><span class="w">    </span><span class="c1">// B</span>
<a href="#__codelineno-60-20" id="__codelineno-60-20" name="__codelineno-60-20"></a><span class="w">    </span><span class="n">C</span><span class="p">::</span><span class="n">func</span><span class="p">(</span><span class="o">&amp;</span><span class="n">c</span><span class="p">);</span><span class="w">    </span><span class="c1">// C 与第一个相同，但显式调用</span>
<a href="#__codelineno-60-21" id="__codelineno-60-21" name="__codelineno-60-21"></a><span class="p">}</span>
</code></pre></div>
<p>这样调用的一个条件是方法的第一个参数是<span><span class="heti-spacing"> </span>self</span>（又叫方法接收器<span><span class="heti-spacing"> </span>receiver</span><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，但如果是关联函数的话，就没有这个<span><span class="heti-spacing"> </span>receiver</span>，<span>rust<span class="heti-spacing"> </span></span>也就自然不知道是调用哪个类型实现的特征上的方法</p>
<p>这时需要使用完全限定语法：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="o">&lt;</span><span class="n">Type</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span><span class="p">::</span><span class="n">function</span><span class="p">(</span><span class="n">receiver_if_method</span><span class="p">,</span><span class="w"> </span><span class="n">next_arg</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.);</span>
</code></pre></div>
例如：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-62-1" id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-62-2" id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">B</span><span class="p">;</span>
<a href="#__codelineno-62-3" id="__codelineno-62-3" name="__codelineno-62-3"></a>
<a href="#__codelineno-62-4" id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="k">impl</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-62-5" id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"A"</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-62-6" id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="p">}</span>
<a href="#__codelineno-62-7" id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="k">impl</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-62-8" id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"B"</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-62-9" id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="p">}</span>
<a href="#__codelineno-62-10" id="__codelineno-62-10" name="__codelineno-62-10"></a>
<a href="#__codelineno-62-11" id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-62-12" id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="w">    </span><span class="n">B</span><span class="p">::</span><span class="n">func</span><span class="p">();</span><span class="w">          </span><span class="c1">// B</span>
<a href="#__codelineno-62-13" id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="c1">//  A::func();          // 报错</span>
<a href="#__codelineno-62-14" id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">B</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">::</span><span class="n">func</span><span class="p">();</span><span class="w">   </span><span class="c1">// A</span>
<a href="#__codelineno-62-15" id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="p">}</span>
</code></pre></div>
<h3 id="trait-trait"><span>trait<span class="heti-spacing"> </span></span>定义中的<span class="heti-skip"><span class="heti-spacing"> </span>trait<span class="heti-spacing"> </span></span>约束<a class="headerlink" href="#trait-trait" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>如果在定义特征<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>的时候需要使用特征<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>的方法，则<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>都要实现（实现了就好，先后无所谓<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。在定义<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>的时候就可以在后面加上约束<span><span class="heti-spacing"> </span>B</span>：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-63-1" id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">A</span><span class="p">:</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-63-2" id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-63-3" id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="p">}</span>
</code></pre></div>
<h3 id="_43">绕过孤儿规则<a class="headerlink" href="#_43" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>绕过孤儿规则，也就是在外部类型上实现外部特征，一种方法是使用<span class="heti-skip"><span class="heti-spacing"> </span>newtype<span class="heti-spacing"> </span></span>模式，即创建一个元祖结构体来包装外部类型，这样就构造了一个在当前作用域内的新类型</p>
<p>比如想要为 <code class="highlight"><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span></code> 实现<span><span class="heti-spacing"> </span>Display trait</span>，二者都在标准库中，无法直接实现。使用<span class="heti-skip"><span class="heti-spacing"> </span>newtype<span class="heti-spacing"> </span></span>模式：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-64-1" id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">;</span>
<a href="#__codelineno-64-2" id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Wrapper</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">);</span>
<a href="#__codelineno-64-3" id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wrapper</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-64-4" id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-64-5" id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="w">        </span><span class="fm">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">"[{}]"</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">join</span><span class="p">(</span><span class="s">", "</span><span class="p">))</span>
<a href="#__codelineno-64-6" id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-64-7" id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="p">}</span>
<a href="#__codelineno-64-8" id="__codelineno-64-8" name="__codelineno-64-8"></a>
<a href="#__codelineno-64-9" id="__codelineno-64-9" name="__codelineno-64-9"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-64-10" id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wrapper</span><span class="p">(</span><span class="fm">vec!</span><span class="p">[</span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"abc"</span><span class="p">),</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"def"</span><span class="p">)]);</span>
<a href="#__codelineno-64-11" id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"w = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">);</span>
<a href="#__codelineno-64-12" id="__codelineno-64-12" name="__codelineno-64-12"></a><span class="p">}</span>
</code></pre></div>
<h2 id="_44">集合类型<a class="headerlink" href="#_44" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="vector">Vector<a class="headerlink" href="#vector" title="Permanent link">¶</a></h3>
<ul>
<li>动态数组，类型<span><span class="heti-spacing"> </span>Vec&lt;T&gt;</span></li>
<li>创建<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>Vec::new()<span class="heti-spacing"> </span></span>创建<ul>
<li>如果预先知道容量，可以使用<span class="heti-skip"><span class="heti-spacing"> </span>Vec::with_capacity(cap)<span class="heti-spacing"> </span></span>创建，会提升性能</li>
</ul>
</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>vec!<span class="heti-spacing"> </span></span>宏来创建，同时给予初值
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-65-1" id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w"> </span><span class="c1">// 自动推断类型</span>
</code></pre></div></li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>Vec::from(...)<span class="heti-spacing"> </span></span>来从数组创建</li>
</ul>
</li>
<li><span>Vector<span class="heti-spacing"> </span></span>类型在移出作用域后会自动删除，其存储的内容也会被删除</li>
<li>操作<ul>
<li><span>.push(...)<span class="heti-spacing"> </span></span>在末尾添加元素</li>
<li><span>.pop()<span class="heti-spacing"> </span></span>剔除末尾元素</li>
<li><span>.extend(...)<span class="heti-spacing"> </span></span>扩展</li>
<li><span>.len()<span class="heti-spacing"> </span></span>获取长度</li>
<li>可以使用切片来借用元素（越界会<span><span class="heti-spacing"> </span>panic</span>）</li>
<li><span>.get(index)<span class="heti-spacing"> </span></span>来根据索引访问元素，返回类型是<span><span class="heti-spacing"> </span>Option&lt;&amp;T&gt;</span>（越界返回<span><span class="heti-spacing"> </span>None</span>）</li>
<li><code class="highlight"><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span></code> 遍历</li>
<li>利用<span class="heti-skip"><span class="heti-spacing"> </span>enum<span class="heti-spacing"> </span></span>或特征对象来存储不同类型的</li>
</ul>
</li>
</ul>
<h3 id="hashmap">HashMap<a class="headerlink" href="#hashmap" title="Permanent link">¶</a></h3>
<ul>
<li>存储键值对，类型<span><span class="heti-spacing"> </span>HashMap&lt;K, V&gt;</span></li>
<li>需要使用<span class="heti-skip"><span class="heti-spacing"> </span>std::collections::HashMap<span class="heti-spacing"> </span></span>引入</li>
<li><span>key<span class="heti-spacing"> </span></span>一定要实现<span class="heti-skip"><span class="heti-spacing"> </span>Hash<span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span>Eq trait</span><ul>
<li><span>f32<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>f64<span class="heti-spacing"> </span></span>不可以</li>
</ul>
</li>
<li>创建<ul>
<li>HashMap::new()</li>
<li>HashMap::with_capacity(cap)</li>
<li>使用迭代器和<span><span class="heti-spacing"> </span>collect</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-66-1" id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">lst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[(</span><span class="n">key1</span><span class="p">,</span><span class="w"> </span><span class="n">value1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">key2</span><span class="p">,</span><span class="w"> </span><span class="n">value2</span><span class="p">),</span><span class="w"> </span><span class="o">..</span><span class="p">.];</span>
<a href="#__codelineno-66-2" id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">map</span><span class="p">:</span><span class="w"> </span><span class="nc">HashMap</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lst</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">collect</span><span class="p">();</span>
</code></pre></div></li>
</ul>
</li>
<li>操作<ul>
<li><span>.insert(key, value)<span class="heti-spacing"> </span></span>插入一个键值对</li>
<li><span>.get(key)<span class="heti-spacing"> </span></span>获取值，返回<span class="heti-skip"><span class="heti-spacing"> </span>Option&lt;V&gt;<span class="heti-spacing"> </span></span>类型</li>
<li>直接使用<span class="heti-skip"><span class="heti-spacing"> </span>[key]<span class="heti-spacing"> </span></span>获取值，没有<span class="heti-skip"><span class="heti-spacing"> </span>key<span class="heti-spacing"> </span></span>会<span><span class="heti-spacing"> </span>panic</span></li>
<li>.entry(key).or_insert(value)<ul>
<li>如果存在<span><span class="heti-spacing"> </span>key</span>，则返回<span class="heti-skip"><span class="heti-spacing"> </span>key<span class="heti-spacing"> </span></span>对应的值</li>
<li>如果不存在<span><span class="heti-spacing"> </span>key</span>，则插入<span class="heti-skip"><span class="heti-spacing"> </span>key-value<span class="heti-spacing"> </span></span>键值对</li>
<li>返回一个<span class="heti-skip"><span class="heti-spacing"> </span>&amp;mut V<span class="heti-spacing"> </span></span>引用，可以直接修改<span class="heti-skip"><span class="heti-spacing"> </span>map<span class="heti-spacing"> </span></span>中内容</li>
</ul>
</li>
<li><span>.contains_key(key)<span class="heti-spacing"> </span></span>查询是否存在<span><span class="heti-spacing"> </span>key</span></li>
</ul>
</li>
</ul>
<h2 id="_45">类型转换<a class="headerlink" href="#_45" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>一般情况下（方法调用除外）<span>Rust<span class="heti-spacing"> </span></span>不会进行隐式的类型转换</li>
<li>使用<span><span class="heti-spacing"> </span>as</span> <em>type</em> 进行显式的转换</li>
<li>超过最大值会溢出，如<span class="heti-skip"><span class="heti-spacing"> </span>300_i32 as i8<span class="heti-spacing"> </span></span>会得到<span><span class="heti-spacing"> </span>44</span>，而不会<span><span class="heti-spacing"> </span>panic</span></li>
<li>内存地址转换为指针
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-67-1" id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">values</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">];</span>
<a href="#__codelineno-67-2" id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">as_mut_ptr</span><span class="p">();</span>
<a href="#__codelineno-67-3" id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">first_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">;</span><span class="w"> </span><span class="c1">// 将 p1 内存地址转换为一个整数</span>
<a href="#__codelineno-67-4" id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">second_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">first_address</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a href="#__codelineno-67-5" id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">second_address</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="c1">// 访问该地址指向的下一个整数 p2</span>
<a href="#__codelineno-67-6" id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-67-7" id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="w">    </span><span class="o">*</span><span class="n">p2</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-67-8" id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="p">}</span>
<a href="#__codelineno-67-9" id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</code></pre></div></li>
<li><span>TryInto<span class="heti-spacing"> </span></span>转换<ul>
<li>use std::convert::TryInto，但不必要，在<span class="heti-skip"><span class="heti-spacing"> </span>prelude<span class="heti-spacing"> </span></span>中</li>
<li><span>TryInto trait<span class="heti-spacing"> </span></span>有<span class="heti-skip"><span class="heti-spacing"> </span>.try_into<span class="heti-spacing"> </span></span>方法，返回一个<span><span class="heti-spacing"> </span>Result</span>，使用<span class="heti-skip"><span class="heti-spacing"> </span>.unwrap()<span class="heti-spacing"> </span></span>提取
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-68-1" id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kt">u16</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span><span class="p">;</span>
<a href="#__codelineno-68-2" id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">try_into</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div></li>
<li>大类型转换为小类型会返回<span><span class="heti-spacing"> </span>Err(e)</span></li>
</ul>
</li>
</ul>
<h3 id="_46">方法调用时的强制类型转换<a class="headerlink" href="#_46" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>例如在调用<span class="heti-skip"><span class="heti-spacing"> </span>a.func()<span class="heti-spacing"> </span></span>时（<span>a<span class="heti-spacing"> </span></span>的类型为<span><span class="heti-spacing"> </span>T</span><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，编译器会进行以下操作</p>
<ol>
<li>尝试值方法调用，即<span><span class="heti-spacing"> </span>T::func(a)</span></li>
<li>如果上一步无法完成，则尝试引用方法调用，即<ul>
<li>&lt;&amp;T&gt;::func(a)</li>
<li>&lt;&amp;mut T&gt;::func(a)</li>
</ul>
</li>
<li>如果上一步仍然无法完成，则试着解引用<span><span class="heti-spacing"> </span>T</span>，如果<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>满足<span><span class="heti-spacing"> </span>Deref&lt;Target = U&gt;</span>，即<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>可以被解引用为<span><span class="heti-spacing"> </span>U</span>，则编译器会使用<span class="heti-skip"><span class="heti-spacing"> </span>U<span class="heti-spacing"> </span></span>类型尝试调用（从<span class="heti-skip"><span class="heti-spacing"> </span>1<span class="heti-spacing"> </span></span>开始同样的步骤<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，称为解引用方法调用</li>
<li>如果<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>不能被解引用，且<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>是一个定长类型，则编译器会尝试将<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>转为不定长类型（例如<span class="heti-skip"><span class="heti-spacing"> </span>[i32; 2]<span class="heti-spacing"> </span></span>转为<span><span class="heti-spacing"> </span>[i32]</span>）</li>
<li>如果上面都不行，则不能通过编译</li>
</ol>
<details class="example" open="open">
<summary>例<span><span class="heti-spacing"> </span>1</span></summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-69-1" id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">array</span><span class="p">:</span><span class="w"> </span><span class="nc">Rc</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span>
<a href="#__codelineno-69-2" id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// 可以获取第一个元素</span>
</code></pre></div>
<p>会进行以下步骤：</p>
<ol>
<li><span>array[0]<span class="heti-spacing"> </span></span>实际上表示<span><span class="heti-spacing"> </span>array.index(0)</span>（Index trait）</li>
<li>检查<span class="heti-skip"><span class="heti-spacing"> </span>array<span class="heti-spacing"> </span></span>是否实现<span class="heti-skip"><span class="heti-spacing"> </span>Index<span class="heti-spacing"> </span></span>特征，<span>Rc&lt;Box&lt;[T; 3]&gt;&gt;<span class="heti-spacing"> </span></span>没有实现，尝试不可变引用和可变引用，都没有实现，无法调用</li>
<li>尝试解引用<span><span class="heti-spacing"> </span>array</span>，变为<span class="heti-skip"><span class="heti-spacing"> </span>Box&lt;[T; 3]&gt;<span class="heti-spacing"> </span></span>类型，对其调用<span><span class="heti-spacing"> </span>.index(0)</span></li>
<li>Box&lt;[T; 3]&gt;、&amp;Box&lt;[T; 3]&gt;、<span>&amp;mut Box&lt;[T; 3]&gt;<span class="heti-spacing"> </span></span>都没有实现<span><span class="heti-spacing"> </span>Index</span>，无法调用</li>
<li>解引用<span><span class="heti-spacing"> </span>Box&lt;[T; 3]&gt;</span>，得到<span><span class="heti-spacing"> </span>[T; 3]</span></li>
<li><span>[T; 3]<span class="heti-spacing"> </span></span>也没有实现<span><span class="heti-spacing"> </span>Index</span>（只有数组切片才可以通过索引访问<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，引用、解引用都不行</li>
<li>将定长<span class="heti-skip"><span class="heti-spacing"> </span>[T; 3]<span class="heti-spacing"> </span></span>转为不定长<span><span class="heti-spacing"> </span>[T]</span>，也就是数组切片，它实现了<span><span class="heti-spacing"> </span>Index</span>，可以调用<span class="heti-skip"><span class="heti-spacing"> </span>.index(0)<span class="heti-spacing"> </span></span>方法</li>
</ol>
</details>
<details class="example">
<summary>例<span><span class="heti-spacing"> </span>2</span></summary>
<p>已知<span class="heti-skip"><span class="heti-spacing"> </span>clone<span class="heti-spacing"> </span></span>方法的签名是 <code class="highlight"><span class="k">fn</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">T</span><span class="p">;</span></code>
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-70-1" id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nb">Clone</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-70-2" id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cloned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a href="#__codelineno-70-3" id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="p">}</span>
</code></pre></div>
上述代码中因为 value 本身是 &amp;T 类型，所以可以直接调用 clone 方法得到一个 T 类型的 cloned
<div class="highlight"><pre><span></span><code><a href="#__codelineno-71-1" id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-71-2" id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cloned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a href="#__codelineno-71-3" id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="p">}</span>
</code></pre></div>
上述代码虽然没有为 T 限制 Clone 特征，但是仍然可以通过编译。这时无法直接调用 value.clone()，所以会尝试进行引用方法调用，此时 T 变为 &amp;T，&amp;T 实现了 Clone 特征，所以可以调用，但这时 clone 的签名相当于 <code class="highlight"><span class="k">fn</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span><span class="o">&amp;&amp;</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span></code>，所以最后得到的结果 cloned 的类型为 &amp;T
</details>
<h2 id="_47">返回值与错误处理<a class="headerlink" href="#_47" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>Rust<span class="heti-spacing"> </span></span>认为的两种错误：</p>
<ul>
<li>可恢复错误，只影响用户自身的操作，不会对系统产生影响</li>
<li>不可恢复错误，全局性或者系统性的错误，对于系统影响很大</li>
</ul>
<p><span>Rust<span class="heti-spacing"> </span></span>推荐可恢复错误使用<span class="heti-skip"><span class="heti-spacing"> </span>Result&lt;T, E&gt;<span class="heti-spacing"> </span></span>返回值等待后续处理异常，不可恢复错误直接<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>终端程序</p>
<h3 id="panic">panic<a class="headerlink" href="#panic" title="Permanent link">¶</a></h3>
<ul>
<li>可以通过<span class="heti-skip"><span class="heti-spacing"> </span>panic!<span class="heti-spacing"> </span></span>宏来直接抛出一个<span><span class="heti-spacing"> </span>panic</span></li>
<li>运行时带有<span class="heti-skip"><span class="heti-spacing"> </span>RUST_BACKTRACE=1<span class="heti-spacing"> </span></span>环境变量的话，会显示回溯栈（需要开启<span class="heti-skip"><span class="heti-spacing"> </span>debug<span class="heti-spacing"> </span></span>标志）</li>
<li><span>panic<span class="heti-spacing"> </span></span>时有两种方式来终止：<ul>
<li>栈展开：回溯栈上数据和函数调用，可以提供充分报错信息和栈调用信息</li>
<li>直接终止：不清理数据，直接退出程序，交给系统来清理</li>
<li>默认情况是栈展开</li>
<li>直接终止编译出的可执行文件更小，可以在<span class="heti-skip"><span class="heti-spacing"> </span>release<span class="heti-spacing"> </span></span>时指定使用直接终止：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-72-1" id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="k">[profile.release]</span>
<a href="#__codelineno-72-2" id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="n">panic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'abort'</span>
</code></pre></div></li>
</ul>
</li>
<li>如果是<span class="heti-skip"><span class="heti-spacing"> </span>main<span class="heti-spacing"> </span></span>线程<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>了，则程序终止。如果子线程<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>了，则线程终止，<span>main<span class="heti-spacing"> </span></span>线程仍然运行，程序不会结束</li>
</ul>
<h3 id="result">Result<a class="headerlink" href="#result" title="Permanent link">¶</a></h3>
<p><span>Result<span class="heti-spacing"> </span></span>是一个枚举类型，定义为：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-73-1" id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="k">enum</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-73-2" id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
<a href="#__codelineno-73-3" id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">E</span><span class="p">),</span>
<a href="#__codelineno-73-4" id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>match<span class="heti-spacing"> </span></span>来处理<span class="heti-skip"><span class="heti-spacing"> </span>Result<span class="heti-spacing"> </span></span>类型<ul>
<li>例如<span class="heti-skip"><span class="heti-spacing"> </span>IO<span class="heti-spacing"> </span></span>错误，可以对于<span class="heti-skip"><span class="heti-spacing"> </span>Err(error)<span class="heti-spacing"> </span></span>再匹配<span><span class="heti-spacing"> </span>error.kind()</span>，其可能的值在<span class="heti-skip"><span class="heti-spacing"> </span>std::io::ErrorKind<span class="heti-spacing"> </span></span>中</li>
<li>可以配合<span><span class="heti-spacing"> </span>panic</span>，将<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>用<span class="heti-skip"><span class="heti-spacing"> </span>debug<span class="heti-spacing"> </span></span>模式（{:?}）进行输出</li>
</ul>
</li>
<li>对于<span><span class="heti-spacing"> </span>Result</span>，如果失败就<span><span class="heti-spacing"> </span>panic</span><ul>
<li>使用<span><span class="heti-spacing"> </span>.unwrap()</span>：如果是<span class="heti-skip"><span class="heti-spacing"> </span>Err<span class="heti-spacing"> </span></span>则会<span><span class="heti-spacing"> </span>panic</span>，并输出错误内容</li>
<li>使用<span><span class="heti-spacing"> </span>.expect("...")</span>：同样<span><span class="heti-spacing"> </span>panic</span>，但会显示为<span><span class="heti-spacing"> </span>panicked at '...:</span> <em><span>Err<span class="heti-spacing"> </span></span>内容</em>'</li>
</ul>
</li>
<li><code>?</code> 传播错误<ul>
<li>在函数中判断<span><span class="heti-spacing"> </span>Result</span>，并传递返回<span class="heti-skip"><span class="heti-spacing"> </span>Err<span class="heti-spacing"> </span></span>可以写为
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-74-1" id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-74-2" id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">::</span><span class="n">open</span><span class="p">(</span><span class="s">"test.txt"</span><span class="p">);</span>
<a href="#__codelineno-74-3" id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-74-4" id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">file</span><span class="p">,</span>
<a href="#__codelineno-74-5" id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
<a href="#__codelineno-74-6" id="__codelineno-74-6" name="__codelineno-74-6"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-74-7" id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-74-8" id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-74-9" id="__codelineno-74-9" name="__codelineno-74-9"></a><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
<a href="#__codelineno-74-10" id="__codelineno-74-10" name="__codelineno-74-10"></a><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
<a href="#__codelineno-74-11" id="__codelineno-74-11" name="__codelineno-74-11"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-74-12" id="__codelineno-74-12" name="__codelineno-74-12"></a><span class="p">}</span>
</code></pre></div></li>
<li>其中<span class="heti-skip"><span class="heti-spacing"> </span>match-return Err<span class="heti-spacing"> </span></span>部分可以利用<span class="heti-skip"><span class="heti-spacing"> </span>?<span class="heti-spacing"> </span></span>来简写：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-75-1" id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s">"test.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
</code></pre></div></li>
<li><span>?<span class="heti-spacing"> </span></span>在返回<span class="heti-skip"><span class="heti-spacing"> </span>Err<span class="heti-spacing"> </span></span>的时候会自动转换错误类型，例如：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-76-1" id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">File</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-76-2" id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">::</span><span class="n">open</span><span class="p">(</span><span class="s">"test.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a href="#__codelineno-76-3" id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a href="#__codelineno-76-4" id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="p">}</span>
</code></pre></div><ul>
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>?<span class="heti-spacing"> </span></span>处理返回错误的时候，得到的是<span class="heti-skip"><span class="heti-spacing"> </span>std::io::Error<span class="heti-spacing"> </span></span>类型，<span>?<span class="heti-spacing"> </span></span>可以自动调用<span class="heti-skip"><span class="heti-spacing"> </span>From trait<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>from<span class="heti-spacing"> </span></span>方法，将<span class="heti-skip"><span class="heti-spacing"> </span>std::io::Error<span class="heti-spacing"> </span></span>转为需要的<span><span class="heti-spacing"> </span>Box&lt;dyn std::error::Error&gt;</span></li>
</ul>
</li>
<li><span>?<span class="heti-spacing"> </span></span>可以进行链式调用：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-77-1" id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-77-2" id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-77-3" id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="w">    </span><span class="n">File</span><span class="p">::</span><span class="n">open</span><span class="p">(</span><span class="s">"test.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a href="#__codelineno-77-4" id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a href="#__codelineno-77-5" id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="p">}</span>
</code></pre></div><ul>
<li>对于这个操作，<span>Rust<span class="heti-spacing"> </span></span>标准库提供了<span class="heti-skip"><span class="heti-spacing"> </span>std::fs::read_to_string(filename)<span class="heti-spacing"> </span></span>函数，而且返回的就是<span><span class="heti-spacing"> </span>Result&lt;String, std::io::Error&gt;</span></li>
</ul>
</li>
</ul>
</li>
<li><span>?<span class="heti-spacing"> </span></span>结合<span><span class="heti-spacing"> </span>Option</span><ul>
<li>和<span class="heti-skip"><span class="heti-spacing"> </span>Result<span class="heti-spacing"> </span></span>同理，<span>?<span class="heti-spacing"> </span></span>也适用于<span class="heti-skip"><span class="heti-spacing"> </span>Option<span class="heti-spacing"> </span></span>的返回，也就是得到<span class="heti-skip"><span class="heti-spacing"> </span>None<span class="heti-spacing"> </span></span>就立即返回<span><span class="heti-spacing"> </span>None</span>，否则展开出<span class="heti-skip"><span class="heti-spacing"> </span>Some<span class="heti-spacing"> </span></span>中的值</li>
</ul>
</li>
<li><span>main<span class="heti-spacing"> </span></span>函数返回值<ul>
<li><span>main<span class="heti-spacing"> </span></span>函数可以有返回值类型<span><span class="heti-spacing"> </span>Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt;</span></li>
<li>只有声明了这种返回值的<span class="heti-skip"><span class="heti-spacing"> </span>main<span class="heti-spacing"> </span></span>函数中才可以使用<span class="heti-skip"><span class="heti-spacing"> </span>?<span class="heti-spacing"> </span></span>来提前探测错误终止<span class="heti-skip"><span class="heti-spacing"> </span>main<span class="heti-spacing"> </span></span>函数：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-78-1" id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">error</span><span class="p">::</span><span class="n">Error</span><span class="p">;</span>
<a href="#__codelineno-78-2" id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">File</span><span class="p">;</span>
<a href="#__codelineno-78-3" id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-78-4" id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">::</span><span class="n">open</span><span class="p">(</span><span class="s">"test.txt"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<a href="#__codelineno-78-5" id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<a href="#__codelineno-78-6" id="__codelineno-78-6" name="__codelineno-78-6"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li><span>try!<span class="heti-spacing"> </span></span>宏<ul>
<li><span>?<span class="heti-spacing"> </span></span>的早期版本，避免使用</li>
<li>定义：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-79-1" id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="fm">macro_rules!</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-79-2" id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="w">    </span><span class="p">(</span><span class="cp">$e</span><span class="p">:</span><span class="nc">expr</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="cp">$e</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-79-3" id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">val</span><span class="p">,</span>
<a href="#__codelineno-79-4" id="__codelineno-79-4" name="__codelineno-79-4"></a><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(::</span><span class="n">std</span><span class="p">::</span><span class="n">convert</span><span class="p">::</span><span class="nb">From</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="n">err</span><span class="p">)),</span>
<a href="#__codelineno-79-5" id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="w">    </span><span class="p">});</span>
<a href="#__codelineno-79-6" id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="p">}</span>
</code></pre></div></li>
<li>使用方法，以下两行等价：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-80-1" id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">func</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
<a href="#__codelineno-80-2" id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">try</span><span class="o">!</span><span class="p">(</span><span class="n">func</span><span class="p">());</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="_48">包和模块<a class="headerlink" href="#_48" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="crate-package"><span>crate<span class="heti-spacing"> </span></span>与<span><span class="heti-spacing"> </span>package</span><a class="headerlink" href="#crate-package" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>crate<span class="heti-spacing"> </span></span>是一个独立的可编译单元，可以编译出可执行文件或者一个库</li>
<li><span>package<span class="heti-spacing"> </span></span>是<span class="heti-skip"><span class="heti-spacing"> </span>cargo<span class="heti-spacing"> </span></span>创建的包含<span class="heti-skip"><span class="heti-spacing"> </span>Cargo.toml<span class="heti-spacing"> </span></span>的“项目”，可以包含因为功能性被组织在一起的一个<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>或多个<span><span class="heti-spacing"> </span>crate</span><ul>
<li>一个<span class="heti-skip"><span class="heti-spacing"> </span>package<span class="heti-spacing"> </span></span>只能包含一个库（library）类型的<span><span class="heti-spacing"> </span>crate</span>，可以包含多个二进制类型的<span><span class="heti-spacing"> </span>crate</span></li>
<li><span>cargo new<span class="heti-spacing"> </span></span>默认创建的就是二进制<span><span class="heti-spacing"> </span>package</span><ul>
<li><span>src/main.rs<span class="heti-spacing"> </span></span>是二进制<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>的根文件，其包名和所属<span class="heti-skip"><span class="heti-spacing"> </span>package<span class="heti-spacing"> </span></span>相同，入口点在<span class="heti-skip"><span class="heti-spacing"> </span>main<span class="heti-spacing"> </span></span>函数</li>
</ul>
</li>
<li>cargo new &lt;<em>name</em><span>&gt; --lib<span class="heti-spacing"> </span></span>创建库<span><span class="heti-spacing"> </span>package</span><ul>
<li>库<span class="heti-skip"><span class="heti-spacing"> </span>package<span class="heti-spacing"> </span></span>只能作为第三方库被引用，不能使用<span class="heti-skip"><span class="heti-spacing"> </span>cargo run<span class="heti-spacing"> </span></span>运行</li>
<li><span>src/lib.rs<span class="heti-spacing"> </span></span>是库类型同名<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>的根文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="package">典型<span class="heti-skip"><span class="heti-spacing"> </span>package<span class="heti-spacing"> </span></span>结构<a class="headerlink" href="#package" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-81-1" id="__codelineno-81-1" name="__codelineno-81-1"></a>.
<a href="#__codelineno-81-2" id="__codelineno-81-2" name="__codelineno-81-2"></a>├── Cargo.toml
<a href="#__codelineno-81-3" id="__codelineno-81-3" name="__codelineno-81-3"></a>├── Cargo.lock
<a href="#__codelineno-81-4" id="__codelineno-81-4" name="__codelineno-81-4"></a>├── src
<a href="#__codelineno-81-5" id="__codelineno-81-5" name="__codelineno-81-5"></a>│   ├── main.rs    // 默认二进制 crate（编译生成 package 同名可执行文件）
<a href="#__codelineno-81-6" id="__codelineno-81-6" name="__codelineno-81-6"></a>│   ├── lib.rs     // 唯一库 crate
<a href="#__codelineno-81-7" id="__codelineno-81-7" name="__codelineno-81-7"></a>│   └── bin        // 其余二进制 crate（分别生成文件名同名可执行文件）
<a href="#__codelineno-81-8" id="__codelineno-81-8" name="__codelineno-81-8"></a>│       └── main1.rs
<a href="#__codelineno-81-9" id="__codelineno-81-9" name="__codelineno-81-9"></a>│       └── main2.rs
<a href="#__codelineno-81-10" id="__codelineno-81-10" name="__codelineno-81-10"></a>├── tests     // 集成测试
<a href="#__codelineno-81-11" id="__codelineno-81-11" name="__codelineno-81-11"></a>│   └── some_integration_tests.rs
<a href="#__codelineno-81-12" id="__codelineno-81-12" name="__codelineno-81-12"></a>├── benches   // 基准性能测试 benchmark 文件
<a href="#__codelineno-81-13" id="__codelineno-81-13" name="__codelineno-81-13"></a>│   └── simple_bench.rs
<a href="#__codelineno-81-14" id="__codelineno-81-14" name="__codelineno-81-14"></a>└── examples  // 示例
<a href="#__codelineno-81-15" id="__codelineno-81-15" name="__codelineno-81-15"></a>    └── simple_example.rs
</code></pre></div>
<h3 id="module">模块<span><span class="heti-spacing"> </span>Module</span><a class="headerlink" href="#module" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>lib.rs<span class="heti-spacing"> </span></span>中使用<span class="heti-skip"><span class="heti-spacing"> </span>mod<span class="heti-spacing"> </span></span>关键字创建模块，后接模块名</li>
<li><span>mod<span class="heti-spacing"> </span></span>可以嵌套，模块中可以定义各种<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>类型</li>
<li><span>src/main.rs<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>src/lib.rs<span class="heti-spacing"> </span></span>称为<span><span class="heti-spacing"> </span>crate root</span></li>
<li>模块使用<span class="heti-skip"><span class="heti-spacing"> </span>::<span class="heti-spacing"> </span></span>逐级访问<ul>
<li><span>crate<span class="heti-spacing"> </span></span>指根，使用<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>也就相当于使用绝对路径</li>
<li><span>super<span class="heti-spacing"> </span></span>指父模块（上一级<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，相当于文件系统中的<span><span class="heti-spacing"> </span>..</span></li>
<li><span>self<span class="heti-spacing"> </span></span>指自身模块</li>
</ul>
</li>
</ul>
<p>如下<span><span class="heti-spacing"> </span>lib.rs</span>：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-82-1" id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="k">mod</span><span class="w"> </span><span class="nn">A</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-82-2" id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="w">    </span><span class="k">mod</span><span class="w"> </span><span class="nn">B</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-82-3" id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="w">        </span><span class="k">fn</span><span class="w"> </span><span class="nf">func_a</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-82-4" id="__codelineno-82-4" name="__codelineno-82-4"></a><span class="w">            </span><span class="bp">self</span><span class="p">::</span><span class="n">func_b</span><span class="p">();</span>
<a href="#__codelineno-82-5" id="__codelineno-82-5" name="__codelineno-82-5"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-82-6" id="__codelineno-82-6" name="__codelineno-82-6"></a><span class="w">        </span><span class="k">fn</span><span class="w"> </span><span class="nf">func_b</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-82-7" id="__codelineno-82-7" name="__codelineno-82-7"></a><span class="w">            </span><span class="k">super</span><span class="p">::</span><span class="n">C</span><span class="p">::</span><span class="n">func_c</span><span class="p">();</span>
<a href="#__codelineno-82-8" id="__codelineno-82-8" name="__codelineno-82-8"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-82-9" id="__codelineno-82-9" name="__codelineno-82-9"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-82-10" id="__codelineno-82-10" name="__codelineno-82-10"></a><span class="w">    </span><span class="k">mod</span><span class="w"> </span><span class="nn">C</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-82-11" id="__codelineno-82-11" name="__codelineno-82-11"></a><span class="w">        </span><span class="k">fn</span><span class="w"> </span><span class="nf">func_c</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-82-12" id="__codelineno-82-12" name="__codelineno-82-12"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-82-13" id="__codelineno-82-13" name="__codelineno-82-13"></a><span class="p">}</span>
<a href="#__codelineno-82-14" id="__codelineno-82-14" name="__codelineno-82-14"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-82-15" id="__codelineno-82-15" name="__codelineno-82-15"></a><span class="w">    </span><span class="k">crate</span><span class="p">::</span><span class="n">A</span><span class="p">::</span><span class="n">B</span><span class="p">::</span><span class="n">func_a</span><span class="p">();</span><span class="w"> </span><span class="c1">// 绝对路径引用</span>
<a href="#__codelineno-82-16" id="__codelineno-82-16" name="__codelineno-82-16"></a><span class="w">    </span><span class="n">A</span><span class="p">::</span><span class="n">B</span><span class="p">::</span><span class="n">func_b</span><span class="p">();</span><span class="w">        </span><span class="c1">// 相对路径引用</span>
<a href="#__codelineno-82-17" id="__codelineno-82-17" name="__codelineno-82-17"></a><span class="w">    </span><span class="bp">self</span><span class="p">::</span><span class="n">A</span><span class="p">::</span><span class="n">C</span><span class="p">::</span><span class="n">func_c</span><span class="p">();</span><span class="w">  </span>
<a href="#__codelineno-82-18" id="__codelineno-82-18" name="__codelineno-82-18"></a><span class="p">}</span>
</code></pre></div>
它的模块树为：
<div class="highlight"><pre><span></span><code><a href="#__codelineno-83-1" id="__codelineno-83-1" name="__codelineno-83-1"></a>crate
<a href="#__codelineno-83-2" id="__codelineno-83-2" name="__codelineno-83-2"></a>  ├── func
<a href="#__codelineno-83-3" id="__codelineno-83-3" name="__codelineno-83-3"></a>  └── A
<a href="#__codelineno-83-4" id="__codelineno-83-4" name="__codelineno-83-4"></a>      ├── B
<a href="#__codelineno-83-5" id="__codelineno-83-5" name="__codelineno-83-5"></a>      │   ├── func_a
<a href="#__codelineno-83-6" id="__codelineno-83-6" name="__codelineno-83-6"></a>      │   └── func_b
<a href="#__codelineno-83-7" id="__codelineno-83-7" name="__codelineno-83-7"></a>      └── C
<a href="#__codelineno-83-8" id="__codelineno-83-8" name="__codelineno-83-8"></a>          └── func_c
</code></pre></div>
<ul>
<li>仅使用<span><span class="heti-spacing"> </span>mod</span> <em>name</em><span>;<span class="heti-spacing"> </span></span>将创建一个模块，并从同目录下同名的 <em>name</em><span>.rs<span class="heti-spacing"> </span></span>中加载模块内容</li>
</ul>
<h4 id="_49">代码可见性<a class="headerlink" href="#_49" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li>默认情况下，所有类型（函数、方法、结构体、枚举……）都是私有的</li>
<li>父模块无法访问子模块中的私有项，而子模块可以访问父模块及更上层的模块的私有项</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>pub<span class="heti-spacing"> </span></span>关键字将模块、函数等标为对外可见的</li>
<li>结构体与枚举的可见性<ul>
<li>仅将结构体设置为<span><span class="heti-spacing"> </span>pub</span>，其内部所有字段仍然是私有的</li>
<li>仅将枚举设置为<span><span class="heti-spacing"> </span>pub</span>，则其内部所有字段都对外可见</li>
</ul>
</li>
</ul>
<h4 id="use"><span>use<span class="heti-spacing"> </span></span>引入<a class="headerlink" href="#use" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>use<span class="heti-spacing"> </span></span>关键字来引入模块或类型，来简化调用</li>
<li>要避免同名调用</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>as<span class="heti-spacing"> </span></span>来设置别名解决冲突问题，例如：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-84-1" id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<a href="#__codelineno-84-2" id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">IoResult</span><span class="p">;</span>
</code></pre></div></li>
<li>利用<span class="heti-skip"><span class="heti-spacing"> </span>use<span class="heti-spacing"> </span></span>导出，如：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-85-1" id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="k">mod</span><span class="w"> </span><span class="nn">A</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-85-2" id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">B</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-85-3" id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func_b</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-85-4" id="__codelineno-85-4" name="__codelineno-85-4"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-85-5" id="__codelineno-85-5" name="__codelineno-85-5"></a><span class="p">}</span>
<a href="#__codelineno-85-6" id="__codelineno-85-6" name="__codelineno-85-6"></a><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">A</span><span class="p">::</span><span class="n">B</span><span class="p">;</span>
<a href="#__codelineno-85-7" id="__codelineno-85-7" name="__codelineno-85-7"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-85-8" id="__codelineno-85-8" name="__codelineno-85-8"></a><span class="w">    </span><span class="n">B</span><span class="p">::</span><span class="n">func_b</span><span class="p">();</span>
<a href="#__codelineno-85-9" id="__codelineno-85-9" name="__codelineno-85-9"></a><span class="p">}</span>
</code></pre></div><ul>
<li>从外部调用的时候也可以直接使用<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>模块</li>
</ul>
</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>{}<span class="heti-spacing"> </span></span>来简化
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-86-1" id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">collections</span><span class="p">::{</span>
<a href="#__codelineno-86-2" id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="w">    </span><span class="n">HashMap</span><span class="p">,</span>
<a href="#__codelineno-86-3" id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="w">    </span><span class="n">BTreeMap</span><span class="p">,</span>
<a href="#__codelineno-86-4" id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="w">    </span><span class="n">HashSet</span>
<a href="#__codelineno-86-5" id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="p">};</span>
<a href="#__codelineno-86-6" id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::{</span><span class="n">cmp</span><span class="p">::</span><span class="n">Ordering</span><span class="p">,</span><span class="w"> </span><span class="n">io</span><span class="p">};</span>
</code></pre></div><ul>
<li><span>{}<span class="heti-spacing"> </span></span>中可以使用<span><span class="heti-spacing"> </span>self</span>：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-87-1" id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::{</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">Write</span><span class="p">}</span>
<a href="#__codelineno-87-2" id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="c1">// 即 use std::io 以及 use std::io::Write</span>
</code></pre></div></li>
</ul>
</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>*<span class="heti-spacing"> </span></span>引入模块下所有公开项，如 <code class="highlight"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">collections</span><span class="p">::</span><span class="o">*</span><span class="p">;</span></code>，但要小心名称冲突</li>
</ul>
<h4 id="_50">使用第三方包<a class="headerlink" href="#_50" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>例如使用<span class="heti-skip"><span class="heti-spacing"> </span>rand<span class="heti-spacing"> </span></span>包：</p>
<ol>
<li>修改<span><span class="heti-spacing"> </span>Cargo.toml</span>，在<span class="heti-skip"><span class="heti-spacing"> </span>[dependencies]<span class="heti-spacing"> </span></span>中添加<span><span class="heti-spacing"> </span>rand = "0.8.3"</span></li>
<li>在代码中使用<span class="heti-skip"><span class="heti-spacing"> </span>rand::...<span class="heti-spacing"> </span></span>即可
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-88-1" id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="k">use</span><span class="w"> </span><span class="n">rand</span><span class="p">::</span><span class="n">Rng</span><span class="p">;</span><span class="w"> </span><span class="c1">// trait</span>
<a href="#__codelineno-88-2" id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-88-3" id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rand</span><span class="p">::</span><span class="n">thread_rng</span><span class="p">().</span><span class="n">gen_range</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">101</span><span class="p">);</span>
<a href="#__codelineno-88-4" id="__codelineno-88-4" name="__codelineno-88-4"></a><span class="p">}</span>
</code></pre></div></li>
</ol>
<p>可以在<a href="https://crates.io"><span class="heti-skip"><span class="heti-spacing"> </span>crates.io<span class="heti-spacing"> </span></span></a>或<a href="https://lib.rs"><span class="heti-skip"><span class="heti-spacing"> </span>lib.rs<span class="heti-spacing"> </span></span></a>中检索使用第三方包</p>
<h4 id="_51">受限可见性<a class="headerlink" href="#_51" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li><code class="highlight"><span class="k">pub</span></code> 表示无任何限制的完全可见</li>
<li><code class="highlight"><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span></code> 表示在当前包内可见</li>
<li><code class="highlight"><span class="k">pub</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code> 表示在当前模块中可见</li>
<li><code class="highlight"><span class="k">pub</span><span class="p">(</span><span class="k">super</span><span class="p">)</span></code> 表示在父模块中可见</li>
<li><code class="highlight"><span class="k">pub</span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span></code> 表示在<span class="heti-skip"><span class="heti-spacing"> </span>&lt;path&gt;<span class="heti-spacing"> </span></span>代表的模块中可见</li>
</ul>
<h4 id="_52">三种模块目录组织方式<a class="headerlink" href="#_52" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li>Rust 2015
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-89-1" id="__codelineno-89-1" name="__codelineno-89-1"></a>.
<a href="#__codelineno-89-2" id="__codelineno-89-2" name="__codelineno-89-2"></a>├── lib.rs
<a href="#__codelineno-89-3" id="__codelineno-89-3" name="__codelineno-89-3"></a>└── foo/
<a href="#__codelineno-89-4" id="__codelineno-89-4" name="__codelineno-89-4"></a>    ├── mod.rs
<a href="#__codelineno-89-5" id="__codelineno-89-5" name="__codelineno-89-5"></a>    └── bar.rs
</code></pre></div><ul>
<li><span>lib.rs<span class="heti-spacing"> </span></span>中<span class="heti-skip"><span class="heti-spacing"> </span>mod foo;<span class="heti-spacing"> </span></span>会引入<span class="heti-skip"><span class="heti-spacing"> </span>foo/mod.rs<span class="heti-spacing"> </span></span>中内容</li>
<li>需要在<span class="heti-skip"><span class="heti-spacing"> </span>foo/mod.rs<span class="heti-spacing"> </span></span>中继续为<span class="heti-skip"><span class="heti-spacing"> </span>bar.rs<span class="heti-spacing"> </span></span>创建同名<span><span class="heti-spacing"> </span>mod</span></li>
</ul>
</li>
<li>Rust 2018
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-90-1" id="__codelineno-90-1" name="__codelineno-90-1"></a>.
<a href="#__codelineno-90-2" id="__codelineno-90-2" name="__codelineno-90-2"></a>├── lib.rs
<a href="#__codelineno-90-3" id="__codelineno-90-3" name="__codelineno-90-3"></a>├── foo.rs
<a href="#__codelineno-90-4" id="__codelineno-90-4" name="__codelineno-90-4"></a>└── foo/
<a href="#__codelineno-90-5" id="__codelineno-90-5" name="__codelineno-90-5"></a>    └── bar.rs
</code></pre></div><ul>
<li><span>lib.rs<span class="heti-spacing"> </span></span>中<span class="heti-skip"><span class="heti-spacing"> </span>mod foo;<span class="heti-spacing"> </span></span>会引入<span><span class="heti-spacing"> </span>foo.rs</span></li>
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>foo.rs<span class="heti-spacing"> </span></span>中<span><span class="heti-spacing"> </span>mod bar;</span></li>
<li>与<span class="heti-skip"><span class="heti-spacing"> </span>2015<span class="heti-spacing"> </span></span>的模式相比就相当于将<span class="heti-skip"><span class="heti-spacing"> </span>mod.rs<span class="heti-spacing"> </span></span>提到文件夹外的同名文件了</li>
</ul>
</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>#[path = ...]<span class="heti-spacing"> </span></span>创建模块（慎用）
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-91-1" id="__codelineno-91-1" name="__codelineno-91-1"></a>.
<a href="#__codelineno-91-2" id="__codelineno-91-2" name="__codelineno-91-2"></a>├── lib.rs       
<a href="#__codelineno-91-3" id="__codelineno-91-3" name="__codelineno-91-3"></a>└── pkg/        // 任意
<a href="#__codelineno-91-4" id="__codelineno-91-4" name="__codelineno-91-4"></a>    ├── foo.rs
<a href="#__codelineno-91-5" id="__codelineno-91-5" name="__codelineno-91-5"></a>    └── bar.rs
</code></pre></div><ul>
<li><span>lib.rs<span class="heti-spacing"> </span></span>中在<span class="heti-skip"><span class="heti-spacing"> </span>mod foo;<span class="heti-spacing"> </span></span>前指定路径：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-92-1" id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="cp">#[path = </span><span class="s">"./pkg/foo.rs"</span><span class="cp">]</span>
<a href="#__codelineno-92-2" id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">foo</span><span class="p">;</span>
<a href="#__codelineno-92-3" id="__codelineno-92-3" name="__codelineno-92-3"></a>
<a href="#__codelineno-92-4" id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="cp">#[path = </span><span class="s">"./pkg/bar.rs"</span><span class="cp">]</span>
<a href="#__codelineno-92-5" id="__codelineno-92-5" name="__codelineno-92-5"></a><span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">bar</span><span class="p">;</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h2 id="_53">注释与文档<a class="headerlink" href="#_53" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>Rust<span class="heti-spacing"> </span></span>中注释分为两类：</p>
<ul>
<li>代码注释：说明某一段代码的作用（<span>//<span class="heti-spacing"> </span></span>行注释和<span class="heti-skip"><span class="heti-spacing"> </span>/* ... */<span class="heti-spacing"> </span></span>块注释）</li>
<li>文档注释：使用<span class="heti-skip"><span class="heti-spacing"> </span>markdown<span class="heti-spacing"> </span></span>语法，描述项目、介绍功能、生成文档<ul>
<li>包和模块注释：说明当前包和模块的功能</li>
</ul>
</li>
</ul>
<h3 id="_54">文档注释<a class="headerlink" href="#_54" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>文档行注释<span class="heti-skip"><span class="heti-spacing"> </span>///<span class="heti-spacing"> </span></span>与文档块注释<span><span class="heti-spacing"> </span>/** ... */</span><ul>
<li>文档注释需要位于库类型的<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>中</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>markdown<span class="heti-spacing"> </span></span>语法，以及代码块高亮显示</li>
<li>写在被注释类型上方</li>
<li>被注释的对象需要<span class="heti-skip"><span class="heti-spacing"> </span>pub<span class="heti-spacing"> </span></span>对外可见</li>
<li>文档注释中可以直接使用多个一级标题，常用的有<ul>
<li># Examples</li>
<li># Panics：描述函数可能会出现的<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>情况</li>
<li># Errors：描述可能会出现的错误以及触发情况</li>
<li># Safety：<span>unsafe<span class="heti-spacing"> </span></span>代码需要注意的使用条件</li>
</ul>
</li>
</ul>
</li>
<li>包<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>模块级别行注释<span class="heti-skip"><span class="heti-spacing"> </span>//!<span class="heti-spacing"> </span></span>与包<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>模块级别块注释<span><span class="heti-spacing"> </span>/*! ... */</span><ul>
<li>写在<span class="heti-skip"><span class="heti-spacing"> </span>crate root<span class="heti-spacing"> </span></span>的最上方</li>
</ul>
</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>cargo doc<span class="heti-spacing"> </span></span>构建文档，生成在<span class="heti-skip"><span class="heti-spacing"> </span>target/doc<span class="heti-spacing"> </span></span>目录下<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>cargo doc --open<span class="heti-spacing"> </span></span>构建并打开</li>
</ul>
</li>
<li>文档测试<ul>
<li>文档注释中的代码块可以用作测试，直接写<span class="heti-skip"><span class="heti-spacing"> </span>assert<span class="heti-spacing"> </span></span>等宏就可以</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>cargo test<span class="heti-spacing"> </span></span>会进行测试，并显示<span><span class="heti-spacing"> </span>"Doc-tests ..."</span></li>
<li>预期会造成<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>等代码块需要在代码块语言后加上<span><span class="heti-spacing"> </span>should_panic</span>：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-93-1" id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="sd">/// # Panics</span>
<a href="#__codelineno-93-2" id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="sd">/// </span>
<a href="#__codelineno-93-3" id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="sd">/// ```rust,should_panic</span>
<a href="#__codelineno-93-4" id="__codelineno-93-4" name="__codelineno-93-4"></a><span class="sd">/// ...</span>
<a href="#__codelineno-93-5" id="__codelineno-93-5" name="__codelineno-93-5"></a><span class="sd">/// ```</span>
</code></pre></div></li>
<li>仅测试，不显示在文档中的行开头加<span class="heti-skip"><span class="heti-spacing"> </span>#<span class="heti-spacing"> </span></span>就可以：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-94-1" id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="sd">/// ```</span>
<a href="#__codelineno-94-2" id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="sd">/// # fn try_main() -&gt; Result&lt;(), String&gt; {</span>
<a href="#__codelineno-94-3" id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="sd">/// let res = ...::func()?;</span>
<a href="#__codelineno-94-4" id="__codelineno-94-4" name="__codelineno-94-4"></a><span class="sd">/// #     Ok(())</span>
<a href="#__codelineno-94-5" id="__codelineno-94-5" name="__codelineno-94-5"></a><span class="sd">/// # }</span>
<a href="#__codelineno-94-6" id="__codelineno-94-6" name="__codelineno-94-6"></a><span class="sd">/// # fn main() {</span>
<a href="#__codelineno-94-7" id="__codelineno-94-7" name="__codelineno-94-7"></a><span class="sd">/// #     try_main().unwrap();</span>
<a href="#__codelineno-94-8" id="__codelineno-94-8" name="__codelineno-94-8"></a><span class="sd">/// # }</span>
</code></pre></div><ul>
<li>如上述例子，最终在文档中只会显示<span class="heti-skip"><span class="heti-spacing"> </span>let<span class="heti-spacing"> </span></span>那一行，但在进行<span class="heti-skip"><span class="heti-spacing"> </span>doc-test<span class="heti-spacing"> </span></span>时全部代码都会运行</li>
</ul>
</li>
</ul>
</li>
<li>代码跳转（自动链接）<ul>
<li>文档中写<span class="heti-skip"><span class="heti-spacing"> </span>[`Option`]<span class="heti-spacing"> </span></span>会在文档中创建一个指向标准库中<span class="heti-skip"><span class="heti-spacing"> </span>Option<span class="heti-spacing"> </span></span>类型的链接</li>
<li>也可以指定具体的路径来创建指向自己代码或其它库中指定项的链接</li>
<li>同名项可以标示类型：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-95-1" id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="sd">/// 跳转到结构体  [`Foo`](struct@Foo)</span>
<a href="#__codelineno-95-2" id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Bar</span><span class="p">;</span>
<a href="#__codelineno-95-3" id="__codelineno-95-3" name="__codelineno-95-3"></a>
<a href="#__codelineno-95-4" id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="sd">/// 跳转到同名函数 [`Foo`](fn@Foo)</span>
<a href="#__codelineno-95-5" id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-95-6" id="__codelineno-95-6" name="__codelineno-95-6"></a>
<a href="#__codelineno-95-7" id="__codelineno-95-7" name="__codelineno-95-7"></a><span class="sd">/// 跳转到同名宏 [`foo!`]</span>
<a href="#__codelineno-95-8" id="__codelineno-95-8" name="__codelineno-95-8"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-95-9" id="__codelineno-95-9" name="__codelineno-95-9"></a>
<a href="#__codelineno-95-10" id="__codelineno-95-10" name="__codelineno-95-10"></a><span class="cp">#[macro_export]</span>
<a href="#__codelineno-95-11" id="__codelineno-95-11" name="__codelineno-95-11"></a><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-95-12" id="__codelineno-95-12" name="__codelineno-95-12"></a><span class="w">  </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{}</span>
<a href="#__codelineno-95-13" id="__codelineno-95-13" name="__codelineno-95-13"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>文档搜索别名
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-96-1" id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="cp">#[doc(alias = </span><span class="s">"x"</span><span class="cp">)]</span>
<a href="#__codelineno-96-2" id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="cp">#[doc(alias = </span><span class="s">"big"</span><span class="cp">)]</span>
<a href="#__codelineno-96-3" id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">BigX</span><span class="p">;</span>
<a href="#__codelineno-96-4" id="__codelineno-96-4" name="__codelineno-96-4"></a>
<a href="#__codelineno-96-5" id="__codelineno-96-5" name="__codelineno-96-5"></a><span class="cp">#[doc(alias(</span><span class="s">"y"</span><span class="cp">, </span><span class="s">"big"</span><span class="cp">))]</span>
<a href="#__codelineno-96-6" id="__codelineno-96-6" name="__codelineno-96-6"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">BigY</span><span class="p">;</span>
</code></pre></div><ul>
<li>如上代码，在文档中搜索的时候，搜索<span class="heti-skip"><span class="heti-spacing"> </span>x<span class="heti-spacing"> </span></span>就会命中<span><span class="heti-spacing"> </span>BigX</span></li>
</ul>
</li>
</ul>
<h2 id="_55">格式化输出<a class="headerlink" href="#_55" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<p><span>Rust<span class="heti-spacing"> </span></span>的格式化就比较类似于<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>format<span class="heti-spacing"> </span></span>了</p>
<ul>
<li>格式化宏<ul>
<li>print!：格式化文本到标准输出，不换行</li>
<li>println!：格式化文本到标准输出，换行</li>
<li>format!：格式化文本，返回<span><span class="heti-spacing"> </span>String</span></li>
<li><span>eprint!<span class="heti-spacing"> </span></span>与<span><span class="heti-spacing"> </span>eprintln!</span>：格式化到标准错误输出</li>
</ul>
</li>
<li>占位符<ul>
<li><span>{}<span class="heti-spacing"> </span></span>适用于实现了<span class="heti-skip"><span class="heti-spacing"> </span>std::fmt::Display trait<span class="heti-spacing"> </span></span>的类型，用于展示给用户</li>
<li><span>{:?}<span class="heti-spacing"> </span></span>适用于实现了<span class="heti-skip"><span class="heti-spacing"> </span>std::fmt::Debug trait<span class="heti-spacing"> </span></span>的类型，用于调试</li>
<li><span>{:#?}<span class="heti-spacing"> </span></span>同上，不过显示更优美（自动换行一类）</li>
</ul>
</li>
<li>实现<span><span class="heti-spacing"> </span>Display trait</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-97-1" id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">;</span>
<a href="#__codelineno-97-2" id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-97-3" id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-97-4" id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="w">        </span><span class="fm">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">"...{}..."</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.)</span>
<a href="#__codelineno-97-5" id="__codelineno-97-5" name="__codelineno-97-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-97-6" id="__codelineno-97-6" name="__codelineno-97-6"></a><span class="p">}</span>
</code></pre></div><ul>
<li>只能为当前作用域中的类型实现<span><span class="heti-spacing"> </span>Display trait</span></li>
<li>为外部类型实现<span class="heti-skip"><span class="heti-spacing"> </span>Display<span class="heti-spacing"> </span></span>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>newtype<span class="heti-spacing"> </span></span>模式</li>
</ul>
</li>
<li>位置参数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-98-1" id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-98-2" id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}{}"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt;"12"</span>
<a href="#__codelineno-98-3" id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{1}{0}"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt;"21"</span>
<a href="#__codelineno-98-4" id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="w">    </span><span class="c1">// =&gt; Alice, this is Bob. Bob, this is Alice</span>
<a href="#__codelineno-98-5" id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{0}, this is {1}. {1}, this is {0}"</span><span class="p">,</span><span class="w"> </span><span class="s">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="s">"Bob"</span><span class="p">);</span>
<a href="#__codelineno-98-6" id="__codelineno-98-6" name="__codelineno-98-6"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{1}{}{0}{}"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; 2112</span>
<a href="#__codelineno-98-7" id="__codelineno-98-7" name="__codelineno-98-7"></a><span class="p">}</span>
</code></pre></div><ul>
<li>对于<span class="heti-skip"><span class="heti-spacing"> </span>{:?}<span class="heti-spacing"> </span></span>或<span><span class="heti-spacing"> </span>{:#?}</span>，将位置参数加在冒号前就可以</li>
</ul>
</li>
<li>具名参数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-99-1" id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-99-2" id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{argument}"</span><span class="p">,</span><span class="w"> </span><span class="n">argument</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"test"</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; "test"</span>
<a href="#__codelineno-99-3" id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{name} {}"</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; "2 1"</span>
<a href="#__codelineno-99-4" id="__codelineno-99-4" name="__codelineno-99-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{a} {c} {b}"</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"a"</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'b'</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; "a 3 b"</span>
<a href="#__codelineno-99-5" id="__codelineno-99-5" name="__codelineno-99-5"></a><span class="p">}</span>
</code></pre></div><ul>
<li>带名称的参数只能放在不带名称的后面</li>
</ul>
</li>
<li>格式化参数<ul>
<li>宽度填充<ul>
<li>字符串
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-100-1" id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="c1">//-----------------------------------</span>
<a href="#__codelineno-100-2" id="__codelineno-100-2" name="__codelineno-100-2"></a><span class="c1">// 以下全部输出 "Hello x    !"</span>
<a href="#__codelineno-100-3" id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="c1">// 为"x"后面填充空格，补齐宽度5</span>
<a href="#__codelineno-100-4" id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:5}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">);</span>
<a href="#__codelineno-100-5" id="__codelineno-100-5" name="__codelineno-100-5"></a><span class="c1">// 使用参数5来指定宽度</span>
<a href="#__codelineno-100-6" id="__codelineno-100-6" name="__codelineno-100-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:1$}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a href="#__codelineno-100-7" id="__codelineno-100-7" name="__codelineno-100-7"></a><span class="c1">// 使用x作为占位符输出内容，同时使用5作为宽度</span>
<a href="#__codelineno-100-8" id="__codelineno-100-8" name="__codelineno-100-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {1:0$}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">);</span>
<a href="#__codelineno-100-9" id="__codelineno-100-9" name="__codelineno-100-9"></a><span class="c1">// 使用有名称的参数作为宽度</span>
<a href="#__codelineno-100-10" id="__codelineno-100-10" name="__codelineno-100-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:width$}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a href="#__codelineno-100-11" id="__codelineno-100-11" name="__codelineno-100-11"></a><span class="c1">//-----------------------------------</span>
<a href="#__codelineno-100-12" id="__codelineno-100-12" name="__codelineno-100-12"></a>
<a href="#__codelineno-100-13" id="__codelineno-100-13" name="__codelineno-100-13"></a><span class="c1">// 使用参数5为参数x指定宽度，同时在结尾输出参数5 =&gt; Hello x    !5</span>
<a href="#__codelineno-100-14" id="__codelineno-100-14" name="__codelineno-100-14"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:1$}!{}"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</code></pre></div></li>
<li>数字
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-101-1" id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="c1">// 宽度是5 =&gt; Hello     5!</span>
<a href="#__codelineno-101-2" id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:5}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a href="#__codelineno-101-3" id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="c1">// 显式的输出正号 =&gt; Hello +5!</span>
<a href="#__codelineno-101-4" id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:+}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a href="#__codelineno-101-5" id="__codelineno-101-5" name="__codelineno-101-5"></a><span class="c1">// 宽度5，使用0进行填充 =&gt; Hello 00005!</span>
<a href="#__codelineno-101-6" id="__codelineno-101-6" name="__codelineno-101-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:05}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a href="#__codelineno-101-7" id="__codelineno-101-7" name="__codelineno-101-7"></a><span class="c1">// 负号也要占用一位宽度 =&gt; Hello -0005!</span>
<a href="#__codelineno-101-8" id="__codelineno-101-8" name="__codelineno-101-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:05}!"</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span><span class="p">);</span>
</code></pre></div></li>
<li>对齐
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-102-1" id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="c1">// 以下全部都会补齐5个字符的长度</span>
<a href="#__codelineno-102-2" id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="c1">// 左对齐 =&gt; Hello x    !</span>
<a href="#__codelineno-102-3" id="__codelineno-102-3" name="__codelineno-102-3"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:&lt;5}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">);</span>
<a href="#__codelineno-102-4" id="__codelineno-102-4" name="__codelineno-102-4"></a><span class="c1">// 右对齐 =&gt; Hello     x!</span>
<a href="#__codelineno-102-5" id="__codelineno-102-5" name="__codelineno-102-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:&gt;5}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">);</span>
<a href="#__codelineno-102-6" id="__codelineno-102-6" name="__codelineno-102-6"></a><span class="c1">// 居中对齐 =&gt; Hello   x  !</span>
<a href="#__codelineno-102-7" id="__codelineno-102-7" name="__codelineno-102-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:^5}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">);</span>
<a href="#__codelineno-102-8" id="__codelineno-102-8" name="__codelineno-102-8"></a>
<a href="#__codelineno-102-9" id="__codelineno-102-9" name="__codelineno-102-9"></a><span class="c1">// 对齐并使用指定符号填充 =&gt; Hello x&amp;&amp;&amp;&amp;!</span>
<a href="#__codelineno-102-10" id="__codelineno-102-10" name="__codelineno-102-10"></a><span class="c1">// 指定符号填充的前提条件是必须有对齐字符</span>
<a href="#__codelineno-102-11" id="__codelineno-102-11" name="__codelineno-102-11"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:&amp;&lt;5}!"</span><span class="p">,</span><span class="w"> </span><span class="s">"x"</span><span class="p">);</span>
</code></pre></div></li>
</ul>
</li>
<li>精度
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-103-1" id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.1415926</span><span class="p">;</span>
<a href="#__codelineno-103-2" id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="c1">// 保留小数点后两位 =&gt; 3.14</span>
<a href="#__codelineno-103-3" id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:.2}"</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<a href="#__codelineno-103-4" id="__codelineno-103-4" name="__codelineno-103-4"></a><span class="c1">// 带符号保留小数点后两位 =&gt; +3.14</span>
<a href="#__codelineno-103-5" id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:+.2}"</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<a href="#__codelineno-103-6" id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="c1">// 不带小数 =&gt; 3</span>
<a href="#__codelineno-103-7" id="__codelineno-103-7" name="__codelineno-103-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:.0}"</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">);</span>
<a href="#__codelineno-103-8" id="__codelineno-103-8" name="__codelineno-103-8"></a><span class="c1">// 通过参数来设定精度 =&gt; 3.1416，相当于{:.4}</span>
<a href="#__codelineno-103-9" id="__codelineno-103-9" name="__codelineno-103-9"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:.1$}"</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a href="#__codelineno-103-10" id="__codelineno-103-10" name="__codelineno-103-10"></a>
<a href="#__codelineno-103-11" id="__codelineno-103-11" name="__codelineno-103-11"></a><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"abcded"</span><span class="p">;</span>
<a href="#__codelineno-103-12" id="__codelineno-103-12" name="__codelineno-103-12"></a><span class="c1">// 保留字符串前三个字符 =&gt; abc</span>
<a href="#__codelineno-103-13" id="__codelineno-103-13" name="__codelineno-103-13"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:.3}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
<a href="#__codelineno-103-14" id="__codelineno-103-14" name="__codelineno-103-14"></a><span class="c1">// {:.*}接收两个参数，第一个是精度，第二个是被格式化的值 =&gt; Hello abc!</span>
<a href="#__codelineno-103-15" id="__codelineno-103-15" name="__codelineno-103-15"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello {:.*}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">"abcdefg"</span><span class="p">);</span>
</code></pre></div></li>
<li>进制
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-104-1" id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="c1">// 二进制 =&gt; 0b11011!</span>
<a href="#__codelineno-104-2" id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:#b}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
<a href="#__codelineno-104-3" id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="c1">// 八进制 =&gt; 0o33!</span>
<a href="#__codelineno-104-4" id="__codelineno-104-4" name="__codelineno-104-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:#o}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
<a href="#__codelineno-104-5" id="__codelineno-104-5" name="__codelineno-104-5"></a><span class="c1">// 十进制 =&gt; 27!</span>
<a href="#__codelineno-104-6" id="__codelineno-104-6" name="__codelineno-104-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
<a href="#__codelineno-104-7" id="__codelineno-104-7" name="__codelineno-104-7"></a><span class="c1">// 小写十六进制 =&gt; 0x1b!</span>
<a href="#__codelineno-104-8" id="__codelineno-104-8" name="__codelineno-104-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:#x}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
<a href="#__codelineno-104-9" id="__codelineno-104-9" name="__codelineno-104-9"></a><span class="c1">// 大写十六进制 =&gt; 0x1B!</span>
<a href="#__codelineno-104-10" id="__codelineno-104-10" name="__codelineno-104-10"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:#X}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
<a href="#__codelineno-104-11" id="__codelineno-104-11" name="__codelineno-104-11"></a>
<a href="#__codelineno-104-12" id="__codelineno-104-12" name="__codelineno-104-12"></a><span class="c1">// 不带前缀的十六进制 =&gt; 1b!</span>
<a href="#__codelineno-104-13" id="__codelineno-104-13" name="__codelineno-104-13"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:x}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
<a href="#__codelineno-104-14" id="__codelineno-104-14" name="__codelineno-104-14"></a>
<a href="#__codelineno-104-15" id="__codelineno-104-15" name="__codelineno-104-15"></a><span class="c1">// 使用0填充二进制，宽度为10 =&gt; 0b00011011!</span>
<a href="#__codelineno-104-16" id="__codelineno-104-16" name="__codelineno-104-16"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:#010b}!"</span><span class="p">,</span><span class="w"> </span><span class="mi">27</span><span class="p">);</span>
</code></pre></div></li>
<li>指数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-105-1" id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:2e}"</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000000</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; 1e9</span>
<a href="#__codelineno-105-2" id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:2E}"</span><span class="p">,</span><span class="w"> </span><span class="mi">1000000000</span><span class="p">);</span><span class="w"> </span><span class="c1">// =&gt; 1E9</span>
</code></pre></div></li>
<li>指针地址
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-106-1" id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<a href="#__codelineno-106-2" id="__codelineno-106-2" name="__codelineno-106-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:p}"</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">as_ptr</span><span class="p">())</span><span class="w"> </span><span class="c1">// =&gt; 0x600002324050</span>
</code></pre></div></li>
<li>输出<span class="heti-skip"><span class="heti-spacing"> </span>{<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>}<span class="heti-spacing"> </span></span>要写两次进行转义</li>
</ul>
</li>
<li><span>1.58<span class="heti-spacing"> </span></span>中新增捕获环境值<ul>
<li>类似<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>中的<span><span class="heti-spacing"> </span>f-string</span>，不过不需要特殊标注</li>
<li>捕获变量可以替换在任何位置
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-107-1" id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">precision</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_format</span><span class="p">();</span>
<a href="#__codelineno-107-2" id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">get_scores</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-107-3" id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{name}: {score:width$.precision$}"</span><span class="p">);</span>
<a href="#__codelineno-107-4" id="__codelineno-107-4" name="__codelineno-107-4"></a><span class="p">}</span>
</code></pre></div></li>
<li><span>panic!<span class="heti-spacing"> </span></span>在<span class="heti-skip"><span class="heti-spacing"> </span>2021<span class="heti-spacing"> </span></span>版本下才可以这样使用</li>
</ul>
</li>
</ul>
<h2 id="_56">生命周期<a class="headerlink" href="#_56" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>存在多个引用时，编译器有时会无法自动推导生命周期，需要手动标注</li>
<li>生命周期是为编译器而标注，并不会改变任何引用的实际作用域</li>
<li>生命周期以<span class="heti-skip"><span class="heti-spacing"> </span>'<span class="heti-spacing"> </span></span>开头，名称往往是单独的小写字母（如 <code class="highlight"><span class="o">'</span><span class="na">a</span></code>）
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-108-1" id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="o">&amp;</span><span class="kt">i32</span><span class="w">        </span><span class="c1">// i32 类型的引用</span>
<a href="#__codelineno-108-2" id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="kt">i32</span><span class="w">     </span><span class="c1">// 带有显示生命周期 'a 的 i32 引用</span>
<a href="#__codelineno-108-3" id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="c1">// 带有显示生命周期 'a 的 i32 可变引用</span>
</code></pre></div></li>
<li>函数签名中使用生命周期需要先像泛型一样声明
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-109-1" id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div><ul>
<li>表示两个参数以及返回引用至少和<span class="heti-skip"><span class="heti-spacing"> </span>'a<span class="heti-spacing"> </span></span>活得一样久</li>
<li>两个参数的真实生命周期可能是不一样的，只需要不小于<span class="heti-skip"><span class="heti-spacing"> </span>'a<span class="heti-spacing"> </span></span>就可以</li>
<li>调用的时候不必标注生命周期</li>
</ul>
</li>
<li>生命周期语法用来将函数的多个引用参数和返回值的作用域关联到一起，避免了悬垂引用<ul>
<li>返回值是引用时，其生命周期只能来自参数，来自函数体内部的话就是悬垂引用</li>
</ul>
</li>
<li>结构体中生命周期<ul>
<li>结构体中使用生命周期可以保证内部引用类型的参数活得比结构体本身长
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-110-1" id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyStruct</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-110-2" id="__codelineno-110-2" name="__codelineno-110-2"></a><span class="w">    </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span>
<a href="#__codelineno-110-3" id="__codelineno-110-3" name="__codelineno-110-3"></a><span class="p">}</span>
</code></pre></div></li>
<li>如下例即是结构体获得比内部参数长，会报错：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-111-1" id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a href="#__codelineno-111-2" id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="p">{</span>
<a href="#__codelineno-111-3" id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
<a href="#__codelineno-111-4" id="__codelineno-111-4" name="__codelineno-111-4"></a><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyStruct</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-111-5" id="__codelineno-111-5" name="__codelineno-111-5"></a><span class="w">        </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="nc">string</span><span class="p">.</span><span class="n">as_str</span><span class="p">()</span>
<a href="#__codelineno-111-6" id="__codelineno-111-6" name="__codelineno-111-6"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-111-7" id="__codelineno-111-7" name="__codelineno-111-7"></a><span class="p">}</span>
<a href="#__codelineno-111-8" id="__codelineno-111-8" name="__codelineno-111-8"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</code></pre></div></li>
</ul>
</li>
<li>生命周期消除<ul>
<li>有时编译器可以自动推测生命周期，不需要显示标注</li>
<li>消除规则（推测规则）<ul>
<li>默认情况下每一个引用参数都会获得一个独自的生命周期</li>
<li>如果只有一个输入生命周期（参数的生命周期，即只有一个引用类型参数<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，则该生命周期会被赋给所有输出生命周期</li>
<li>如果存在多个输入生命周期，但其中一个是 <code class="highlight"><span class="o">&amp;</span><span class="bp">self</span></code> 或 <code class="highlight"><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span></code>，则<span class="heti-skip"><span class="heti-spacing"> </span>self<span class="heti-spacing"> </span></span>的生命周期会被赋给所有输出生命周期</li>
</ul>
</li>
<li>闭包不会遵循这个规则</li>
<li><span>impl<span class="heti-spacing"> </span></span>块生命周期消除（即省略）<ul>
<li><span>impl<span class="heti-spacing"> </span></span>块中没有用到的生命周期可以使用<span class="heti-skip"><span class="heti-spacing"> </span>'_<span class="heti-spacing"> </span></span>来进行省略：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-112-1" id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
<a href="#__codelineno-112-2" id="__codelineno-112-2" name="__codelineno-112-2"></a><span class="k">impl</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="o">&lt;'</span><span class="nb">_</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>为带有生命周期的结构体实现方法<ul>
<li>需要像泛型一样为<span class="heti-skip"><span class="heti-spacing"> </span>impl<span class="heti-spacing"> </span></span>和结构体名都标注上生命周期
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-113-1" id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-113-2" id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">another_str</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-113-3" id="__codelineno-113-3" name="__codelineno-113-3"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">another_str</span><span class="p">);</span>
<a href="#__codelineno-113-4" id="__codelineno-113-4" name="__codelineno-113-4"></a><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">string</span>
<a href="#__codelineno-113-5" id="__codelineno-113-5" name="__codelineno-113-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-113-6" id="__codelineno-113-6" name="__codelineno-113-6"></a><span class="p">}</span>
</code></pre></div><ul>
<li>上面例子中可以不为<span class="heti-skip"><span class="heti-spacing"> </span>method<span class="heti-spacing"> </span></span>标注生命周期，因为根据上面消除规则的第一和第三条，会自动推测为返回值标上和 <code class="highlight"><span class="o">&amp;</span><span class="bp">self</span></code> 一样的生命周期</li>
</ul>
</li>
</ul>
</li>
<li>生命周期约束<ul>
<li>如想要为上面<span class="heti-skip"><span class="heti-spacing"> </span>method<span class="heti-spacing"> </span></span>的返回值赋上和<span class="heti-skip"><span class="heti-spacing"> </span>another_str<span class="heti-spacing"> </span></span>一样的生命周期，则需要保证这个生命周期要比<span class="heti-skip"><span class="heti-spacing"> </span>self<span class="heti-spacing"> </span></span>的生命周期小，使用 <code class="highlight"><span class="o">'</span><span class="na">a</span><span class="p">:</span><span class="w"> </span><span class="o">'</span><span class="na">b</span></code> 语法来表示<span class="heti-skip"><span class="heti-spacing"> </span>'a<span class="heti-spacing"> </span></span>一定不小于<span><span class="heti-spacing"> </span>'b</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-114-1" id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">:</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="p">,</span><span class="w"> </span><span class="o">'</span><span class="na">b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-114-2" id="__codelineno-114-2" name="__codelineno-114-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">method</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">another</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-114-3" id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">another</span><span class="p">);</span>
<a href="#__codelineno-114-4" id="__codelineno-114-4" name="__codelineno-114-4"></a><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">string</span>
<a href="#__codelineno-114-5" id="__codelineno-114-5" name="__codelineno-114-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-114-6" id="__codelineno-114-6" name="__codelineno-114-6"></a><span class="p">}</span>
</code></pre></div><ul>
<li>或者使用<span class="heti-skip"><span class="heti-spacing"> </span>where<span class="heti-spacing"> </span></span>来单独对一个方法进行约束：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-115-1" id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="k">impl</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyStruct</span><span class="o">&lt;'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-115-2" id="__codelineno-115-2" name="__codelineno-115-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">method</span><span class="o">&lt;'</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">another</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">b</span><span class="w"> </span><span class="kt">str</span>
<a href="#__codelineno-115-3" id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="w">        </span><span class="nc">where</span><span class="w"> </span><span class="o">'</span><span class="na">a</span><span class="p">:</span><span class="w"> </span><span class="o">'</span><span class="na">b</span>
<a href="#__codelineno-115-4" id="__codelineno-115-4" name="__codelineno-115-4"></a><span class="w">    </span><span class="p">{</span>
<a href="#__codelineno-115-5" id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">another</span><span class="p">);</span>
<a href="#__codelineno-115-6" id="__codelineno-115-6" name="__codelineno-115-6"></a><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">string</span>
<a href="#__codelineno-115-7" id="__codelineno-115-7" name="__codelineno-115-7"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-115-8" id="__codelineno-115-8" name="__codelineno-115-8"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li><span>T: 'a<span class="heti-spacing"> </span></span>表示类型<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>必须获得比<span class="heti-skip"><span class="heti-spacing"> </span>'a<span class="heti-spacing"> </span></span>久：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-116-1" id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Ref</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">'</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-116-2" id="__codelineno-116-2" name="__codelineno-116-2"></a><span class="w">    </span><span class="n">r</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="na">a</span><span class="w"> </span><span class="nc">T</span>
<a href="#__codelineno-116-3" id="__codelineno-116-3" name="__codelineno-116-3"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>静态生命周期<ul>
<li>和整个程序活得一样久的引用可以使用<span class="heti-skip"><span class="heti-spacing"> </span>'static<span class="heti-spacing"> </span></span>来标注（例如字符串字面量）</li>
<li><span>&amp;'static<span class="heti-spacing"> </span></span>仅针对引用，而不是持有该引用的变量</li>
<li>取悦编译器可以使用<span><span class="heti-spacing"> </span>T: 'static</span>，即使<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>不是<span class="heti-skip"><span class="heti-spacing"> </span>static<span class="heti-spacing"> </span></span>的
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-117-1" id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">static_bound</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">Display</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="nb">static</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-117-2" id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<a href="#__codelineno-117-3" id="__codelineno-117-3" name="__codelineno-117-3"></a><span class="p">}</span>
<a href="#__codelineno-117-4" id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-117-5" id="__codelineno-117-5" name="__codelineno-117-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"String"</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span>
<a href="#__codelineno-117-6" id="__codelineno-117-6" name="__codelineno-117-6"></a><span class="w">    </span><span class="n">static_bound</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s1</span><span class="p">);</span>
<a href="#__codelineno-117-7" id="__codelineno-117-7" name="__codelineno-117-7"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>NLL（Non-Lexical Lifetime）规则<ul>
<li><span>Rust 1.31<span class="heti-spacing"> </span></span>后引用的生命周期从借用处开始一直持续到 <strong>最后一次使用的地方</strong></li>
</ul>
</li>
<li><span>Reborrow<span class="heti-spacing"> </span></span>再借用
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-118-1" id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>
<a href="#__codelineno-118-2" id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a href="#__codelineno-118-3" id="__codelineno-118-3" name="__codelineno-118-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">rr</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;*</span><span class="n">r</span><span class="p">;</span>
<a href="#__codelineno-118-4" id="__codelineno-118-4" name="__codelineno-118-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">rr</span><span class="p">);</span>
<a href="#__codelineno-118-5" id="__codelineno-118-5" name="__codelineno-118-5"></a><span class="n">r</span><span class="p">.</span><span class="n">move_to</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<a href="#__codelineno-118-6" id="__codelineno-118-6" name="__codelineno-118-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
</code></pre></div><ul>
<li>可变借用和不可变的它的再借用可以同时存在，但是不能在再借用的生命周期内使用可变借用。也就是上面例子中在<span class="heti-skip"><span class="heti-spacing"> </span>rr<span class="heti-spacing"> </span></span>的生命周期内不能使用<span><span class="heti-spacing"> </span>r</span>（<span>rr<span class="heti-spacing"> </span></span>的生命周期由于<span class="heti-skip"><span class="heti-spacing"> </span>NLL<span class="heti-spacing"> </span></span>规则，到第一个<span class="heti-skip"><span class="heti-spacing"> </span>println!<span class="heti-spacing"> </span></span>的时候就已经结束了，后面可以继续使用<span><span class="heti-spacing"> </span>r</span>）</li>
</ul>
</li>
</ul>
<h2 id="_57">闭包和迭代器<a class="headerlink" href="#_57" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_58">闭包<a class="headerlink" href="#_58" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>一种匿名函数，可以赋值给变量也可以作为参数传递给函数，但可以捕获调用者作用域中的值
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-119-1" id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-119-2" id="__codelineno-119-2" name="__codelineno-119-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">y</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a href="#__codelineno-119-3" id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</code></pre></div></li>
<li>闭包语法：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-120-1" id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="o">|</span><span class="n">para1</span><span class="p">,</span><span class="w"> </span><span class="n">para2</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-120-2" id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="w">    </span><span class="n">statement1</span><span class="p">;</span>
<a href="#__codelineno-120-3" id="__codelineno-120-3" name="__codelineno-120-3"></a><span class="w">    </span><span class="n">statement2</span><span class="p">;</span>
<a href="#__codelineno-120-4" id="__codelineno-120-4" name="__codelineno-120-4"></a><span class="w">    </span><span class="n">expression</span>
<a href="#__codelineno-120-5" id="__codelineno-120-5" name="__codelineno-120-5"></a><span class="p">}</span>
<a href="#__codelineno-120-6" id="__codelineno-120-6" name="__codelineno-120-6"></a><span class="o">|</span><span class="n">para1</span><span class="p">,</span><span class="w"> </span><span class="n">para2</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="o">|</span><span class="w"> </span><span class="n">expression</span>
</code></pre></div></li>
<li>类型推导<ul>
<li>闭包不会作为<span class="heti-skip"><span class="heti-spacing"> </span>api<span class="heti-spacing"> </span></span>对外提供，可以直接依靠编译器的类型推导能力，无需手动标注
    ```rust
    let sum = |x, y| x + y;
    let v = sum(1, 2) // 编译器通过这句推导出类型
    ````</li>
<li>但当闭包只声明没有使用时，编译器并不能推导出类型，需要手动标注</li>
<li>当编译器推导出一种类型之后，就会一直使用该类型，而不能将闭包当作泛型使用</li>
</ul>
</li>
<li>结构体中存储闭包
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-121-1" id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Cacher</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span>
<a href="#__codelineno-121-2" id="__codelineno-121-2" name="__codelineno-121-2"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nb">Fn</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">E</span><span class="p">,</span>
<a href="#__codelineno-121-3" id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="w">          </span><span class="n">E</span><span class="p">:</span><span class="w"> </span><span class="nb">Copy</span>
<a href="#__codelineno-121-4" id="__codelineno-121-4" name="__codelineno-121-4"></a><span class="p">{</span>
<a href="#__codelineno-121-5" id="__codelineno-121-5" name="__codelineno-121-5"></a><span class="w">    </span><span class="n">query</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<a href="#__codelineno-121-6" id="__codelineno-121-6" name="__codelineno-121-6"></a><span class="w">    </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">,</span>
<a href="#__codelineno-121-7" id="__codelineno-121-7" name="__codelineno-121-7"></a><span class="p">}</span>
</code></pre></div><ul>
<li>闭包类型一定要通过泛型来定义，因为不同实现的类型都是不一样的，要求仅仅是实现<span class="heti-skip"><span class="heti-spacing"> </span>Fn(E) -&gt; E<span class="heti-spacing"> </span></span>这个<span><span class="heti-spacing"> </span>trait</span>，即输入<span class="heti-skip"><span class="heti-spacing"> </span>E<span class="heti-spacing"> </span></span>返回<span><span class="heti-spacing"> </span>E</span></li>
</ul>
</li>
<li>三种<span><span class="heti-spacing"> </span>Fn trait</span><ul>
<li>FnOnce：只能运行一次（会带走被捕获变量的所有权）<ul>
<li>带走所有权的例子：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-122-1" id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
<a href="#__codelineno-122-2" id="__codelineno-122-2" name="__codelineno-122-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">y</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a href="#__codelineno-122-3" id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="s">"test"</span><span class="p">));</span>
<a href="#__codelineno-122-4" id="__codelineno-122-4" name="__codelineno-122-4"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// 报错，因为所有权进入了闭包中    </span>
</code></pre></div></li>
<li>仅实现了<span class="heti-skip"><span class="heti-spacing"> </span>FnOnce<span class="heti-spacing"> </span></span>的闭包在调用时会转移所有权，不能调用两次：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-123-1" id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">fn_once</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">func</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">)</span>
<a href="#__codelineno-123-2" id="__codelineno-123-2" name="__codelineno-123-2"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">F</span><span class="p">:</span><span class="w"> </span><span class="nb">FnOnce</span><span class="p">(</span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">bool</span>
<a href="#__codelineno-123-3" id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="p">{</span>
<a href="#__codelineno-123-4" id="__codelineno-123-4" name="__codelineno-123-4"></a><span class="w">    </span><span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-123-5" id="__codelineno-123-5" name="__codelineno-123-5"></a><span class="w">    </span><span class="n">func</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// 报错</span>
<a href="#__codelineno-123-6" id="__codelineno-123-6" name="__codelineno-123-6"></a><span class="p">}</span>
</code></pre></div><ul>
<li>但是给<span class="heti-skip"><span class="heti-spacing"> </span>F<span class="heti-spacing"> </span></span>加一个<span class="heti-skip"><span class="heti-spacing"> </span>Copy<span class="heti-spacing"> </span></span>的约束则可以调用多次</li>
</ul>
</li>
<li>在参数列表前加<span class="heti-skip"><span class="heti-spacing"> </span>move<span class="heti-spacing"> </span></span>关键字强制闭包获取捕获变量的所有权（聚焦于如何捕获变量）</li>
</ul>
</li>
<li>FnMut：以可变借用方式捕获环境中的值<ul>
<li>直接调用时需要将闭包标记为<span><span class="heti-spacing"> </span>mut</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-124-1" id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-124-2" id="__codelineno-124-2" name="__codelineno-124-2"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">update_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">st</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="n">st</span><span class="p">);</span>
<a href="#__codelineno-124-3" id="__codelineno-124-3" name="__codelineno-124-3"></a><span class="n">update_string</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
</code></pre></div></li>
<li>当作变量时不需要标记为<span><span class="heti-spacing"> </span>mut</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-125-1" id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">exec</span><span class="o">&lt;'</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">:</span><span class="w"> </span><span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;'</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="nc">F</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 这里需要 mut</span>
<a href="#__codelineno-125-2" id="__codelineno-125-2" name="__codelineno-125-2"></a><span class="w">    </span><span class="n">f</span><span class="p">(</span><span class="s">"test"</span><span class="p">);</span>
<a href="#__codelineno-125-3" id="__codelineno-125-3" name="__codelineno-125-3"></a><span class="p">}</span>
<a href="#__codelineno-125-4" id="__codelineno-125-4" name="__codelineno-125-4"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-125-5" id="__codelineno-125-5" name="__codelineno-125-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-125-6" id="__codelineno-125-6" name="__codelineno-125-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">update_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">st</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="n">st</span><span class="p">);</span><span class="w"> </span><span class="c1">// 这里不需要 mut</span>
<a href="#__codelineno-125-7" id="__codelineno-125-7" name="__codelineno-125-7"></a><span class="w">    </span><span class="n">exec</span><span class="p">(</span><span class="n">update_string</span><span class="p">);</span>
<a href="#__codelineno-125-8" id="__codelineno-125-8" name="__codelineno-125-8"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>Fn：以不可变借用的方式捕获环境中的值</li>
<li>一个闭包实现了哪种<span class="heti-skip"><span class="heti-spacing"> </span>Fn trait<span class="heti-spacing"> </span></span>取决于该闭包<strong>如何使用</strong>被捕获的变量，而不是如何捕获。而<span class="heti-skip"><span class="heti-spacing"> </span>move<span class="heti-spacing"> </span></span>则关注于如何捕获，有<span class="heti-skip"><span class="heti-spacing"> </span>move<span class="heti-spacing"> </span></span>则强制获取所有权<ul>
<li>使用了<span class="heti-skip"><span class="heti-spacing"> </span>move<span class="heti-spacing"> </span></span>关键字仍然可以实现<span><span class="heti-spacing"> </span>Fn trait</span>（当闭包对于捕获变量的使用仅仅是不可变借用时）</li>
</ul>
</li>
<li>三种<span class="heti-skip"><span class="heti-spacing"> </span>Fn<span class="heti-spacing"> </span></span>的关系
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-126-1" id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Fn</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-126-2" id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="w">    </span><span class="k">extern</span><span class="w"> </span><span class="s">"rust-call"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">call</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Args</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">;</span>
<a href="#__codelineno-126-3" id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="p">}</span>
<a href="#__codelineno-126-4" id="__codelineno-126-4" name="__codelineno-126-4"></a>
<a href="#__codelineno-126-5" id="__codelineno-126-5" name="__codelineno-126-5"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-126-6" id="__codelineno-126-6" name="__codelineno-126-6"></a><span class="w">    </span><span class="k">extern</span><span class="w"> </span><span class="s">"rust-call"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">call_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Args</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">;</span>
<a href="#__codelineno-126-7" id="__codelineno-126-7" name="__codelineno-126-7"></a><span class="p">}</span>
<a href="#__codelineno-126-8" id="__codelineno-126-8" name="__codelineno-126-8"></a>
<a href="#__codelineno-126-9" id="__codelineno-126-9" name="__codelineno-126-9"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-126-10" id="__codelineno-126-10" name="__codelineno-126-10"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Output</span><span class="p">;</span>
<a href="#__codelineno-126-11" id="__codelineno-126-11" name="__codelineno-126-11"></a><span class="w">    </span><span class="k">extern</span><span class="w"> </span><span class="s">"rust-call"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">call_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="nc">Args</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="p">::</span><span class="n">Output</span><span class="p">;</span>
<a href="#__codelineno-126-12" id="__codelineno-126-12" name="__codelineno-126-12"></a><span class="p">}</span>
</code></pre></div><ul>
<li>所有闭包都会实现<span><span class="heti-spacing"> </span>FnOnce trait</span>，因为至少可以被调用一次</li>
<li>没有移出捕获变量所有权的闭包自动实现<span><span class="heti-spacing"> </span>FnMut trait</span></li>
<li>不需要对捕获变量进行改变的闭包自动实现<span><span class="heti-spacing"> </span>Fn trait</span></li>
<li>实现<span class="heti-skip"><span class="heti-spacing"> </span>Fn<span class="heti-spacing"> </span></span>的前提是实现<span><span class="heti-spacing"> </span>FnMut</span>，实现<span class="heti-skip"><span class="heti-spacing"> </span>FnMut<span class="heti-spacing"> </span></span>的前提是实现<span><span class="heti-spacing"> </span>FnOnce</span></li>
<li><span>Fn<span class="heti-spacing"> </span></span>获取<span><span class="heti-spacing"> </span>&amp;self</span>、<span>FnMut<span class="heti-spacing"> </span></span>获取<span><span class="heti-spacing"> </span>&amp;mut self</span>、<span>FnOnce<span class="heti-spacing"> </span></span>获取<span><span class="heti-spacing"> </span>self</span></li>
<li>建议先使用<span><span class="heti-spacing"> </span>Fn</span>，然后靠编译器来判断正误以及如何选择</li>
</ul>
</li>
</ul>
</li>
<li>闭包作为返回值<ul>
<li>不能使用<span class="heti-skip"><span class="heti-spacing"> </span>Fn(...) -&gt; ...<span class="heti-spacing"> </span></span>作为返回值，因为它是特征，没有固定内存大小</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>impl Fn(...) -&gt; ...<span class="heti-spacing"> </span></span>作为返回值</li>
<li>可以使用特征对象，即<span class="heti-skip"><span class="heti-spacing"> </span>Box&lt;dyn Fn(...) -&gt; ...&gt;<span class="heti-spacing"> </span></span>的形式</li>
</ul>
</li>
</ul>
<h3 id="_59">迭代器<a class="headerlink" href="#_59" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>for<span class="heti-spacing"> </span></span>循环遍历数组实际上是在数组上调用了<span class="heti-skip"><span class="heti-spacing"> </span>into_iter<span class="heti-spacing"> </span></span>方法（来自<span><span class="heti-spacing"> </span>IntoIterator trait</span>）</li>
<li>Iterator trait
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-127-1" id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Iterator</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-127-2" id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Item</span><span class="p">;</span>
<a href="#__codelineno-127-3" id="__codelineno-127-3" name="__codelineno-127-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">::</span><span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span>
<a href="#__codelineno-127-4" id="__codelineno-127-4" name="__codelineno-127-4"></a><span class="p">}</span>
</code></pre></div><ul>
<li><span>next<span class="heti-spacing"> </span></span>方法有值时返回<span><span class="heti-spacing"> </span>Some(...)</span>，迭代结束则返回<span><span class="heti-spacing"> </span>None</span></li>
<li>手动迭代必须声明迭代器为<span><span class="heti-spacing"> </span>mut</span></li>
<li>仅需要实现<span class="heti-skip"><span class="heti-spacing"> </span>next<span class="heti-spacing"> </span></span>方法，其它方法有默认实现</li>
</ul>
</li>
<li>IntoIterator trait<ul>
<li><span>Iterator<span class="heti-spacing"> </span></span>自动实现<span><span class="heti-spacing"> </span>IntoIterator</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-128-1" id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">I</span><span class="p">:</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-128-2" id="__codelineno-128-2" name="__codelineno-128-2"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">::</span><span class="n">Item</span><span class="p">;</span>
<a href="#__codelineno-128-3" id="__codelineno-128-3" name="__codelineno-128-3"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">IntoIter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">I</span><span class="p">;</span>
<a href="#__codelineno-128-4" id="__codelineno-128-4" name="__codelineno-128-4"></a><span class="w">    </span><span class="cp">#[inline]</span>
<a href="#__codelineno-128-5" id="__codelineno-128-5" name="__codelineno-128-5"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">into_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">I</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-128-6" id="__codelineno-128-6" name="__codelineno-128-6"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>into_iter、iter、iter_mut<ul>
<li><span>.into_iter<span class="heti-spacing"> </span></span>会夺走所有权</li>
<li><span>.iter<span class="heti-spacing"> </span></span>是不可变借用，调用<span class="heti-skip"><span class="heti-spacing"> </span>next<span class="heti-spacing"> </span></span>返回<span><span class="heti-spacing"> </span>Some(&amp;T)</span></li>
<li><span>.iter_mut<span class="heti-spacing"> </span></span>是可变借用，调用<span class="heti-skip"><span class="heti-spacing"> </span>next<span class="heti-spacing"> </span></span>返回<span><span class="heti-spacing"> </span>Some(&amp;mut T)</span></li>
</ul>
</li>
<li>消费者适配器<ul>
<li>内部调用了<span class="heti-skip"><span class="heti-spacing"> </span>next<span class="heti-spacing"> </span></span>的迭代器方法，会消耗迭代器上元素，返回其它值，称为消费者适配器</li>
<li>例如<span class="heti-skip"><span class="heti-spacing"> </span>.sum<span class="heti-spacing"> </span></span>方法，内部调用<span class="heti-skip"><span class="heti-spacing"> </span>next<span class="heti-spacing"> </span></span>来对所有元素求和，也会拿走迭代器的所有权</li>
<li><span>collect<span class="heti-spacing"> </span></span>方法可以将迭代器中的值收集到集合类型中，但需要先标注要收集到的类型
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-129-1" id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">v</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iterator</span><span class="p">.</span><span class="n">collect</span><span class="p">();</span>
</code></pre></div></li>
</ul>
</li>
<li>迭代器适配器<ul>
<li>迭代器适配器或返回新的迭代器</li>
<li>例如<span><span class="heti-spacing"> </span>.map .filter .zip</span></li>
<li>可以进行链式调用，一般使用<span class="heti-skip"><span class="heti-spacing"> </span>collect<span class="heti-spacing"> </span></span>收尾收集元素</li>
</ul>
</li>
</ul>
<h2 id="_60">深入类型<a class="headerlink" href="#_60" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>newtype<ul>
<li>即使用一个元组结构体来包装</li>
<li>可以为外部类型实现外部<span><span class="heti-spacing"> </span>trait</span></li>
<li>可以具有更好的可读性，以及可以实现类型异化</li>
</ul>
</li>
<li>类型别名<ul>
<li>如 <code class="highlight"><span class="k">type</span><span class="w"> </span><span class="nc">Meters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u32</span></code></li>
<li>仅仅是别名，并不是全新类型，即上面<span class="heti-skip"><span class="heti-spacing"> </span>Meters<span class="heti-spacing"> </span></span>类型和<span class="heti-skip"><span class="heti-spacing"> </span>u32<span class="heti-spacing"> </span></span>在编译器眼里没有区别</li>
<li>可以增加可读性、简化代码</li>
</ul>
</li>
<li>用不返回类型<span><span class="heti-spacing"> </span>!</span><ul>
<li>对于<span><span class="heti-spacing"> </span>match</span>，各分支返回的类型需要一致，但如果有分支返回<span class="heti-skip"><span class="heti-spacing"> </span>!<span class="heti-spacing"> </span></span>类型，则可以忽略这个分支</li>
</ul>
</li>
<li>定长类型与不定长类型<ul>
<li>定长类型自动实现<span><span class="heti-spacing"> </span>Sized trait</span>，并且在使用泛型的时候会自动添加<span class="heti-skip"><span class="heti-spacing"> </span>Sized<span class="heti-spacing"> </span></span>约束</li>
<li>不定长类型（动态大小类型，DST<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，包括切片、str、特征等（<span>Vec<span class="heti-spacing"> </span></span>等集合类型是定长的，因为在栈上存储的信息定长）<ul>
<li><span>DST<span class="heti-spacing"> </span></span>无法单独使用，只能通过引用或者<span class="heti-skip"><span class="heti-spacing"> </span>Box<span class="heti-spacing"> </span></span>来间接使用，如将特征封装为特征对象</li>
<li><span>?Size<span class="heti-spacing"> </span></span>特征表示既有可能是固定大小类型也有可能是<span><span class="heti-spacing"> </span>DST</span>：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-130-1" id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div></li>
<li>将<span class="heti-skip"><span class="heti-spacing"> </span>str<span class="heti-spacing"> </span></span>包裹为<span class="heti-skip"><span class="heti-spacing"> </span>Box&lt;str&gt;<span class="heti-spacing"> </span></span>不能直接使用<span><span class="heti-spacing"> </span>Box::new("..." as str)</span>，因为这里并不能知道<span class="heti-skip"><span class="heti-spacing"> </span>str<span class="heti-spacing"> </span></span>的大小。可以使用<span class="heti-skip"><span class="heti-spacing"> </span>.into()<span class="heti-spacing"> </span></span>来让编译器来转换类型（将<span class="heti-skip"><span class="heti-spacing"> </span>&amp;str<span class="heti-spacing"> </span></span>转为<span><span class="heti-spacing"> </span>Box</span>）
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-131-1" id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"..."</span><span class="p">.</span><span class="n">into</span><span class="p">();</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>整数与枚举的类型转换
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-132-1" id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">MyEnum</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-132-2" id="__codelineno-132-2" name="__codelineno-132-2"></a><span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a href="#__codelineno-132-3" id="__codelineno-132-3" name="__codelineno-132-3"></a><span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a href="#__codelineno-132-4" id="__codelineno-132-4" name="__codelineno-132-4"></a><span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a href="#__codelineno-132-5" id="__codelineno-132-5" name="__codelineno-132-5"></a><span class="p">}</span>
</code></pre></div><ul>
<li>将枚举转换为整数可以直接使用<span><span class="heti-spacing"> </span>as</span>：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-133-1" id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyEnum</span><span class="p">::</span><span class="n">A</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
</code></pre></div></li>
<li>整数转为枚举则相对复杂，有几种方法<ul>
<li>使用第三方库：<span>num-traits num-derive<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>num_enums<span class="heti-spacing"> </span></span>等</li>
<li>使用<span><span class="heti-spacing"> </span>TryFrom trait</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-134-1" id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">convert</span><span class="p">::</span><span class="n">TryFrom</span><span class="p">;</span>
<a href="#__codelineno-134-2" id="__codelineno-134-2" name="__codelineno-134-2"></a><span class="k">impl</span><span class="w"> </span><span class="n">TryFrom</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyEnum</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-134-3" id="__codelineno-134-3" name="__codelineno-134-3"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">();</span>
<a href="#__codelineno-134-4" id="__codelineno-134-4" name="__codelineno-134-4"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">try_from</span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="bp">Self</span><span class="p">,</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-134-5" id="__codelineno-134-5" name="__codelineno-134-5"></a><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-134-6" id="__codelineno-134-6" name="__codelineno-134-6"></a><span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MyEnum</span><span class="p">::</span><span class="n">A</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">MyEnum</span><span class="p">::</span><span class="n">A</span><span class="p">),</span>
<a href="#__codelineno-134-7" id="__codelineno-134-7" name="__codelineno-134-7"></a><span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MyEnum</span><span class="p">::</span><span class="n">B</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">MyEnum</span><span class="p">::</span><span class="n">B</span><span class="p">),</span>
<a href="#__codelineno-134-8" id="__codelineno-134-8" name="__codelineno-134-8"></a><span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MyEnum</span><span class="p">::</span><span class="n">C</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">MyEnum</span><span class="p">::</span><span class="n">C</span><span class="p">),</span>
<a href="#__codelineno-134-9" id="__codelineno-134-9" name="__codelineno-134-9"></a><span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nb">Err</span><span class="p">(()),</span>
<a href="#__codelineno-134-10" id="__codelineno-134-10" name="__codelineno-134-10"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-134-11" id="__codelineno-134-11" name="__codelineno-134-11"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-134-12" id="__codelineno-134-12" name="__codelineno-134-12"></a><span class="p">}</span>
</code></pre></div><ul>
<li>为<span class="heti-skip"><span class="heti-spacing"> </span>MyEnum<span class="heti-spacing"> </span></span>实现了<span class="heti-skip"><span class="heti-spacing"> </span>TryFrom&lt;i32&gt;<span class="heti-spacing"> </span></span>后就可以调用<span class="heti-skip"><span class="heti-spacing"> </span>i32.try_into()<span class="heti-spacing"> </span></span>来尝试转为<span class="heti-skip"><span class="heti-spacing"> </span>MyEnum<span class="heti-spacing"> </span></span>了
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-135-1" id="__codelineno-135-1" name="__codelineno-135-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<a href="#__codelineno-135-2" id="__codelineno-135-2" name="__codelineno-135-2"></a><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">try_into</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-135-3" id="__codelineno-135-3" name="__codelineno-135-3"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">EyEnum</span><span class="p">::</span><span class="n">A</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">..</span><span class="p">.,</span>
<a href="#__codelineno-135-4" id="__codelineno-135-4" name="__codelineno-135-4"></a><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-135-5" id="__codelineno-135-5" name="__codelineno-135-5"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>unsafe transmute<span class="heti-spacing"> </span></span>转换
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-136-1" id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="cp">#[repr(i32)]</span><span class="w"> </span><span class="c1">// 规定内部存储为 i32</span>
<a href="#__codelineno-136-2" id="__codelineno-136-2" name="__codelineno-136-2"></a><span class="k">enum</span><span class="w"> </span><span class="nc">MyEnum</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-136-3" id="__codelineno-136-3" name="__codelineno-136-3"></a><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-136-4" id="__codelineno-136-4" name="__codelineno-136-4"></a><span class="p">}</span>
<a href="#__codelineno-136-5" id="__codelineno-136-5" name="__codelineno-136-5"></a>
<a href="#__codelineno-136-6" id="__codelineno-136-6" name="__codelineno-136-6"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-136-7" id="__codelineno-136-7" name="__codelineno-136-7"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">MyEnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">mem</span><span class="p">::</span><span class="n">transmute</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="_61">智能指针<a class="headerlink" href="#_61" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>引用仅是借用数据，而智能指针往往可以拥有指向的数据</li>
<li>智能指针实现了<span class="heti-skip"><span class="heti-spacing"> </span>Deref<span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span>Drop trait</span><ul>
<li><span>Deref<span class="heti-spacing"> </span></span>让智能指针可以像引用一样工作</li>
<li><span>Drop<span class="heti-spacing"> </span></span>允许指定智能指针超出作用域后自动执行的代码</li>
</ul>
</li>
</ul>
<h3 id="deref-trait">Deref trait<a class="headerlink" href="#deref-trait" title="Permanent link">¶</a></h3>
<ul>
<li><code class="highlight"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">Deref</span></code></li>
<li>实现了<span class="heti-skip"><span class="heti-spacing"> </span>Deref<span class="heti-spacing"> </span></span>之后就可以使用<span class="heti-skip"><span class="heti-spacing"> </span>*<span class="heti-spacing"> </span></span>解引用了
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-137-1" id="__codelineno-137-1" name="__codelineno-137-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">Deref</span>
<a href="#__codelineno-137-2" id="__codelineno-137-2" name="__codelineno-137-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyBox</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<a href="#__codelineno-137-3" id="__codelineno-137-3" name="__codelineno-137-3"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">MyBox</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-137-4" id="__codelineno-137-4" name="__codelineno-137-4"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">MyBox</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">MyBox</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-137-5" id="__codelineno-137-5" name="__codelineno-137-5"></a><span class="p">}</span>
<a href="#__codelineno-137-6" id="__codelineno-137-6" name="__codelineno-137-6"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyBox</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-137-7" id="__codelineno-137-7" name="__codelineno-137-7"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a href="#__codelineno-137-8" id="__codelineno-137-8" name="__codelineno-137-8"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">Self</span><span class="p">::</span><span class="n">Target</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-137-9" id="__codelineno-137-9" name="__codelineno-137-9"></a><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span>
<a href="#__codelineno-137-10" id="__codelineno-137-10" name="__codelineno-137-10"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-137-11" id="__codelineno-137-11" name="__codelineno-137-11"></a><span class="p">}</span>
</code></pre></div><ul>
<li><span>deref<span class="heti-spacing"> </span></span>返回内部值的正常引用，可以使用<span class="heti-skip"><span class="heti-spacing"> </span>*<span class="heti-spacing"> </span></span>来解引用</li>
<li>对<span class="heti-skip"><span class="heti-spacing"> </span>MyBox<span class="heti-spacing"> </span></span>进行解引用时实际上调用的是 <code class="highlight"><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">deref</span><span class="p">())</span></code></li>
</ul>
</li>
<li>参数中隐式<span class="heti-skip"><span class="heti-spacing"> </span>Deref<span class="heti-spacing"> </span></span>转换
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-138-1" id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-138-2" id="__codelineno-138-2" name="__codelineno-138-2"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-138-3" id="__codelineno-138-3" name="__codelineno-138-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyBox</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"..."</span><span class="p">));</span>
<a href="#__codelineno-138-4" id="__codelineno-138-4" name="__codelineno-138-4"></a><span class="w">    </span><span class="n">func</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
<a href="#__codelineno-138-5" id="__codelineno-138-5" name="__codelineno-138-5"></a><span class="p">}</span>
</code></pre></div><ul>
<li>调用时<span><span class="heti-spacing"> </span>&amp;s: &amp;MyBox</span><string\><span><span class="heti-spacing"> </span>-&gt; &amp;String -&gt; &amp;str</span></string\></li>
</ul>
</li>
<li>引用归一化<ul>
<li>智能指针会从结构体中脱壳出来得到内部的引用类型</li>
<li>多重引用可以归一化
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-139-1" id="__codelineno-139-1" name="__codelineno-139-1"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">T</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-139-2" id="__codelineno-139-2" name="__codelineno-139-2"></a><span class="w">    </span><span class="k">type</span><span class="w"> </span><span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a href="#__codelineno-139-3" id="__codelineno-139-3" name="__codelineno-139-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">T</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-139-4" id="__codelineno-139-4" name="__codelineno-139-4"></a><span class="w">        </span><span class="o">*</span><span class="bp">self</span><span class="w">  </span><span class="c1">// 这里 self 是 &amp;&amp;T 类型</span>
<a href="#__codelineno-139-5" id="__codelineno-139-5" name="__codelineno-139-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-139-6" id="__codelineno-139-6" name="__codelineno-139-6"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li><span>DerefMut<span class="heti-spacing"> </span></span>与<span><span class="heti-spacing"> </span>Deref</span><ul>
<li>当<span class="heti-skip"><span class="heti-spacing"> </span>T: Deref&lt;Target=U&gt;<span class="heti-spacing"> </span></span>时，<span>&amp;T<span class="heti-spacing"> </span></span>可以转换为<span><span class="heti-spacing"> </span>&amp;U</span>、<span>&amp;mut T<span class="heti-spacing"> </span></span>也可以转换为<span><span class="heti-spacing"> </span>&amp;U</span>（<span>rust<span class="heti-spacing"> </span></span>可以把可变引用隐式转换为不可变引用）</li>
<li>当<span class="heti-skip"><span class="heti-spacing"> </span>T: DerefMut&lt;Target=U&gt;<span class="heti-spacing"> </span></span>时，<span>&amp;mut T<span class="heti-spacing"> </span></span>可以转换为<span><span class="heti-spacing"> </span>&amp;mut U</span></li>
<li>实现<span class="heti-skip"><span class="heti-spacing"> </span>DerefMut trait<span class="heti-spacing"> </span></span>需要先实现<span><span class="heti-spacing"> </span>Deref</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-140-1" id="__codelineno-140-1" name="__codelineno-140-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">ops</span><span class="p">::</span><span class="n">DerefMut</span><span class="p">;</span>
<a href="#__codelineno-140-2" id="__codelineno-140-2" name="__codelineno-140-2"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">DerefMut</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyBox</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-140-3" id="__codelineno-140-3" name="__codelineno-140-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">deref_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="bp">Self</span><span class="p">::</span><span class="n">Target</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-140-4" id="__codelineno-140-4" name="__codelineno-140-4"></a><span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span>
<a href="#__codelineno-140-5" id="__codelineno-140-5" name="__codelineno-140-5"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-140-6" id="__codelineno-140-6" name="__codelineno-140-6"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="drop-trait">Drop trait<a class="headerlink" href="#drop-trait" title="Permanent link">¶</a></h3>
<ul>
<li>变量离开作用域的时候会自动执行<span class="heti-skip"><span class="heti-spacing"> </span>Drop trait<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>drop<span class="heti-spacing"> </span></span>方法</li>
<li>可以为结构体自定义<span><span class="heti-spacing"> </span>drop</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-141-1" id="__codelineno-141-1" name="__codelineno-141-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">A</span><span class="p">;</span>
<a href="#__codelineno-141-2" id="__codelineno-141-2" name="__codelineno-141-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">B</span><span class="p">;</span>
<a href="#__codelineno-141-3" id="__codelineno-141-3" name="__codelineno-141-3"></a><span class="k">impl</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"drop A"</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-141-4" id="__codelineno-141-4" name="__codelineno-141-4"></a><span class="k">impl</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"drop B"</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-141-5" id="__codelineno-141-5" name="__codelineno-141-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-141-6" id="__codelineno-141-6" name="__codelineno-141-6"></a><span class="w">    </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">A</span><span class="p">,</span>
<a href="#__codelineno-141-7" id="__codelineno-141-7" name="__codelineno-141-7"></a><span class="w">    </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">B</span><span class="p">,</span>
<a href="#__codelineno-141-8" id="__codelineno-141-8" name="__codelineno-141-8"></a><span class="p">}</span>
<a href="#__codelineno-141-9" id="__codelineno-141-9" name="__codelineno-141-9"></a><span class="k">impl</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"drop C"</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-141-10" id="__codelineno-141-10" name="__codelineno-141-10"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-141-11" id="__codelineno-141-11" name="__codelineno-141-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nc">A</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="p">};</span>
<a href="#__codelineno-141-12" id="__codelineno-141-12" name="__codelineno-141-12"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"end"</span><span class="p">);</span>
<a href="#__codelineno-141-13" id="__codelineno-141-13" name="__codelineno-141-13"></a><span class="p">}</span>
<a href="#__codelineno-141-14" id="__codelineno-141-14" name="__codelineno-141-14"></a><span class="c1">// end</span>
<a href="#__codelineno-141-15" id="__codelineno-141-15" name="__codelineno-141-15"></a><span class="c1">// drop C</span>
<a href="#__codelineno-141-16" id="__codelineno-141-16" name="__codelineno-141-16"></a><span class="c1">// drop A</span>
<a href="#__codelineno-141-17" id="__codelineno-141-17" name="__codelineno-141-17"></a><span class="c1">// drop B</span>
</code></pre></div><ul>
<li><span>drop<span class="heti-spacing"> </span></span>方法借用目标使用的是可变引用，不会拿走所有权</li>
<li>结构体每个字段都会<span><span class="heti-spacing"> </span>drop</span></li>
<li>先声明的变量后<span><span class="heti-spacing"> </span>drop</span>、结构体内部按顺序依次<span><span class="heti-spacing"> </span>drop</span></li>
<li>即使<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>不手动实现<span><span class="heti-spacing"> </span>Drop</span>，也会调用到<span class="heti-skip"><span class="heti-spacing"> </span>A<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>B<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>drop</span>，因为会为<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>提供默认的<span class="heti-skip"><span class="heti-spacing"> </span>Drop<span class="heti-spacing"> </span></span>实现</li>
</ul>
</li>
<li><span>.drop<span class="heti-spacing"> </span></span>函数不能手动调用，因为它是借用，后面依然可以访问原值，但是可能已经被清理了<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>std::mem::drop<span class="heti-spacing"> </span></span>函数（在<span class="heti-skip"><span class="heti-spacing"> </span>prelude<span class="heti-spacing"> </span></span>中）来手动<span><span class="heti-spacing"> </span>drop</span></li>
<li><span>std::mem::drop<span class="heti-spacing"> </span></span>的签名：<code class="highlight"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">drop</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_x</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span></code></li>
<li>这个<span class="heti-skip"><span class="heti-spacing"> </span>drop<span class="heti-spacing"> </span></span>是一个空实现，它可以带走目标的所有权，然后这个函数直接结束，目标的作用域也就结束了，导致自动调用<span class="heti-skip"><span class="heti-spacing"> </span>drop<span class="heti-spacing"> </span></span>方法来释放</li>
</ul>
</li>
<li>无法为同一个类型实现<span class="heti-skip"><span class="heti-spacing"> </span>Copy<span class="heti-spacing"> </span></span>和<span><span class="heti-spacing"> </span>Drop</span></li>
</ul>
<h3 id="box">Box<a class="headerlink" href="#box" title="Permanent link">¶</a></h3>
<ul>
<li><span>Box&lt;T&gt;<span class="heti-spacing"> </span></span>允许将一个值分配到堆上，然后在栈上保留一个智能指针指向堆上数据</li>
<li>可以将数据分配到堆上
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-142-1" id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-142-2" id="__codelineno-142-2" name="__codelineno-142-2"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"a = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// 利用 Deref 自动解引用</span>
<a href="#__codelineno-142-3" id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 表达式中需要手动解引用</span>
</code></pre></div><ul>
<li>但是<span class="heti-skip"><span class="heti-spacing"> </span>Box::new<span class="heti-spacing"> </span></span>会先在栈上分配空间然后移到堆上，比如<span class="heti-skip"><span class="heti-spacing"> </span>Box::new([0; 1000000000000])<span class="heti-spacing"> </span></span>会报错栈溢出</li>
</ul>
</li>
<li>避免栈上数据拷贝<ul>
<li>栈上数据所有权转移的时候会拷贝一份数据，但在堆上时堆上数据不会拷贝，仅仅需要拷贝一份栈上的指针即可完成所有权转移</li>
</ul>
</li>
<li>将<span class="heti-skip"><span class="heti-spacing"> </span>DST<span class="heti-spacing"> </span></span>变为固定大小类型<ul>
<li>如递归类型，<span>rust<span class="heti-spacing"> </span></span>不知道递归类型需要多少空间，但包裹一层<span class="heti-skip"><span class="heti-spacing"> </span>Box<span class="heti-spacing"> </span></span>则可以变成固定大小
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-143-1" id="__codelineno-143-1" name="__codelineno-143-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">List</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-143-2" id="__codelineno-143-2" name="__codelineno-143-2"></a><span class="w">    </span><span class="n">Cons</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&gt;</span><span class="p">),</span>
<a href="#__codelineno-143-3" id="__codelineno-143-3" name="__codelineno-143-3"></a><span class="w">    </span><span class="n">Nil</span><span class="p">,</span>
<a href="#__codelineno-143-4" id="__codelineno-143-4" name="__codelineno-143-4"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>将特征转为特征对象</li>
<li>Box::leak<ul>
<li>消费掉<span><span class="heti-spacing"> </span>Box</span>，并强制目标值从内存中泄露</li>
<li>例如将<span class="heti-skip"><span class="heti-spacing"> </span>String<span class="heti-spacing"> </span></span>类型变成拥有<span class="heti-skip"><span class="heti-spacing"> </span>'static<span class="heti-spacing"> </span></span>生命周期的<span class="heti-skip"><span class="heti-spacing"> </span>&amp;str<span class="heti-spacing"> </span></span>类型
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-144-1" id="__codelineno-144-1" name="__codelineno-144-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">'</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-144-2" id="__codelineno-144-2" name="__codelineno-144-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-144-3" id="__codelineno-144-3" name="__codelineno-144-3"></a><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="n">push_str</span><span class="p">(</span><span class="s">"..."</span><span class="p">);</span>
<a href="#__codelineno-144-4" id="__codelineno-144-4" name="__codelineno-144-4"></a><span class="w">    </span><span class="nb">Box</span><span class="p">::</span><span class="n">leak</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">into_boxed_str</span><span class="p">())</span>
<a href="#__codelineno-144-5" id="__codelineno-144-5" name="__codelineno-144-5"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="rc-arc"><span>Rc<span class="heti-spacing"> </span></span>与<span><span class="heti-spacing"> </span>Arc</span><a class="headerlink" href="#rc-arc" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>Rc<span class="heti-spacing"> </span></span>即引用计数（reference counting<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，记录一个数据被引用的次数来确定数据是否被使用，当引用次数归零，则清理释放</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>clone<span class="heti-spacing"> </span></span>来复制智能指针并增加引用计数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-145-1" id="__codelineno-145-1" name="__codelineno-145-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">rc</span><span class="p">::</span><span class="n">Rc</span>
<a href="#__codelineno-145-2" id="__codelineno-145-2" name="__codelineno-145-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">"..."</span><span class="p">));</span>
<a href="#__codelineno-145-3" id="__codelineno-145-3" name="__codelineno-145-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rc</span><span class="p">::</span><span class="n">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
<a href="#__codelineno-145-4" id="__codelineno-145-4" name="__codelineno-145-4"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Rc</span><span class="p">::</span><span class="n">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">));</span>
<a href="#__codelineno-145-5" id="__codelineno-145-5" name="__codelineno-145-5"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Rc</span><span class="p">::</span><span class="n">strong_count</span><span class="p">(</span><span class="o">&amp;</span><span class="n">b</span><span class="p">));</span>
</code></pre></div><ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>Rc::strong_count<span class="heti-spacing"> </span></span>来获取计数</li>
</ul>
</li>
<li><span>Rc<span class="heti-spacing"> </span></span>在离开作用域时会被释放，并将引用数据的计数减一</li>
<li><span>Rc<span class="heti-spacing"> </span></span>是指向底层数据的不可变引用，无法通过它来修改数据</li>
<li><span>Rc<span class="heti-spacing"> </span></span>只能用在同一线程内部，多线程之间共享需要使用<span><span class="heti-spacing"> </span>Arc</span>（Atomic Rc<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，其<span class="heti-skip"><span class="heti-spacing"> </span>api<span class="heti-spacing"> </span></span>一致但是线程安全的，不过效率会有所降低<ul>
<li>需要 <code class="highlight"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">Arc</span></code></li>
</ul>
</li>
</ul>
<h3 id="cell-refcell"><span>Cell<span class="heti-spacing"> </span></span>与<span><span class="heti-spacing"> </span>RefCell</span><a class="headerlink" href="#cell-refcell" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>Cell&lt;T&gt;<span class="heti-spacing"> </span></span>适用于<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>实现<span class="heti-skip"><span class="heti-spacing"> </span>Copy<span class="heti-spacing"> </span></span>的情况，而没有<span class="heti-skip"><span class="heti-spacing"> </span>Copy<span class="heti-spacing"> </span></span>的话则不能使用<span class="heti-skip"><span class="heti-spacing"> </span>Cell<span class="heti-spacing"> </span></span>只能使用<span><span class="heti-spacing"> </span>RefCell</span>。二者都可以达到内部可变性的效果</p>
<p><span>Rust<span class="heti-spacing"> </span></span>规定一个结构体中的字段要么都是<span class="heti-skip"><span class="heti-spacing"> </span>immutable<span class="heti-spacing"> </span></span>要么都是<span><span class="heti-spacing"> </span>mutable</span>，而不能将部分字段标记为<span><span class="heti-spacing"> </span>mutable</span>。但可以使用<span class="heti-skip"><span class="heti-spacing"> </span>Cell<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>RefCell<span class="heti-spacing"> </span></span>包裹想要可变的字段，这样就实现了<span class="heti-skip"><span class="heti-spacing"> </span>immutable<span class="heti-spacing"> </span></span>结构体中部分字段可变的效果而不必将整个结构体标记为<span><span class="heti-spacing"> </span>mutable</span></p>
<h4 id="cell">Cell<a class="headerlink" href="#cell" title="Permanent link">¶</a></h4>
<ul>
<li><code class="highlight"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cell</span><span class="p">::</span><span class="n">Cell</span><span class="p">;</span></code></li>
<li><span>.get()<span class="heti-spacing"> </span></span>取值（<span>Copy<span class="heti-spacing"> </span></span>出来）</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>.set()<span class="heti-spacing"> </span></span>设置新值而不需要将其标记为<span><span class="heti-spacing"> </span>mut</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-146-1" id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cell</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">"abcd"</span><span class="p">);</span>
<a href="#__codelineno-146-2" id="__codelineno-146-2" name="__codelineno-146-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<a href="#__codelineno-146-3" id="__codelineno-146-3" name="__codelineno-146-3"></a><span class="n">c</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">"efgh"</span><span class="p">);</span>
<a href="#__codelineno-146-4" id="__codelineno-146-4" name="__codelineno-146-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<a href="#__codelineno-146-5" id="__codelineno-146-5" name="__codelineno-146-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{} {}"</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"> </span><span class="c1">// abcd efgh</span>
</code></pre></div></li>
<li>例：<ul>
<li>下面代码会报错：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-147-1" id="__codelineno-147-1" name="__codelineno-147-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a href="#__codelineno-147-2" id="__codelineno-147-2" name="__codelineno-147-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a href="#__codelineno-147-3" id="__codelineno-147-3" name="__codelineno-147-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a href="#__codelineno-147-4" id="__codelineno-147-4" name="__codelineno-147-4"></a><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="o">*</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a href="#__codelineno-147-5" id="__codelineno-147-5" name="__codelineno-147-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</code></pre></div></li>
<li>而下面的不会：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-148-1" id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Cell</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-148-2" id="__codelineno-148-2" name="__codelineno-148-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span>
<a href="#__codelineno-148-3" id="__codelineno-148-3" name="__codelineno-148-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span>
<a href="#__codelineno-148-4" id="__codelineno-148-4" name="__codelineno-148-4"></a><span class="n">x</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="n">z</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a href="#__codelineno-148-5" id="__codelineno-148-5" name="__codelineno-148-5"></a><span class="fm">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</code></pre></div><ul>
<li>这里<span class="heti-skip"><span class="heti-spacing"> </span>x<span class="heti-spacing"> </span></span>也不必声明为<span><span class="heti-spacing"> </span>mut</span>，<span>y z<span class="heti-spacing"> </span></span>都是<span class="heti-skip"><span class="heti-spacing"> </span>x<span class="heti-spacing"> </span></span>的不可变引用，可以共存</li>
<li>但可以通过<span class="heti-skip"><span class="heti-spacing"> </span>x y z<span class="heti-spacing"> </span></span>来改变<span class="heti-skip"><span class="heti-spacing"> </span>cell<span class="heti-spacing"> </span></span>中的值</li>
</ul>
</li>
</ul>
</li>
<li><span>Cell<span class="heti-spacing"> </span></span>没有性能损耗</li>
<li><span>Rust 1.37<span class="heti-spacing"> </span></span>中增加了两个方法，可以很好地解决借用冲突：<ul>
<li>Cell::from_mut，将<span class="heti-skip"><span class="heti-spacing"> </span>&amp;mut T<span class="heti-spacing"> </span></span>转为<span><span class="heti-spacing"> </span>&amp;Cell&lt;T&gt;</span></li>
<li>Cell::as_slice_of_cells，将<span class="heti-skip"><span class="heti-spacing"> </span>&amp;Cell&lt;[T]&gt;<span class="heti-spacing"> </span></span>转为<span><span class="heti-spacing"> </span>&amp;[Cell&lt;T&gt;]</span></li>
</ul>
</li>
</ul>
<h4 id="refcell">RefCell<a class="headerlink" href="#refcell" title="Permanent link">¶</a></h4>
<ul>
<li><code class="highlight"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cell</span><span class="p">::</span><span class="n">RefCell</span><span class="p">;</span></code></li>
<li>可以使编译期可变和不可变引用共存</li>
<li>使用时可变和不可变引用一样不能共存，会<span><span class="heti-spacing"> </span>panic</span>，并不能依次绕过借用规则</li>
<li>与<span class="heti-skip"><span class="heti-spacing"> </span>Cell<span class="heti-spacing"> </span></span>提供值相比，<span>RefCell<span class="heti-spacing"> </span></span>提供引用<ul>
<li><span>.borrow()<span class="heti-spacing"> </span></span>创建不可变引用、<span>.borrow_mut()<span class="heti-spacing"> </span></span>创建可变引用</li>
</ul>
</li>
<li><span>RefCell<span class="heti-spacing"> </span></span>适用于编译期误报或者一个引用在多处使用难以管理借用关系时</li>
<li>可以利用<span class="heti-skip"><span class="heti-spacing"> </span>RefCell<span class="heti-spacing"> </span></span>来创建一个不是<span class="heti-skip"><span class="heti-spacing"> </span>mut<span class="heti-spacing"> </span></span>但是内部值可变的东西
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-149-1" id="__codelineno-149-1" name="__codelineno-149-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cell</span><span class="p">::</span><span class="n">RefCell</span><span class="p">;</span>
<a href="#__codelineno-149-2" id="__codelineno-149-2" name="__codelineno-149-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Messenger</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-149-3" id="__codelineno-149-3" name="__codelineno-149-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">);</span><span class="w"> </span><span class="c1">// 定义时不是 &amp;mut self</span>
<a href="#__codelineno-149-4" id="__codelineno-149-4" name="__codelineno-149-4"></a><span class="p">}</span>
<a href="#__codelineno-149-5" id="__codelineno-149-5" name="__codelineno-149-5"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">MsgQueue</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-149-6" id="__codelineno-149-6" name="__codelineno-149-6"></a><span class="w">    </span><span class="n">msg_cache</span><span class="p">:</span><span class="w"> </span><span class="nc">RefCell</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<a href="#__codelineno-149-7" id="__codelineno-149-7" name="__codelineno-149-7"></a><span class="p">}</span>
<a href="#__codelineno-149-8" id="__codelineno-149-8" name="__codelineno-149-8"></a><span class="k">impl</span><span class="w"> </span><span class="n">Messenger</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MsgQueue</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-149-9" id="__codelineno-149-9" name="__codelineno-149-9"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-149-10" id="__codelineno-149-10" name="__codelineno-149-10"></a><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">msg_cache</span><span class="p">.</span><span class="n">borrow_mut</span><span class="p">().</span><span class="n">push</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="c1">// self 不是 mut 的，msg_cache 也就不是 mut 的</span>
<a href="#__codelineno-149-11" id="__codelineno-149-11" name="__codelineno-149-11"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-149-12" id="__codelineno-149-12" name="__codelineno-149-12"></a><span class="p">}</span>
</code></pre></div></li>
<li><span>Rc<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>RefCell<span class="heti-spacing"> </span></span>组合使用，可以同时拥有多个所有者并实现数据的可变性：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-150-1" id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cell</span><span class="p">::</span><span class="n">RefCell</span><span class="p">;</span>
<a href="#__codelineno-150-2" id="__codelineno-150-2" name="__codelineno-150-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">rc</span><span class="p">::</span><span class="n">Rc</span><span class="p">;</span>
<a href="#__codelineno-150-3" id="__codelineno-150-3" name="__codelineno-150-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-150-4" id="__codelineno-150-4" name="__codelineno-150-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">RefCell</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">"..."</span><span class="p">.</span><span class="n">to_string</span><span class="p">()));</span>
<a href="#__codelineno-150-5" id="__codelineno-150-5" name="__codelineno-150-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a href="#__codelineno-150-6" id="__codelineno-150-6" name="__codelineno-150-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a href="#__codelineno-150-7" id="__codelineno-150-7" name="__codelineno-150-7"></a><span class="w">    </span><span class="n">s2</span><span class="p">.</span><span class="n">borrow_mut</span><span class="p">().</span><span class="n">push_str</span><span class="p">(</span><span class="s">"..."</span><span class="p">);</span>
<a href="#__codelineno-150-8" id="__codelineno-150-8" name="__codelineno-150-8"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"{:?}</span><span class="se">\n</span><span class="s">{:?}</span><span class="se">\n</span><span class="s">{:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">);</span>
<a href="#__codelineno-150-9" id="__codelineno-150-9" name="__codelineno-150-9"></a><span class="p">}</span>
</code></pre></div><ul>
<li>会输出三遍 <code>RefCell { value: "......" }</code></li>
<li>组合使用性能其实很高</li>
</ul>
</li>
</ul>
<h3 id="weak"><span>Weak<span class="heti-spacing"> </span></span>弱引用<a class="headerlink" href="#weak" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><code class="highlight"><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">rc</span><span class="p">::</span><span class="n">Weak</span></code></li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>Rc<span class="heti-spacing"> </span></span>配合<span class="heti-skip"><span class="heti-spacing"> </span>RefCell<span class="heti-spacing"> </span></span>会构造出两个指针互相指也就是循环引用的情况，可能会造成引用计数无法清零不会<span class="heti-skip"><span class="heti-spacing"> </span>drop<span class="heti-spacing"> </span></span>从而造成内存泄漏</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>Weak<span class="heti-spacing"> </span></span>可以解决循环引用的问题，它并不保证引用关系会存在，与<span class="heti-skip"><span class="heti-spacing"> </span>Rc<span class="heti-spacing"> </span></span>相比，它的特点：<ul>
<li>不会计数</li>
<li>不拥有值的所有权</li>
<li>不会阻止值的释放（<span>Rc<span class="heti-spacing"> </span></span>只有当计数为<span class="heti-skip"><span class="heti-spacing"> </span>0<span class="heti-spacing"> </span></span>时才能<span><span class="heti-spacing"> </span>drop</span>）</li>
</ul>
</li>
<li><span>Weak<span class="heti-spacing"> </span></span>在使用时需要先调用<span class="heti-skip"><span class="heti-spacing"> </span>upgrade<span class="heti-spacing"> </span></span>方法得到一个<span class="heti-skip"><span class="heti-spacing"> </span>Option&lt;Rc&lt;T&gt;&gt;<span class="heti-spacing"> </span></span>类型的值（当引用值存在时返回<span><span class="heti-spacing"> </span>Some(rc)</span>，取出<span class="heti-skip"><span class="heti-spacing"> </span>Rc<span class="heti-spacing"> </span></span>使用，不存在时返回<span><span class="heti-spacing"> </span>None</span>）</li>
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>Rc&lt;T&gt;<span class="heti-spacing"> </span></span>上调用<span class="heti-skip"><span class="heti-spacing"> </span>downgrade<span class="heti-spacing"> </span></span>方法即可获得<span><span class="heti-spacing"> </span>Weak&lt;T&gt;</span>，同时会计入到该<span class="heti-skip"><span class="heti-spacing"> </span>Rc<span class="heti-spacing"> </span></span>的一个<span class="heti-skip"><span class="heti-spacing"> </span>weak_count<span class="heti-spacing"> </span></span>上</li>
<li>当会造成循环引用时，将其中一支换为<span class="heti-skip"><span class="heti-spacing"> </span>Weak<span class="heti-spacing"> </span></span>即可避免</li>
</ul>
<h2 id="_62">多线程并发编程<a class="headerlink" href="#_62" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_63">使用线程<a class="headerlink" href="#_63" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>创建线程<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>std::thread::spawn<span class="heti-spacing"> </span></span>创建线程</li>
<li>线程内部代码使用闭包来执行</li>
<li><span>main<span class="heti-spacing"> </span></span>线程结束则程序立即结束不会等到子线程全部结束</li>
<li><span>thread::sleep<span class="heti-spacing"> </span></span>休眠当前线程指定时间
<div class="highlight"><pre><span></span><code><a href="#__codelineno-151-1" id="__codelineno-151-1" name="__codelineno-151-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="p">;</span>
<a href="#__codelineno-151-2" id="__codelineno-151-2" name="__codelineno-151-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">time</span><span class="p">::</span><span class="n">Duration</span><span class="p">;</span>
<a href="#__codelineno-151-3" id="__codelineno-151-3" name="__codelineno-151-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-151-4" id="__codelineno-151-4" name="__codelineno-151-4"></a><span class="w">    </span><span class="n">thread</span><span class="p">::</span><span class="n">spawn</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-151-5" id="__codelineno-151-5" name="__codelineno-151-5"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-151-6" id="__codelineno-151-6" name="__codelineno-151-6"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"hi number {} from the spawned thread!"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a href="#__codelineno-151-7" id="__codelineno-151-7" name="__codelineno-151-7"></a><span class="w">            </span><span class="n">thread</span><span class="p">::</span><span class="n">sleep</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a href="#__codelineno-151-8" id="__codelineno-151-8" name="__codelineno-151-8"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-151-9" id="__codelineno-151-9" name="__codelineno-151-9"></a><span class="w">    </span><span class="p">});</span>
<a href="#__codelineno-151-10" id="__codelineno-151-10" name="__codelineno-151-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-151-11" id="__codelineno-151-11" name="__codelineno-151-11"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"hi number {} from the main thread!"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a href="#__codelineno-151-12" id="__codelineno-151-12" name="__codelineno-151-12"></a><span class="w">        </span><span class="n">thread</span><span class="p">::</span><span class="n">sleep</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_millis</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a href="#__codelineno-151-13" id="__codelineno-151-13" name="__codelineno-151-13"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-151-14" id="__codelineno-151-14" name="__codelineno-151-14"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>等待子线程结束<ul>
<li><span>spawn<span class="heti-spacing"> </span></span>会返回一个<span class="heti-skip"><span class="heti-spacing"> </span>JoinHandle&lt;()&gt;<span class="heti-spacing"> </span></span>类型的值，可以在其上调用<span class="heti-skip"><span class="heti-spacing"> </span>.join<span class="heti-spacing"> </span></span>方法来阻塞当前线程
<div class="highlight"><pre><span></span><code><a href="#__codelineno-152-1" id="__codelineno-152-1" name="__codelineno-152-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thread</span><span class="p">::</span><span class="n">spawn</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
<a href="#__codelineno-152-2" id="__codelineno-152-2" name="__codelineno-152-2"></a><span class="n">handle</span><span class="p">.</span><span class="n">join</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div></li>
</ul>
</li>
<li>线程闭包中捕获变量<ul>
<li>创建线程的闭包中不能直接使用当前线程中的变量，因为无法确定创建的新线程会存活多久，可能在借用变量创建新线程，在新线程运行时，借用的原值已经被<span><span class="heti-spacing"> </span>drop</span></li>
<li>因此使用捕获变量的话一定要在参数列表前加上<span class="heti-skip"><span class="heti-spacing"> </span>move<span class="heti-spacing"> </span></span>关键字来强制转移所有权（也就是说当前线程后面将不可以在使用这个变量）</li>
</ul>
</li>
<li>barrier<ul>
<li>在多个线程内同步，即等待各线程执行到同一位置后再继续执行</li>
<li>使用<span><span class="heti-spacing"> </span>std::sync::Barrier</span>，需要通过<span class="heti-skip"><span class="heti-spacing"> </span>Arc<span class="heti-spacing"> </span></span>来分配到各个线程中</li>
<li>调用其<span class="heti-skip"><span class="heti-spacing"> </span>.wait()<span class="heti-spacing"> </span></span>方法来对所有使用了<span class="heti-skip"><span class="heti-spacing"> </span>barrier<span class="heti-spacing"> </span></span>对线程进行同步
<div class="highlight"><pre><span></span><code><a href="#__codelineno-153-1" id="__codelineno-153-1" name="__codelineno-153-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sync</span><span class="p">::{</span><span class="n">Arc</span><span class="p">,</span><span class="w"> </span><span class="n">Barrier</span><span class="p">};</span>
<a href="#__codelineno-153-2" id="__codelineno-153-2" name="__codelineno-153-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="p">;</span>
<a href="#__codelineno-153-3" id="__codelineno-153-3" name="__codelineno-153-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-153-4" id="__codelineno-153-4" name="__codelineno-153-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="p">::</span><span class="n">with_capacity</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<a href="#__codelineno-153-5" id="__codelineno-153-5" name="__codelineno-153-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">barrier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Barrier</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
<a href="#__codelineno-153-6" id="__codelineno-153-6" name="__codelineno-153-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..=</span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-153-7" id="__codelineno-153-7" name="__codelineno-153-7"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">barrier</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a href="#__codelineno-153-8" id="__codelineno-153-8" name="__codelineno-153-8"></a><span class="w">        </span><span class="n">handles</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">thread</span><span class="p">::</span><span class="n">spawn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-153-9" id="__codelineno-153-9" name="__codelineno-153-9"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"before wait"</span><span class="p">);</span>
<a href="#__codelineno-153-10" id="__codelineno-153-10" name="__codelineno-153-10"></a><span class="w">            </span><span class="n">b</span><span class="p">.</span><span class="n">wait</span><span class="p">();</span>
<a href="#__codelineno-153-11" id="__codelineno-153-11" name="__codelineno-153-11"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"after wait"</span><span class="p">);</span>
<a href="#__codelineno-153-12" id="__codelineno-153-12" name="__codelineno-153-12"></a><span class="w">        </span><span class="p">}))</span>
<a href="#__codelineno-153-13" id="__codelineno-153-13" name="__codelineno-153-13"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-153-14" id="__codelineno-153-14" name="__codelineno-153-14"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-153-15" id="__codelineno-153-15" name="__codelineno-153-15"></a><span class="w">        </span><span class="n">handle</span><span class="p">.</span><span class="n">join</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
<a href="#__codelineno-153-16" id="__codelineno-153-16" name="__codelineno-153-16"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-153-17" id="__codelineno-153-17" name="__codelineno-153-17"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>线程局部变量<ul>
<li>标准库<span class="heti-skip"><span class="heti-spacing"> </span>thread_local<span class="heti-spacing"> </span></span>宏<ul>
<li>通过宏来创建一个生命周期为<span class="heti-skip"><span class="heti-spacing"> </span>'static<span class="heti-spacing"> </span></span>的线程局部变量</li>
<li>每个线程访问时都会使用它的初始值，且各线程间彼此不干扰</li>
<li>线程内部使用这个变量的<span class="heti-skip"><span class="heti-spacing"> </span>with<span class="heti-spacing"> </span></span>方法来获取值进行操作
<div class="highlight"><pre><span></span><code><a href="#__codelineno-154-1" id="__codelineno-154-1" name="__codelineno-154-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cell</span><span class="p">::</span><span class="n">RefCell</span><span class="p">;</span>
<a href="#__codelineno-154-2" id="__codelineno-154-2" name="__codelineno-154-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="p">;</span>
<a href="#__codelineno-154-3" id="__codelineno-154-3" name="__codelineno-154-3"></a><span class="fm">thread_local!</span><span class="p">(</span><span class="k">static</span><span class="w"> </span><span class="n">FOO</span><span class="p">:</span><span class="w"> </span><span class="nc">RefCell</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RefCell</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a href="#__codelineno-154-4" id="__codelineno-154-4" name="__codelineno-154-4"></a><span class="n">FOO</span><span class="p">.</span><span class="n">with</span><span class="p">(</span><span class="o">|</span><span class="n">f</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">})</span>
<a href="#__codelineno-154-5" id="__codelineno-154-5" name="__codelineno-154-5"></a><span class="n">thread</span><span class="p">::</span><span class="n">spawn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-154-6" id="__codelineno-154-6" name="__codelineno-154-6"></a><span class="w">    </span><span class="n">FOO</span><span class="p">.</span><span class="n">with</span><span class="p">(</span><span class="o">|</span><span class="n">f</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">})</span>
<a href="#__codelineno-154-7" id="__codelineno-154-7" name="__codelineno-154-7"></a><span class="p">}).</span><span class="n">join</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</code></pre></div></li>
</ul>
</li>
<li>第三方库<span><span class="heti-spacing"> </span>thread-local</span></li>
</ul>
</li>
</ul>
<p><strong>TODO：歇逼了，以后有时间有耐心了再看多线程</strong></p>
<h2 id="_64">全局变量<a class="headerlink" href="#_64" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>编译期初始化<ul>
<li>静态常量<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>const<span class="heti-spacing"> </span></span>定义，必须指定类型，命名一般全大写</li>
<li>可以在任意作用域定义，生命周期贯穿整个程序</li>
<li>赋值只能是在编译期就能计算的表达式</li>
<li>不允许出现重复定义</li>
</ul>
</li>
<li>静态变量<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>static<span class="heti-spacing"> </span></span>定义，必须指定类型，命名一般全大写</li>
<li>必须使用<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>语句块才能访问和修改<span class="heti-skip"><span class="heti-spacing"> </span>static<span class="heti-spacing"> </span></span>变量</li>
<li>只有在同一线程内或者不在乎多线程中数据准确性时才应该使用全局静态变量</li>
<li>赋值只能是在编译期就能计算的表达式</li>
<li>静态变量不会被内联，且整个程序中只有一个实例</li>
<li>存储在静态变量中的值需要实现<span><span class="heti-spacing"> </span>Sync trait</span></li>
</ul>
</li>
<li>原子类型<ul>
<li>可以作为全局计数器，且是线程安全的
<div class="highlight"><pre><span></span><code><a href="#__codelineno-155-1" id="__codelineno-155-1" name="__codelineno-155-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">sync</span><span class="p">::</span><span class="n">atomic</span><span class="p">::{</span><span class="n">AtomicUsize</span><span class="p">.</span><span class="w"> </span><span class="n">Ordering</span><span class="p">};</span>
<a href="#__codelineno-155-2" id="__codelineno-155-2" name="__codelineno-155-2"></a><span class="k">static</span><span class="w"> </span><span class="n">VAR</span><span class="p">:</span><span class="w"> </span><span class="nc">AtomicUsize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AtomicUsize</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a href="#__codelineno-155-3" id="__codelineno-155-3" name="__codelineno-155-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-155-4" id="__codelineno-155-4" name="__codelineno-155-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">100</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-155-5" id="__codelineno-155-5" name="__codelineno-155-5"></a><span class="w">        </span><span class="n">VAR</span><span class="p">.</span><span class="n">fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Ordering</span><span class="p">::</span><span class="n">Relaxed</span><span class="p">);</span>
<a href="#__codelineno-155-6" id="__codelineno-155-6" name="__codelineno-155-6"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-155-7" id="__codelineno-155-7" name="__codelineno-155-7"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>运行期初始化<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>lazy_static<span class="heti-spacing"> </span></span>包中的<span class="heti-skip"><span class="heti-spacing"> </span>lazy_static<span class="heti-spacing"> </span></span>宏</li>
<li>使用<span><span class="heti-spacing"> </span>Box::leak</span></li>
</ul>
</li>
</ul>
<h2 id="_65">错误处理<a class="headerlink" href="#_65" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>组合器<ul>
<li><span>.or() .and()<span class="heti-spacing"> </span></span>对两个<span class="heti-skip"><span class="heti-spacing"> </span>Option / Result<span class="heti-spacing"> </span></span>进行类似布尔类型的操作返回其中一个，如：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-156-1" id="__codelineno-156-1" name="__codelineno-156-1"></a><span class="nb">None</span><span class="p">.</span><span class="n">or</span><span class="p">(</span><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="c1">// -&gt; Some(1)</span>
<a href="#__codelineno-156-2" id="__codelineno-156-2" name="__codelineno-156-2"></a><span class="nb">Ok</span><span class="p">(</span><span class="s">"ok"</span><span class="p">).</span><span class="n">and</span><span class="p">(</span><span class="nb">Err</span><span class="p">(</span><span class="s">"err"</span><span class="p">))</span><span class="w"> </span><span class="c1">// -&gt; Err("err")</span>
</code></pre></div></li>
<li><span>.or_else() .and_then()<span class="heti-spacing"> </span></span>第二个表达式是一个返回<span class="heti-skip"><span class="heti-spacing"> </span>Option / Result<span class="heti-spacing"> </span></span>的闭包，其他和<span class="heti-skip"><span class="heti-spacing"> </span>or and<span class="heti-spacing"> </span></span>用法一样</li>
<li><span>.filter()<span class="heti-spacing"> </span></span>可以对<span class="heti-skip"><span class="heti-spacing"> </span>Option<span class="heti-spacing"> </span></span>进行过滤
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-157-1" id="__codelineno-157-1" name="__codelineno-157-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<a href="#__codelineno-157-2" id="__codelineno-157-2" name="__codelineno-157-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>
<a href="#__codelineno-157-3" id="__codelineno-157-3" name="__codelineno-157-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">None</span><span class="p">;</span>
<a href="#__codelineno-157-4" id="__codelineno-157-4" name="__codelineno-157-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">fn_is_even</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">i8</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a href="#__codelineno-157-5" id="__codelineno-157-5" name="__codelineno-157-5"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">s1</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fn_is_even</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">  </span><span class="c1">// Some(3) -&gt; 3 is not even -&gt; None</span>
<a href="#__codelineno-157-6" id="__codelineno-157-6" name="__codelineno-157-6"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fn_is_even</span><span class="p">),</span><span class="w"> </span><span class="n">s2</span><span class="p">);</span><span class="w"> </span><span class="c1">// Some(6) -&gt; 6 is even -&gt; Some(6)</span>
<a href="#__codelineno-157-7" id="__codelineno-157-7" name="__codelineno-157-7"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="n">fn_is_even</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">   </span><span class="c1">// None -&gt; no value -&gt; None</span>
</code></pre></div></li>
<li>.map() .map_err()<ul>
<li><span>.map()<span class="heti-spacing"> </span></span>根据闭包将<span class="heti-skip"><span class="heti-spacing"> </span>Some<span class="heti-spacing"> </span></span>或<span class="heti-skip"><span class="heti-spacing"> </span>Ok<span class="heti-spacing"> </span></span>中的值更改为另一个
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-158-1" id="__codelineno-158-1" name="__codelineno-158-1"></a><span class="nb">Some</span><span class="p">(</span><span class="s">"..."</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">chars</span><span class="p">().</span><span class="n">count</span><span class="p">())</span><span class="w"> </span><span class="c1">// -&gt; Some(3)</span>
</code></pre></div></li>
<li><span>.map_err()<span class="heti-spacing"> </span></span>同理，是将<span class="heti-skip"><span class="heti-spacing"> </span>Err<span class="heti-spacing"> </span></span>中的值更改为另一个</li>
</ul>
</li>
<li>.map_or() .map_or_else()<ul>
<li><span>.map_or()<span class="heti-spacing"> </span></span>包含两个参数，当调用者是<span class="heti-skip"><span class="heti-spacing"> </span>Ok / Some<span class="heti-spacing"> </span></span>时，执行第二个参数中的闭包，返回闭包的返回值；当调用者是<span class="heti-skip"><span class="heti-spacing"> </span>Err / None<span class="heti-spacing"> </span></span>时返回第一个参数作为默认值</li>
<li><span>.map_or_else()<span class="heti-spacing"> </span></span>类似<span><span class="heti-spacing"> </span>map_or</span>，不过第一个参数即默认值也使用闭包来提供</li>
</ul>
</li>
<li>.ok_or() .ok_or_else()<ul>
<li><span>.ok_or()<span class="heti-spacing"> </span></span>将<span class="heti-skip"><span class="heti-spacing"> </span>Option<span class="heti-spacing"> </span></span>转换为<span><span class="heti-spacing"> </span>Result</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-159-1" id="__codelineno-159-1" name="__codelineno-159-1"></a><span class="nb">Some</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">ok_or</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span><span class="w"> </span><span class="c1">// -&gt; Ok(1)</span>
<a href="#__codelineno-159-2" id="__codelineno-159-2" name="__codelineno-159-2"></a><span class="nb">None</span><span class="p">.</span><span class="n">ok_or</span><span class="p">(</span><span class="s">"..."</span><span class="p">)</span><span class="w"> </span><span class="c1">// -&gt; Err("...")</span>
</code></pre></div></li>
<li><span>.ok_or_else()<span class="heti-spacing"> </span></span>类似，但参数由闭包来提供</li>
</ul>
</li>
</ul>
</li>
<li>自定义错误类型<ul>
<li><span>std::error::Error trait<span class="heti-spacing"> </span></span>定义
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-160-1" id="__codelineno-160-1" name="__codelineno-160-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">::{</span><span class="n">Debug</span><span class="p">,</span><span class="w"> </span><span class="n">Display</span><span class="p">};</span>
<a href="#__codelineno-160-2" id="__codelineno-160-2" name="__codelineno-160-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Error</span><span class="p">:</span><span class="w"> </span><span class="nc">Debug</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Display</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-160-3" id="__codelineno-160-3" name="__codelineno-160-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">source</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="p">(</span><span class="n">Error</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">'</span><span class="nb">static</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* 有默认实现 */</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-160-4" id="__codelineno-160-4" name="__codelineno-160-4"></a><span class="p">}</span>
</code></pre></div><ul>
<li>由此可见，自定义错误类型只需要自动<span><span class="heti-spacing"> </span>derive Debug</span>，然后手动实现一下<span><span class="heti-spacing"> </span>Display trait</span></li>
</ul>
</li>
<li>自定义错误类型
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-161-1" id="__codelineno-161-1" name="__codelineno-161-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">;</span>
<a href="#__codelineno-161-2" id="__codelineno-161-2" name="__codelineno-161-2"></a><span class="cp">#[derive(Debug)]</span>
<a href="#__codelineno-161-3" id="__codelineno-161-3" name="__codelineno-161-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyError</span><span class="p">;</span>
<a href="#__codelineno-161-4" id="__codelineno-161-4" name="__codelineno-161-4"></a><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyError</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-161-5" id="__codelineno-161-5" name="__codelineno-161-5"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-161-6" id="__codelineno-161-6" name="__codelineno-161-6"></a><span class="w">        </span><span class="fm">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">"my error"</span><span class="p">)</span>
<a href="#__codelineno-161-7" id="__codelineno-161-7" name="__codelineno-161-7"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-161-8" id="__codelineno-161-8" name="__codelineno-161-8"></a><span class="p">}</span>
<a href="#__codelineno-161-9" id="__codelineno-161-9" name="__codelineno-161-9"></a><span class="k">fn</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">MyError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-161-10" id="__codelineno-161-10" name="__codelineno-161-10"></a><span class="w">    </span><span class="nb">Err</span><span class="p">(</span><span class="n">MyError</span><span class="p">)</span>
<a href="#__codelineno-161-11" id="__codelineno-161-11" name="__codelineno-161-11"></a><span class="p">}</span>
</code></pre></div></li>
<li>错误转换<span><span class="heti-spacing"> </span>From trait</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-162-1" id="__codelineno-162-1" name="__codelineno-162-1"></a><span class="cp">#[derive(Debug)]</span>
<a href="#__codelineno-162-2" id="__codelineno-162-2" name="__codelineno-162-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyError</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-162-3" id="__codelineno-162-3" name="__codelineno-162-3"></a><span class="w">    </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<a href="#__codelineno-162-4" id="__codelineno-162-4" name="__codelineno-162-4"></a><span class="p">}</span>
<a href="#__codelineno-162-5" id="__codelineno-162-5" name="__codelineno-162-5"></a><span class="k">impl</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyError</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-162-6" id="__codelineno-162-6" name="__codelineno-162-6"></a><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyError</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-162-7" id="__codelineno-162-7" name="__codelineno-162-7"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="nc">io</span><span class="p">::</span><span class="n">Error</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-162-8" id="__codelineno-162-8" name="__codelineno-162-8"></a><span class="w">        </span><span class="n">MyError</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-162-9" id="__codelineno-162-9" name="__codelineno-162-9"></a><span class="w">            </span><span class="n">message</span><span class="p">:</span><span class="w"> </span><span class="nc">error</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span>
<a href="#__codelineno-162-10" id="__codelineno-162-10" name="__codelineno-162-10"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-162-11" id="__codelineno-162-11" name="__codelineno-162-11"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-162-12" id="__codelineno-162-12" name="__codelineno-162-12"></a><span class="p">}</span>
</code></pre></div><ul>
<li>这样实现了之后就可以在<span class="heti-skip"><span class="heti-spacing"> </span>?<span class="heti-spacing"> </span></span>的时候支持自动将<span class="heti-skip"><span class="heti-spacing"> </span>io::Error<span class="heti-spacing"> </span></span>转换成<span><span class="heti-spacing"> </span>MyError</span></li>
</ul>
</li>
</ul>
</li>
<li>归一化错误类型<ul>
<li>例如将<span class="heti-skip"><span class="heti-spacing"> </span>std::env::VarError<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>std::io::Error<span class="heti-spacing"> </span></span>归一化为同一种类型</li>
<li>可以使用特征对象</li>
<li>可以自定义<span class="heti-skip"><span class="heti-spacing"> </span>enum<span class="heti-spacing"> </span></span>错误类型，但是代码较复杂</li>
<li>可以使用第三方包<span class="heti-skip"><span class="heti-spacing"> </span>thiserror<span class="heti-spacing"> </span></span>来简化自定义错误类型集合
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-163-1" id="__codelineno-163-1" name="__codelineno-163-1"></a><span class="cp">#[derive(thiserror::Error, Debug)]</span>
<a href="#__codelineno-163-2" id="__codelineno-163-2" name="__codelineno-163-2"></a><span class="k">enum</span><span class="w"> </span><span class="nc">MyError</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-163-3" id="__codelineno-163-3" name="__codelineno-163-3"></a><span class="w">    </span><span class="cp">#[error(</span><span class="s">"Environment variable not found"</span><span class="cp">)]</span>
<a href="#__codelineno-163-4" id="__codelineno-163-4" name="__codelineno-163-4"></a><span class="w">    </span><span class="n">EnvironmentVariableNotFound</span><span class="p">(</span><span class="cp">#[from]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">env</span><span class="p">::</span><span class="n">VarError</span><span class="p">),</span>
<a href="#__codelineno-163-5" id="__codelineno-163-5" name="__codelineno-163-5"></a><span class="w">    </span><span class="cp">#[error(transparent)]</span>
<a href="#__codelineno-163-6" id="__codelineno-163-6" name="__codelineno-163-6"></a><span class="w">    </span><span class="n">IOError</span><span class="p">(</span><span class="cp">#[from]</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="p">),</span>
<a href="#__codelineno-163-7" id="__codelineno-163-7" name="__codelineno-163-7"></a><span class="p">}</span>
</code></pre></div></li>
<li>可以使用第三方包<span class="heti-skip"><span class="heti-spacing"> </span>anyhow<span class="heti-spacing"> </span></span>中的<span><span class="heti-spacing"> </span>anyhow::Result&lt;T&gt;</span>，不关心错误消息</li>
</ul>
</li>
</ul>
<h2 id="unsafe">unsafe<a class="headerlink" href="#unsafe" title="Permanent link">¶</a></h2>
<p><span>unsafe<span class="heti-spacing"> </span></span>代码块有五种能力</p>
<ul>
<li>解引用裸指针</li>
<li>调用一个<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>或外部的函数</li>
<li>访问或修改一个可变的静态变量（前面介绍过了）</li>
<li>实现一个<span><span class="heti-spacing"> </span>unsafe trait</span></li>
<li>访问<span class="heti-skip"><span class="heti-spacing"> </span>union<span class="heti-spacing"> </span></span>中的字段</li>
</ul>
<p>但<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>代码块仍然受<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>的安全支持，它并不能绕过<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>的借用检查，也不能关闭任何<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>的安全检查</p>
<h3 id="_66">解引用裸指针<a class="headerlink" href="#_66" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>裸指针<ul>
<li>裸指针不适用<span class="heti-skip"><span class="heti-spacing"> </span>Rust<span class="heti-spacing"> </span></span>的借用规则，同时拥有一个数据的可变和不可变指针</li>
<li>裸指针不能保证指向合法的内存</li>
<li>裸指针可以是<span><span class="heti-spacing"> </span>null</span></li>
<li>裸指针没有实现任何自动的回收（drop）</li>
<li>裸指针可以使用加减法（对地址操作<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，但是这不会考虑单元大小，建议对裸指针调用<span class="heti-skip"><span class="heti-spacing"> </span>.add<span class="heti-spacing"> </span></span>方法（会自动乘单元大小）</li>
</ul>
</li>
<li>创建裸指针<ul>
<li>创建裸指针是<span class="heti-skip"><span class="heti-spacing"> </span>safe<span class="heti-spacing"> </span></span>的，不需要写在<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>块中</li>
<li>裸指针有两种写法：<code class="highlight"><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">T</span></code> 和 <code class="highlight"><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="n">T</span></code> 分别表示<span class="heti-skip"><span class="heti-spacing"> </span>T<span class="heti-spacing"> </span></span>类型的不可变指针和可变指针（这里的<span class="heti-skip"><span class="heti-spacing"> </span>*<span class="heti-spacing"> </span></span>仅仅是记号，不表示解引用的含义）</li>
<li>基于引用创建裸指针
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-164-1" id="__codelineno-164-1" name="__codelineno-164-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a href="#__codelineno-164-2" id="__codelineno-164-2" name="__codelineno-164-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">num</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
<a href="#__codelineno-164-3" id="__codelineno-164-3" name="__codelineno-164-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">num</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
</code></pre></div></li>
<li>基于内存地址创建裸指针
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-165-1" id="__codelineno-165-1" name="__codelineno-165-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x012345</span><span class="k">usize</span><span class="p">;</span>
<a href="#__codelineno-165-2" id="__codelineno-165-2" name="__codelineno-165-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
</code></pre></div><ul>
<li>相当危险，但创建这样的裸指针仍然是<span class="heti-skip"><span class="heti-spacing"> </span>safe<span class="heti-spacing"> </span></span>的，只要不解引用</li>
</ul>
</li>
<li>基于智能指针创建裸指针
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-166-1" id="__codelineno-166-1" name="__codelineno-166-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a href="#__codelineno-166-2" id="__codelineno-166-2" name="__codelineno-166-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;*</span><span class="n">a</span><span class="p">;</span>
<a href="#__codelineno-166-3" id="__codelineno-166-3" name="__codelineno-166-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="p">::</span><span class="n">into_raw</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</code></pre></div></li>
<li>调用方法创建裸指针<ul>
<li>例如<span class="heti-skip"><span class="heti-spacing"> </span>String<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>.as_ptr()<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>.as_mut_ptr()<span class="heti-spacing"> </span></span>方法</li>
</ul>
</li>
</ul>
</li>
<li>解引用裸指针<ul>
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>块中可以直接使用<span class="heti-skip"><span class="heti-spacing"> </span>*<span class="heti-spacing"> </span></span>对裸指针进行解引用</li>
</ul>
</li>
</ul>
<h3 id="unsafe_1">调用<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>或外部函数<a class="headerlink" href="#unsafe_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="unsafe_2"><span>unsafe<span class="heti-spacing"> </span></span>函数<a class="headerlink" href="#unsafe_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>unsafe fn<span class="heti-spacing"> </span></span>定义</li>
<li>不能直接调用，只能在<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>块中调用，即要确保认识到了正在调用的是一个不安全的函数</li>
<li>包含<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>块的函数不必都标记为<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>函数，因为有些函数虽然用了<span><span class="heti-spacing"> </span>unsafe</span>，但操作实际上是完全安全的（编译器保守认为其不安全）</li>
</ul>
<h4 id="ffi">FFI<a class="headerlink" href="#ffi" title="Permanent link">¶</a></h4>
<ul>
<li>即<span><span class="heti-spacing"> </span>Foreign Function Interface</span>，用来和其他语言进行交互</li>
<li><span>rust<span class="heti-spacing"> </span></span>调用<span><span class="heti-spacing"> </span>c</span><ul>
<li>需要在<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>代码中写明要调用的函数签名</li>
<li>调用必须在<span class="heti-skip"><span class="heti-spacing"> </span>unsafe<span class="heti-spacing"> </span></span>块中进行</li>
<li>例如调用<span class="heti-skip"><span class="heti-spacing"> </span>C<span class="heti-spacing"> </span></span>标准库中的<span class="heti-skip"><span class="heti-spacing"> </span>abs<span class="heti-spacing"> </span></span>函数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-167-1" id="__codelineno-167-1" name="__codelineno-167-1"></a><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-167-2" id="__codelineno-167-2" name="__codelineno-167-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">abs</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
<a href="#__codelineno-167-3" id="__codelineno-167-3" name="__codelineno-167-3"></a><span class="p">}</span>
<a href="#__codelineno-167-4" id="__codelineno-167-4" name="__codelineno-167-4"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-167-5" id="__codelineno-167-5" name="__codelineno-167-5"></a><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">"abs(-1) = {}"</span><span class="p">,</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="p">}</span>
<a href="#__codelineno-167-6" id="__codelineno-167-6" name="__codelineno-167-6"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li><span>c<span class="heti-spacing"> </span></span>调用<span><span class="heti-spacing"> </span>rust</span>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-168-1" id="__codelineno-168-1" name="__codelineno-168-1"></a><span class="cp">#[no_mangle]</span>
<a href="#__codelineno-168-2" id="__codelineno-168-2" name="__codelineno-168-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="s">"C"</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">call_from_c</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-168-3" id="__codelineno-168-3" name="__codelineno-168-3"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Call from C"</span><span class="p">);</span>
<a href="#__codelineno-168-4" id="__codelineno-168-4" name="__codelineno-168-4"></a><span class="p">}</span>
</code></pre></div><ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>extern<span class="heti-spacing"> </span></span>创建一个接口</li>
<li><code class="highlight"><span class="cp">#[no_mangle]</span></code> 告诉编译器不要修饰函数名</li>
</ul>
</li>
<li>实用工具<ul>
<li>自动生成<span class="heti-skip"><span class="heti-spacing"> </span>FFI<span class="heti-spacing"> </span></span>接口<ul>
<li>生成<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>调用<span class="heti-skip"><span class="heti-spacing"> </span>c<span class="heti-spacing"> </span></span>的代码：<a href="https://github.com/rust-lang/rust-bindgen"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path></svg></span> rust-lang/rust-bindgen</a></li>
<li>从<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>代码生成<span><span class="heti-spacing"> </span>c bindings</span>：<a href="https://github.com/eqrion/cbindgen"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path></svg></span> eqrion/cbindgen</a></li>
</ul>
</li>
<li>与<span class="heti-skip"><span class="heti-spacing"> </span>C++<span class="heti-spacing"> </span></span>代码交互（是安全的<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：<a href="https://github.com/dtolnay/cxx"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path></svg></span> dtolnay/cxx</a></li>
</ul>
</li>
</ul>
<h3 id="unsafe-trait">实现<span><span class="heti-spacing"> </span>unsafe trait</span><a class="headerlink" href="#unsafe-trait" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>至少有一个方法包含编译器无法验证的内容的<span class="heti-skip"><span class="heti-spacing"> </span>trait<span class="heti-spacing"> </span></span>会被标为<span><span class="heti-spacing"> </span>unsafe</span></li>
<li>定义使用<span class="heti-skip"><span class="heti-spacing"> </span>unsafe trait<span class="heti-spacing"> </span></span>定义</li>
<li>实现方法使用<span><span class="heti-spacing"> </span>unsafe impl</span></li>
</ul>
<h3 id="union">访问<span class="heti-skip"><span class="heti-spacing"> </span>union<span class="heti-spacing"> </span></span>中字段<a class="headerlink" href="#union" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>类似结构体，但所有字段共用同一个存储空间，即向一个字段中写入值回覆盖其它字段
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-169-1" id="__codelineno-169-1" name="__codelineno-169-1"></a><span class="cp">#[repr(C)]</span>
<a href="#__codelineno-169-2" id="__codelineno-169-2" name="__codelineno-169-2"></a><span class="k">union</span><span class="w"> </span><span class="nc">MyUnion</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-169-3" id="__codelineno-169-3" name="__codelineno-169-3"></a><span class="w">    </span><span class="n">f1</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<a href="#__codelineno-169-4" id="__codelineno-169-4" name="__codelineno-169-4"></a><span class="w">    </span><span class="n">f2</span><span class="p">:</span><span class="w"> </span><span class="kt">f32</span><span class="p">,</span>
<a href="#__codelineno-169-5" id="__codelineno-169-5" name="__codelineno-169-5"></a><span class="p">}</span>
</code></pre></div></li>
<li>访问<span class="heti-skip"><span class="heti-spacing"> </span>union<span class="heti-spacing"> </span></span>字段是不安全的，因为<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>无法保证当前存储在<span class="heti-skip"><span class="heti-spacing"> </span>union<span class="heti-spacing"> </span></span>实例中的数据类型，但写入是安全的</li>
</ul>
<h2 id="macro"><span>macro<span class="heti-spacing"> </span></span>宏编程<a class="headerlink" href="#macro" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_67">声明式宏<a class="headerlink" href="#_67" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>macro_rules!<span class="heti-spacing"> </span></span>进行定义，匹配代码并生成代码
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-170-1" id="__codelineno-170-1" name="__codelineno-170-1"></a><span class="cp">#[macro_export]</span>
<a href="#__codelineno-170-2" id="__codelineno-170-2" name="__codelineno-170-2"></a><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">myvec</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-170-3" id="__codelineno-170-3" name="__codelineno-170-3"></a><span class="w">    </span><span class="p">(</span><span class="w"> </span><span class="cp">$(</span><span class="w"> </span><span class="cp">$x</span><span class="p">:</span><span class="nc">expr</span><span class="w"> </span><span class="p">),</span><span class="o">*</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-170-4" id="__codelineno-170-4" name="__codelineno-170-4"></a><span class="w">        </span><span class="p">{</span>
<a href="#__codelineno-170-5" id="__codelineno-170-5" name="__codelineno-170-5"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">tmp_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a href="#__codelineno-170-6" id="__codelineno-170-6" name="__codelineno-170-6"></a><span class="w">            </span><span class="cp">$(</span>
<a href="#__codelineno-170-7" id="__codelineno-170-7" name="__codelineno-170-7"></a><span class="w">                </span><span class="n">tmp_vec</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="cp">$x</span><span class="p">);</span>
<a href="#__codelineno-170-8" id="__codelineno-170-8" name="__codelineno-170-8"></a><span class="w">            </span><span class="p">)</span><span class="o">*</span>
<a href="#__codelineno-170-9" id="__codelineno-170-9" name="__codelineno-170-9"></a><span class="w">            </span><span class="n">tmp_vec</span>
<a href="#__codelineno-170-10" id="__codelineno-170-10" name="__codelineno-170-10"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-170-11" id="__codelineno-170-11" name="__codelineno-170-11"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-170-12" id="__codelineno-170-12" name="__codelineno-170-12"></a><span class="p">}</span>
</code></pre></div><ul>
<li>宏名称不必加<span><span class="heti-spacing"> </span>!</span>，但调用时需要加</li>
<li><code class="highlight"><span class="cp">#[macro_export]</span></code> 用于导出宏，让其它包可以引入使用</li>
<li>进行输入代码的模式匹配，使用 <code class="highlight"><span class="p">(</span><span class="w"> </span><span class="cp">$(</span><span class="w"> </span><span class="cp">$x</span><span class="p">:</span><span class="nc">expr</span><span class="w"> </span><span class="p">),</span><span class="o">*</span><span class="w"> </span><span class="p">)</span></code> 匹配多个以<span class="heti-skip"><span class="heti-spacing"> </span>,<span class="heti-spacing"> </span></span>分隔的表达式，每个记为<span class="heti-skip"><span class="heti-spacing"> </span>$x<span class="heti-spacing"> </span></span>供后面代码中使用，<span>*<span class="heti-spacing"> </span></span>代表前面的模式可以出现任意次（包括<span><span class="heti-spacing"> </span>0</span>）</li>
<li><span>=&gt;<span class="heti-spacing"> </span></span>后面是要生成的目标代码</li>
<li>可以使用 <code class="highlight"><span class="n">myvec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span></code> 创建<span><span class="heti-spacing"> </span>Vec</span>，也可以使用 <code class="highlight"><span class="n">myvec</span><span class="o">!</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span></code> 或 <code class="highlight"><span class="n">myvec</span><span class="o">!</span><span class="p">{</span><span class="o">..</span><span class="p">.}</span></code>，这三者等价</li>
</ul>
</li>
<li>详细用法<span><span class="heti-spacing"> </span>TODO</span>：<a href="https://veykril.github.io/tlborm/">https://veykril.github.io/tlborm/</a></li>
</ul>
<h3 id="_68">过程宏<a class="headerlink" href="#_68" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>过程宏的定义必须放入独立的<span class="heti-skip"><span class="heti-spacing"> </span>lib crate<span class="heti-spacing"> </span></span>中</li>
<li>自定义<span class="heti-skip"><span class="heti-spacing"> </span>derive<span class="heti-spacing"> </span></span>过程宏<ul>
<li>在当前<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>根目录下创建一个新的<span class="heti-skip"><span class="heti-spacing"> </span>lib crate<span class="heti-spacing"> </span></span>用于编写宏</li>
<li>新的<span class="heti-skip"><span class="heti-spacing"> </span>Cargo.toml<span class="heti-spacing"> </span></span>中需要添加
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-171-1" id="__codelineno-171-1" name="__codelineno-171-1"></a><span class="k">[lib]</span>
<a href="#__codelineno-171-2" id="__codelineno-171-2" name="__codelineno-171-2"></a><span class="n">proc-macro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<a href="#__codelineno-171-3" id="__codelineno-171-3" name="__codelineno-171-3"></a>
<a href="#__codelineno-171-4" id="__codelineno-171-4" name="__codelineno-171-4"></a><span class="k">[dependencies]</span>
<a href="#__codelineno-171-5" id="__codelineno-171-5" name="__codelineno-171-5"></a><span class="n">syn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1.0"</span>
<a href="#__codelineno-171-6" id="__codelineno-171-6" name="__codelineno-171-6"></a><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"1.0"</span>
</code></pre></div></li>
<li>lib.rs
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-172-1" id="__codelineno-172-1" name="__codelineno-172-1"></a><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">proc_macro</span><span class="p">;</span>
<a href="#__codelineno-172-2" id="__codelineno-172-2" name="__codelineno-172-2"></a>
<a href="#__codelineno-172-3" id="__codelineno-172-3" name="__codelineno-172-3"></a><span class="k">use</span><span class="w"> </span><span class="n">proc_macro</span><span class="p">::</span><span class="n">TokenStream</span><span class="p">;</span>
<a href="#__codelineno-172-4" id="__codelineno-172-4" name="__codelineno-172-4"></a><span class="k">use</span><span class="w"> </span><span class="n">quote</span><span class="p">::</span><span class="n">quote</span><span class="p">;</span>
<a href="#__codelineno-172-5" id="__codelineno-172-5" name="__codelineno-172-5"></a><span class="k">use</span><span class="w"> </span><span class="n">syn</span><span class="p">;</span>
<a href="#__codelineno-172-6" id="__codelineno-172-6" name="__codelineno-172-6"></a>
<a href="#__codelineno-172-7" id="__codelineno-172-7" name="__codelineno-172-7"></a><span class="cp">#[proc_macro_derive(HelloMacro)]</span>
<a href="#__codelineno-172-8" id="__codelineno-172-8" name="__codelineno-172-8"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">hello_macro_derive</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-172-9" id="__codelineno-172-9" name="__codelineno-172-9"></a><span class="w">    </span><span class="c1">// 基于 input 构建 AST 语法树</span>
<a href="#__codelineno-172-10" id="__codelineno-172-10" name="__codelineno-172-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">syn</span><span class="p">::</span><span class="n">parse</span><span class="p">(</span><span class="n">input</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
<a href="#__codelineno-172-11" id="__codelineno-172-11" name="__codelineno-172-11"></a>
<a href="#__codelineno-172-12" id="__codelineno-172-12" name="__codelineno-172-12"></a><span class="w">    </span><span class="c1">// 构建特征实现代码</span>
<a href="#__codelineno-172-13" id="__codelineno-172-13" name="__codelineno-172-13"></a><span class="w">    </span><span class="n">impl_hello_macro</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ast</span><span class="p">)</span>
<a href="#__codelineno-172-14" id="__codelineno-172-14" name="__codelineno-172-14"></a><span class="p">}</span>
</code></pre></div></li>
<li><span>impl_hello_macro<span class="heti-spacing"> </span></span>函数
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-173-1" id="__codelineno-173-1" name="__codelineno-173-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">impl_hello_macro</span><span class="p">(</span><span class="n">ast</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">syn</span><span class="p">::</span><span class="n">DeriveInput</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-173-2" id="__codelineno-173-2" name="__codelineno-173-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ast</span><span class="p">.</span><span class="n">ident</span><span class="p">;</span>
<a href="#__codelineno-173-3" id="__codelineno-173-3" name="__codelineno-173-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">gen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quote</span><span class="o">!</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-173-4" id="__codelineno-173-4" name="__codelineno-173-4"></a><span class="w">        </span><span class="k">impl</span><span class="w"> </span><span class="n">HelloMacro</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">#</span><span class="n">name</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-173-5" id="__codelineno-173-5" name="__codelineno-173-5"></a><span class="w">            </span><span class="k">fn</span><span class="w"> </span><span class="nf">hello_macro</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-173-6" id="__codelineno-173-6" name="__codelineno-173-6"></a><span class="w">                </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Hello, Macro! My name is {}!"</span><span class="p">,</span><span class="w"> </span><span class="fm">stringify!</span><span class="p">(#</span><span class="n">name</span><span class="p">));</span>
<a href="#__codelineno-173-7" id="__codelineno-173-7" name="__codelineno-173-7"></a><span class="w">            </span><span class="p">}</span>
<a href="#__codelineno-173-8" id="__codelineno-173-8" name="__codelineno-173-8"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-173-9" id="__codelineno-173-9" name="__codelineno-173-9"></a><span class="w">    </span><span class="p">};</span>
<a href="#__codelineno-173-10" id="__codelineno-173-10" name="__codelineno-173-10"></a><span class="w">    </span><span class="n">gen</span><span class="p">.</span><span class="n">into</span><span class="p">()</span>
<a href="#__codelineno-173-11" id="__codelineno-173-11" name="__codelineno-173-11"></a><span class="p">}</span>
</code></pre></div><ul>
<li>读取<span><span class="heti-spacing"> </span>ast</span>，使用<span class="heti-skip"><span class="heti-spacing"> </span>quote<span class="heti-spacing"> </span></span>生成代码，然后调用<span class="heti-skip"><span class="heti-spacing"> </span>.into<span class="heti-spacing"> </span></span>转换成<span><span class="heti-spacing"> </span>TokenStream</span></li>
</ul>
</li>
<li>导入这个<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>之后就可以使用 <code class="highlight"><span class="cp">#[derive(HelloMacro)]</span></code> 生成代码自动实现<span class="heti-skip"><span class="heti-spacing"> </span>HelloMacro<span class="heti-spacing"> </span></span>了</li>
</ul>
</li>
<li>类属性宏（attribute-like macros）<ul>
<li>例如修饰一个函数：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-174-1" id="__codelineno-174-1" name="__codelineno-174-1"></a><span class="cp">#[route(GET, </span><span class="s">"/"</span><span class="cp">)]</span>
<a href="#__codelineno-174-2" id="__codelineno-174-2" name="__codelineno-174-2"></a><span class="k">fn</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></li>
<li>也需要一个独立的<span class="heti-skip"><span class="heti-spacing"> </span>crate<span class="heti-spacing"> </span></span>来定义，定义函数：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-175-1" id="__codelineno-175-1" name="__codelineno-175-1"></a><span class="cp">#[proc_macro_attribute]</span>
<a href="#__codelineno-175-2" id="__codelineno-175-2" name="__codelineno-175-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">route</span><span class="p">(</span><span class="n">attr</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenStream</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-175-3" id="__codelineno-175-3" name="__codelineno-175-3"></a><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-175-4" id="__codelineno-175-4" name="__codelineno-175-4"></a><span class="p">}</span>
</code></pre></div><ul>
<li><span>attr<span class="heti-spacing"> </span></span>是属性包含的内容，如上例子中的<span><span class="heti-spacing"> </span>GET, "/"</span></li>
<li><span>item<span class="heti-spacing"> </span></span>是标注的项，如上例子中的<span class="heti-skip"><span class="heti-spacing"> </span>fn index() { ... }<span class="heti-spacing"> </span></span>即整个函数体</li>
</ul>
</li>
</ul>
</li>
<li>类函数宏<ul>
<li>和声明宏的使用方式类似，但和前两种过程宏的定义方式类似</li>
<li>例如如下调用解析<span class="heti-skip"><span class="heti-spacing"> </span>SQL<span class="heti-spacing"> </span></span>语句：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-176-1" id="__codelineno-176-1" name="__codelineno-176-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sql</span><span class="o">!</span><span class="p">(</span><span class="n">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="n">posts</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div><ul>
<li>需要对<span class="heti-skip"><span class="heti-spacing"> </span>SQL<span class="heti-spacing"> </span></span>语句进行解析，<span>macro_rules<span class="heti-spacing"> </span></span>难以实现</li>
</ul>
</li>
<li>类函数宏定义形式：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-177-1" id="__codelineno-177-1" name="__codelineno-177-1"></a><span class="cp">#[proc_macro]</span>
<a href="#__codelineno-177-2" id="__codelineno-177-2" name="__codelineno-177-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">sql</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="w"> </span><span class="nc">TokenStream</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">TokenStream</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-177-3" id="__codelineno-177-3" name="__codelineno-177-3"></a><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-177-4" id="__codelineno-177-4" name="__codelineno-177-4"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>TODO<ul>
<li>过程宏：<a href="https://github.com/dtolnay/proc-macro-workshop">https://github.com/dtolnay/proc-macro-workshop</a>、<a href="https://blog.turbo.fish/">https://blog.turbo.fish/</a></li>
<li>声明宏：<a href="https://veykril.github.io/tlborm/">https://veykril.github.io/tlborm/</a>、<a href="https://zjp-cn.github.io/tlborm/">https://zjp-cn.github.io/tlborm/</a></li>
</ul>
</li>
</ul>
<h2 id="_69">测试<a class="headerlink" href="#_69" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_70">断言<a class="headerlink" href="#_70" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>assert_eq!<span class="heti-spacing"> </span></span>宏用于判断两个表达式的值是否相等<ul>
<li>不相等当前线程会直接<span><span class="heti-spacing"> </span>panic</span></li>
<li>可以从第三个参数开始补充格式化输出额外信息
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-178-1" id="__codelineno-178-1" name="__codelineno-178-1"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="s">"额外信息：a = {}..."</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
</code></pre></div></li>
</ul>
</li>
<li><span>assert_ne!<span class="heti-spacing"> </span></span>宏类似，不过相等会<span><span class="heti-spacing"> </span>panic</span></li>
<li><span>assert!<span class="heti-spacing"> </span></span>宏用于判断传入的布尔表达式是否为<span><span class="heti-spacing"> </span>true</span>，为<span class="heti-skip"><span class="heti-spacing"> </span>false<span class="heti-spacing"> </span></span>的话会<span><span class="heti-spacing"> </span>panic</span></li>
<li><span>debug_assert_eq! debug_assert_ne! debug_assert!<span class="heti-spacing"> </span></span>宏用法相同，但是只会在<span class="heti-skip"><span class="heti-spacing"> </span>Debug<span class="heti-spacing"> </span></span>模式下运行，例如<span class="heti-skip"><span class="heti-spacing"> </span>cargo run --release<span class="heti-spacing"> </span></span>就不会执行这些断言</li>
</ul>
<h3 id="_71">编写测试<a class="headerlink" href="#_71" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><span>rust<span class="heti-spacing"> </span></span>只会能<span class="heti-skip"><span class="heti-spacing"> </span>lib crate<span class="heti-spacing"> </span></span>进行测试，而无法对<span class="heti-skip"><span class="heti-spacing"> </span>bin crate<span class="heti-spacing"> </span></span>测试</li>
<li>单元测试<ul>
<li>定义一个<span class="heti-skip"><span class="heti-spacing"> </span>mod<span class="heti-spacing"> </span></span>并标记为<span><span class="heti-spacing"> </span>test</span>：
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-179-1" id="__codelineno-179-1" name="__codelineno-179-1"></a><span class="cp">#[cfg(test)]</span>
<a href="#__codelineno-179-2" id="__codelineno-179-2" name="__codelineno-179-2"></a><span class="k">mod</span><span class="w"> </span><span class="nn">tests</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-179-3" id="__codelineno-179-3" name="__codelineno-179-3"></a><span class="w">    </span><span class="cp">#[test]</span>
<a href="#__codelineno-179-4" id="__codelineno-179-4" name="__codelineno-179-4"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">test1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-179-5" id="__codelineno-179-5" name="__codelineno-179-5"></a><span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a href="#__codelineno-179-6" id="__codelineno-179-6" name="__codelineno-179-6"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-179-7" id="__codelineno-179-7" name="__codelineno-179-7"></a><span class="p">}</span>
</code></pre></div></li>
<li><span>panic<span class="heti-spacing"> </span></span>了则不通过</li>
<li>对于测试函数添加一个 <code class="highlight"><span class="cp">#[should_panic]</span></code> 可以标记<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>为期望结果，不<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>则不通过<ul>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>expected<span class="heti-spacing"> </span></span>参数来表示期望得到的<span class="heti-skip"><span class="heti-spacing"> </span>panic<span class="heti-spacing"> </span></span>字符串
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-180-1" id="__codelineno-180-1" name="__codelineno-180-1"></a><span class="cp">#[test]</span>
<a href="#__codelineno-180-2" id="__codelineno-180-2" name="__codelineno-180-2"></a><span class="cp">#[should_panic(expected=</span><span class="s">"..."</span><span class="cp">)]</span>
<a href="#__codelineno-180-3" id="__codelineno-180-3" name="__codelineno-180-3"></a><span class="k">fn</span><span class="w"> </span><span class="nf">test2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-180-4" id="__codelineno-180-4" name="__codelineno-180-4"></a><span class="w">    </span><span class="o">..</span><span class="p">.</span>
<a href="#__codelineno-180-5" id="__codelineno-180-5" name="__codelineno-180-5"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>可以使用<span class="heti-skip"><span class="heti-spacing"> </span>Result<span class="heti-spacing"> </span></span>作为返回值，返回<span class="heti-skip"><span class="heti-spacing"> </span>Err<span class="heti-spacing"> </span></span>则不通过，可以这样来实现测试的链式调用，但 <code class="highlight"><span class="cp">#[should_panic]</span></code> 在此时将不可用</li>
<li>使用 <code class="highlight"><span class="cp">#[ignore]</span></code> 来忽略当前测试<ul>
<li><span>cargo test<span class="heti-spacing"> </span></span>时传入<span class="heti-skip"><span class="heti-spacing"> </span>--ignored<span class="heti-spacing"> </span></span>可以执行忽略的测试</li>
</ul>
</li>
</ul>
</li>
<li>集成测试<ul>
<li><span>tests<span class="heti-spacing"> </span></span>目录用来专门存放集成测试，<span>cargo<span class="heti-spacing"> </span></span>会从中寻找测试文件，在测试时都会运行</li>
<li>每个文件内部不需要 <code class="highlight"><span class="cp">#[cfg(test)]</span></code> 以及不需要创建<span><span class="heti-spacing"> </span>mod</span></li>
<li><span>cargo test --test name<span class="heti-spacing"> </span></span>来仅测试<span class="heti-skip"><span class="heti-spacing"> </span>tests/name.rs<span class="heti-spacing"> </span></span>文件</li>
<li><span>tests<span class="heti-spacing"> </span></span>目录下的子目录中的文件不会被当作独立的包也不会有测试输出，可以通过子目录创建模块来存放测试时会使用但不希望被测试的代码</li>
</ul>
</li>
<li>cargo test<ul>
<li><span>cargo test<span class="heti-spacing"> </span></span>执行所有测试<ul>
<li>单元测试、集成测试、文档测试</li>
</ul>
</li>
<li>使用<span class="heti-skip"><span class="heti-spacing"> </span>--<span class="heti-spacing"> </span></span>附加参数<ul>
<li><span>--<span class="heti-spacing"> </span></span>后加<span class="heti-skip"><span class="heti-spacing"> </span>--test-threads=...<span class="heti-spacing"> </span></span>来指定进行测试的线程数</li>
<li><span>--<span class="heti-spacing"> </span></span>后加<span class="heti-skip"><span class="heti-spacing"> </span>--show-output<span class="heti-spacing"> </span></span>来输出标准输出中内容<ul>
<li>默认情况下测试时如果通过则标准输出的内容不会显示出来</li>
</ul>
</li>
<li><span>--<span class="heti-spacing"> </span></span>后加<span class="heti-skip"><span class="heti-spacing"> </span>--ignored<span class="heti-spacing"> </span></span>来仅运行忽略的测试</li>
<li><span>--<span class="heti-spacing"> </span></span>后加<span class="heti-skip"><span class="heti-spacing"> </span>--no-run<span class="heti-spacing"> </span></span>仅编译出测试二进制文件而不运行</li>
</ul>
</li>
<li>运行部分测试<ul>
<li><span>cargo test name<span class="heti-spacing"> </span></span>来运行函数名里包含<span class="heti-skip"><span class="heti-spacing"> </span>name<span class="heti-spacing"> </span></span>的测试函数<ul>
<li>模块名也包含在其中，所以可以依此分模块进行测试</li>
</ul>
</li>
</ul>
</li>
<li><span>Cargo.toml<span class="heti-spacing"> </span></span>中加入<span class="heti-skip"><span class="heti-spacing"> </span>[dev-dependencies]<span class="heti-spacing"> </span></span>指定仅在<span class="heti-skip"><span class="heti-spacing"> </span>test<span class="heti-spacing"> </span></span>时会用到的依赖</li>
<li><span>cargo test<span class="heti-spacing"> </span></span>时会生成可运行测试的二进制文件，保存在<span class="heti-skip"><span class="heti-spacing"> </span>target/debug/deps/<span class="heti-spacing"> </span></span>中</li>
</ul>
</li>
<li>基准测试<span><span class="heti-spacing"> </span>benchmark</span><ul>
<li>官方<span><span class="heti-spacing"> </span>benchmark</span><ul>
<li>只能在非<span class="heti-skip"><span class="heti-spacing"> </span>stable<span class="heti-spacing"> </span></span>版本下使用，需要引入特性 <code class="highlight"><span class="cp">#![feature(test)]</span></code></li>
<li>和<span class="heti-skip"><span class="heti-spacing"> </span>test<span class="heti-spacing"> </span></span>一样写在 <code class="highlight"><span class="cp">#[cfg(test)]</span></code> 中，但不标记为 <code class="highlight"><span class="cp">#[test]</span></code> 而是 <code class="highlight"><span class="cp">#[bench]</span></code>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-181-1" id="__codelineno-181-1" name="__codelineno-181-1"></a><span class="cp">#[bench]</span>
<a href="#__codelineno-181-2" id="__codelineno-181-2" name="__codelineno-181-2"></a><span class="k">fn</span><span class="w"> </span><span class="nf">bench_test</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Bencher</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-181-3" id="__codelineno-181-3" name="__codelineno-181-3"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="o">..</span><span class="p">.);</span>
<a href="#__codelineno-181-4" id="__codelineno-181-4" name="__codelineno-181-4"></a><span class="p">}</span>
</code></pre></div><ul>
<li>初始化代码要写在<span class="heti-skip"><span class="heti-spacing"> </span>iter<span class="heti-spacing"> </span></span>之外，否则会多次循环</li>
</ul>
</li>
<li><span>cargo test<span class="heti-spacing"> </span></span>会执行<span class="heti-skip"><span class="heti-spacing"> </span>benchmark<span class="heti-spacing"> </span></span>部分但不会有性能测试的输出结果</li>
<li>通过<span class="heti-skip"><span class="heti-spacing"> </span>cargo bench<span class="heti-spacing"> </span></span>来执行<span class="heti-skip"><span class="heti-spacing"> </span>benchmark<span class="heti-spacing"> </span></span>代码，此时非<span class="heti-skip"><span class="heti-spacing"> </span>bench<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>test<span class="heti-spacing"> </span></span>会被<span><span class="heti-spacing"> </span>ignore</span></li>
<li><span>LLVM<span class="heti-spacing"> </span></span>会将没有副作用的函数直接优化删掉，可以使用<span class="heti-skip"><span class="heti-spacing"> </span>test::black_box<span class="heti-spacing"> </span></span>来包裹防止被优化，如
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-182-1" id="__codelineno-182-1" name="__codelineno-182-1"></a><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<a href="#__codelineno-182-2" id="__codelineno-182-2" name="__codelineno-182-2"></a><span class="w">    </span><span class="n">test</span><span class="p">::</span><span class="n">black_box</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">test</span><span class="p">::</span><span class="n">black_box</span><span class="p">(</span><span class="n">arg</span><span class="p">)));</span>
<a href="#__codelineno-182-3" id="__codelineno-182-3" name="__codelineno-182-3"></a><span class="p">})</span>
</code></pre></div></li>
</ul>
</li>
<li>使用<span><span class="heti-spacing"> </span>criterion.rs</span>（推荐）<ul>
<li>可以有更多的分析信息</li>
<li>官方文档：<a href="https://bheisler.github.io/criterion.rs/book/getting_started.html">https://bheisler.github.io/criterion.rs/book/getting_started.html</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="hr-before-source-file"><hr/></div>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最后更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2022年8月30日 11:32:57 CST">2022年8月30日 11:32:57</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="创建日期">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime" title="2022年8月29日 21:47:20 CST">2022年8月29日 21:47:20</span>
</span>
</aside>
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDOGnfbUc4CPrf4" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="TonyCrane/note" data-repo-id="R_kgDOGnfbUQ" data-theme="light" src="https://giscus.app/client.js">
</script>
<script>
    if (document.querySelector("body").getAttribute("data-md-color-scheme") === "slate") {
      var giscus = document.querySelector("script[src*=giscus]")
      giscus.setAttribute("data-theme", "transparent_dark") 
    }
  </script>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
</main>
<footer class="md-footer">
<nav aria-label="页脚" class="md-footer__inner md-grid">
<a aria-label="上一页: Rust" class="md-footer__link md-footer__link--prev" href="../">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                上一页
              </span>
<div class="md-ellipsis">
                Rust
              </div>
</div>
</a>
<a aria-label="下一页: Rust 杂项随记" class="md-footer__link md-footer__link--next" href="../misc/">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一页
              </span>
<div class="md-ellipsis">
                Rust 杂项随记
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2022-2025 <a href="https://github.com/TonyCrane" rel="noopener" target="_blank">TonyCrane</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
    
    modified by
    <a href="https://github.com/TonyCrane" rel="noopener" target="_blank">
      TonyCrane
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/TonyCrane/" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg>
</a>
<a class="md-social__link" href="https://blog.tonycrane.cc/" rel="noopener" target="_blank" title="blog.tonycrane.cc">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32" fill="currentColor"></path></svg>
</a>
<a class="md-social__link" href="https://tonycrane.cc/" rel="noopener" target="_blank" title="tonycrane.cc">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272h16v176c0 35.3 28.7 64 64 64h288c35.3 0 64-28.7 64-64V272h16c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1zM240 320h32c26.5 0 48 21.5 48 48v96H192v-96c0-26.5 21.5-48 48-48" fill="currentColor"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.top", "navigation.tabs", "navigation.footer", "navigation.indexes"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
<script src="../../../../assets/javascripts/bundle.50899def.min.js"></script>
<script src="https://cdn.tonycrane.cc/utils/katex.min.js"></script>
<script src="../../../../js/katex.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>