<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="é¹¤ç¿”ä¸‡é‡Œï¼ˆTonyCraneï¼‰çš„ç¬”è®°æœ¬" name="description"/>
<link href="https://note.tonycrane.cc/writeups/n1ctf2022/" rel="canonical"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.3.1, mkdocs-material-8.1.4" name="generator"/>
<title>N1CTF 2022 - é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬</title>
<link href="../../assets/stylesheets/main.bb3983ee.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.e6a45f82.min.css" rel="stylesheet"/>
<link href="../../css/heti.css" rel="stylesheet"/>
<link href="../../css/timeline.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/utils/katex.min.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/jbmono/jetbrainsmono.css" rel="stylesheet"/>
<link href="https://cdn.tonycrane.cc/lxgw/lxgwscreen.css" rel="stylesheet"/>
<link href="../../css/tasklist.css" rel="stylesheet"/>
<link href="../../css/custom.css" rel="stylesheet"/>
<link href="../../css/card.css" rel="stylesheet"/>
<link href="../../css/flink.css" rel="stylesheet"/>
<link href="../../css/changelog_extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c273de7f67d992cb6aef08c3ddf09bb2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DYETCPM289"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-DYETCPM289",{page_path:e.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DYETCPM289"></script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script src="../../js/scheme.js" type="text/javascript"></script>
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#n1ctf-2022-writeup">
            è·³è½¬è‡³
          </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="é¡µçœ‰" class="md-header__inner md-grid">
<a aria-label="é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬" class="md-header__button md-logo" data-md-component="logo" href="../.." title="é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              N1CTF 2022
            
          </span>
</div>
</div>
</div>
<div class="md-header__options">
<div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon">
<a class="light-mode" href="javascript:toggleScheme();" title="Light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"></path></svg>
</a>
<a class="dark-mode" href="javascript:toggleScheme();" title="Dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"></path></svg>
</a>
<a class="system-mode" href="javascript:toggleScheme();" title="System preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34z"></path></svg>
</a>
<a class="unknown-mode" href="javascript:toggleScheme();" title="Unknown scheme">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10z"></path></svg>
</a>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="æœç´¢" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="æœç´¢" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="æŸ¥æ‰¾" class="md-search__options">
<button aria-label="æ¸…ç©ºå½“å‰å†…å®¹" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/TonyCrane/note/" title="å‰å¾€ä»“åº“">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    TonyCrane/note
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="æ ‡ç­¾" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        Home
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../cs/">
        Computer Science
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../sec/">
        Security
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../web/">
        Web
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../ctf/">
        CTF
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../">
        Writeups
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../others/">
        Others
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="å¯¼èˆªæ " class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2z"></path></svg>
</a>
    é¹¤ç¿”ä¸‡é‡Œçš„ç¬”è®°æœ¬
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/TonyCrane/note/" title="å‰å¾€ä»“åº“">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    TonyCrane/note
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../..">Home</a>
<label for="__nav_1">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Home" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          Home
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../changelog/">
        æ›´æ–°è®°å½•
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../links/">
        å‹é“¾
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/">Computer Science</a>
<label for="__nav_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Computer Science" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Computer Science
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/pl/">ç¼–ç¨‹è¯­è¨€ &amp; ISA</a>
<label for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="ç¼–ç¨‹è¯­è¨€ &amp; ISA" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          ç¼–ç¨‹è¯­è¨€ &amp; ISA
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_2" id="__nav_2_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/pl/python/">Python</a>
<label for="__nav_2_2_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Python" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_2">
<span class="md-nav__icon md-icon"></span>
          Python
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/python/basic/">
        Python åŸºç¡€è¯­æ³•
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/python/numpy/">
        NumPy
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/python/pil/">
        PIL
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_3" id="__nav_2_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/pl/rust/">Rust</a>
<label for="__nav_2_2_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Rust" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_3">
<span class="md-nav__icon md-icon"></span>
          Rust
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/rust/basic/">
        Rust åŸºç¡€è¯­æ³•
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/rust/misc/">
        Rust æ‚é¡¹éšè®°
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/c_cpp/">
        C/C++
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/haskell/">
        Haskell
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/asm/">
        x86 æ±‡ç¼–è¯­è¨€
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_7" id="__nav_2_2_7" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/pl/riscv/">RISC-V ISA</a>
<label for="__nav_2_2_7">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="RISC-V ISA" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_7">
<span class="md-nav__icon md-icon"></span>
          RISC-V ISA
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/riscv/unprivileged/">
        RISC-V éç‰¹æƒçº§ ISA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/pl/riscv/privileged/">
        RISC-V ç‰¹æƒçº§ ISA
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/system/">è®¡ç®—æœºç³»ç»Ÿ</a>
<label for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="è®¡ç®—æœºç³»ç»Ÿ" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          è®¡ç®—æœºç³»ç»Ÿ
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2" id="__nav_2_3_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/system/cs1/">è®¡ç®—æœºç³»ç»Ÿ I</a>
<label for="__nav_2_3_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="è®¡ç®—æœºç³»ç»Ÿ I" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_2">
<span class="md-nav__icon md-icon"></span>
          è®¡ç®—æœºç³»ç»Ÿ I
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/topic1/">
        æ•°æ®çš„è¡¨ç¤º
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/topic2/">
        æ•°å­—é€»è¾‘ç”µè·¯åŸºç¡€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/topic3/">
        ç»„åˆé€»è¾‘ç”µè·¯è®¾è®¡
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/topic4/">
        æ—¶åºé€»è¾‘ç”µè·¯è®¾è®¡
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/topic5/">
        æŒ‡ä»¤é›†ä½“ç³»ç»“æ„
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/topic6/">
        å¤„ç†å™¨
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2_8" id="__nav_2_3_2_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_2_8">
          ç³»ç»Ÿ I å®éªŒéƒ¨åˆ†
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ç³»ç»Ÿ I å®éªŒéƒ¨åˆ†" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_3_2_8">
<span class="md-nav__icon md-icon"></span>
          ç³»ç»Ÿ I å®éªŒéƒ¨åˆ†
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab1-1/">
        ç³»ç»Ÿ I lab1-1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab1-2/">
        ç³»ç»Ÿ I lab1-2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab2-1/">
        ç³»ç»Ÿ I lab2-1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab2-2/">
        ç³»ç»Ÿ I lab2-2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab3/">
        ç³»ç»Ÿ I lab3
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab4-1/">
        ç³»ç»Ÿ I lab4-1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab4-2/">
        ç³»ç»Ÿ I lab4-2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab5-1/">
        ç³»ç»Ÿ I lab5-1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs1/lab5-2/">
        ç³»ç»Ÿ I lab5-2
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_3" id="__nav_2_3_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/system/cs2/">è®¡ç®—æœºç³»ç»Ÿ II</a>
<label for="__nav_2_3_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="è®¡ç®—æœºç³»ç»Ÿ II" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_3_3">
<span class="md-nav__icon md-icon"></span>
          è®¡ç®—æœºç³»ç»Ÿ II
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/topic1/">
        æµæ°´çº¿ CPU
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/topic2/">
        æ“ä½œç³»ç»Ÿç®€ä»‹
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/topic3/">
        æ“ä½œç³»ç»Ÿç»“æ„åŠç³»ç»Ÿè°ƒç”¨
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/topic4/">
        è¿›ç¨‹ä¸çº¿ç¨‹
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/topic5/">
        CPU è°ƒåº¦
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/topic6/">
        è¿›ç¨‹åŒæ­¥
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_3_8" id="__nav_2_3_3_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3_3_8">
          ç³»ç»Ÿ II å®éªŒéƒ¨åˆ†
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ç³»ç»Ÿ II å®éªŒéƒ¨åˆ†" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_2_3_3_8">
<span class="md-nav__icon md-icon"></span>
          ç³»ç»Ÿ II å®éªŒéƒ¨åˆ†
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/lab1/">
        ç³»ç»Ÿ II lab1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/lab2/">
        ç³»ç»Ÿ II lab2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/lab3/">
        ç³»ç»Ÿ II lab3
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/lab4/">
        ç³»ç»Ÿ II lab4
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/cs2/lab5/">
        ç³»ç»Ÿ II lab5
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/system/pa/">
        ICS PA å®éªŒçºªå®
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4">
          ç®—æ³•ç›¸å…³
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ç®—æ³•ç›¸å…³" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
          ç®—æ³•ç›¸å…³
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_1" id="__nav_2_4_1" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/algorithm/ds/">æ•°æ®ç»“æ„åŸºç¡€</a>
<label for="__nav_2_4_1">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="æ•°æ®ç»“æ„åŸºç¡€" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_4_1">
<span class="md-nav__icon md-icon"></span>
          æ•°æ®ç»“æ„åŸºç¡€
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/algorithm/ds/topic1/">
        ç®—æ³•åˆ†æåŸºç¡€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/algorithm/ds/summary1/">
        åŸºç¡€æ•°æ®ç»“æ„
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/algorithm/ds/summary2/">
        æ’åºä¸å“ˆå¸Œ
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5">
          äººå·¥æ™ºèƒ½ç›¸å…³
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="äººå·¥æ™ºèƒ½ç›¸å…³" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
          äººå·¥æ™ºèƒ½ç›¸å…³
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/ai/basic/">
        äººå·¥æ™ºèƒ½åŸºç¡€
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" id="__nav_2_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../hpc/">é«˜æ€§èƒ½è®¡ç®—</a>
<label for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="é«˜æ€§èƒ½è®¡ç®—" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
          é«˜æ€§èƒ½è®¡ç®—
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6_2" id="__nav_2_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6_2">
          HPC 101 è¶…ç®—å°å­¦æœŸ
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="HPC 101 è¶…ç®—å°å­¦æœŸ" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_6_2">
<span class="md-nav__icon md-icon"></span>
          HPC 101 è¶…ç®—å°å­¦æœŸ
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../hpc/hpc101/vectorized/">
        å‘é‡åŒ–è®¡ç®—
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hpc/hpc101/gpu/">
        GPU ç¼–ç¨‹
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hpc/hpc101/openmp/">
        OpenMP åŸºç¡€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hpc/hpc101/mpi/">
        MPI åŸºç¡€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../hpc/hpc101/ml/">
        æœºå™¨å­¦ä¹ åŸºç¡€
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7">
          é›¶æ•£çŸ¥è¯†ç‚¹
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="é›¶æ•£çŸ¥è¯†ç‚¹" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
          é›¶æ•£çŸ¥è¯†ç‚¹
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/regex/">
        æ­£åˆ™è¡¨è¾¾å¼
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/unicode/">
        Unicode
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" id="__nav_2_8" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/analysis/">æºç å‰–æ</a>
<label for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="æºç å‰–æ" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
          æºç å‰–æ
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/analysis/mkdocs/">
        mkdocs æºç å‰–æ
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" id="__nav_2_9" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../cs/tools/">å·¥å…·ç›¸å…³</a>
<label for="__nav_2_9">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="å·¥å…·ç›¸å…³" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_9">
<span class="md-nav__icon md-icon"></span>
          å·¥å…·ç›¸å…³
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/toolbox/">
        å·¥å…·æ”¶é›†
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9_3" id="__nav_2_9_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_9_3">
          å‘½ä»¤è¡Œå·¥å…·
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="å‘½ä»¤è¡Œå·¥å…·" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_9_3">
<span class="md-nav__icon md-icon"></span>
          å‘½ä»¤è¡Œå·¥å…·
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/git/">
        Git å‘½ä»¤å¤‡å¿˜
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/shell/">
        Shell å‘½ä»¤å¤‡å¿˜
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/docker/">
        Docker ç›¸å…³å¤‡å¿˜
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/gdb/">
        gdb ç›¸å…³å¤‡å¿˜
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9_4" id="__nav_2_9_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_9_4">
          CI å·¥å…·
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CI å·¥å…·" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_9_4">
<span class="md-nav__icon md-icon"></span>
          CI å·¥å…·
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/action/">
        GitHub Action
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9_5" id="__nav_2_9_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_9_5">
          ç«™ç‚¹ç”Ÿæˆå·¥å…·
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="ç«™ç‚¹ç”Ÿæˆå·¥å…·" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_9_5">
<span class="md-nav__icon md-icon"></span>
          ç«™ç‚¹ç”Ÿæˆå·¥å…·
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/mkdocs/">
        mkdocs ä½¿ç”¨è®°å½•
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/hexo/">
        hexo ä½¿ç”¨è®°å½•
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../cs/tools/sphinx/">
        sphinx ä½¿ç”¨è®°å½•
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../sec/">Security</a>
<label for="__nav_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Security" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Security
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2">
          æ¼æ´å¤ç°
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="æ¼æ´å¤ç°" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
          æ¼æ´å¤ç°
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../sec/vulns/log4j/">
        log4j æ¼æ´å¤ç°
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../web/">Web</a>
<label for="__nav_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Web" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Web
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../web/protocol/">ç½‘ç»œåè®®</a>
<label for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="ç½‘ç»œåè®®" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          ç½‘ç»œåè®®
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/protocol/vmess/">
        VMess
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3">
          æ’ç‰ˆå†™ä½œè§„èŒƒ
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="æ’ç‰ˆå†™ä½œè§„èŒƒ" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          æ’ç‰ˆå†™ä½œè§„èŒƒ
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/typesetting/clreq/">
        ä¸­æ–‡æ’ç‰ˆéœ€æ±‚
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/typesetting/tech/">
        ä¸­æ–‡æŠ€æœ¯æ–‡æ¡£é£æ ¼æŒ‡å—
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../web/svg/">
        SVG
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/">CTF</a>
<label for="__nav_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="CTF" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          CTF
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" id="__nav_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/steg/">éšå†™æœ¯</a>
<label for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="éšå†™æœ¯" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
          éšå†™æœ¯
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/steg/image/">
        å›¾ç‰‡éšå†™
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/steg/audio/">
        éŸ³é¢‘éšå†™
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" id="__nav_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/escapes/">æ²™ç®±é€ƒé€¸</a>
<label for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="æ²™ç®±é€ƒé€¸" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
          æ²™ç®±é€ƒé€¸
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/escapes/pysandbox/">
        Python æ²™ç®±é€ƒé€¸
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_4" id="__nav_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/forensics/">å–è¯</a>
<label for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="å–è¯" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
          å–è¯
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/forensics/mem/">
        å†…å­˜å–è¯
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/coding/">
        ç¼–ç ä¸å¯†ç 
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/qrcode/">
        QRCode
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/esolang/">
        Esolang
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_8" id="__nav_5_8" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/blockchain/">Blockchain</a>
<label for="__nav_5_8">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Blockchain" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_8">
<span class="md-nav__icon md-icon"></span>
          Blockchain
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_8_2" id="__nav_5_8_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/blockchain/eth/">Ethereum</a>
<label for="__nav_5_8_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Ethereum" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_8_2">
<span class="md-nav__icon md-icon"></span>
          Ethereum
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/basic/">
        ä»¥å¤ªåŠåŸºç¡€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/evm/">
        ä»¥å¤ªåŠè™šæ‹Ÿæœº
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/solidity/">
        Solidity è¯­è¨€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/yul/">
        Yul è¯­è¨€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/vuln/">
        å¸¸è§åˆçº¦æ¼æ´æ”»å‡»æ‰‹æ®µ
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/erc/">
        ERC æ ‡å‡†
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ctf/blockchain/eth/eip/">
        å…¶ä½™é‡è¦ EIPs
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_8_3" id="__nav_5_8_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../ctf/blockchain/solana/">Solana</a>
</div>
<nav aria-label="Solana" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_5_8_3">
<span class="md-nav__icon md-icon"></span>
          Solana
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../">Writeups</a>
<label for="__nav_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Writeups" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Writeups
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" id="__nav_6_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_2">
          Training
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Training" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_2">
<span class="md-nav__icon md-icon"></span>
          Training
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../ethernaut/">
        Ethernaut
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../SecurityInnovation/">
        Security Innovation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sadservers/">
        SadServers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../AAA/">
        ğŸ”’ AAA School Bus
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" id="__nav_6_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_3">
          2021
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="2021" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
          2021
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../sysu_msc_puzzle/">
        SYSU MSC Puzzle 2021
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hackergame2021/">
        USTC Hackergame 2021
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../d0g3/">
        ç¬¬å››å±Šâ€œå®‰æ´µæ¯â€
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bytectf2021_final/">
        ByteCTF 2021 Final
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sctf2021/">
        SCTF 2021
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" id="__nav_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4">
          2022
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="2022" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
          2022
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../vnctf2022/">
        VNCTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tqlctf2022/">
        TQLCTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../susctf2022/">
        SUSCTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../d3ctf2022/">
        D3CTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%2Actf2022/">
        *CTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mrctf2022/">
        MRCTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../qwb2022/">
        å¼ºç½‘æ¯ 2022 Quals
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tctf2022/">
        TCTF/0CTF 2022
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hackergame2022/">
        USTC Hackergame 2022
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          N1CTF 2022
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        N1CTF 2022
      </a>
<nav aria-label="ç›®å½•" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
        ç›®å½•
      </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#utility-payment-service">
    Utility Payment Service
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#simple-staking">
    Simple Staking
  </a>
<nav aria-label="Simple Staking" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    é¢˜ç›®åˆçº¦
  </a>
<nav aria-label="é¢˜ç›®åˆçº¦" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#initialize">
    Initialize
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#register">
    Register
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deposit">
    Deposit
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#withdraw">
    Withdraw
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    é¢˜ç›®äº¤äº’éƒ¨åˆ†
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    åšæ³•
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#just-find-flag">
    just find flag
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../seccon2022/">
        SECCON 2022 Quals
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../others/">Others</a>
<label for="__nav_7">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Others" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Others
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../others/notes/">
        è¯¾ç¨‹ç¬”è®°
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" id="__nav_7_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../others/troubleshooting/">TroubleShooting</a>
<label for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="TroubleShooting" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_3">
<span class="md-nav__icon md-icon"></span>
          TroubleShooting
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../others/troubleshooting/mac/">
        macOS TroubleShooting
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="ç›®å½•" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
        ç›®å½•
      </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#utility-payment-service">
    Utility Payment Service
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#simple-staking">
    Simple Staking
  </a>
<nav aria-label="Simple Staking" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    é¢˜ç›®åˆçº¦
  </a>
<nav aria-label="é¢˜ç›®åˆçº¦" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#initialize">
    Initialize
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#register">
    Register
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deposit">
    Deposit
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#withdraw">
    Withdraw
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    é¢˜ç›®äº¤äº’éƒ¨åˆ†
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    åšæ³•
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#just-find-flag">
    just find flag
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<script defer="" src="/js/toc.js"></script>
<link href="/css/fold_toc.css" rel="stylesheet"/>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/TonyCrane/note/tree/master/docs/writeups/n1ctf2022.md" title="ç¼–è¾‘æ­¤é¡µ">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="n1ctf-2022-writeup">N1CTF 2022 Writeup<a class="headerlink" href="#n1ctf-2022-writeup" title="Permanent link">Â¶</a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5z"></path></svg></span> çº¦<span class="heti-skip"><span class="heti-spacing"> </span>2683<span class="heti-spacing"> </span></span>ä¸ªå­— <span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> <span>838<span class="heti-spacing"> </span></span>è¡Œä»£ç  <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13z"></path></svg></span> é¢„è®¡é˜…è¯»æ—¶é—´<span class="heti-skip"><span class="heti-spacing"> </span>19<span class="heti-spacing"> </span></span>åˆ†é’Ÿ</p>
</div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>è¿™æ¬¡ä¸»è¦åšäº†ä¸‹<span><span class="heti-spacing"> </span>blockchain</span>ï¼Œ<span>misc<span class="heti-spacing"> </span></span>æœ‰ä¸ªå†…å­˜å–è¯å·®ä¸€ç‚¹åšå‡ºæ¥ï¼Œä¹Ÿåœ¨è¿™é‡Œè®°ä¸€ä¸‹</p>
<p>å¬è¯´è¿™æ¬¡çš„<span class="heti-skip"><span class="heti-spacing"> </span>blockchain<span class="heti-spacing"> </span></span>ä¼šè®¾å•é¡¹å¥–ï¼Œåº”è¯¥å¾ˆæœ‰è´¨é‡ã€‚æ²¡æƒ³åˆ°æ˜¯æ²¡æ¥è§¦è¿‡çš„<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>åŒºå—é“¾ï¼Œç¬¬ä¸€æ¬¡ç©ï¼Œè¿˜æŒºæœ‰æ„æ€çš„ï¼Œè€Œä¸”é¢˜ç»™çš„åšé¢˜æ¡†æ¶ä¹Ÿå¾ˆå…¨ï¼Œè¿˜ç®—å¾ˆèˆ’é€‚</p>
<p>æ„Ÿè§‰<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>è¿˜æ˜¯æœ‰å¾ˆå¤šéœ€è¦äº†è§£çš„åŸºç¡€çŸ¥è¯†è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæœ‰æ—¶é—´ä»¥åç³»ç»Ÿå­¦ä¹ çš„æ—¶å€™å†è®°å½•å§</p>
</div>
<hr/>
<h2 id="utility-payment-service">Utility Payment Service<a class="headerlink" href="#utility-payment-service" title="Permanent link">Â¶</a></h2>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://img.shields.io/badge/-BLOCKCHAIN-orange?style=flat-square"><img alt="" src="https://img.shields.io/badge/-BLOCKCHAIN-orange?style=flat-square"/></a></p>
<p><span>solana<span class="heti-spacing"> </span></span>çš„åˆçº¦çœ‹èµ·æ¥å¾ˆé•¿å¾ˆå¤æ‚ï¼Œé™„ä»¶ä¹Ÿæ˜¯å®Œæ•´çš„<span class="heti-skip"><span class="heti-spacing"> </span>cargo<span class="heti-spacing"> </span></span>å·¥ä½œåŒºï¼Œæ‰€ä»¥è¿™é‡Œä¸å…¨åˆ—å‡ºæ¥äº†ã€‚</p>
<details class="question">
<summary><span>processor<span class="heti-spacing"> </span></span>éƒ¨åˆ†</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">use</span><span class="w"> </span><span class="n">borsh</span>::<span class="p">{</span><span class="n">BorshDeserialize</span><span class="p">,</span><span class="w"> </span><span class="n">BorshSerialize</span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">use</span><span class="w"> </span><span class="n">solana_program</span>::<span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="n">account_info</span>::<span class="p">{</span><span class="n">next_account_info</span><span class="p">,</span><span class="w"> </span><span class="n">AccountInfo</span><span class="p">},</span><span class="w"></span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="n">entrypoint</span>::<span class="n">ProgramResult</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="n">msg</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="n">program</span>::<span class="p">{</span><span class="n">invoke</span><span class="p">,</span><span class="w"> </span><span class="n">invoke_signed</span><span class="p">},</span><span class="w"></span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="n">pubkey</span>::<span class="n">Pubkey</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="n">system_instruction</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="k">use</span><span class="w"> </span><span class="k">crate</span>::<span class="p">{</span><span class="n">Escrow</span><span class="p">,</span><span class="w"> </span><span class="n">ServiceInstruction</span><span class="p">,</span><span class="w"> </span><span class="n">ESCROW_ACCOUNT_SIZE</span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">process_instruction</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="n">program</span>: <span class="kp">&amp;</span><span class="nc">Pubkey</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="n">accounts</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">AccountInfo</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="k">mut</span><span class="w"> </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ProgramResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">ServiceInstruction</span>::<span class="n">deserialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="o">?</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">        </span><span class="n">ServiceInstruction</span>::<span class="n">Init</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">init_escrow</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">        </span><span class="n">ServiceInstruction</span>::<span class="n">DepositEscrow</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">deposit_escrow</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="n">ServiceInstruction</span>::<span class="n">WithdrawEscrow</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">withdraw_escrow</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">        </span><span class="n">ServiceInstruction</span>::<span class="n">Pay</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">pay_utility_fees</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_escrow</span><span class="p">(</span><span class="n">program</span>: <span class="nc">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="n">user</span>: <span class="nc">Pubkey</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"ESCROW"</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">to_bytes</span><span class="p">()],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program</span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_reserve</span><span class="p">(</span><span class="n">program</span>: <span class="nc">Pubkey</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"RESERVE"</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program</span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a>
<a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">///</span>
<a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">/// init escrow</span>
<a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">///</span>
<a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="k">fn</span> <span class="nf">init_escrow</span><span class="p">(</span><span class="n">program</span>: <span class="kp">&amp;</span><span class="nc">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">AccountInfo</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">ProgramResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="n">iter</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sys_prog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a>
<a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">is_signer</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data_is_empty</span><span class="p">());</span><span class="w"></span>
<a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="n">escrow_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_escrow</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="w">    </span><span class="n">invoke_signed</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="o">&amp;</span><span class="n">system_instruction</span>::<span class="n">create_account</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">        </span><span class="n">ESCROW_ACCOUNT_SIZE</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">program</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="o">&amp;</span><span class="p">[</span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">escrow_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">sys_prog</span><span class="p">.</span><span class="n">clone</span><span class="p">()],</span><span class="w"></span>
<a href="#__codelineno-0-60" id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"ESCROW"</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">.</span><span class="n">to_bytes</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">escrow_bump</span><span class="p">]]],</span><span class="w"></span>
<a href="#__codelineno-0-61" id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-62" id="__codelineno-0-62" name="__codelineno-0-62"></a>
<a href="#__codelineno-0-63" id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Escrow</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-64" id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="w">        </span><span class="n">user</span>: <span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-65" id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="w">        </span><span class="n">amount</span>: <span class="mi">0</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-66" id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="w">        </span><span class="n">bump</span>: <span class="nc">escrow_bump</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-67" id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-0-68" id="__codelineno-0-68" name="__codelineno-0-68"></a>
<a href="#__codelineno-0-69" id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="w">    </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">]).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-70" id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a href="#__codelineno-0-71" id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-0-72" id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-73" id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a href="#__codelineno-0-74" id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">///</span>
<a href="#__codelineno-0-75" id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">/// deposit escrow</span>
<a href="#__codelineno-0-76" id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">///</span>
<a href="#__codelineno-0-77" id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="k">fn</span> <span class="nf">deposit_escrow</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-0-78" id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">    </span><span class="n">program</span>: <span class="kp">&amp;</span><span class="nc">Pubkey</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-79" id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="w">    </span><span class="n">accounts</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">AccountInfo</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-0-80" id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="n">deposit_amount</span>: <span class="kt">u16</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-0-81" id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ProgramResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-82" id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="n">iter</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-83" id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a href="#__codelineno-0-84" id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-85" id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-86" id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-87" id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sys_prog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-88" id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a href="#__codelineno-0-89" id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">is_signer</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-90" id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_reserve</span><span class="p">,</span><span class="w"> </span><span class="n">_reserve_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_reserve</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-91" id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected_reserve</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-92" id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="n">_escrow_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_escrow</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-93" id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-94" id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a href="#__codelineno-0-95" id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="w">    </span><span class="n">invoke</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-0-96" id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">system_instruction</span>::<span class="n">transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">deposit_amount</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-97" id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-0-98" id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-0-99" id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="w">            </span><span class="n">reserve</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-0-100" id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="w">            </span><span class="n">sys_prog</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span><span class="w"></span>
<a href="#__codelineno-0-101" id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="w">        </span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-0-102" id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-103" id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a href="#__codelineno-0-104" id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Escrow</span>::<span class="n">deserialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">])</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-105" id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">deposit_amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-106" id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">    </span><span class="n">escrow_data</span><span class="w"></span>
<a href="#__codelineno-0-107" id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">        </span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">])</span><span class="w"></span>
<a href="#__codelineno-0-108" id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-109" id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a href="#__codelineno-0-110" id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-0-111" id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-112" id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a href="#__codelineno-0-113" id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">///</span>
<a href="#__codelineno-0-114" id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">/// withdraw all balance in escrow</span>
<a href="#__codelineno-0-115" id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">///</span>
<a href="#__codelineno-0-116" id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="k">fn</span> <span class="nf">withdraw_escrow</span><span class="p">(</span><span class="n">program</span>: <span class="kp">&amp;</span><span class="nc">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">AccountInfo</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">ProgramResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-117" id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="n">iter</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-118" id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a href="#__codelineno-0-119" id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-120" id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-121" id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-122" id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sys_prog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-123" id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a href="#__codelineno-0-124" id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">is_signer</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-125" id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_reserve</span><span class="p">,</span><span class="w"> </span><span class="n">reserve_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_reserve</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-126" id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected_reserve</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-127" id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="n">_escrow_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_escrow</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-128" id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-129" id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a href="#__codelineno-0-130" id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Escrow</span>::<span class="n">deserialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">])</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-131" id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-132" id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="w">    </span><span class="n">invoke_signed</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-0-133" id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">system_instruction</span>::<span class="n">transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u64</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-0-134" id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">reserve</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"> </span><span class="n">sys_prog</span><span class="p">.</span><span class="n">clone</span><span class="p">()],</span><span class="w"></span>
<a href="#__codelineno-0-135" id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"RESERVE"</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">reserve_bump</span><span class="p">]]],</span><span class="w"></span>
<a href="#__codelineno-0-136" id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-137" id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a href="#__codelineno-0-138" id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="w">    </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-139" id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="w">    </span><span class="n">escrow_data</span><span class="w"></span>
<a href="#__codelineno-0-140" id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="w">        </span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">])</span><span class="w"></span>
<a href="#__codelineno-0-141" id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-142" id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a href="#__codelineno-0-143" id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-0-144" id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-145" id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a href="#__codelineno-0-146" id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">///</span>
<a href="#__codelineno-0-147" id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">/// pay utility</span>
<a href="#__codelineno-0-148" id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">///</span>
<a href="#__codelineno-0-149" id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="k">fn</span> <span class="nf">pay_utility_fees</span><span class="p">(</span><span class="n">program</span>: <span class="kp">&amp;</span><span class="nc">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="n">accounts</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">AccountInfo</span><span class="p">],</span><span class="w"> </span><span class="n">amount</span>: <span class="kt">u16</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ProgramResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-150" id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="n">iter</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-151" id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a href="#__codelineno-0-152" id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-153" id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-154" id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-155" id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_sys_prog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-156" id="__codelineno-0-156" name="__codelineno-0-156"></a>
<a href="#__codelineno-0-157" id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="w">    </span><span class="fm">assert!</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">is_signer</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-158" id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_reserve</span><span class="p">,</span><span class="w"> </span><span class="n">_reserve_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_reserve</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-159" id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected_reserve</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-160" id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="n">_escrow_bump</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_escrow</span><span class="p">(</span><span class="o">*</span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-161" id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="w">    </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">expected_escrow</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-162" id="__codelineno-0-162" name="__codelineno-0-162"></a>
<a href="#__codelineno-0-163" id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Escrow</span>::<span class="n">deserialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">])</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-164" id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a href="#__codelineno-0-165" id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">base_fee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15_</span><span class="k">u16</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-166" id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-167" id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">base_fee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-168" id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="w">            </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">base_fee</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-169" id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-170" id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="w">            </span><span class="fm">assert!</span><span class="p">(</span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-171" id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">            </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-0-172" id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-173" id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-0-174" id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="w">        </span><span class="n">msg</span><span class="o">!</span><span class="p">(</span><span class="s">"ABORT: Cannot make payments when the escrow account has a balance less than 10 lamports."</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-0-175" id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-0-176" id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a href="#__codelineno-0-177" id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="w">    </span><span class="n">escrow_data</span><span class="w"></span>
<a href="#__codelineno-0-178" id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">        </span><span class="p">.</span><span class="n">serialize</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">borrow_mut</span><span class="p">()[</span><span class="o">..</span><span class="p">])</span><span class="w"></span>
<a href="#__codelineno-0-179" id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="p">.</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-0-180" id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a href="#__codelineno-0-181" id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-0-182" id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<p>å¯ä»¥çœ‹å‡ºä¸»è¦æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>Initï¼šåˆå§‹åŒ–å¹¶ç­¾å<span><span class="heti-spacing"> </span>escrow</span></li>
<li>DepositEscrowï¼šå­˜å…¥<span class="heti-skip"><span class="heti-spacing"> </span>deposit_amount<span class="heti-spacing"> </span></span>é‡‘é¢<ul>
<li>å°†é’±è½¬å…¥<span><span class="heti-spacing"> </span>reserve account</span>ï¼ˆåªç”±<span class="heti-skip"><span class="heti-spacing"> </span>program seed<span class="heti-spacing"> </span></span>ç”Ÿæˆï¼‰</li>
<li>å°†ç”¨æˆ·å¯¹åº”<span><span class="heti-spacing"> </span>escrow account</span>ï¼ˆç”±<span class="heti-skip"><span class="heti-spacing"> </span>program<span class="heti-spacing"> </span></span>å’Œ<span class="heti-skip"><span class="heti-spacing"> </span>user.key<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>åˆæˆç”Ÿæˆï¼‰çš„<span class="heti-skip"><span class="heti-spacing"> </span>amount<span class="heti-spacing"> </span></span>å¢åŠ <span><span class="heti-spacing"> </span>deposit_amout</span></li>
</ul>
</li>
<li>WithdrawEscrowï¼šå°†<span class="heti-skip"><span class="heti-spacing"> </span>escrow<span class="heti-spacing"> </span></span>è®°å½•çš„æ‰€æœ‰é‡‘é¢éƒ½è½¬å›ç»™ç”¨æˆ·<ul>
<li>ä»<span class="heti-skip"><span class="heti-spacing"> </span>reserve account<span class="heti-spacing"> </span></span>è½¬å‡º</li>
</ul>
</li>
<li>Payï¼šæ”¯ä»˜ï¼Œä¹Ÿå°±æ˜¯å‡å°‘ç”¨æˆ·<span class="heti-skip"><span class="heti-spacing"> </span>escrow<span class="heti-spacing"> </span></span>çš„<span><span class="heti-spacing"> </span>amount</span>ã€‚è¿˜æ˜¯çœ‹ä»£ç æ›´æ¸…æ™°ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">base_fee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15_</span><span class="k">u16</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">if</span><span class="w"> </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">base_fee</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">        </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">base_fee</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">        </span><span class="n">escrow_data</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="n">msg</span><span class="o">!</span><span class="p">(</span><span class="s">"ABORT: Cannot make payments when the escrow account has a balance less than 10 lamports."</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></li>
</ul>
<p>è¿™é‡Œå­˜åœ¨ä¸€ä¸ªè¾ƒæ˜æ˜¾çš„éšæ‚£æ˜¯<span><span class="heti-spacing"> </span>u16</span>ï¼Œä¹Ÿå°±æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>16<span class="heti-spacing"> </span></span>ä½æ— ç¬¦å·æ•´å‹ã€‚å†å›å¤´çœ‹<span class="heti-skip"><span class="heti-spacing"> </span>lib.rs<span class="heti-spacing"> </span></span>ä¸­è§„å®šçš„<span class="heti-skip"><span class="heti-spacing"> </span>Escrow account<span class="heti-spacing"> </span></span>ç»“æ„ä½“ï¼š
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="cp">#[repr(C)]</span><span class="w"></span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="cp">#[derive(BorshSerialize, BorshDeserialize)]</span><span class="w"></span>
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Escrow</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">user</span>: <span class="nc">Pubkey</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">amount</span>: <span class="kt">u16</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">bump</span>: <span class="kt">u8</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
è¿™é‡Œçš„ amount ä¹Ÿæ˜¯ u16ï¼Œå­˜åœ¨æ•´å‹æº¢å‡ºé£é™©ã€‚
<p>æ¥ç€çœ‹<span class="heti-skip"><span class="heti-spacing"> </span>main.rs<span class="heti-spacing"> </span></span>ä¸­çš„é¢˜ç›®éƒ¨åˆ†ï¼š</p>
<details class="question">
<summary>é¢˜ç›®äº¤äº’éƒ¨åˆ†</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">fn</span> <span class="nf">handle_connection</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">socket</span>: <span class="nc">TcpStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChallengeBuilder</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">try_clone</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="c1">// load programs</span>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solve_pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">input_program</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">program_pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">chall_programs</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"./utility_payment.so"</span><span class="p">])[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="c1">// make user</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"program pubkey: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">program_pubkey</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"solve pubkey: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">solve_pubkey</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-13" id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user pubkey: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-14" id="__codelineno-3-14" name="__codelineno-3-14"></a>
<a href="#__codelineno-3-15" id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">    </span><span class="c1">// println!("program: {}", program_pubkey);</span>
<a href="#__codelineno-3-16" id="__codelineno-3-16" name="__codelineno-3-16"></a>
<a href="#__codelineno-3-17" id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">    </span><span class="c1">// add accounts and lamports</span>
<a href="#__codelineno-3-18" id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reserve</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_reserve</span><span class="p">(</span><span class="n">program_pubkey</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-3-19" id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="w">    </span><span class="c1">// let (escrow, _) =  get_escrow(program_pubkey, user.pubkey());</span>
<a href="#__codelineno-3-20" id="__codelineno-3-20" name="__codelineno-3-20"></a>
<a href="#__codelineno-3-21" id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">TARGET_AMT</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="mi">60_000</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-22" id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">INIT_BAL</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-23" id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">RESERVE_BAL</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="mi">1_000_000</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-24" id="__codelineno-3-24" name="__codelineno-3-24"></a>
<a href="#__codelineno-3-25" id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="w">    </span><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-3-26" id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="w">        </span><span class="p">.</span><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-3-27" id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="w">        </span><span class="p">.</span><span class="n">add_account_with_lamports</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w"> </span><span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">INIT_BAL</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-3-28" id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="w">    </span><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-3-29" id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="w">        </span><span class="p">.</span><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-3-30" id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="w">        </span><span class="p">.</span><span class="n">add_account_with_lamports</span><span class="p">(</span><span class="n">reserve</span><span class="p">,</span><span class="w"> </span><span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">RESERVE_BAL</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-3-31" id="__codelineno-3-31" name="__codelineno-3-31"></a>
<a href="#__codelineno-3-32" id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-3-33" id="__codelineno-3-33" name="__codelineno-3-33"></a>
<a href="#__codelineno-3-34" id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">challenge</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">lamports</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-35" id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user lamport before: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-36" id="__codelineno-3-36" name="__codelineno-3-36"></a>
<a href="#__codelineno-3-37" id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="w">    </span><span class="c1">// run solve</span>
<a href="#__codelineno-3-38" id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="w">    </span><span class="n">challenge</span><span class="p">.</span><span class="n">input_instruction</span><span class="p">(</span><span class="n">solve_pubkey</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="n">user</span><span class="p">]).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-3-39" id="__codelineno-3-39" name="__codelineno-3-39"></a>
<a href="#__codelineno-3-40" id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="w">    </span><span class="c1">// check solve</span>
<a href="#__codelineno-3-41" id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">challenge</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">lamports</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-42" id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user lamport after: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-43" id="__codelineno-3-43" name="__codelineno-3-43"></a>
<a href="#__codelineno-3-44" id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">TARGET_AMT</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-3-45" id="__codelineno-3-45" name="__codelineno-3-45"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-3-46" id="__codelineno-3-46" name="__codelineno-3-46"></a><span class="w">        </span><span class="fm">writeln!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-3-47" id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="w">            </span><span class="n">socket</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-3-48" id="__codelineno-3-48" name="__codelineno-3-48"></a><span class="w">            </span><span class="s">"Flag: {}"</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-3-49" id="__codelineno-3-49" name="__codelineno-3-49"></a><span class="w">            </span><span class="n">flag</span><span class="w"></span>
<a href="#__codelineno-3-50" id="__codelineno-3-50" name="__codelineno-3-50"></a><span class="w">        </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-3-51" id="__codelineno-3-51" name="__codelineno-3-51"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-3-52" id="__codelineno-3-52" name="__codelineno-3-52"></a>
<a href="#__codelineno-3-53" id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-3-54" id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<p>ç¬¬ä¸€æ¬¡æ¥è§¦<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>é¢˜ç›®ï¼Œæ‰€ä»¥é€æ­¥è§£æä¸€ä¸‹ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>builder<span class="heti-spacing"> </span></span>å¹¶è·å–ç”¨æˆ·åˆçº¦ä»¥åŠé¢˜ç›®åˆçº¦ï¼ˆ<span>ChallengeBuilder<span class="heti-spacing"> </span></span>æ¥è‡ª<span><span class="heti-spacing"> </span>sol-ctf-framework</span>ï¼‰ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChallengeBuilder</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">try_clone</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="c1">// load programs</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="kd">let</span><span class="w"> </span><span class="n">solve_pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">input_program</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">program_pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">chall_programs</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"./utility_payment.so"</span><span class="p">])[</span><span class="mi">0</span><span class="p">];</span><span class="w"></span>
</code></pre></div><ul>
<li>è¿™é‡Œéœ€è¦äº†è§£çš„æ˜¯ä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>åˆçº¦åœ¨ä¸Šé“¾çš„æ—¶å€™éœ€è¦ç¼–è¯‘æˆ<span><span class="heti-spacing"> </span>BPF</span>ï¼ˆBerkley Packer Filterï¼‰å­—èŠ‚ç ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>.so<span class="heti-spacing"> </span></span>æ–‡ä»¶</li>
<li><span>ChallengeBuilder::input_program<span class="heti-spacing"> </span></span>æ–¹æ³•å¯ä»¥é€šè¿‡æºç çœ‹å‡ºé¦–å…ˆè¾“å…¥ç¨‹åºé•¿åº¦ï¼Œç„¶åè¯»å–<span class="heti-skip"><span class="heti-spacing"> </span>.so<span class="heti-spacing"> </span></span>çš„å­—èŠ‚åºåˆ—</li>
</ul>
</li>
<li>åˆ›å»ºç”¨æˆ·è´¦æˆ·å¹¶è¾“å‡ºä¸€ç³»åˆ—<span><span class="heti-spacing"> </span>pubkey</span>ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"program pubkey: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">program_pubkey</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"solve pubkey: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">solve_pubkey</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user pubkey: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div></li>
<li>æ ¹æ®<span class="heti-skip"><span class="heti-spacing"> </span>program_pubkey<span class="heti-spacing"> </span></span>æ¥æ‰¾åˆ°<span class="heti-skip"><span class="heti-spacing"> </span>reserve<span class="heti-spacing"> </span></span>è´¦æˆ·ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">reserve</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_reserve</span><span class="p">(</span><span class="n">program_pubkey</span><span class="p">);</span><span class="w"></span>
</code></pre></div><ul>
<li>å…¶ä¸­<span class="heti-skip"><span class="heti-spacing"> </span>get_reserve<span class="heti-spacing"> </span></span>å‡½æ•°åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>processor.rs<span class="heti-spacing"> </span></span>ä¸­å®šä¹‰ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_reserve</span><span class="p">(</span><span class="n">program</span>: <span class="nc">Pubkey</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">Pubkey</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">"RESERVE"</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">()],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program</span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></li>
<li>è¿™é‡Œéœ€è¦äº†è§£çš„ä¸€ä¸ªæ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>çš„è´¦æˆ·åˆ†ä¸ºä¸€èˆ¬è´¦æˆ·å’Œ<span><span class="heti-spacing"> </span>PDA</span>ï¼ˆProgram Derived Addressï¼‰<ul>
<li><span>PDA<span class="heti-spacing"> </span></span>ä¸€èˆ¬æ˜¯ç”±ç¨‹åºç”Ÿæˆç”¨æ¥è®°å½•æ•°æ®çš„</li>
<li><span>PDA<span class="heti-spacing"> </span></span>çš„è®¡ç®—æ˜¯æ ¹æ®<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>å’Œ<span><span class="heti-spacing"> </span>program_id</span>ï¼ˆä¹Ÿå°±æ˜¯ç¨‹åºçš„<span><span class="heti-spacing"> </span>pubkey</span>ï¼‰åšå“ˆå¸Œæ¥ç”Ÿæˆçš„</li>
<li>ä½†æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>PDA<span class="heti-spacing"> </span></span>è¦ä¿è¯ä¸æ˜¯å¯ç”¨çš„<span><span class="heti-spacing"> </span>Pubkey</span>ï¼ˆè¿™ä¸ªè¿˜æ²¡ç†è§£ï¼‰ï¼Œæ‰€ä»¥<span class="heti-skip"><span class="heti-spacing"> </span>hash<span class="heti-spacing"> </span></span>çš„æ—¶å€™è¦å†åŠ ä¸€ä¸ªå‚æ•°<span><span class="heti-spacing"> </span>bump</span>ï¼špda = hash(seed, bump, program_id)</li>
<li>å¯»æ‰¾ä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>PDA<span class="heti-spacing"> </span></span>çš„æ—¶å€™ä¼šä»<span class="heti-skip"><span class="heti-spacing"> </span>0<span class="heti-spacing"> </span></span>åˆ°<span class="heti-skip"><span class="heti-spacing"> </span>256<span class="heti-spacing"> </span></span>æšä¸¾<span><span class="heti-spacing"> </span>bump</span>ï¼Œç¬¬ä¸€ä¸ªå¯ä»¥ç”Ÿæˆæœ‰æ•ˆ<span class="heti-skip"><span class="heti-spacing"> </span>PDA<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>bump<span class="heti-spacing"> </span></span>ç§°ä¸º<span><span class="heti-spacing"> </span>canonical bump</span>ï¼Œè€Œä¸”ä¸€èˆ¬å°±ä½¿ç”¨è¿™ä¸ª<span><span class="heti-spacing"> </span>PDA</span></li>
<li>æ‰€ä»¥æ ¹æ®ç›¸åŒ<span><span class="heti-spacing"> </span>seed</span>ã€ç›¸åŒ<span class="heti-skip"><span class="heti-spacing"> </span>program_id<span class="heti-spacing"> </span></span>ç”Ÿæˆçš„<span class="heti-skip"><span class="heti-spacing"> </span>PDA<span class="heti-spacing"> </span></span>ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚<span>Pubkey::find_program_address<span class="heti-spacing"> </span></span>åšçš„å°±æ˜¯è¿™ä¸ªï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<span><span class="heti-spacing"> </span>seed</span>ã€ç¬¬äºŒä¸ªå‚æ•°æ˜¯<span><span class="heti-spacing"> </span>program_id</span></li>
</ul>
</li>
<li>æ‰€ä»¥<span class="heti-skip"><span class="heti-spacing"> </span>reserve<span class="heti-spacing"> </span></span>æ˜¯ä¸€ä¸ªç”±<span class="heti-skip"><span class="heti-spacing"> </span>RESERVE seed<span class="heti-spacing"> </span></span>å’Œ<span class="heti-skip"><span class="heti-spacing"> </span>program_pubkey<span class="heti-spacing"> </span></span>ç”Ÿæˆçš„<span><span class="heti-spacing"> </span>PDA</span></li>
</ul>
</li>
<li>ä¸º<span class="heti-skip"><span class="heti-spacing"> </span>account<span class="heti-spacing"> </span></span>å¢åŠ åˆå§‹<span><span class="heti-spacing"> </span>lamports</span>ï¼ˆé’±ï¼‰ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="k">const</span><span class="w"> </span><span class="n">TARGET_AMT</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="mi">60_000</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="k">const</span><span class="w"> </span><span class="n">INIT_BAL</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="k">const</span><span class="w"> </span><span class="n">RESERVE_BAL</span>: <span class="kt">u64</span> <span class="o">=</span><span class="w"> </span><span class="mi">1_000_000</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="p">.</span><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="p">.</span><span class="n">add_account_with_lamports</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w"> </span><span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">INIT_BAL</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">    </span><span class="p">.</span><span class="n">builder</span><span class="w"></span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="p">.</span><span class="n">add_account_with_lamports</span><span class="p">(</span><span class="n">reserve</span><span class="p">,</span><span class="w"> </span><span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">RESERVE_BAL</span><span class="p">);</span><span class="w"></span>
</code></pre></div><ul>
<li>ç»™<span><span class="heti-spacing"> </span>user 50 lamports</span></li>
<li>ç»™<span><span class="heti-spacing"> </span>reserve 1000000 lamports</span></li>
</ul>
</li>
<li>æ„å»º<span><span class="heti-spacing"> </span>challenge</span>ã€è¾“å‡º<span class="heti-skip"><span class="heti-spacing"> </span>user<span class="heti-spacing"> </span></span>åˆå§‹<span><span class="heti-spacing"> </span>lamports</span>ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">challenge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">challenge</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">lamports</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user lamport before: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</code></pre></div></li>
<li>æ¥æ”¶æŒ‡ä»¤ï¼Œäº¤ç»™ç”¨æˆ·åˆçº¦æ‰§è¡Œï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">challenge</span><span class="p">.</span><span class="n">input_instruction</span><span class="p">(</span><span class="n">solve_pubkey</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="n">user</span><span class="p">]).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
</code></pre></div><ul>
<li>è¿™é‡Œçš„<span class="heti-skip"><span class="heti-spacing"> </span>input_instruction<span class="heti-spacing"> </span></span>æ–¹æ³•ä¹Ÿæ˜¯åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>sol-ctf-framework<span class="heti-spacing"> </span></span>ä¸­å®šä¹‰çš„ï¼Œè¾“å…¥æ–¹æ³•è¾ƒå¤æ‚ï¼Œä¸è¿‡å¥½åœ¨é¢˜ç›®æä¾›äº†ä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>solve.py<span class="heti-spacing"> </span></span>ç”¨æ¥äº¤äº’è¾“å…¥æŒ‡ä»¤</li>
</ul>
</li>
<li>æ£€æŸ¥ç›®æ ‡ï¼Œè¾¾åˆ°åˆ™ä¸‹å‘<span><span class="heti-spacing"> </span>flag</span>ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">challenge</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="n">get_account</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">pubkey</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">().</span><span class="n">lamports</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user lamport after: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="k">if</span><span class="w"> </span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">TARGET_AMT</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fs</span>::<span class="n">read_to_string</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">        </span><span class="n">socket</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">        </span><span class="s">"Flag: {}"</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">        </span><span class="n">flag</span><span class="w"></span>
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="p">}</span><span class="w"></span>
</code></pre></div><ul>
<li>å¯è§ç›®æ ‡æ˜¯ä½¿<span class="heti-skip"><span class="heti-spacing"> </span>user<span class="heti-spacing"> </span></span>æ‹¥æœ‰çš„<span class="heti-skip"><span class="heti-spacing"> </span>lamports<span class="heti-spacing"> </span></span>å¤§äº<span><span class="heti-spacing"> </span>60000 lamports</span></li>
</ul>
</li>
</ul>
<p>è¿™æ ·æˆ‘ä»¬çš„æ”»å‡»æ–¹å¼å°±å¾ˆæ˜æ˜¾äº†ï¼š</p>
<ul>
<li>å…ˆè°ƒç”¨é¢˜ç›®åˆçº¦çš„<span class="heti-skip"><span class="heti-spacing"> </span>Init<span class="heti-spacing"> </span></span>æŒ‡ä»¤å®Œæˆåˆå§‹åŒ–ï¼ˆé¢˜ç›®å·²ç»å†™å¥½ï¼‰</li>
<li>å†<span><span class="heti-spacing"> </span>deposit 11 lamports</span>ï¼Œä½¿ç”¨æˆ·å¯¹åº”çš„<span class="heti-skip"><span class="heti-spacing"> </span>escrow<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>amount<span class="heti-spacing"> </span></span>è®°ä¸º<span><span class="heti-spacing"> </span>11</span></li>
<li>ç„¶å<span><span class="heti-spacing"> </span>pay 11 lamports</span>ï¼Œè¿™æ—¶ä¸ä¼šæ”¶å–<span class="heti-skip"><span class="heti-spacing"> </span>11 lamports<span class="heti-spacing"> </span></span>è€Œæ˜¯æ”¶å–åŸºç¡€è´¹ç”¨<span><span class="heti-spacing"> </span>15 lamports</span>ã€‚<span>escrow<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>amount<span class="heti-spacing"> </span></span>ä»<span class="heti-skip"><span class="heti-spacing"> </span>11<span class="heti-spacing"> </span></span>å‡å»<span class="heti-skip"><span class="heti-spacing"> </span>15<span class="heti-spacing"> </span></span>å‘ç”Ÿæº¢å‡ºï¼Œæº¢å‡ºåˆ°<span><span class="heti-spacing"> </span>65531</span>ï¼Œæ­¤æ—¶<span class="heti-skip"><span class="heti-spacing"> </span>withdraw<span class="heti-spacing"> </span></span>çš„è¯<span class="heti-skip"><span class="heti-spacing"> </span>reserve<span class="heti-spacing"> </span></span>æœ‰<span class="heti-skip"><span class="heti-spacing"> </span>1000000<span class="heti-spacing"> </span></span>è¶³å¤Ÿæ”¯ä»˜ï¼Œæå‡ºæ¥åä¹Ÿå¯ä»¥è¾¾åˆ°é¢˜ç›®<span class="heti-skip"><span class="heti-spacing"> </span>60000<span class="heti-spacing"> </span></span>çš„ç›®æ ‡</li>
<li>ç›´æ¥<span class="heti-skip"><span class="heti-spacing"> </span>withdraw<span class="heti-spacing"> </span></span>å³å¯</li>
</ul>
<p>æ‰€ä»¥åªéœ€è¦å°†è¿™äº›æ­¥éª¤éƒ½ç…§è‘«èŠ¦ç”»ç“¢å†™åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>processor.rs<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>process_instruction<span class="heti-spacing"> </span></span>ä¸­å³å¯ï¼š</p>
<details class="success" open="open">
<summary><span>exp<span class="heti-spacing"> </span></span>åˆçº¦</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">process_instruction</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="n">_program</span>: <span class="kp">&amp;</span><span class="nc">Pubkey</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="n">accounts</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">AccountInfo</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="n">_data</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ProgramResult</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">account_iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">accounts</span><span class="p">.</span><span class="n">iter</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">utility_program</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">escrow_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sys_prog_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_account_info</span><span class="p">(</span><span class="n">account_iter</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a>
<a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">    </span><span class="n">invoke</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">Instruction</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">            </span><span class="n">program_id</span>: <span class="o">*</span><span class="n">utility_program</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">            </span><span class="n">accounts</span>: <span class="nc">vec</span><span class="o">!</span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-18" id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-19" id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new</span><span class="p">(</span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-20" id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">                </span><span class="n">AccountMeta</span>::<span class="n">new_readonly</span><span class="p">(</span><span class="n">system_program</span>::<span class="n">id</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-21" id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">            </span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-12-22" id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">            </span><span class="n">data</span>: <span class="nc">ServiceInstruction</span>::<span class="n">Init</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-12-23" id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="w">                </span><span class="p">.</span><span class="n">try_to_vec</span><span class="p">()</span><span class="w"></span>
<a href="#__codelineno-12-24" id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="w">                </span><span class="p">.</span><span class="n">unwrap</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-25" id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a href="#__codelineno-12-26" id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-12-27" id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="w">            </span><span class="n">reserve</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-28" id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">            </span><span class="n">escrow_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-29" id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-30" id="__codelineno-12-30" name="__codelineno-12-30"></a><span class="w">            </span><span class="n">sys_prog_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-31" id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="w">        </span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-12-32" id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-33" id="__codelineno-12-33" name="__codelineno-12-33"></a>
<a href="#__codelineno-12-34" id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">    </span><span class="n">invoke</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-35" id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">deposit_escrow</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-36" id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">            </span><span class="o">*</span><span class="n">utility_program</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-37" id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">            </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-38" id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">            </span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-39" id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="w">            </span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-40" id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="w">            </span><span class="mi">11</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-41" id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="w">        </span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-42" id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-12-43" id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="w">            </span><span class="n">reserve</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-44" id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="w">            </span><span class="n">escrow_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-45" id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-46" id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="w">            </span><span class="n">sys_prog_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-47" id="__codelineno-12-47" name="__codelineno-12-47"></a><span class="w">        </span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-12-48" id="__codelineno-12-48" name="__codelineno-12-48"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-49" id="__codelineno-12-49" name="__codelineno-12-49"></a>
<a href="#__codelineno-12-50" id="__codelineno-12-50" name="__codelineno-12-50"></a><span class="w">    </span><span class="n">invoke</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-51" id="__codelineno-12-51" name="__codelineno-12-51"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">pay_utility_fees</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-52" id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="w">            </span><span class="o">*</span><span class="n">utility_program</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-53" id="__codelineno-12-53" name="__codelineno-12-53"></a><span class="w">            </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-54" id="__codelineno-12-54" name="__codelineno-12-54"></a><span class="w">            </span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-55" id="__codelineno-12-55" name="__codelineno-12-55"></a><span class="w">            </span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"> </span>
<a href="#__codelineno-12-56" id="__codelineno-12-56" name="__codelineno-12-56"></a><span class="w">            </span><span class="mi">11</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-57" id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="w">        </span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-58" id="__codelineno-12-58" name="__codelineno-12-58"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-12-59" id="__codelineno-12-59" name="__codelineno-12-59"></a><span class="w">            </span><span class="n">reserve</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-60" id="__codelineno-12-60" name="__codelineno-12-60"></a><span class="w">            </span><span class="n">escrow_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-61" id="__codelineno-12-61" name="__codelineno-12-61"></a><span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-62" id="__codelineno-12-62" name="__codelineno-12-62"></a><span class="w">            </span><span class="n">sys_prog_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-63" id="__codelineno-12-63" name="__codelineno-12-63"></a><span class="w">        </span><span class="p">],</span><span class="w">        </span>
<a href="#__codelineno-12-64" id="__codelineno-12-64" name="__codelineno-12-64"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-65" id="__codelineno-12-65" name="__codelineno-12-65"></a>
<a href="#__codelineno-12-66" id="__codelineno-12-66" name="__codelineno-12-66"></a><span class="w">    </span><span class="n">invoke</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-67" id="__codelineno-12-67" name="__codelineno-12-67"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">withdraw_escrow</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-12-68" id="__codelineno-12-68" name="__codelineno-12-68"></a><span class="w">            </span><span class="o">*</span><span class="n">utility_program</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-69" id="__codelineno-12-69" name="__codelineno-12-69"></a><span class="w">            </span><span class="o">*</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-70" id="__codelineno-12-70" name="__codelineno-12-70"></a><span class="w">            </span><span class="o">*</span><span class="n">reserve</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-71" id="__codelineno-12-71" name="__codelineno-12-71"></a><span class="w">            </span><span class="o">*</span><span class="n">escrow_account</span><span class="p">.</span><span class="n">key</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-12-72" id="__codelineno-12-72" name="__codelineno-12-72"></a><span class="w">        </span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-12-73" id="__codelineno-12-73" name="__codelineno-12-73"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-12-74" id="__codelineno-12-74" name="__codelineno-12-74"></a><span class="w">            </span><span class="n">reserve</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-75" id="__codelineno-12-75" name="__codelineno-12-75"></a><span class="w">            </span><span class="n">escrow_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-76" id="__codelineno-12-76" name="__codelineno-12-76"></a><span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-77" id="__codelineno-12-77" name="__codelineno-12-77"></a><span class="w">            </span><span class="n">sys_prog_account</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-12-78" id="__codelineno-12-78" name="__codelineno-12-78"></a><span class="w">        </span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-12-79" id="__codelineno-12-79" name="__codelineno-12-79"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-12-80" id="__codelineno-12-80" name="__codelineno-12-80"></a>
<a href="#__codelineno-12-81" id="__codelineno-12-81" name="__codelineno-12-81"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-12-82" id="__codelineno-12-82" name="__codelineno-12-82"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<p>ä¹‹ååˆ©ç”¨<span><span class="heti-spacing"> </span>cargo build-bpf</span>ï¼ˆéœ€è¦å…ˆå®‰è£…<span><span class="heti-spacing"> </span>solana</span>ï¼‰ç¼–è¯‘å‡º<span class="heti-skip"><span class="heti-spacing"> </span>.so<span class="heti-spacing"> </span></span>æ–‡ä»¶ï¼Œå†äº¤ç»™<span class="heti-skip"><span class="heti-spacing"> </span>solve.py<span class="heti-spacing"> </span></span>è„šæœ¬äº¤é¢˜å³å¯ã€‚</p>
<p>flag: <strong>n1ctf{cashback_â€¦â€¦}</strong></p>
<hr/>
<h2 id="simple-staking">Simple Staking<a class="headerlink" href="#simple-staking" title="Permanent link">Â¶</a></h2>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://img.shields.io/badge/-BLOCKCHAIN-orange?style=flat-square"><img alt="" src="https://img.shields.io/badge/-BLOCKCHAIN-orange?style=flat-square"/></a></p>
<p>åŒæ ·ä¹Ÿæ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>åˆçº¦ï¼Œä¸è¿‡ç”¨äº†<span><span class="heti-spacing"> </span>anchor lang</span>ï¼š<a href="https://www.anchor-lang.com/">https://www.anchor-lang.com/</a> ï¼Œæœ‰å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„å†™æ³•ï¼Œä½†çœ‹çœ‹æ–‡æ¡£è¿˜æŒºå¥½æ‡‚çš„</p>
<p>è¿˜æ˜¯è¯¦ç»†è§£æä¸€ä¸‹ï¼š</p>
<h3 id="_1">é¢˜ç›®åˆçº¦<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>Â¶</span></a></h3>
<p><span>anchor lang<span class="heti-spacing"> </span></span>çš„è¯­æ³•çœ‹èµ·æ¥å°±æ˜¯æŠŠå¤„ç†å‡½æ•°å°è£…åœ¨ä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>mod<span class="heti-spacing"> </span></span>ä¸­ç„¶åç”¨ <code class="highlight"><span class="cp">#[program]</span><span class="w"></span></code> å®æ¥å¤„ç†ã€‚</p>
<p>è¿™ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>mod<span class="heti-spacing"> </span></span>ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½ä¼šè¢«å¤„ç†æˆä¸€ä¸ªæŒ‡ä»¤ï¼Œå®ƒä»¬ç¬¬ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>Context<span class="heti-spacing"> </span></span>æ³›å‹ï¼Œå…¶ä¾èµ–çš„æ˜¯é’ˆå¯¹æ¯ç§æŒ‡ä»¤çš„ç»“æ„ä½“<span><span class="heti-spacing"> </span>Accounts</span>ï¼ˆå³<span><span class="heti-spacing"> </span>Context</span><accounts>ï¼‰ï¼Œç„¶ååœ¨å‡½æ•°å†…éƒ¨å¯ä»¥åˆ©ç”¨<span class="heti-skip"><span class="heti-spacing"> </span>ctx.accounts.?<span class="heti-spacing"> </span></span>æ¥è·å–å¯¹åº”ç»“æ„ä½“ä¸­çš„å„ä¸ª<span><span class="heti-spacing"> </span>account</span>ã€‚</accounts></p>
<p>ç»“æ„ä½“çš„å®šä¹‰ä¼šä½¿ç”¨ <code class="highlight"><span class="cp">#[derive(Accounts)]</span><span class="w"></span></code> å®æ¥è¿›è¡Œå¤„ç†ã€‚å…¶ä¸­æˆå‘˜ä¹Ÿå¯ä»¥ä½¿ç”¨ <code class="highlight"><span class="cp">#[account()]</span><span class="w"></span></code> å®è¿›è¡Œé™å®šï¼Œå¦‚æœè¾“å…¥ä¸æ»¡è¶³é™å®šåˆ™ä¼šæŠ¥é”™ï¼Œå…·ä½“å†™æ³•å’Œæ„ä¹‰å¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h4 id="initialize">Initialize<a class="headerlink" href="#initialize" title="Permanent link">Â¶</a></h4>
<ul>
<li>å¤„ç†å‡½æ•°æ˜¯ç©ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ“ä½œéƒ½åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>Initialize<span class="heti-spacing"> </span></span>ç»“æ„ä½“ä¸­è¿›è¡Œ
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">_ctx</span>: <span class="nc">Context</span><span class="o">&lt;</span><span class="n">Initialize</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></li>
<li><span>Initialize<span class="heti-spacing"> </span></span>ç»“æ„ä½“å­—æ®µï¼š<ul>
<li>catalogï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="cp">    init,</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="cp">    seeds = [ b</span><span class="s">"CATALOG"</span><span class="cp"> ],</span>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="cp">    bump,   </span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="cp">    payer = payer,</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="cp">    space = Catalog::SIZE,</span>
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="k">pub</span><span class="w"> </span><span class="n">catalog</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Catalog</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li><span>init<span class="heti-spacing"> </span></span>è¡¨ç¤ºè¿™ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>account<span class="heti-spacing"> </span></span>éœ€è¦åˆå§‹åŒ–ï¼ˆè€Œä¸”ä¸èƒ½é‡å¤è¿›è¡Œï¼‰</li>
<li><span>seeds<span class="heti-spacing"> </span></span>è¡¨ç¤ºç”¨è¿™ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>æ¥æ‰¾<span><span class="heti-spacing"> </span>PDA</span></li>
<li><span>bump<span class="heti-spacing"> </span></span>è¡¨ç¤ºè¦è®°å½•ä¸‹<span><span class="heti-spacing"> </span>canonical bump</span>ï¼ˆå¯ä»¥é€šè¿‡ <code class="highlight"><span class="o">*</span><span class="n">ctx</span><span class="p">.</span><span class="n">bumps</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"catalog"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()</span><span class="w"></span></code> æ¥è·å–è¿™ä¸ª<span><span class="heti-spacing"> </span>bump</span></li>
<li><span>payer<span class="heti-spacing"> </span></span>è¡¨ç¤ºåˆ›å»ºè´¦å·è¦ç”¨çš„<span><span class="heti-spacing"> </span>payer</span></li>
<li><span>space<span class="heti-spacing"> </span></span>ç”¨æ¥ç¡®å®šå¤§å°ï¼Œç”±<span class="heti-skip"><span class="heti-spacing"> </span>Catalog<span class="heti-spacing"> </span></span>è§„å®š</li>
<li>è¿™ä¸ªè´¦æˆ·å­˜çš„ä¿¡æ¯ï¼ˆdataï¼‰æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>Catalog<span class="heti-spacing"> </span></span>ç»“æ„ä½“çš„å†…å®¹ï¼ˆåºåˆ—åŒ–åï¼‰<span>Catalog<span class="heti-spacing"> </span></span>å®šä¹‰ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="cp">#[account]</span><span class="w"></span>
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="cp">#[repr(C, align(8))]</span><span class="w"></span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="cp">#[derive(Default)]</span><span class="w"></span>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Catalog</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">orgs</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">ids</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="k">impl</span><span class="w"> </span><span class="n">Catalog</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SIZE</span><span class="w"> </span>: <span class="kt">usize</span> <span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span>
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAXIMUM_STRING_SIZE</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAXIMUM_CATALOG_SIZE</span><span class="w">   </span><span class="c1">// orgs: Vec&lt;String&gt;,</span>
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAXIMUM_STRING_SIZE</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAXIMUM_CATALOG_SIZE</span><span class="p">;</span><span class="w">  </span><span class="c1">//  ids: Vec&lt;String&gt;,</span>
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></li>
</ul>
</li>
<li>reserveï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="cp">    init,</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="cp">    seeds = [ b</span><span class="s">"RESERVE"</span><span class="cp"> ],</span>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="cp">    bump,</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="cp">    payer = payer,</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="cp">    token::mint = mint,</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="cp">    token::authority = reserve</span>
<a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="k">pub</span><span class="w"> </span><span class="n">reserve</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">TokenAccount</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li>ä¸å‰é¢åŒç†</li>
<li>è¿™æ˜¯ä¸€ä¸ª<span><span class="heti-spacing"> </span>TokenAccount</span>ï¼Œå…¶å®šä¹‰åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>spl_token<span class="heti-spacing"> </span></span>ä¸­ï¼Œæ˜¯ä¸€ä¸ªç±»ä¼¼<span class="heti-skip"><span class="heti-spacing"> </span>ERC20<span class="heti-spacing"> </span></span>çš„ä»£å¸</li>
</ul>
</li>
<li>å…¶å®ƒï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">pub</span><span class="w"> </span><span class="n">mint</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Mint</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="cp">#[account(mut)]</span><span class="w"></span>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="k">pub</span><span class="w"> </span><span class="n">payer</span>: <span class="nc">Signer</span><span class="o">&lt;'</span><span class="na">info</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="k">pub</span><span class="w"> </span><span class="n">token_program</span>: <span class="nc">Program</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Token</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="k">pub</span><span class="w"> </span><span class="n">system_program</span>: <span class="nc">Program</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="k">pub</span><span class="w"> </span><span class="n">rent</span>: <span class="nc">Sysvar</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Rent</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li><span>mint<span class="heti-spacing"> </span></span>ä¸º<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>åˆçº¦çš„<span class="heti-skip"><span class="heti-spacing"> </span>mint<span class="heti-spacing"> </span></span>è´¦æˆ·ï¼Œç”¨æ¥ç»™<span class="heti-skip"><span class="heti-spacing"> </span>reserve<span class="heti-spacing"> </span></span>æä¾›å‚æ•°<span><span class="heti-spacing"> </span>token::mint</span></li>
<li><span>payer<span class="heti-spacing"> </span></span>ä¹Ÿæ˜¯ä¸ºå‰é¢ä¸¤ä¸ªæä¾›å‚æ•°</li>
<li><span>token_program<span class="heti-spacing"> </span></span>æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>spl token<span class="heti-spacing"> </span></span>çš„<span><span class="heti-spacing"> </span>ID</span></li>
<li><span>system_program<span class="heti-spacing"> </span></span>æ˜¯é¢˜ç›®åˆçº¦çš„<span><span class="heti-spacing"> </span>ID</span></li>
<li><span>rent<span class="heti-spacing"> </span></span>æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>ç³»ç»Ÿçš„<span><span class="heti-spacing"> </span>rent ID</span>ï¼ˆä¸ç”¨ç®¡è¿™ä¸ªï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="register">Register<a class="headerlink" href="#register" title="Permanent link">Â¶</a></h4>
<ul>
<li><span>Register<span class="heti-spacing"> </span></span>ç»“æ„ä½“ï¼š<ul>
<li>catalogï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="cp">    mut,</span>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="cp">    seeds = [ b</span><span class="s">"CATALOG"</span><span class="cp"> ],</span>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="cp">    bump</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="k">pub</span><span class="w"> </span><span class="n">catalog</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Catalog</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li>æ ¹æ®è¿™ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>æ¥è·å–ï¼ŒåŒæ ·è®°å½•<span><span class="heti-spacing"> </span>bump</span></li>
</ul>
</li>
<li>employee_recordï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="cp">    init,</span>
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="cp">    seeds = [user.key().as_ref()],</span>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="cp">    bump,</span>
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="cp">    payer = user,</span>
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="cp">    space = EmployeeRecord::SIZE,</span>
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="k">pub</span><span class="w"> </span><span class="n">employee_record</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">EmployeeRecord</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li>å’Œå‰é¢<span class="heti-skip"><span class="heti-spacing"> </span>Initialize<span class="heti-spacing"> </span></span>çš„åŒç†</li>
<li>å…¶ä¸­<span class="heti-skip"><span class="heti-spacing"> </span>EmployeeRecord<span class="heti-spacing"> </span></span>ç»“æ„ä½“ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="cp">#[account]</span><span class="w"></span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="cp">#[repr(C, align(8))]</span><span class="w"></span>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="cp">#[derive(Default)]</span><span class="w"></span>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">EmployeeRecord</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">org</span>: <span class="nb">String</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">id</span>: <span class="nb">String</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">key</span>: <span class="nc">Pubkey</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="k">impl</span><span class="w"> </span><span class="n">EmployeeRecord</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SIZE</span><span class="w"> </span>: <span class="kt">usize</span> <span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span>
<a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAXIMUM_STRING_SIZE</span><span class="w">   </span><span class="c1">// orgs: String,</span>
<a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MAXIMUM_STRING_SIZE</span><span class="w">   </span><span class="c1">//  ids: String,</span>
<a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w">                       </span><span class="c1">//  key: Pubkey</span>
<a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></li>
</ul>
</li>
<li>å…¶å®ƒï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="cp">#[account(mut)]</span><span class="w"></span>
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="k">pub</span><span class="w"> </span><span class="n">user</span>: <span class="nc">Signer</span><span class="o">&lt;'</span><span class="na">info</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="k">pub</span><span class="w"> </span><span class="n">system_program</span>: <span class="nc">Program</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">pub</span><span class="w"> </span><span class="n">rent</span>: <span class="nc">Sysvar</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Rent</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div></li>
</ul>
</li>
<li>å¤„ç†å‡½æ•°ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">register</span><span class="p">(</span><span class="n">ctx</span>: <span class="nc">Context</span><span class="o">&lt;</span><span class="n">Register</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">org_name</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">employee_id</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="n">msg</span><span class="o">!</span><span class="p">(</span><span class="s">"[CHALL] register: org {}, id {}"</span><span class="p">,</span><span class="w"> </span><span class="n">org_name</span><span class="p">,</span><span class="w"> </span><span class="n">employee_id</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">        </span><span class="n">org_name</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAXIMUM_STRING_SIZE</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">        </span><span class="n">CoreError</span>::<span class="n">StringTooLong</span><span class="w"></span>
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">        </span><span class="n">employee_id</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">MAXIMUM_STRING_SIZE</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">        </span><span class="n">CoreError</span>::<span class="n">StringTooLong</span><span class="w"></span>
<a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a>
<a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">catalog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">catalog</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">        </span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">catalog</span><span class="p">.</span><span class="n">orgs</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">org_name</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">catalog</span><span class="p">.</span><span class="n">ids</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">employee_id</span><span class="p">)</span><span class="w"> </span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">        </span><span class="n">CoreError</span>::<span class="n">DuplicatedEmployee</span><span class="w"></span>
<a href="#__codelineno-22-17" id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-22-18" id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">    </span><span class="n">catalog</span><span class="p">.</span><span class="n">orgs</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">org_name</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span><span class="w"></span>
<a href="#__codelineno-22-19" id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="w">    </span><span class="n">catalog</span><span class="p">.</span><span class="n">ids</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">employee_id</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span><span class="w"></span>
<a href="#__codelineno-22-20" id="__codelineno-22-20" name="__codelineno-22-20"></a>
<a href="#__codelineno-22-21" id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">employee_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">employee_record</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-22-22" id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">employee_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-22-23" id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="w">    </span><span class="n">employee_record</span><span class="p">.</span><span class="n">org</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">org_name</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-22-24" id="__codelineno-22-24" name="__codelineno-22-24"></a><span class="w">    </span><span class="n">employee_record</span><span class="p">.</span><span class="n">id</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">employee_id</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-22-25" id="__codelineno-22-25" name="__codelineno-22-25"></a><span class="w">    </span><span class="n">employee_record</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee_key</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-22-26" id="__codelineno-22-26" name="__codelineno-22-26"></a>
<a href="#__codelineno-22-27" id="__codelineno-22-27" name="__codelineno-22-27"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-22-28" id="__codelineno-22-28" name="__codelineno-22-28"></a><span class="p">}</span><span class="w"></span>
</code></pre></div><ul>
<li>é¦–å…ˆéªŒè¯<span class="heti-skip"><span class="heti-spacing"> </span>org_name<span class="heti-spacing"> </span></span>å’Œ<span class="heti-skip"><span class="heti-spacing"> </span>employee_id<span class="heti-spacing"> </span></span>çš„é•¿åº¦</li>
<li>æ£€æŸ¥<span class="heti-skip"><span class="heti-spacing"> </span>(org_name, employee_id)<span class="heti-spacing"> </span></span>æ˜¯å¦åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>catalog<span class="heti-spacing"> </span></span>ä¸­å­˜åœ¨ï¼Œå­˜åœ¨åˆ™æŠ¥é”™</li>
<li>å°†<span class="heti-skip"><span class="heti-spacing"> </span>(org_name, employee_id)<span class="heti-spacing"> </span></span>æ·»åŠ åˆ°<span class="heti-skip"><span class="heti-spacing"> </span>catalog<span class="heti-spacing"> </span></span>ä¸­</li>
<li>ä¿®æ”¹<span><span class="heti-spacing"> </span>employee_record</span></li>
</ul>
</li>
</ul>
<h4 id="deposit">Deposit<a class="headerlink" href="#deposit" title="Permanent link">Â¶</a></h4>
<ul>
<li><span>Deposit<span class="heti-spacing"> </span></span>ç»“æ„ä½“<ul>
<li>vaultï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="cp">    init_if_needed,</span>
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="cp">    seeds = [org_name.as_bytes(), employee_id.as_bytes()],</span>
<a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="cp">    bump,</span>
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="cp">    space = Vault::SIZE,</span>
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="cp">    payer = user </span>
<a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="k">pub</span><span class="w"> </span><span class="n">vault</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Vault</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li>é€šè¿‡<span class="heti-skip"><span class="heti-spacing"> </span>[org_name, employee_id]<span class="heti-spacing"> </span></span>è¿™ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>è·å–<span><span class="heti-spacing"> </span>PDA</span></li>
<li><span>Vault<span class="heti-spacing"> </span></span>å®šä¹‰ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="cp">#[account]</span><span class="w"></span>
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="cp">#[repr(C, align(8))]</span><span class="w"></span>
<a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="cp">#[derive(Default)]</span><span class="w"></span>
<a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span> <span class="nc">Vault</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span>: <span class="kt">u64</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="k">impl</span><span class="w"> </span><span class="n">Vault</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">SIZE</span><span class="w"> </span>: <span class="kt">usize</span> <span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="c1">// DISCRIMINATOR_SIZE</span>
<a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w">                   </span><span class="c1">// u64</span>
<a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></li>
</ul>
</li>
<li>employee_recordï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="cp">    seeds = [user.key().as_ref()],</span>
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="cp">    bump,</span>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="cp">    constraint = employee_record.org == org_name,</span>
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="cp">    constraint = employee_record.id == employee_id,</span>
<a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="cp">    constraint = employee_record.key == user.key(),</span>
<a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="k">pub</span><span class="w"> </span><span class="n">employee_record</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">EmployeeRecord</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div><ul>
<li>è¿™é‡Œæœ‰æ–°å‡ºç°çš„<span><span class="heti-spacing"> </span>constraint</span>ï¼Œä¼ å‚æ—¶ä¼šæ£€æŸ¥å…¶å†…å®¹æ˜¯å¦ä¸º<span><span class="heti-spacing"> </span>true</span>ï¼Œä¸æ˜¯çš„è¯å°±æŠ¥é”™ç„¶å<span><span class="heti-spacing"> </span>revert</span></li>
</ul>
</li>
<li>å…¶å®ƒ
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="cp">#[account(</span>
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="cp">    mut,</span>
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="cp">    seeds = [ b</span><span class="s">"RESERVE"</span><span class="cp"> ],</span>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="cp">    bump,</span>
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="cp">    constraint = reserve.mint == mint.key(),</span>
<a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="k">pub</span><span class="w"> </span><span class="n">reserve</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">TokenAccount</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a>
<a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="cp">#[account(</span>
<a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="cp">    mut,</span>
<a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="cp">    constraint = user_token_account.owner == user.key(),</span>
<a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="cp">    constraint = user_token_account.mint  == mint.key()</span>
<a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="cp">)]</span><span class="w"></span>
<a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="k">pub</span><span class="w"> </span><span class="n">user_token_account</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">TokenAccount</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a>
<a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="k">pub</span><span class="w"> </span><span class="n">mint</span>: <span class="nc">Account</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Mint</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a>
<a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="cp">#[account(mut)]</span><span class="w"></span>
<a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="k">pub</span><span class="w"> </span><span class="n">user</span>: <span class="nc">Signer</span><span class="o">&lt;'</span><span class="na">info</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="k">pub</span><span class="w"> </span><span class="n">token_program</span>: <span class="nc">Program</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Token</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="k">pub</span><span class="w"> </span><span class="n">system_program</span>: <span class="nc">Program</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">System</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="k">pub</span><span class="w"> </span><span class="n">rent</span>: <span class="nc">Sysvar</span><span class="o">&lt;'</span><span class="na">info</span><span class="p">,</span><span class="w"> </span><span class="n">Rent</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
</code></pre></div></li>
</ul>
</li>
<li>å¤„ç†å‡½æ•°ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">deposit</span><span class="p">(</span><span class="n">ctx</span>: <span class="nc">Context</span><span class="o">&lt;</span><span class="n">Deposit</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">org_name</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">employee_id</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span>: <span class="kt">u64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">    </span><span class="n">msg</span><span class="o">!</span><span class="p">(</span><span class="s">"[CHALL] deposit"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">vault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">vault</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">employee_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">employee_record</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a>
<a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="n">key</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">employee_record</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">org_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">employee_record</span><span class="p">.</span><span class="n">org</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">employee_record</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">        </span><span class="n">CoreError</span>::<span class="n">UnknownEmployee</span><span class="w"></span>
<a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a>
<a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">deposit_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CpiContext</span>::<span class="n">new</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-27-13" id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">token_program</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-27-14" id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">        </span><span class="n">Transfer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-27-15" id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">            </span><span class="n">from</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user_token_account</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-27-16" id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">            </span><span class="n">to</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">reserve</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-27-17" id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="w">            </span><span class="n">authority</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">()</span><span class="w"></span>
<a href="#__codelineno-27-18" id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-27-19" id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-27-20" id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="w">    </span><span class="n">token</span>::<span class="n">transfer</span><span class="p">(</span><span class="n">deposit_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-27-21" id="__codelineno-27-21" name="__codelineno-27-21"></a>
<a href="#__codelineno-27-22" id="__codelineno-27-22" name="__codelineno-27-22"></a><span class="w">    </span><span class="n">vault</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-27-23" id="__codelineno-27-23" name="__codelineno-27-23"></a>
<a href="#__codelineno-27-24" id="__codelineno-27-24" name="__codelineno-27-24"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-27-25" id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="p">}</span><span class="w"></span>
</code></pre></div><ul>
<li>å…ˆè¯•ä¸€ç³»åˆ—æ£€æŸ¥ï¼Œæ£€æŸ¥è¾“å…¥æ˜¯å¦åˆæ³•</li>
<li>ç„¶åè°ƒç”¨<span class="heti-skip"><span class="heti-spacing"> </span>spl token<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>transfer<span class="heti-spacing"> </span></span>æŒ‡ä»¤æ¥ä»<span class="heti-skip"><span class="heti-spacing"> </span>user_token_account<span class="heti-spacing"> </span></span>è½¬<span class="heti-skip"><span class="heti-spacing"> </span>amount<span class="heti-spacing"> </span></span>ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>token<span class="heti-spacing"> </span></span>ç»™<span><span class="heti-spacing"> </span>reserve</span></li>
<li>ä¸º<span class="heti-skip"><span class="heti-spacing"> </span>vault<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>amount<span class="heti-spacing"> </span></span>å¢åŠ <span><span class="heti-spacing"> </span>amount</span>ï¼ˆè¿™ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>vault<span class="heti-spacing"> </span></span>æ˜¯æ ¹æ®<span class="heti-skip"><span class="heti-spacing"> </span>seed [org_name, employee_id]<span class="heti-spacing"> </span></span>æ‰¾åˆ°çš„<span><span class="heti-spacing"> </span>PDA</span>ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="withdraw">Withdraw<a class="headerlink" href="#withdraw" title="Permanent link">Â¶</a></h4>
<ul>
<li><span>Withdraw<span class="heti-spacing"> </span></span>ç»“æ„ä½“<ul>
<li>å…¶å†…å®¹å’Œ<span class="heti-skip"><span class="heti-spacing"> </span>Deposit<span class="heti-spacing"> </span></span>å‡ ä¹ä¸€è‡´</li>
<li>åŒºåˆ«åœ¨äº<span class="heti-skip"><span class="heti-spacing"> </span>Deposit<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>user<span class="heti-spacing"> </span></span>åœ¨è¿™é‡Œå«åš<span><span class="heti-spacing"> </span>payer</span>ï¼Œä¸è¿‡ç”¨å¤„åº”è¯¥æ²¡å˜</li>
</ul>
</li>
<li>å¤„ç†å‡½æ•°ï¼š
    <div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">ctx</span>: <span class="nc">Context</span><span class="o">&lt;</span><span class="n">Withdraw</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">org_name</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">employee_id</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span>: <span class="kt">u64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="n">msg</span><span class="o">!</span><span class="p">(</span><span class="s">"[CHALL] withdraw"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">vault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">vault</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">employee_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">employee_record</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">payer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">payer</span><span class="p">.</span><span class="n">key</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a>
<a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">        </span><span class="n">payer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">employee_record</span><span class="p">.</span><span class="n">key</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">org_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">employee_record</span><span class="p">.</span><span class="n">org</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">employee_record</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-28-9" id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">        </span><span class="n">CoreError</span>::<span class="n">UnknownEmployee</span><span class="w"></span>
<a href="#__codelineno-28-10" id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-28-11" id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">    </span><span class="n">require</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-28-12" id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">        </span><span class="n">vault</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-28-13" id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">        </span><span class="n">CoreError</span>::<span class="n">InsufficientBalance</span><span class="w"></span>
<a href="#__codelineno-28-14" id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-28-15" id="__codelineno-28-15" name="__codelineno-28-15"></a>
<a href="#__codelineno-28-16" id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve_bump</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">*</span><span class="n">ctx</span><span class="p">.</span><span class="n">bumps</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"reserve"</span><span class="p">).</span><span class="n">unwrap</span><span class="p">()];</span><span class="w"></span>
<a href="#__codelineno-28-17" id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">signer_seeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a href="#__codelineno-28-18" id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="w">        </span><span class="s">b"RESERVE"</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-28-19" id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="w">        </span><span class="n">reserve_bump</span><span class="p">.</span><span class="n">as_ref</span><span class="p">()</span><span class="w"></span>
<a href="#__codelineno-28-20" id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="w">    </span><span class="p">];</span><span class="w"></span>
<a href="#__codelineno-28-21" id="__codelineno-28-21" name="__codelineno-28-21"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">signer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="n">signer_seeds</span><span class="p">[</span><span class="o">..</span><span class="p">]];</span><span class="w"></span>
<a href="#__codelineno-28-22" id="__codelineno-28-22" name="__codelineno-28-22"></a>
<a href="#__codelineno-28-23" id="__codelineno-28-23" name="__codelineno-28-23"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">withdraw_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CpiContext</span>::<span class="n">new_with_signer</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-28-24" id="__codelineno-28-24" name="__codelineno-28-24"></a><span class="w">        </span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">token_program</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-28-25" id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="w">        </span><span class="n">Transfer</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-28-26" id="__codelineno-28-26" name="__codelineno-28-26"></a><span class="w">            </span><span class="n">from</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">reserve</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-28-27" id="__codelineno-28-27" name="__codelineno-28-27"></a><span class="w">            </span><span class="n">to</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user_account</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-28-28" id="__codelineno-28-28" name="__codelineno-28-28"></a><span class="w">            </span><span class="n">authority</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">reserve</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">()</span><span class="w"></span>
<a href="#__codelineno-28-29" id="__codelineno-28-29" name="__codelineno-28-29"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a href="#__codelineno-28-30" id="__codelineno-28-30" name="__codelineno-28-30"></a><span class="w">        </span><span class="n">signer</span><span class="w"></span>
<a href="#__codelineno-28-31" id="__codelineno-28-31" name="__codelineno-28-31"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-28-32" id="__codelineno-28-32" name="__codelineno-28-32"></a><span class="w">    </span><span class="n">token</span>::<span class="n">transfer</span><span class="p">(</span><span class="n">withdraw_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-28-33" id="__codelineno-28-33" name="__codelineno-28-33"></a>
<a href="#__codelineno-28-34" id="__codelineno-28-34" name="__codelineno-28-34"></a><span class="w">    </span><span class="n">vault</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-28-35" id="__codelineno-28-35" name="__codelineno-28-35"></a>
<a href="#__codelineno-28-36" id="__codelineno-28-36" name="__codelineno-28-36"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-28-37" id="__codelineno-28-37" name="__codelineno-28-37"></a><span class="p">}</span><span class="w"></span>
</code></pre></div><ul>
<li>åŒæ ·åšäº†å¾ˆå¤šæ£€æŸ¥</li>
<li>åˆ©ç”¨<span class="heti-skip"><span class="heti-spacing"> </span>spl token<span class="heti-spacing"> </span></span>åˆçº¦ä»<span class="heti-skip"><span class="heti-spacing"> </span>reserve transfer amount token<span class="heti-spacing"> </span></span>ç»™<span><span class="heti-spacing"> </span>user_account</span></li>
<li>ç»™<span class="heti-skip"><span class="heti-spacing"> </span>vault.amount<span class="heti-spacing"> </span></span>å‡å°‘<span><span class="heti-spacing"> </span>amount</span></li>
</ul>
</li>
</ul>
<h3 id="_2">é¢˜ç›®äº¤äº’éƒ¨åˆ†<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>Â¶</span></a></h3>
<details class="question">
<summary>é¢˜ç›®äº¤äº’ä»£ç </summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="k">async</span><span class="w"> </span><span class="k">fn</span> <span class="nf">handle_connection</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">socket</span>: <span class="nc">TcpStream</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ChallengeBuilder</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">try_clone</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">chall_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">add_program</span><span class="p">(</span><span class="s">"./chall/target/deploy/chall.so"</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">chall</span>::<span class="n">ID</span><span class="p">));</span><span class="w"></span>
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solve_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">input_program</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">chall</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">build</span><span class="p">().</span><span class="k">await</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a>
<a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">    </span><span class="c1">// -------------------------------------------------------------------------</span>
<a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="c1">// [setup env] initialize</span>
<a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">    </span><span class="c1">// -------------------------------------------------------------------------</span>
<a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">program_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall_id</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a>
<a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">mint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">add_mint</span><span class="p">().</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a>
<a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">payer_keypair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">chall</span><span class="p">.</span><span class="n">ctx</span><span class="p">.</span><span class="n">payer</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">payer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payer_keypair</span><span class="p">.</span><span class="n">pubkey</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a>
<a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user_keypair</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Keypair</span>::<span class="n">new</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user_keypair</span><span class="p">.</span><span class="n">pubkey</span><span class="p">();</span><span class="w"></span>
<a href="#__codelineno-29-21" id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-22" id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">        </span><span class="p">.</span><span class="n">run_ix</span><span class="p">(</span><span class="n">system_instruction</span>::<span class="n">transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">payer</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="mi">100_000_000_000</span><span class="p">))</span><span class="w"></span>
<a href="#__codelineno-29-23" id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-24" id="__codelineno-29-24" name="__codelineno-29-24"></a>
<a href="#__codelineno-29-25" id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">catalog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">b"CATALOG"</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program_id</span><span class="p">).</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-26" id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="s">b"RESERVE"</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program_id</span><span class="p">).</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-27" id="__codelineno-29-27" name="__codelineno-29-27"></a>
<a href="#__codelineno-29-28" id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Accounts created...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-29-29" id="__codelineno-29-29" name="__codelineno-29-29"></a>
<a href="#__codelineno-29-30" id="__codelineno-29-30" name="__codelineno-29-30"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">instruction</span>::<span class="n">Initialize</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<a href="#__codelineno-29-31" id="__codelineno-29-31" name="__codelineno-29-31"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ix_accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">accounts</span>::<span class="n">Initialize</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-32" id="__codelineno-29-32" name="__codelineno-29-32"></a><span class="w">        </span><span class="n">catalog</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-33" id="__codelineno-29-33" name="__codelineno-29-33"></a><span class="w">        </span><span class="n">reserve</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-34" id="__codelineno-29-34" name="__codelineno-29-34"></a><span class="w">        </span><span class="n">mint</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-35" id="__codelineno-29-35" name="__codelineno-29-35"></a><span class="w">        </span><span class="n">payer</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-36" id="__codelineno-29-36" name="__codelineno-29-36"></a><span class="w">        </span><span class="n">token_program</span>: <span class="nc">spl_token</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-37" id="__codelineno-29-37" name="__codelineno-29-37"></a><span class="w">        </span><span class="n">system_program</span>: <span class="nc">solana_program</span>::<span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-38" id="__codelineno-29-38" name="__codelineno-29-38"></a><span class="w">        </span><span class="n">rent</span>: <span class="nc">solana_program</span>::<span class="n">sysvar</span>::<span class="n">rent</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-39" id="__codelineno-29-39" name="__codelineno-29-39"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-29-40" id="__codelineno-29-40" name="__codelineno-29-40"></a>
<a href="#__codelineno-29-41" id="__codelineno-29-41" name="__codelineno-29-41"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-42" id="__codelineno-29-42" name="__codelineno-29-42"></a><span class="w">        </span><span class="p">.</span><span class="n">run_ix</span><span class="p">(</span><span class="n">Instruction</span>::<span class="n">new_with_bytes</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-43" id="__codelineno-29-43" name="__codelineno-29-43"></a><span class="w">            </span><span class="n">program_id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-44" id="__codelineno-29-44" name="__codelineno-29-44"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">ix</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-45" id="__codelineno-29-45" name="__codelineno-29-45"></a><span class="w">            </span><span class="n">ix_accounts</span><span class="p">.</span><span class="n">to_account_metas</span><span class="p">(</span><span class="nb">None</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-29-46" id="__codelineno-29-46" name="__codelineno-29-46"></a><span class="w">        </span><span class="p">))</span><span class="w"></span>
<a href="#__codelineno-29-47" id="__codelineno-29-47" name="__codelineno-29-47"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-48" id="__codelineno-29-48" name="__codelineno-29-48"></a>
<a href="#__codelineno-29-49" id="__codelineno-29-49" name="__codelineno-29-49"></a><span class="w">    </span><span class="c1">// -------------------------------------------------------------------------</span>
<a href="#__codelineno-29-50" id="__codelineno-29-50" name="__codelineno-29-50"></a><span class="w">    </span><span class="c1">// [setup env] register</span>
<a href="#__codelineno-29-51" id="__codelineno-29-51" name="__codelineno-29-51"></a><span class="w">    </span><span class="c1">// -------------------------------------------------------------------------</span>
<a href="#__codelineno-29-52" id="__codelineno-29-52" name="__codelineno-29-52"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">org_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"product"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-29-53" id="__codelineno-29-53" name="__codelineno-29-53"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">employee_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"employ_A"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-29-54" id="__codelineno-29-54" name="__codelineno-29-54"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">instruction</span>::<span class="n">Register</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-55" id="__codelineno-29-55" name="__codelineno-29-55"></a><span class="w">        </span><span class="n">org_name</span>: <span class="nc">org_name</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-56" id="__codelineno-29-56" name="__codelineno-29-56"></a><span class="w">        </span><span class="n">employee_id</span>: <span class="nc">employee_id</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-57" id="__codelineno-29-57" name="__codelineno-29-57"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-29-58" id="__codelineno-29-58" name="__codelineno-29-58"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">employee_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="n">payer</span><span class="p">.</span><span class="n">as_ref</span><span class="p">()],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program_id</span><span class="p">).</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-59" id="__codelineno-29-59" name="__codelineno-29-59"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reg_accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">accounts</span>::<span class="n">Register</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-60" id="__codelineno-29-60" name="__codelineno-29-60"></a><span class="w">        </span><span class="n">catalog</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-61" id="__codelineno-29-61" name="__codelineno-29-61"></a><span class="w">        </span><span class="n">employee_record</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-62" id="__codelineno-29-62" name="__codelineno-29-62"></a><span class="w">        </span><span class="n">user</span>: <span class="nc">payer</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-63" id="__codelineno-29-63" name="__codelineno-29-63"></a><span class="w">        </span><span class="n">system_program</span>: <span class="nc">solana_program</span>::<span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-64" id="__codelineno-29-64" name="__codelineno-29-64"></a><span class="w">        </span><span class="n">rent</span>: <span class="nc">solana_program</span>::<span class="n">sysvar</span>::<span class="n">rent</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-65" id="__codelineno-29-65" name="__codelineno-29-65"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-29-66" id="__codelineno-29-66" name="__codelineno-29-66"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-67" id="__codelineno-29-67" name="__codelineno-29-67"></a><span class="w">        </span><span class="p">.</span><span class="n">run_ix</span><span class="p">(</span><span class="n">Instruction</span>::<span class="n">new_with_bytes</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-68" id="__codelineno-29-68" name="__codelineno-29-68"></a><span class="w">            </span><span class="n">program_id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-69" id="__codelineno-29-69" name="__codelineno-29-69"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">ix</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-70" id="__codelineno-29-70" name="__codelineno-29-70"></a><span class="w">            </span><span class="n">reg_accounts</span><span class="p">.</span><span class="n">to_account_metas</span><span class="p">(</span><span class="nb">None</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-29-71" id="__codelineno-29-71" name="__codelineno-29-71"></a><span class="w">        </span><span class="p">))</span><span class="w"></span>
<a href="#__codelineno-29-72" id="__codelineno-29-72" name="__codelineno-29-72"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-73" id="__codelineno-29-73" name="__codelineno-29-73"></a>
<a href="#__codelineno-29-74" id="__codelineno-29-74" name="__codelineno-29-74"></a><span class="w">    </span><span class="c1">// -------------------------------------------------------------------------</span>
<a href="#__codelineno-29-75" id="__codelineno-29-75" name="__codelineno-29-75"></a><span class="w">    </span><span class="c1">// [setup env] deposits 1_000</span>
<a href="#__codelineno-29-76" id="__codelineno-29-76" name="__codelineno-29-76"></a><span class="w">    </span><span class="c1">// -------------------------------------------------------------------------</span>
<a href="#__codelineno-29-77" id="__codelineno-29-77" name="__codelineno-29-77"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">payer_token_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">add_token_account</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">payer</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-78" id="__codelineno-29-78" name="__codelineno-29-78"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-79" id="__codelineno-29-79" name="__codelineno-29-79"></a><span class="w">        </span><span class="p">.</span><span class="n">mint_to</span><span class="p">(</span><span class="mi">1_000_</span><span class="k">u64</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">payer_token_account</span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-29-80" id="__codelineno-29-80" name="__codelineno-29-80"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-81" id="__codelineno-29-81" name="__codelineno-29-81"></a>
<a href="#__codelineno-29-82" id="__codelineno-29-82" name="__codelineno-29-82"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">vault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-83" id="__codelineno-29-83" name="__codelineno-29-83"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="n">org_name</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">as_bytes</span><span class="p">(),</span><span class="w"> </span><span class="n">employee_id</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">as_bytes</span><span class="p">()],</span><span class="w"></span>
<a href="#__codelineno-29-84" id="__codelineno-29-84" name="__codelineno-29-84"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">program_id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-85" id="__codelineno-29-85" name="__codelineno-29-85"></a><span class="w">    </span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-29-86" id="__codelineno-29-86" name="__codelineno-29-86"></a><span class="w">    </span><span class="p">.</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-87" id="__codelineno-29-87" name="__codelineno-29-87"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">instruction</span>::<span class="n">Deposit</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-88" id="__codelineno-29-88" name="__codelineno-29-88"></a><span class="w">        </span><span class="n">org_name</span>: <span class="nc">org_name</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-89" id="__codelineno-29-89" name="__codelineno-29-89"></a><span class="w">        </span><span class="n">employee_id</span>: <span class="nc">employee_id</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-90" id="__codelineno-29-90" name="__codelineno-29-90"></a><span class="w">        </span><span class="n">amount</span>: <span class="mi">500_</span><span class="k">u64</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-91" id="__codelineno-29-91" name="__codelineno-29-91"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-29-92" id="__codelineno-29-92" name="__codelineno-29-92"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ix_accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">accounts</span>::<span class="n">Deposit</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-93" id="__codelineno-29-93" name="__codelineno-29-93"></a><span class="w">        </span><span class="n">vault</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-94" id="__codelineno-29-94" name="__codelineno-29-94"></a><span class="w">        </span><span class="n">employee_record</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-95" id="__codelineno-29-95" name="__codelineno-29-95"></a><span class="w">        </span><span class="n">reserve</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-96" id="__codelineno-29-96" name="__codelineno-29-96"></a><span class="w">        </span><span class="n">user_token_account</span>: <span class="nc">payer_token_account</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-97" id="__codelineno-29-97" name="__codelineno-29-97"></a><span class="w">        </span><span class="n">mint</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-98" id="__codelineno-29-98" name="__codelineno-29-98"></a><span class="w">        </span><span class="n">user</span>: <span class="nc">payer</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-99" id="__codelineno-29-99" name="__codelineno-29-99"></a><span class="w">        </span><span class="n">token_program</span>: <span class="nc">spl_token</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-100" id="__codelineno-29-100" name="__codelineno-29-100"></a><span class="w">        </span><span class="n">system_program</span>: <span class="nc">solana_program</span>::<span class="n">system_program</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-101" id="__codelineno-29-101" name="__codelineno-29-101"></a><span class="w">        </span><span class="n">rent</span>: <span class="nc">solana_program</span>::<span class="n">sysvar</span>::<span class="n">rent</span>::<span class="n">ID</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-102" id="__codelineno-29-102" name="__codelineno-29-102"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-29-103" id="__codelineno-29-103" name="__codelineno-29-103"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-104" id="__codelineno-29-104" name="__codelineno-29-104"></a><span class="w">        </span><span class="p">.</span><span class="n">run_ix</span><span class="p">(</span><span class="n">Instruction</span>::<span class="n">new_with_bytes</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-105" id="__codelineno-29-105" name="__codelineno-29-105"></a><span class="w">            </span><span class="n">program_id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-106" id="__codelineno-29-106" name="__codelineno-29-106"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">ix</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-107" id="__codelineno-29-107" name="__codelineno-29-107"></a><span class="w">            </span><span class="n">ix_accounts</span><span class="p">.</span><span class="n">to_account_metas</span><span class="p">(</span><span class="nb">None</span><span class="p">),</span><span class="w"></span>
<a href="#__codelineno-29-108" id="__codelineno-29-108" name="__codelineno-29-108"></a><span class="w">        </span><span class="p">))</span><span class="w"></span>
<a href="#__codelineno-29-109" id="__codelineno-29-109" name="__codelineno-29-109"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-110" id="__codelineno-29-110" name="__codelineno-29-110"></a>
<a href="#__codelineno-29-111" id="__codelineno-29-111" name="__codelineno-29-111"></a><span class="w">    </span><span class="c1">// TDOD: comment out</span>
<a href="#__codelineno-29-112" id="__codelineno-29-112" name="__codelineno-29-112"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">read_token_account</span><span class="p">(</span><span class="n">reserve</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-113" id="__codelineno-29-113" name="__codelineno-29-113"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">reserve_balance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reserve_account</span><span class="p">.</span><span class="n">amount</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-114" id="__codelineno-29-114" name="__codelineno-29-114"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-115" id="__codelineno-29-115" name="__codelineno-29-115"></a><span class="w">        </span><span class="s">"</span><span class="se">\n</span><span class="s">vault = {}</span><span class="se">\n</span><span class="s">reserve balance = {}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-116" id="__codelineno-29-116" name="__codelineno-29-116"></a><span class="w">        </span><span class="n">vault</span><span class="p">,</span><span class="w"> </span><span class="n">reserve_balance</span><span class="w"></span>
<a href="#__codelineno-29-117" id="__codelineno-29-117" name="__codelineno-29-117"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-29-118" id="__codelineno-29-118" name="__codelineno-29-118"></a><span class="w">    </span><span class="c1">// ----------------------------------------------------------------------------</span>
<a href="#__codelineno-29-119" id="__codelineno-29-119" name="__codelineno-29-119"></a><span class="w">    </span><span class="c1">// [setup env] done</span>
<a href="#__codelineno-29-120" id="__codelineno-29-120" name="__codelineno-29-120"></a><span class="w">    </span><span class="c1">// ----------------------------------------------------------------------------</span>
<a href="#__codelineno-29-121" id="__codelineno-29-121" name="__codelineno-29-121"></a>
<a href="#__codelineno-29-122" id="__codelineno-29-122" name="__codelineno-29-122"></a>
<a href="#__codelineno-29-123" id="__codelineno-29-123" name="__codelineno-29-123"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">init_amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100_</span><span class="k">u64</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-124" id="__codelineno-29-124" name="__codelineno-29-124"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user_record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="o">&amp;</span><span class="p">[</span><span class="n">user</span><span class="p">.</span><span class="n">as_ref</span><span class="p">()],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">program_id</span><span class="p">).</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-125" id="__codelineno-29-125" name="__codelineno-29-125"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user_token_account_pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">add_token_account</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-126" id="__codelineno-29-126" name="__codelineno-29-126"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-127" id="__codelineno-29-127" name="__codelineno-29-127"></a><span class="w">        </span><span class="p">.</span><span class="n">mint_to</span><span class="p">(</span><span class="n">init_amount</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mint</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_token_account_pubkey</span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-29-128" id="__codelineno-29-128" name="__codelineno-29-128"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-129" id="__codelineno-29-129" name="__codelineno-29-129"></a>
<a href="#__codelineno-29-130" id="__codelineno-29-130" name="__codelineno-29-130"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-131" id="__codelineno-29-131" name="__codelineno-29-131"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user_record: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">user_record</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-132" id="__codelineno-29-132" name="__codelineno-29-132"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"catalog: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">catalog</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-133" id="__codelineno-29-133" name="__codelineno-29-133"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"mint: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">mint</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-134" id="__codelineno-29-134" name="__codelineno-29-134"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"user_token_account: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">user_token_account_pubkey</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-135" id="__codelineno-29-135" name="__codelineno-29-135"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"reserve: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">reserve</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-136" id="__codelineno-29-136" name="__codelineno-29-136"></a>
<a href="#__codelineno-29-137" id="__codelineno-29-137" name="__codelineno-29-137"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">bump_budget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComputeBudgetInstruction</span>::<span class="n">request_units</span><span class="p">(</span><span class="mi">10_000_000</span><span class="k">u32</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="k">u32</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-29-138" id="__codelineno-29-138" name="__codelineno-29-138"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solve_ix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">read_instruction</span><span class="p">(</span><span class="n">solve_id</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-139" id="__codelineno-29-139" name="__codelineno-29-139"></a><span class="w">    </span><span class="n">chall</span><span class="w"></span>
<a href="#__codelineno-29-140" id="__codelineno-29-140" name="__codelineno-29-140"></a><span class="w">        </span><span class="p">.</span><span class="n">run_ixs_full</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-141" id="__codelineno-29-141" name="__codelineno-29-141"></a><span class="w">            </span><span class="o">&amp;</span><span class="p">[</span><span class="n">bump_budget</span><span class="p">,</span><span class="w"> </span><span class="n">solve_ix</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-29-142" id="__codelineno-29-142" name="__codelineno-29-142"></a><span class="w">            </span><span class="o">&amp;</span><span class="p">[</span><span class="o">&amp;</span><span class="n">user_keypair</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-29-143" id="__codelineno-29-143" name="__codelineno-29-143"></a><span class="w">            </span><span class="o">&amp;</span><span class="n">user_keypair</span><span class="p">.</span><span class="n">pubkey</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-29-144" id="__codelineno-29-144" name="__codelineno-29-144"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a href="#__codelineno-29-145" id="__codelineno-29-145" name="__codelineno-29-145"></a><span class="w">        </span><span class="p">.</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-146" id="__codelineno-29-146" name="__codelineno-29-146"></a>
<a href="#__codelineno-29-147" id="__codelineno-29-147" name="__codelineno-29-147"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user_token_account</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span><span class="p">.</span><span class="n">read_token_account</span><span class="p">(</span><span class="n">user_token_account_pubkey</span><span class="p">).</span><span class="k">await</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-148" id="__codelineno-29-148" name="__codelineno-29-148"></a><span class="w">    </span><span class="fm">writeln!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-149" id="__codelineno-29-149" name="__codelineno-29-149"></a><span class="w">        </span><span class="n">socket</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-150" id="__codelineno-29-150" name="__codelineno-29-150"></a><span class="w">        </span><span class="s">"player_account_amount: {:?}"</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-151" id="__codelineno-29-151" name="__codelineno-29-151"></a><span class="w">        </span><span class="n">user_token_account</span><span class="p">.</span><span class="n">amount</span><span class="w"></span>
<a href="#__codelineno-29-152" id="__codelineno-29-152" name="__codelineno-29-152"></a><span class="w">    </span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-153" id="__codelineno-29-153" name="__codelineno-29-153"></a>
<a href="#__codelineno-29-154" id="__codelineno-29-154" name="__codelineno-29-154"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-29-155" id="__codelineno-29-155" name="__codelineno-29-155"></a><span class="w">        </span><span class="s">"</span><span class="se">\n</span><span class="s">player_account_amount balance = {}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-29-156" id="__codelineno-29-156" name="__codelineno-29-156"></a><span class="w">        </span><span class="n">user_token_account</span><span class="p">.</span><span class="n">amount</span><span class="w"></span>
<a href="#__codelineno-29-157" id="__codelineno-29-157" name="__codelineno-29-157"></a><span class="w">    </span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-29-158" id="__codelineno-29-158" name="__codelineno-29-158"></a>
<a href="#__codelineno-29-159" id="__codelineno-29-159" name="__codelineno-29-159"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">user_token_account</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">init_amount</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-160" id="__codelineno-29-160" name="__codelineno-29-160"></a><span class="w">        </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"congrats!"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-161" id="__codelineno-29-161" name="__codelineno-29-161"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">env</span>::<span class="n">var</span><span class="p">(</span><span class="s">"FLAG"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-162" id="__codelineno-29-162" name="__codelineno-29-162"></a><span class="w">            </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"flag: {:?}"</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-163" id="__codelineno-29-163" name="__codelineno-29-163"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-29-164" id="__codelineno-29-164" name="__codelineno-29-164"></a><span class="w">            </span><span class="fm">writeln!</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="s">"flag not found, please contact admin"</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-29-165" id="__codelineno-29-165" name="__codelineno-29-165"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-29-166" id="__codelineno-29-166" name="__codelineno-29-166"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a href="#__codelineno-29-167" id="__codelineno-29-167" name="__codelineno-29-167"></a>
<a href="#__codelineno-29-168" id="__codelineno-29-168" name="__codelineno-29-168"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-29-169" id="__codelineno-29-169" name="__codelineno-29-169"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<ul>
<li>è¯»å–é¢˜ç›®åˆçº¦å’Œç”¨æˆ·è¾“å…¥åˆçº¦</li>
<li>å¢åŠ <span><span class="heti-spacing"> </span>mint</span>ã€payerã€<span>user<span class="heti-spacing"> </span></span>è´¦æˆ·<ul>
<li>åˆå§‹ç»™<span><span class="heti-spacing"> </span>user 100_000_000_000 lamports</span></li>
</ul>
</li>
<li>è·å–å±äºé¢˜ç›®åˆçº¦çš„<span class="heti-skip"><span class="heti-spacing"> </span>catalog<span class="heti-spacing"> </span></span>å’Œ<span><span class="heti-spacing"> </span>reserve PDA</span></li>
<li>è°ƒç”¨é¢˜ç›®åˆçº¦çš„<span class="heti-skip"><span class="heti-spacing"> </span>Initialize<span class="heti-spacing"> </span></span>æŒ‡ä»¤</li>
<li>è°ƒç”¨<span><span class="heti-spacing"> </span>Register</span>ï¼Œ<span>org_name<span class="heti-spacing"> </span></span>å’Œ<span class="heti-skip"><span class="heti-spacing"> </span>employee_id<span class="heti-spacing"> </span></span>ä¸º<span><span class="heti-spacing"> </span>("product", "employ_A")</span></li>
<li>åˆ›å»º<span><span class="heti-spacing"> </span>payer_token_account</span>ï¼Œåˆå§‹ç»™å…¶<span><span class="heti-spacing"> </span>1000 token</span></li>
<li>è·å–<span class="heti-skip"><span class="heti-spacing"> </span>seed ("product", "employ_A")<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>PDA<span class="heti-spacing"> </span></span>ä½œä¸º<span><span class="heti-spacing"> </span>vault</span>ï¼Œè°ƒç”¨<span><span class="heti-spacing"> </span>Deposit</span>ï¼Œ<span>amount<span class="heti-spacing"> </span></span>ä¸º<span><span class="heti-spacing"> </span>500 token</span></li>
<li>åˆ›å»º<span class="heti-skip"><span class="heti-spacing"> </span>user_record<span class="heti-spacing"> </span></span>å’Œ<span><span class="heti-spacing"> </span>user_token_account</span>ï¼Œå‘å…¶ä¸­åˆå§‹è½¬<span><span class="heti-spacing"> </span>100 token</span></li>
<li>è¾“å‡ºä¸€ç³»åˆ—<span><span class="heti-spacing"> </span>pubkey</span></li>
<li>è¯»å–æŒ‡ä»¤ï¼Œè°ƒç”¨ç”¨æˆ·åˆçº¦</li>
<li>è·å–<span class="heti-skip"><span class="heti-spacing"> </span>user_token_account<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>token<span class="heti-spacing"> </span></span>ä¸ªæ•°ï¼Œå¦‚æœå¤šäº<span class="heti-skip"><span class="heti-spacing"> </span>100<span class="heti-spacing"> </span></span>ä¸ªåˆ™è¾“å‡º<span><span class="heti-spacing"> </span>flag</span></li>
</ul>
<h3 id="_3">åšæ³•<a class="headerlink" href="#_3" title="Permanent link"><span><span class="heti-spacing"> </span>Â¶</span></a></h3>
<p>è¿™é¢˜çš„ç­”é¢˜äº¤äº’ä¹Ÿç»™äº†ï¼Œæ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>rust<span class="heti-spacing"> </span></span>ä»£ç ï¼Œå†™å¥½äº†ç›´æ¥æ”¹ä¸‹<span class="heti-skip"><span class="heti-spacing"> </span>tcp<span class="heti-spacing"> </span></span>åœ°å€ç„¶å<span class="heti-skip"><span class="heti-spacing"> </span>cargo run<span class="heti-spacing"> </span></span>å°±å¯ä»¥æ‰“äº†ã€‚</p>
<p>ä¸»è¦çš„è§£æ³•è¿˜æ˜¯åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>solve/programs/solve/src/lib.rs<span class="heti-spacing"> </span></span>ä¸­ç¼–å†™ã€‚</p>
<p>é¢˜ç»™äº†ä¸€ä¸ªåˆå§‹åŒ–æŒ‡ä»¤å’Œå…¶ç»“æ„ä½“çš„å®šä¹‰ï¼Œåœ¨é‡Œé¢è¡¥å……å°±å¯ä»¥ã€‚åŸæœ‰çš„æ˜¯ä¸€ä¸ªè°ƒç”¨<span class="heti-skip"><span class="heti-spacing"> </span>Register<span class="heti-spacing"> </span></span>çš„ä»£ç ï¼Œ<span>register<span class="heti-spacing"> </span></span>äº†<span class="heti-skip"><span class="heti-spacing"> </span>("product", "employ_B")<span class="heti-spacing"> </span></span>è¿™ä¸ª<span><span class="heti-spacing"> </span>record</span>ã€‚</p>
<p>æ‰¾äº†å¾ˆé•¿æ—¶é—´æ²¡çœ‹å‡ºæ¼æ´åœ¨å“ªã€‚ä½†<span class="heti-skip"><span class="heti-spacing"> </span>solana<span class="heti-spacing"> </span></span>çš„å®˜æ–¹æ–‡æ¡£ä¸­<a href="https://docs.solana.com/developing/programming-model/calling-between-programs#hash-based-generated-program-addresses">å…³äº<span class="heti-skip"><span class="heti-spacing"> </span>PDA seed<span class="heti-spacing"> </span></span>çš„æè¿°</a>é‡Œé¢æœ‰ä¸€ä¸ª<span><span class="heti-spacing"> </span>warning</span>ï¼š</p>
<blockquote>
<p><strong>Warning:</strong> Because of the way the seeds are hashed there is a potential for program address collisions for the same program id. The seeds are hashed sequentially which means that seeds {"abcdef"}, {"abc", "def"}, and {"ab", "cd", "ef"} will all result in the same program address given the same program id. Since the chance of collision is local to a given program id, the developer of that program must take care to choose seeds that do not collide with each other. For seed schemes that are susceptible to this type of hash collision, a common remedy is to insert separators between seeds, e.g. transforming {"abc", "def"} into {"abc", "-", "def"}.</p>
</blockquote>
<p>å¤§ä½“æ„æ€å°±æ˜¯ï¼Œå¦‚æœ<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>æœ‰å¤šä¸ªçš„è¯ï¼Œè®¡ç®—çš„æ—¶å€™æ˜¯ç›´æ¥æ‹¼æ¥èµ·æ¥çš„ï¼Œ<span>["abcdef"]<span class="heti-spacing"> </span></span>å’Œ<span><span class="heti-spacing"> </span>["abc", "def"]</span>ã€<span>["ab", "cdef"]<span class="heti-spacing"> </span></span>ç®—å‡ºæ¥çš„<span class="heti-skip"><span class="heti-spacing"> </span>PDA<span class="heti-spacing"> </span></span>æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>è€Œé¢˜ç›®ä¸­è·å–<span class="heti-skip"><span class="heti-spacing"> </span>vault<span class="heti-spacing"> </span></span>ç”¨çš„<span class="heti-skip"><span class="heti-spacing"> </span>seed<span class="heti-spacing"> </span></span>æ˜¯<span><span class="heti-spacing"> </span>[org_name, employee_id]</span>ï¼Œè¿™é‡Œå°±å­˜åœ¨äº†æ‹¼æ¥ã€‚æ—¢ç„¶æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨åŒæ ·çš„<span class="heti-skip"><span class="heti-spacing"> </span>(org_name, employee_id)<span class="heti-spacing"> </span></span>æ¥æ³¨å†Œã€è·å–åˆ°å…¶è®°å½•æœ‰<span class="heti-skip"><span class="heti-spacing"> </span>500 token<span class="heti-spacing"> </span></span>çš„<span><span class="heti-spacing"> </span>vault</span>ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨å¦ä¸€å¯¹<span class="heti-skip"><span class="heti-spacing"> </span>(org_name, employee_id)<span class="heti-spacing"> </span></span>æ¥å®Œæˆæ³¨å†Œã€å¹¶åœ¨<span class="heti-skip"><span class="heti-spacing"> </span>withdraw<span class="heti-spacing"> </span></span>è·å–<span class="heti-skip"><span class="heti-spacing"> </span>vault<span class="heti-spacing"> </span></span>çš„æ—¶å€™ä½¿å…¶æ‹¼æ¥èµ·æ¥å’Œé¢˜ç›®ä¸­çš„ä¸€æ ·æ¥è·å–åˆ°é‚£ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>500 token<span class="heti-spacing"> </span></span>çš„<span><span class="heti-spacing"> </span>vault</span>ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ³¨å†Œä¸€ä¸ª<span class="heti-skip"><span class="heti-spacing"> </span>("produc", "temploy_A")<span class="heti-spacing"> </span></span>ç„¶åç›´æ¥<span class="heti-skip"><span class="heti-spacing"> </span>withdraw<span class="heti-spacing"> </span></span>å°±å¯ä»¥äº†ï¼š</p>
<details class="success" open="open">
<summary><span>exp<span class="heti-spacing"> </span></span>åˆçº¦<span class="heti-skip"><span class="heti-spacing"> </span>initialize<span class="heti-spacing"> </span></span>æŒ‡ä»¤</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">ctx</span>: <span class="nc">Context</span><span class="o">&lt;</span><span class="n">Initialize</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>
<a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">o1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"produc"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"temploy_A"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a>
<a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cpi_accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">cpi</span>::<span class="n">accounts</span>::<span class="n">Register</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">        </span><span class="n">catalog</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">catalog</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">        </span><span class="n">employee_record</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user_record</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">        </span><span class="n">user</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">        </span><span class="n">system_program</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">system_program</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="w">        </span><span class="n">rent</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">rent</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-12" id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-30-13" id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cpi_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CpiContext</span>::<span class="n">new</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">chall</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"> </span><span class="n">cpi_accounts</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-30-14" id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">    </span><span class="n">chall</span>::<span class="n">cpi</span>::<span class="n">register</span><span class="p">(</span><span class="n">cpi_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">o1</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-30-15" id="__codelineno-30-15" name="__codelineno-30-15"></a>
<a href="#__codelineno-30-16" id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">o1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"produc"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-30-17" id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">"temploy_A"</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-30-18" id="__codelineno-30-18" name="__codelineno-30-18"></a>
<a href="#__codelineno-30-19" id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cpi_accounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chall</span>::<span class="n">cpi</span>::<span class="n">accounts</span>::<span class="n">Withdraw</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a href="#__codelineno-30-20" id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">        </span><span class="n">vault</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">vault</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-21" id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">        </span><span class="n">employee_record</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user_record</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-22" id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="w">        </span><span class="n">reserve</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">reserve</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-23" id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="w">        </span><span class="n">user_account</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user_token_account</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-24" id="__codelineno-30-24" name="__codelineno-30-24"></a><span class="w">        </span><span class="n">mint</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">mint</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-25" id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="w">        </span><span class="n">payer</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-26" id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="w">        </span><span class="n">token_program</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">token_program</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-27" id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="w">        </span><span class="n">system_program</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">system_program</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-28" id="__codelineno-30-28" name="__codelineno-30-28"></a><span class="w">        </span><span class="n">rent</span>: <span class="nc">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">rent</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"></span>
<a href="#__codelineno-30-29" id="__codelineno-30-29" name="__codelineno-30-29"></a><span class="w">    </span><span class="p">};</span><span class="w"></span>
<a href="#__codelineno-30-30" id="__codelineno-30-30" name="__codelineno-30-30"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cpi_ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CpiContext</span>::<span class="n">new</span><span class="p">(</span><span class="n">ctx</span><span class="p">.</span><span class="n">accounts</span><span class="p">.</span><span class="n">chall</span><span class="p">.</span><span class="n">to_account_info</span><span class="p">(),</span><span class="w"> </span><span class="n">cpi_accounts</span><span class="p">);</span><span class="w"></span>
<a href="#__codelineno-30-31" id="__codelineno-30-31" name="__codelineno-30-31"></a><span class="w">    </span><span class="n">chall</span>::<span class="n">cpi</span>::<span class="n">withdraw</span><span class="p">(</span><span class="n">cpi_ctx</span><span class="p">,</span><span class="w"> </span><span class="n">o1</span><span class="p">,</span><span class="w"> </span><span class="n">e1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
<a href="#__codelineno-30-32" id="__codelineno-30-32" name="__codelineno-30-32"></a>
<a href="#__codelineno-30-33" id="__codelineno-30-33" name="__codelineno-30-33"></a><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<a href="#__codelineno-30-34" id="__codelineno-30-34" name="__codelineno-30-34"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
</details>
<p>ç„¶åäº¤äº’çš„<span class="heti-skip"><span class="heti-spacing"> </span>main.rs<span class="heti-spacing"> </span></span>ä¸­è¿˜æœ‰ä¸€å¤„è·å–å‚æ•°<span class="heti-skip"><span class="heti-spacing"> </span>vault<span class="heti-spacing"> </span></span>çš„åœ°æ–¹ä¹Ÿéœ€è¦æ”¹ä¸€ä¸‹ï¼š
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">vault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pubkey</span>::<span class="n">find_program_address</span><span class="p">(</span><span class="w"></span>
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">        </span><span class="o">&amp;</span><span class="p">[</span><span class="s">b"produc"</span><span class="p">,</span><span class="w"> </span><span class="s">b"temploy_A"</span><span class="p">],</span><span class="w"></span>
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">chall_id</span><span class="p">,</span><span class="w"></span>
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="p">).</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>å…¶å®ƒæ²¿ç”¨ç»™çš„äº¤äº’å°±å¯ä»¥äº†ã€‚è¿™æ ·<span class="heti-skip"><span class="heti-spacing"> </span>main.rs<span class="heti-spacing"> </span></span>ä¸­è¾“å…¥æŒ‡ä»¤ï¼Œè°ƒç”¨<span class="heti-skip"><span class="heti-spacing"> </span>exp<span class="heti-spacing"> </span></span>åˆçº¦çš„<span class="heti-skip"><span class="heti-spacing"> </span>Initialize<span class="heti-spacing"> </span></span>æŒ‡ä»¤ï¼Œå…¶ä¸­<span class="heti-skip"><span class="heti-spacing"> </span>withdraw<span class="heti-spacing"> </span></span>äº†ï¼Œç»“æŸåæ£€æŸ¥<span class="heti-skip"><span class="heti-spacing"> </span>token amount<span class="heti-spacing"> </span></span>å°±ä¼šæ¯”åŸå…ˆæ›´å¤šäº†ã€‚</p>
<p>flag: <strong>n1ctf{I_sh0uld_h4ve_ch0s3n_4_b3tt3r_se3d_de5ign}</strong></p>
<hr/>
<h2 id="just-find-flag">just find flag<a class="headerlink" href="#just-find-flag" title="Permanent link">Â¶</a></h2>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://img.shields.io/badge/-MISC-informational?style=flat-square"><img alt="" src="https://img.shields.io/badge/-MISC-informational?style=flat-square"/></a></p>
<p>ä¸€é“<span class="heti-skip"><span class="heti-spacing"> </span>Windows<span class="heti-spacing"> </span></span>å†…å­˜å–è¯é¢˜ï¼Œå·®äº†ä¸€æ­¥æ²¡åšå‡ºæ¥ã€‚ç»“æŸåè¡¥å®Œäº†ã€‚</p>
<p>å†…å­˜å–è¯ç›´æ¥ä¸Šæ‰‹å…ˆ<span class="heti-skip"><span class="heti-spacing"> </span>strings<span class="heti-spacing"> </span></span>ä¸€æŠŠæ¢­ï¼Œå‘ç°äº†<span><span class="heti-spacing"> </span>flag.zip</span>ã€flag.txtã€‚æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œç›´æ¥ä»åå…­è¿›åˆ¶é‡ŒæŠŠå®ƒå®Œæ•´å†…å®¹æ‰’å‡ºæ¥ï¼Œå‘ç°æœ‰å¯†ç ï¼Œè€Œä¸”æ˜¯çœŸå¯†ç ï¼Œå…­ä½æ•°å¯†ç çˆ†ä¸å‡ºæ¥ã€‚</p>
<p>ç»§ç»­<span class="heti-skip"><span class="heti-spacing"> </span>volatility<span class="heti-spacing"> </span></span>ä¸€æŠŠæ¢­ï¼Œ<span>imageinfo<span class="heti-spacing"> </span></span>å‡ºæ¥æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>Win7<span class="heti-spacing"> </span></span>ç³»ç»Ÿï¼Œä¸€äº›æ²¡ç”¨çš„æŒ‡ä»¤è¾“å‡ºå°±ä¸åœ¨è¿™é‡Œå†™äº†</p>
<p>åœ¨æ‰§è¡Œ<span class="heti-skip"><span class="heti-spacing"> </span>consoles<span class="heti-spacing"> </span></span>æŒ‡ä»¤çš„æ—¶å€™å‘ç°äº†ï¼š
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a>**************************************************
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a>ConsoleProcess: conhost.exe Pid: 2480
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>Console: 0xff656200 CommandHistorySize: 50
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a>HistoryBufferCount: 2 HistoryBufferMax: 4
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a>OriginalTitle: %SystemRoot%\system32\cmd.exe
<a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>Title: C:\Windows\system32\cmd.exe - C:\Python27\python.exe  -m SimpleHTTPServer
<a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a>AttachedProcess: python.exe Pid: 2052 Handle: 0x8c
<a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a>AttachedProcess: cmd.exe Pid: 2336 Handle: 0x60
<a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a>----
<a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a>CommandHistory: 0x37ed10 Application: python.exe Flags: Allocated
<a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a>CommandCount: 0 LastAdded: -1 LastDisplayed: -1
<a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a>FirstCommand: 0 CommandCountMax: 50
<a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a>ProcessHandle: 0x8c
<a href="#__codelineno-32-14" id="__codelineno-32-14" name="__codelineno-32-14"></a>----
<a href="#__codelineno-32-15" id="__codelineno-32-15" name="__codelineno-32-15"></a>CommandHistory: 0x37e9c0 Application: cmd.exe Flags: Allocated, Reset
<a href="#__codelineno-32-16" id="__codelineno-32-16" name="__codelineno-32-16"></a>CommandCount: 3 LastAdded: 2 LastDisplayed: 2
<a href="#__codelineno-32-17" id="__codelineno-32-17" name="__codelineno-32-17"></a>FirstCommand: 0 CommandCountMax: 50
<a href="#__codelineno-32-18" id="__codelineno-32-18" name="__codelineno-32-18"></a>ProcessHandle: 0x60
<a href="#__codelineno-32-19" id="__codelineno-32-19" name="__codelineno-32-19"></a>Cmd #0 at 0x382d60: echo "Stucked? You can ask WallPaper god for help."
<a href="#__codelineno-32-20" id="__codelineno-32-20" name="__codelineno-32-20"></a>Cmd #1 at 0x35e3a0: cd Desktop
<a href="#__codelineno-32-21" id="__codelineno-32-21" name="__codelineno-32-21"></a>Cmd #2 at 0x382dd0: C:\Python27\python.exe -m SimpleHTTPServer
<a href="#__codelineno-32-22" id="__codelineno-32-22" name="__codelineno-32-22"></a>----
<a href="#__codelineno-32-23" id="__codelineno-32-23" name="__codelineno-32-23"></a>Screen 0x360f70 X:80 Y:300
<a href="#__codelineno-32-24" id="__codelineno-32-24" name="__codelineno-32-24"></a>Dump:
<a href="#__codelineno-32-25" id="__codelineno-32-25" name="__codelineno-32-25"></a>Microsoft Windows [Version 6.1.7601]
<a href="#__codelineno-32-26" id="__codelineno-32-26" name="__codelineno-32-26"></a>Copyright (c) 2009 Microsoft Corporation.  All rights reserved.
<a href="#__codelineno-32-27" id="__codelineno-32-27" name="__codelineno-32-27"></a>
<a href="#__codelineno-32-28" id="__codelineno-32-28" name="__codelineno-32-28"></a>C:\Users\dora&gt;echo "Stucked? You can ask WallPaper god for help."
<a href="#__codelineno-32-29" id="__codelineno-32-29" name="__codelineno-32-29"></a>"Stucked? You can ask WallPaper god for help."
<a href="#__codelineno-32-30" id="__codelineno-32-30" name="__codelineno-32-30"></a>
<a href="#__codelineno-32-31" id="__codelineno-32-31" name="__codelineno-32-31"></a>C:\Users\dora&gt;cd Desktop
<a href="#__codelineno-32-32" id="__codelineno-32-32" name="__codelineno-32-32"></a>
<a href="#__codelineno-32-33" id="__codelineno-32-33" name="__codelineno-32-33"></a>C:\Users\dora\Desktop&gt;C:\Python27\python.exe -m SimpleHTTPServer
<a href="#__codelineno-32-34" id="__codelineno-32-34" name="__codelineno-32-34"></a>Serving HTTP on 0.0.0.0 port 8000 ...
<a href="#__codelineno-32-35" id="__codelineno-32-35" name="__codelineno-32-35"></a>192.168.17.129 - - [05/Nov/2022 03:08:43] "GET /mem.zip HTTP/1.1" 200 -
</code></pre></div>
æœ‰ä¸€å¥ "Stucked? You can ask WallPaper god for help."ã€‚æ‰€ä»¥åœ¨ strings é‡Œé¢å†æœ Wallpaperï¼Œå‘ç°æœ‰ç›¸å…³æ–‡ä»¶ï¼Œç»§ç»­ volatility æ¢­ï¼š
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a>volatility -f mem.raw --profile<span class="o">=</span>Win7SP1x64 filescan &gt; files.txt
</code></pre></div>
æœ‰å¾ˆå¤šå¾ˆå¤šæ–‡ä»¶ï¼Œåœ¨é‡Œé¢æœä¸€ä¸‹å‘ç°äº†ä¸¤ä¸ª Wallpaper è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼š
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a>Offset(P)            #Ptr   #Hnd Access Name
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>------------------ ------ ------ ------ ----
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a>...
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a>0x000000007eee11c0     10      0 R--r-- \Device\HarddiskVolume1\Windows\Web\Wallpaper\Windows\img0.jpg
<a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a>...
<a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a>0x000000007fc48f20     16      0 R--r-d \Device\HarddiskVolume1\Windows\Web\Wallpaper\Windows\img0.jpeg
<a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a>...
</code></pre></div>
ç„¶ååˆ†åˆ«ç”¨ <code>volatility -f mem.raw --profile=Win7SP1x64 dumpfiles -Q &lt;Offset&gt; --dump-dir=./</code> æå–ï¼Œå‘ç°ä¸Šé¢ä¸€å¼ æ˜¯ Win7 ç»å…¸å£çº¸ï¼Œä¸‹é¢ä¸€å¼ æ˜¯ï¼š
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="/assets/images/writeups/n1ctf2022/img1.jpeg"><img alt="" src="/assets/images/writeups/n1ctf2022/img1.jpeg"/></a>
<p>ç„¶åè¿™é‡Œå¡ä½äº†ï¼Œæ‰¾äº†å¾ˆé•¿æ—¶é—´ä¹Ÿæ‰¾ä¸å‡ºä»–è¯´çš„æ²¡æœ‰<span class="heti-skip"><span class="heti-spacing"> </span>Desktop<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>full path<span class="heti-spacing"> </span></span>æ˜¯ä»€ä¹ˆã€‚</p>
<p>èµ›åå¬è¯´æ˜¯è¦ç”¨<span class="heti-skip"><span class="heti-spacing"> </span>volatility<span class="heti-spacing"> </span></span>çš„<span class="heti-skip"><span class="heti-spacing"> </span>mtfparser<span class="heti-spacing"> </span></span>æŒ‡ä»¤ï¼Œè¯•äº†ä¸€ä¸‹ï¼Œç¡®å®æ˜¯æœ‰çš„ï¼š
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a>volatility -f mem.raw --profile<span class="o">=</span>Win7SP1x64 mftparser &gt; mftparser.txt
</code></pre></div>
<a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="/assets/images/writeups/n1ctf2022/img2.png"><img alt="" src="/assets/images/writeups/n1ctf2022/img2.png"/></a>
æœ‰ä¸ªè·¯å¾„ <code>PROGRA~2\WINDOW~2\ACCESS~1\flag.zip</code>ï¼Œå¯ä»¥æ¨æµ‹å‡ºè¿™ä¸ªç¼©å†™å®é™…ä¸Šæ˜¯ <code>C:\Program Files (x86)\Windows NT\Accessories\flag.zip</code>ã€‚æ‰€ä»¥å‹ç¼©åŒ…çš„å¯†ç å°±æ˜¯ï¼ˆ<code>\f</code> å°±æ˜¯è¦è¿™æ ·æ”¾ç€ä¸ç®¡ï¼Œé¢˜ç›®ç»™äº† note äº†ï¼‰ï¼š
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s2">"C:\Program Files (x86)\Windows NT\Accessories</span><span class="se">\f</span><span class="s2">lag.zip"</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="c1"># 0d3ba7db468bdbd4f93a88c97ba7bef1</span>
</code></pre></div>
è§£å‹å‡ºæ¥å°±æ˜¯ flag äº†ã€‚
<p>åæ­£è¿˜æ˜¯<span class="heti-skip"><span class="heti-spacing"> </span>volatility<span class="heti-spacing"> </span></span>ä¸ç†Ÿç»ƒï¼Œè®°ä¸‹äº†ã€‚<span>Windows<span class="heti-spacing"> </span></span>ä¸‹ä¸€äº›åˆ æ‰äº†çš„æ–‡ä»¶å¯ä»¥å°è¯•ç”¨<span class="heti-skip"><span class="heti-spacing"> </span>mtfparser<span class="heti-spacing"> </span></span>æ¥æœä¸€ä¸‹ã€‚</p>
<hr/>
<div class="md-source-file">
<small>
    
      æœ€åæ›´æ–°:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2022å¹´11æœˆ7æ—¥ 19:06:21</span>
<br/>
        åˆ›å»ºæ—¥æœŸ:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2022å¹´11æœˆ7æ—¥ 19:06:21</span>
</small>
</div>
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDOGnfbUc4CPrf4" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="TonyCrane/note" data-repo-id="R_kgDOGnfbUQ" data-theme="light" src="https://giscus.app/client.js">
</script>
<script>
                      if (document.querySelector("body").getAttribute("data-md-color-scheme") === "slate") {
                        var giscus = document.querySelector("script[src*=giscus]")
                        giscus.setAttribute("data-theme", "https://gcore.jsdelivr.net/gh/TonyCrane/note/docs/css/giscus.css") 
                      }
                    </script>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
              å›åˆ°é¡µé¢é¡¶éƒ¨
            </a>
</main>
<footer class="md-footer">
<nav aria-label="é¡µè„š" class="md-footer__inner md-grid">
<a aria-label="ä¸Šä¸€é¡µ: USTC Hackergame 2022" class="md-footer__link md-footer__link--prev" href="../hackergame2022/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                ä¸Šä¸€é¡µ
              </span>
              USTC Hackergame 2022
            </div>
</div>
</a>
<a aria-label="ä¸‹ä¸€é¡µ: SECCON 2022 Quals" class="md-footer__link md-footer__link--next" href="../seccon2022/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                ä¸‹ä¸€é¡µ
              </span>
              SECCON 2022 Quals
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright Â© 2022-2023 <a href="https://github.com/TonyCrane" rel="noopener" target="_blank">TonyCrane</a>
</div>
  
  
    Powered by
    <a href="https://www.mkdocs.org/" rel="noopener" target="_blank">
      MkDocs
    </a>
    with theme
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material
    </a>
    modified by
    <a href="https://github.com/TonyCrane" rel="noopener" target="_blank">
      TonyCrane
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/TonyCrane/" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://blog.tonycrane.cc/" rel="noopener" target="_blank" title="blog.tonycrane.cc">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg>
</a>
<a class="md-social__link" href="https://tonycrane.cc/" rel="noopener" target="_blank" title="tonycrane.cc">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26 96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47 488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.361d90f1.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
<script src="https://cdn.tonycrane.cc/utils/katex.min.js"></script>
<script src="../../js/katex.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>
