
  <!doctype html>
  <html lang="zh" class="no-js">
    <head>
      
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        
          <meta name="description" content="鹤翔万里（TonyCrane）的笔记本">
        
        
        
          <link rel="canonical" href="https://note.tonycrane.cc/writeups/sadservers/">
        
        <link rel="icon" href="../../assets/images/favicon.png">
        <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.1.4">
      
      
        
          <title>SadServers - 鹤翔万里的笔记本</title>
        
      
      
        <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
        
          
          <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
          
        
      
      
      
        
          
          <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
          <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=JetBrains+Mono:300,400,400i,700%7CJetBrains+Mono&display=fallback">
          <style>:root{--md-text-font:"JetBrains Mono";--md-code-font:"JetBrains Mono"}</style>
        
      
      
        <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">
      
        <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css">
      
        <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
      
        <link rel="stylesheet" href="../../css/tasklist.css">
      
        <link rel="stylesheet" href="../../css/custom.css">
      
        <link rel="stylesheet" href="../../css/card.css">
      
      
        <link rel="stylesheet" href="/css/counter.css">
      
      <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
      
        
  


  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c273de7f67d992cb6aef08c3ddf09bb2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-DYETCPM289"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-DYETCPM289",{page_path:e.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DYETCPM289"></script>


      
      
    </head>
    
    
      
      
        
      
      
      
      
      <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
    
      <script src="../../js/scheme.js" type="text/javascript"></script>
      
      
        <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
      
      <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
      <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
      <label class="md-overlay" for="__drawer"></label>
      <div data-md-component="skip">
        
          
          <a href="#sadservers-writeup" class="md-skip">
            跳转至
          </a>
        
      </div>
      <div data-md-component="announce">
        
      </div>
      
      
        

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="鹤翔万里的笔记本" class="md-header__button md-logo" aria-label="鹤翔万里的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            鹤翔万里的笔记本
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SadServers
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon">
          <a
            href="javascript:toggleScheme();"
            title="Light mode"
            class="light-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
          </a>
          <a
            href="javascript:toggleScheme();"
            title="Dark mode"
            class="dark-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
          </a>
          <a
            href="javascript:toggleScheme();"
            title="System preference"
            class="system-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34z"/></svg>
          </a>
           <a
            href="javascript:toggleScheme();"
            title="Unknown scheme"
            class="unknown-mode"
          >
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10z"/></svg>
          </a>
      </div>
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="清空当前内容" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TonyCrane/note/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    TonyCrane/note
  </div>
</a>
      </div>
    
  </nav>
  
</header>
      
      <div class="md-container" data-md-component="container">
        
        
          
            
              
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../cs/" class="md-tabs__link">
        Computer Science
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../ctf/" class="md-tabs__link">
        CTF
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Writeups
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../others/" class="md-tabs__link">
        Others
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
            
          
        
        <main class="md-main" data-md-component="main">
          <div class="md-main__inner md-grid">
            
              
                <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                  <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                      
                        

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="鹤翔万里的笔记本" class="md-nav__button md-logo" aria-label="鹤翔万里的笔记本" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2z"/></svg>

    </a>
    鹤翔万里的笔记本
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TonyCrane/note/" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    TonyCrane/note
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../..">Home</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/">Computer Science</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Computer Science" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Computer Science
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/pl/">编程语言</a>
          
            <label for="__nav_2_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="编程语言" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_2" type="checkbox" id="__nav_2_2_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/pl/python/">Python</a>
          
            <label for="__nav_2_2_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Python" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/python/basic/" class="md-nav__link">
        Python 基础语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/python/numpy/" class="md-nav__link">
        NumPy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/python/pil/" class="md-nav__link">
        PIL
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_3" type="checkbox" id="__nav_2_2_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/pl/rust/">Rust</a>
          
            <label for="__nav_2_2_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Rust" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_2_3">
          <span class="md-nav__icon md-icon"></span>
          Rust
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/rust/basic/" class="md-nav__link">
        Rust 基础语法
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/rust/misc/" class="md-nav__link">
        Rust 杂项随记
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/c_cpp/" class="md-nav__link">
        C/C++
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/haskell/" class="md-nav__link">
        Haskell
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/asm/" class="md-nav__link">
        x86 汇编语言
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/pl/riscv/" class="md-nav__link">
        RISC-V ISA
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/system/">计算机系统</a>
          
            <label for="__nav_2_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="计算机系统" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          计算机系统
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2" type="checkbox" id="__nav_2_3_2" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/system/cs1/">计算机系统 I</a>
          
            <label for="__nav_2_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="计算机系统 I" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_3_2">
          <span class="md-nav__icon md-icon"></span>
          计算机系统 I
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs1/topic1/" class="md-nav__link">
        数据的表示
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs1/topic2/" class="md-nav__link">
        数字逻辑电路基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs1/topic3/" class="md-nav__link">
        组合逻辑电路设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs1/topic4/" class="md-nav__link">
        时序逻辑电路设计
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs1/topic5/" class="md-nav__link">
        指令集体系结构
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs1/topic6/" class="md-nav__link">
        处理器
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_3" type="checkbox" id="__nav_2_3_3" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/system/cs2/">计算机系统 II</a>
          
            <label for="__nav_2_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="计算机系统 II" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_3_3">
          <span class="md-nav__icon md-icon"></span>
          计算机系统 II
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/system/cs2/topic1/" class="md-nav__link">
        流水线 CPU
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/web/">网络相关</a>
          
            <label for="__nav_2_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="网络相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          网络相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_2" type="checkbox" id="__nav_2_4_2" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/web/protocol/">网络协议</a>
          
            <label for="__nav_2_4_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="网络协议" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_4_2">
          <span class="md-nav__icon md-icon"></span>
          网络协议
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/web/protocol/vmess/" class="md-nav__link">
        VMess
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/web/svg/" class="md-nav__link">
        SVG
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/web/log4j_vuln/" class="md-nav__link">
        log4j 漏洞复现
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_5">
          算法相关
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="算法相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          算法相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_1" type="checkbox" id="__nav_2_5_1" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/algorithm/ds/">数据结构基础</a>
          
            <label for="__nav_2_5_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="数据结构基础" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_5_1">
          <span class="md-nav__icon md-icon"></span>
          数据结构基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/algorithm/ds/topic1/" class="md-nav__link">
        算法分析基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/algorithm/ds/topic2/" class="md-nav__link">
        列表、栈、队列
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_6">
          人工智能相关
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="人工智能相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          人工智能相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6_1" type="checkbox" id="__nav_2_6_1" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/ai/basic/">人工智能基础</a>
          
            <label for="__nav_2_6_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="人工智能基础" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_6_1">
          <span class="md-nav__icon md-icon"></span>
          人工智能基础
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/ai/basic/topic1/" class="md-nav__link">
        逻辑与推理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/ai/basic/topic2/" class="md-nav__link">
        搜索求解
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" type="checkbox" id="__nav_2_7" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../hpc/">高性能计算</a>
          
            <label for="__nav_2_7">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="高性能计算" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          高性能计算
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_2" type="checkbox" id="__nav_2_7_2" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_7_2">
          HPC 101 超算小学期
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="HPC 101 超算小学期" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_7_2">
          <span class="md-nav__icon md-icon"></span>
          HPC 101 超算小学期
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hpc/hpc101/vectorized/" class="md-nav__link">
        向量化计算
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hpc/hpc101/gpu/" class="md-nav__link">
        GPU 编程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hpc/hpc101/openmp/" class="md-nav__link">
        OpenMP 基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hpc/hpc101/mpi/" class="md-nav__link">
        MPI 基础
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hpc/hpc101/ml/" class="md-nav__link">
        机器学习基础
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" type="checkbox" id="__nav_2_8" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_8">
          零散知识点
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="零散知识点" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_8">
          <span class="md-nav__icon md-icon"></span>
          零散知识点
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/regex/" class="md-nav__link">
        正则表达式
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/unicode/" class="md-nav__link">
        Unicode
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" type="checkbox" id="__nav_2_9" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/analysis/">源码剖析</a>
          
            <label for="__nav_2_9">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="源码剖析" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          源码剖析
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/analysis/mkdocs/" class="md-nav__link">
        mkdocs 源码剖析
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10" type="checkbox" id="__nav_2_10" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../cs/tools/">工具相关</a>
          
            <label for="__nav_2_10">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="工具相关" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          工具相关
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/toolbox/" class="md-nav__link">
        工具收集
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10_3" type="checkbox" id="__nav_2_10_3" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_10_3">
          命令行工具
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="命令行工具" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_10_3">
          <span class="md-nav__icon md-icon"></span>
          命令行工具
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/git/" class="md-nav__link">
        Git 命令备忘
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/shell/" class="md-nav__link">
        Shell 命令备忘
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/docker/" class="md-nav__link">
        Docker 相关备忘
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/gdb/" class="md-nav__link">
        gdb 相关备忘
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10_4" type="checkbox" id="__nav_2_10_4" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_10_4">
          CI 工具
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CI 工具" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_10_4">
          <span class="md-nav__icon md-icon"></span>
          CI 工具
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/action/" class="md-nav__link">
        GitHub Action
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10_5" type="checkbox" id="__nav_2_10_5" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_10_5">
          站点生成工具
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="站点生成工具" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_10_5">
          <span class="md-nav__icon md-icon"></span>
          站点生成工具
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/mkdocs/" class="md-nav__link">
        mkdocs 使用记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/hexo/" class="md-nav__link">
        hexo 使用记录
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cs/tools/sphinx/" class="md-nav__link">
        sphinx 使用记录
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ctf/">CTF</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="CTF" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          CTF
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ctf/steg/">隐写术</a>
          
            <label for="__nav_3_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="隐写术" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          隐写术
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/steg/image/" class="md-nav__link">
        图片隐写
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/steg/audio/" class="md-nav__link">
        音频隐写
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ctf/escapes/">沙箱逃逸</a>
          
            <label for="__nav_3_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="沙箱逃逸" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          沙箱逃逸
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/escapes/pysandbox/" class="md-nav__link">
        Python 沙箱逃逸
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ctf/forensics/">取证</a>
          
            <label for="__nav_3_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="取证" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          取证
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/forensics/mem/" class="md-nav__link">
        内存取证
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/coding/" class="md-nav__link">
        编码与密码
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/qrcode/" class="md-nav__link">
        QRCode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ctf/esolang/" class="md-nav__link">
        Esolang
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      
      
        
          
            
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../ctf/eth/">Ethereum</a>
          
        </div>
      
      <nav class="md-nav" aria-label="Ethereum" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Ethereum
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Writeups</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Writeups" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Writeups
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Training
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Training" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Training
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ethernaut/" class="md-nav__link">
        Ethernaut
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SecurityInnovation/" class="md-nav__link">
        Security Innovation
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SadServers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SadServers
      </a>
      
        
  
  <nav class="md-nav md-nav--secondary " aria-label="目录">
    
    
    
      
    
    
      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        目录
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#saint-john" class="md-nav__link">
    "Saint John"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saskatoon" class="md-nav__link">
    "Saskatoon"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokyo" class="md-nav__link">
    "Tokyo"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manhattan" class="md-nav__link">
    "Manhattan"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cape-town" class="md-nav__link">
    "Cape Town"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salta" class="md-nav__link">
    "Salta"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jakarta" class="md-nav__link">
    "Jakarta"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bern" class="md-nav__link">
    "Bern"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#singara" class="md-nav__link">
    "Singara"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#karakorum" class="md-nav__link">
    "Karakorum"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hong-kong" class="md-nav__link">
    "Hong-Kong"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#venice" class="md-nav__link">
    "Venice"
  </a>
  
</li>
        
      </ul>
    
  </nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AAA/" class="md-nav__link">
        🔒 AAA School Bus
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_3">
          2021
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2021" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          2021
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sysu_msc_puzzle/" class="md-nav__link">
        SYSU MSC Puzzle 2021
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hackergame2021/" class="md-nav__link">
        USTC Hackergame 2021
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../d0g3/" class="md-nav__link">
        第四届“安洵杯”
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bytectf2021_final/" class="md-nav__link">
        ByteCTF 2021 Final
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sctf2021/" class="md-nav__link">
        SCTF 2021
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4_4">
          2022
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2022" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          2022
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../vnctf2022/" class="md-nav__link">
        VNCTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tqlctf2022/" class="md-nav__link">
        TQLCTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../susctf2022/" class="md-nav__link">
        SUSCTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../d3ctf2022/" class="md-nav__link">
        D3CTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../%2Actf2022/" class="md-nav__link">
        *CTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mrctf2022/" class="md-nav__link">
        MRCTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../qwb2022/" class="md-nav__link">
        强网杯 2022 Quals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tctf2022/" class="md-nav__link">
        TCTF/0CTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hackergame2022/" class="md-nav__link">
        USTC Hackergame 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../n1ctf2022/" class="md-nav__link">
        N1CTF 2022
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../seccon2022/" class="md-nav__link">
        SECCON 2022 Quals
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
            
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../others/">Others</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Others" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Others
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/notes/" class="md-nav__link">
        课程笔记
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" >
      
      
      
        
          
            
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../others/troubleshooting/">TroubleShooting</a>
          
            <label for="__nav_5_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="TroubleShooting" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          TroubleShooting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/troubleshooting/mac/" class="md-nav__link">
        macOS TroubleShooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                      
                    </div>
                  </div>
                </div>
              
              
                <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                  <div class="md-sidebar__scrollwrap">
                    <div class="md-sidebar__inner">
                      
                        
  
  <nav class="md-nav md-nav--secondary " aria-label="目录">
    
    
    
      
    
    
      <label class="md-nav__title" for="__toc">
        <span class="md-nav__icon md-icon"></span>
        目录
      </label>
      <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
        
          <li class="md-nav__item">
  <a href="#saint-john" class="md-nav__link">
    "Saint John"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saskatoon" class="md-nav__link">
    "Saskatoon"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tokyo" class="md-nav__link">
    "Tokyo"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manhattan" class="md-nav__link">
    "Manhattan"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cape-town" class="md-nav__link">
    "Cape Town"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#salta" class="md-nav__link">
    "Salta"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jakarta" class="md-nav__link">
    "Jakarta"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bern" class="md-nav__link">
    "Bern"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#singara" class="md-nav__link">
    "Singara"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#karakorum" class="md-nav__link">
    "Karakorum"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hong-kong" class="md-nav__link">
    "Hong-Kong"
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#venice" class="md-nav__link">
    "Venice"
  </a>
  
</li>
        
      </ul>
    
  </nav>
                      
                    </div>
                  </div>
                </div>
                <script src="/js/toc.js" defer></script>
                <link rel="stylesheet" href="/css/fold_toc.css">
              
            
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
<a href="https://github.com/TonyCrane/note/tree/master/docs/writeups/sadservers.md" title="编辑此页" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="sadservers-writeup">SadServers Writeup<a class="headerlink" href="#sadservers-writeup" title="Permanent link">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>水 tg 发现的，挺好玩的，就做一做，学到很多，就写一写。</p>
<p>平台地址在 <a href="https://sadservers.com/">https://sadservers.com/</a> 。大概类似运维？反正大概就是修复一些 Linux 服务器出现的问题。</p>
<p>不算 CTF，不知道咋分类，就扔这里吧</p>
<p>看起来题目不多，据说是 "new challenges weekly"，出的话或许可以随时更新？（咕咕咕</p>
</div>
<hr />
<h2 id="saint-john">"Saint John"<a class="headerlink" href="#saint-john" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Saint John": what is writing to this log file?</p>
<p><strong>Level:</strong> Easy</p>
<p><strong>Description:</strong> A developer created a testing program that is continuously writing to a log file /var/log/bad.log and filling up disk. You can check for example with <code>tail -f /var/log/bad.log</code>.
This program is no longer needed. Find it and terminate it.</p>
<p><strong>OS:</strong> Ubuntu 22.04 LTS</p>
</blockquote>
<p>可以 tail -f /var/log/bad.log 看一眼确实在一直填东西。然后当然是先查一下后台进程 ps -aux，可以发现有一条很可疑：
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>...
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>ubuntu       610  0.0  1.7  17672  8212 ?        S    07:57   0:00 /usr/bin/python3 /home/ubuntu/badlog.py
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>...
</code></pre></div>
可以 cat 看一下 badlog.py:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="ch">#! /usr/bin/python3</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="c1"># test python writing to a file</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/var/log/bad.log&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>  <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">2147483647</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>  <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; token: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>  <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>
确实是在每一秒写一行。所以直接 kill -9 610 强制杀死这个进程就好了。</p>
<p>题目的本意大概是用 lsof 来查看使用某一文件的进程：
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ubuntu@ip-172-31-32-108:/$ lsof /var/log/bad.log 
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF  NODE NAME
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>badlog.py 610 ubuntu    3w   REG  259,1    31275 67701 /var/log/bad.log
</code></pre></div></p>
<p>然后同样是强杀。</p>
<hr />
<h2 id="saskatoon">"Saskatoon"<a class="headerlink" href="#saskatoon" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Saskatoon": counting IPs.</p>
<p><strong>Level:</strong> Easy</p>
<p><strong>Description:</strong> There's a web server access log file at /home/admin/access.log. The file consists of one line per HTTP request, with the requester's IP address at the beginning of each line.</p>
<p>Find what's the IP address that has the most requests in this file (there's no tie; the IP is unique). Write the solution into a file /home/admin/highestip.txt. For example, if your solution is "1.2.3.4", you can do echo "1.2.3.4" &gt; /home/admin/highestip.txt</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>所有需要的东西都在 access.log 里面，所以写一个 python 脚本读取、统计、排序、输出就好了：
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/home/admin/access.log&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">ips</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">contents</span><span class="p">]</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="n">cnt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([(</span><span class="n">ips</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="n">ip</span><span class="p">)</span> <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="n">ips</span><span class="p">]))</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">cnt</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="c1"># (482, &#39;66.249.73.135&#39;)</span>
</code></pre></div>
所以请求最多的 ip 就是 66.249.73.135。</p>
<p>当然题目的意思是通过 shell 命令直接来做。可以 cat 然后 cut 来取出 ip，然后 sort | uniq -c 来统计次数（要先 sort，uniq 只会统计相邻的重复行），之后在 sort 一下，最后一行就是要的了：
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$ cat /home/admin/access.log | cut -d &#39; &#39; -f 1 | sort | uniq -c | sort | tail -n 1
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    482 66.249.73.135
</code></pre></div>
用 awk 来处理也很方便，直接一行解决：
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$ awk <span class="s1">&#39;{print $1}&#39;</span> /home/admin/access.log <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort <span class="p">|</span> tail -n <span class="m">1</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span> &gt; /home/admin/highestip.txt
</code></pre></div></p>
<hr />
<h2 id="tokyo">"Tokyo"<a class="headerlink" href="#tokyo" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Tokyo": can't serve web file</p>
<p><strong>Level:</strong> Medium</p>
<p><strong>Description:</strong> There's a web server serving a file /var/www/html/index.html with content "hello sadserver" but when we try to check it locally with an HTTP client like curl 127.0.0.1:80, nothing is returned. This scenario is not about the particular web server configuration and you only need to have general knowledge about how web servers work.</p>
<p><strong>OS:</strong> Ubuntu 22.04 LTS</p>
</blockquote>
<p>ps -aux 可以发现这个 web server 服务是由 apache2 提供的：
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>...
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>www-data     774  0.0  0.9 1211728 4304 ?        Sl   08:27   0:00 /usr/sbin/apache2 -k start
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>www-data     775  0.0  0.9 1211728 4304 ?        Sl   08:27   0:00 /usr/sbin/apache2 -k start
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>...
</code></pre></div>
去 /etc/apache2 逛了一圈，确实没什么问题。</p>
<p><code>curl -v 127.0.0.1:80</code>，发现根本就连不上。可能是防火墙的问题，看一下 iptables：
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a># iptables -L -n
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>Chain INPUT (policy ACCEPT)
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>target     prot opt source               destination         
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>DROP       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:80
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>Chain FORWARD (policy ACCEPT)
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>target     prot opt source               destination         
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>Chain OUTPUT (policy ACCEPT)
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>target     prot opt source               destination
</code></pre></div>
发现 INPUT 链把所有 tcp 包都 DROP 了。所以可以直接情况规则：
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a># iptables -F
</code></pre></div>
然后再 curl 发现返回 403 Forbidden。检查一下 /var/www/html/index.html 的权限：
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a># ls -l /var/www/html/index.html
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>-rw------- 1 root root 16 Aug  1 00:40 /var/www/html/index.html
</code></pre></div>
所以需要修改一下权限，让所有人可读：
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a># chmod +r /var/www/html/index.html
</code></pre></div>
然后再 curl 就可以了。</p>
<hr />
<h2 id="manhattan">"Manhattan"<a class="headerlink" href="#manhattan" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Manhattan": can't write data into database.</p>
<p><strong>Level:</strong> Medium</p>
<p><strong>Description:</strong> Your objective is to be able to insert a row in an existing Postgres database. The issue is not specific to Postgres and you don't need to know details about it (although it may help).</p>
<p>Helpful Postgres information: it's a service that listens to a port (:5432) and writes to disk in a data directory, the location of which is defined in the data_directory parameter of the configuration file /etc/postgresql/14/main/postgresql.conf. In our case Postgres is managed by systemd as a unit with name postgresql.</p>
<p><strong>OS:</strong> Debian 10</p>
</blockquote>
<p>有一些难度，看了些提示。</p>
<p>首先 <code>systemctl status postgresql</code> 可以看出 postgresql 确实在运行，但是连不上。看一看 /var/log/syslog 没有什么异样。</p>
<p>试着 <code>systemctl restart postgresql</code> 重启 postgresql，没有报错，但是 /var/log/syslog 里面可以看到错误：
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Nov  3 09:11:58 ip-172-31-47-134 postgresql@14-main[884]: 2022-11-03 09:11:58.882 UTC [889] FATAL:  could not create lock file &quot;postmaster.pid&quot;: No space left on device
</code></pre></div>
No space left on device，所以 df 看一下磁盘用量：
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>root@ip-172-31-47-134:/# df
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Filesystem      1K-blocks    Used Available Use% Mounted on
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>udev               229200       0    229200   0% /dev
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>tmpfs               47660    1520     46140   4% /run
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>/dev/nvme1n1p1    8026128 1233676   6363196  17% /
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>tmpfs              238300       0    238300   0% /dev/shm
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>tmpfs                5120       0      5120   0% /run/lock
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>tmpfs              238300       0    238300   0% /sys/fs/cgroup
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>/dev/nvme1n1p15    126710     278    126432   1% /boot/efi
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>/dev/nvme0n1      8378368 8378340        28 100% /opt/pgdata
</code></pre></div>
可以看到挂载在 /opt/pgdata 上的设备容量满了。检查一下这个目录：
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>root@ip-172-31-47-134:/# ls -l /opt/pgdata
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>total 8285620
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>-rw-r--r--  1 root     root             69 May 21 22:20 deleteme
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>-rw-r--r--  1 root     root     7516192768 May 21 22:06 file1.bk
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>-rw-r--r--  1 root     root      967774208 May 21 22:17 file2.bk
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>-rw-r--r--  1 root     root         499712 May 21 22:23 file3.bk
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>drwx------ 19 postgres postgres       4096 May 21 22:24 main
</code></pre></div>
可以发现一堆 .bk 备份文件占满了磁盘，删除、重启、测试，发现一切正常了：
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>root@ip-172-31-47-134:/# rm /opt/pgdata/file*.bk
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>root@ip-172-31-47-134:/# ls -l /opt/pgdata
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>total 8
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>-rw-r--r--  1 root     root       69 May 21 22:20 deleteme
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>drwx------ 19 postgres postgres 4096 May 21 22:24 main
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>root@ip-172-31-47-134:/# systemctl restart postgresql
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>root@ip-172-31-47-134:/# sudo -u postgres psql -c &quot;insert into persons(name) values (&#39;jane smith&#39;);&quot; -d dt
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>INSERT 0 1
</code></pre></div></p>
<hr />
<h2 id="cape-town">"Cape Town"<a class="headerlink" href="#cape-town" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Cape Town": Borked Nginx</p>
<p><strong>Level:</strong> Medium</p>
<p><strong>Description:</strong> There's an Nginx web server installed and managed by systemd. Running curl -I 127.0.0.1:80 returns curl: (7) Failed to connect to localhost port 80: Connection refused , fix it so when you curl you get the default Nginx page.</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>首先 systemctl status nginx 检查一下 nginx 运行状态：
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$ sudo systemctl status nginx
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>● nginx.service - The NGINX HTTP and reverse proxy server
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>     Loaded: loaded (/etc/systemd/system/nginx.service; enabled; vendor preset: enabled)
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>     Active: failed (Result: exit-code) since Thu 2022-11-03 09:30:47 UTC; 42s ago
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    Process: 584 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=1/FAILURE)
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        CPU: 28ms
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>Nov 03 09:30:47 ip-172-31-33-45 systemd[1]: Starting The NGINX HTTP and reverse proxy server...
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>Nov 03 09:30:47 ip-172-31-33-45 nginx[584]: nginx: [emerg] unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>Nov 03 09:30:47 ip-172-31-33-45 nginx[584]: nginx: configuration file /etc/nginx/nginx.conf test failed
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>Nov 03 09:30:47 ip-172-31-33-45 systemd[1]: nginx.service: Control process exited, code=exited, status=1/FAILURE
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>Nov 03 09:30:47 ip-172-31-33-45 systemd[1]: nginx.service: Failed with result &#39;exit-code&#39;.
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>Nov 03 09:30:47 ip-172-31-33-45 systemd[1]: Failed to start The NGINX HTTP and reverse proxy server.
</code></pre></div>
发现有报错，说在 /etc/nginx/sites-enabled/default:1 有一个 unexpected ";"，所以去删掉它，然后重启。
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>admin@ip-172-31-33-45:/$ sudo vim /etc/nginx/sites-enabled/default 
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>admin@ip-172-31-33-45:/$ sudo systemctl restart nginx
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>admin@ip-172-31-33-45:/$ sudo systemctl status nginx
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>● nginx.service - The NGINX HTTP and reverse proxy server
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>     Loaded: loaded (/etc/systemd/system/nginx.service; enabled; vendor preset: enabled)
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>     Active: active (running) since Thu 2022-11-03 09:32:32 UTC; 6s ago
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    Process: 868 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    Process: 869 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>   Main PID: 870 (nginx)
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>      Tasks: 2 (limit: 524)
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>     Memory: 2.4M
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>        CPU: 27ms
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>     CGroup: /system.slice/nginx.service
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>             ├─870 nginx: master process /usr/sbin/nginx
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>             └─871 nginx: worker process
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>Nov 03 09:32:32 ip-172-31-33-45 systemd[1]: Starting The NGINX HTTP and reverse proxy server...
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>Nov 03 09:32:32 ip-172-31-33-45 nginx[868]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>Nov 03 09:32:32 ip-172-31-33-45 nginx[868]: nginx: configuration file /etc/nginx/nginx.conf test is successful
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>Nov 03 09:32:32 ip-172-31-33-45 systemd[1]: Started The NGINX HTTP and reverse proxy server.
</code></pre></div>
工作正常，但是 curl 一下会得到 500。检查一下 log：
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>admin@ip-172-31-33-45:/$ cat /var/log/nginx/error.log | tail -n 10
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>2022/09/11 16:39:11 [emerg] 5875#5875: unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>2022/09/11 16:54:26 [emerg] 5931#5931: unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>2022/09/11 16:55:00 [emerg] 5961#5961: unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>2022/09/11 17:02:07 [emerg] 6066#6066: unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>2022/09/11 17:07:03 [emerg] 6146#6146: unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>2022/11/03 09:30:47 [emerg] 584#584: unexpected &quot;;&quot; in /etc/nginx/sites-enabled/default:1
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>2022/11/03 09:32:32 [alert] 870#870: socketpair() failed while spawning &quot;worker process&quot; (24: Too many open files)
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>2022/11/03 09:32:32 [emerg] 871#871: eventfd() failed (24: Too many open files)
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>2022/11/03 09:32:32 [alert] 871#871: socketpair() failed (24: Too many open files)
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>2022/11/03 09:33:03 [crit] 871#871: *1 open() &quot;/var/www/html/index.nginx-debian.html&quot; failed (24: Too many open files), client: 127.0.0.1, server: _, request: &quot;GET / HTTP/1.1&quot;, host: &quot;127.0.0.1&quot;
</code></pre></div>
可以发现报错 Too many open files。搜了一下，网上提供的方法都试了一圈，问题不出在 nginx 的配置上。然后根据提示去看了 systemd 上 nginx 的配置：
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>admin@ip-172-31-33-45:/$ cat /etc/systemd/system/nginx.service 
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>[Unit]
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Description=The NGINX HTTP and reverse proxy server
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>After=syslog.target network-online.target remote-fs.target nss-lookup.target
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>Wants=network-online.target
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>[Service]
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>Type=forking
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>PIDFile=/run/nginx.pid
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>ExecStartPre=/usr/sbin/nginx -t
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>ExecStart=/usr/sbin/nginx
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>ExecReload=/usr/sbin/nginx -s reload
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>ExecStop=/bin/kill -s QUIT $MAINPID
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>PrivateTmp=true
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>LimitNOFILE=10
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>[Install]
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>WantedBy=multi-user.target
</code></pre></div>
把 LimitNOFILE=10 改成 LimitNOFILE=1024，然后重启 nginx 即可正常得到响应：
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>admin@ip-172-31-33-45:/$ sudo systemctl restart nginx
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>Warning: The unit file, source configuration file or drop-ins of nginx.service changed on disk. Run &#39;systemctl daemon-reload&#39; to reload units.
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>admin@ip-172-31-33-45:/$ sudo systemctl daemon-reload
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>admin@ip-172-31-33-45:/$ sudo systemctl restart nginx
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>admin@ip-172-31-33-45:/$ curl -Is 127.0.0.1:80 | head -1
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>HTTP/1.1 200 OK
</code></pre></div></p>
<hr />
<h2 id="salta">"Salta"<a class="headerlink" href="#salta" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Salta": Docker container won't start.</p>
<p><strong>Level:</strong> Medium</p>
<p><strong>Description:</strong> There's a "dockerized" Node.js web application in the /home/admin/app directory. Create a Docker container so you get a web app on port :8888 and can curl to it. For the solution to be valid, there should be only one running Docker container.</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>首先检查一下 docker 容器：
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>admin@ip-172-31-38-21:/$ sudo docker ps -a
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>CONTAINER ID   IMAGE     COMMAND                  CREATED       STATUS                   PORTS     NAMES
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>124a4fb17a1c   app       &quot;docker-entrypoint.s…&quot;   6 weeks ago   Exited (1) 6 weeks ago             elated_taussig
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>admin@ip-172-31-38-21:~/app$ sudo docker logs 124
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>node:internal/modules/cjs/loader:928
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>  throw err;
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>  ^
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>Error: Cannot find module &#39;/usr/src/app/serve.js&#39;
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:925:15)
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>    at Function.Module._load (node:internal/modules/cjs/loader:769:27)
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:76:12)
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>    at node:internal/main/run_main_module:17:47 {
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>  code: &#39;MODULE_NOT_FOUND&#39;,
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>  requireStack: []
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>}
</code></pre></div>
发现报错了，Dockerfile 里出了一些问题，看一下：
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c"># documentation https://nodejs.org/en/docs/guides/nodejs-docker-webapp/</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c"># most recent node (security patches) and alpine (minimal, adds to security, possible libc issues)</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:15.7-alpine</span><span class="w"> </span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="c"># Create app directory &amp; copy app files</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/usr/src/app</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="c"># we copy first package.json only, so we take advantage of cached Docker layers</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">COPY</span><span class="w"> </span>./package*.json ./
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="c"># RUN npm ci --only=production</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="k">RUN</span><span class="w"> </span>npm install
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="c"># Copy app source</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="k">COPY</span><span class="w"> </span>./* ./
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="c"># port used by this app</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8880</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="c"># command to run</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;serve.js&quot;</span><span class="w"> </span><span class="p">]</span>
</code></pre></div>
发现最后 CMD 里 server.js 打成了 serve.js，而且 EXPOSE 的端口也不对。两个问题修一下然后重新构建、运行：
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>admin@ip-172-31-38-21:~/app$ sudo docker build -t app .
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>admin@ip-172-31-38-21:~/app$ sudo docker rm 124
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>admin@ip-172-31-38-21:~/app$ sudo docker run -d -p 8888:8888 app
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>e67b36ff14ff3676e419036180abf9231e97eacc5ec6fe9d76426e7003acfb8f
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>docker: Error response from daemon: driver failed programming external connectivity on endpoint nifty_bhaskara (ce8a09c7a42f730b89e0bd1bd3298de1598d79bf0d08d1532a7f38002cda84d4): Error starting userland proxy: listen tcp4 0.0.0.0:8888: bind: address already in use.
</code></pre></div>
发现报错 8888 端口被占用了。没有 lsof，用 netstat 查一下端口：
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>admin@ip-172-31-38-21:~/app$ netstat -tunlp
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>(Not all processes could be identified, non-owned process info
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a> will not be shown, you would have to be root to see it all.)
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>Active Internet connections (only servers)
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>tcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      -                   
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>tcp6       0      0 :::8080                 :::*                    LISTEN      562/gotty           
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>tcp6       0      0 :::22                   :::*                    LISTEN      -                   
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>tcp6       0      0 :::8888                 :::*                    LISTEN      -                   
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>tcp6       0      0 :::6767                 :::*                    LISTEN      563/sadagent        
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>udp        0      0 127.0.0.1:323           0.0.0.0:*                           -                   
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>udp        0      0 0.0.0.0:68              0.0.0.0:*                           -                   
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>udp6       0      0 fe80::8d3:45ff:fee9:546 :::*                                -                   
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>udp6       0      0 ::1:323                 :::*                                - 
</code></pre></div>
发现 8888 端口在用，ps -aux 可以看到有一个 nginx 在运行，在 /etc/nginx/sites-enabled/default 里确实有使用 8888 端口。</p>
<p>所以先停掉 nginx，然后重新部署容器即可：
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>admin@ip-172-31-38-21:~/app$ sudo systemctl stop nginx
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>admin@ip-172-31-38-21:~/app$ sudo docker stop e6
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>e6
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>admin@ip-172-31-38-21:~/app$ sudo docker rm e6
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>e6
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>admin@ip-172-31-38-21:~/app$ sudo docker run -d -p 8888:8888 app
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>...
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>admin@ip-172-31-38-21:~/app$ curl localhost:8888
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>Hello World!
</code></pre></div></p>
<hr />
<h2 id="jakarta">"Jakarta"<a class="headerlink" href="#jakarta" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Jakarta": it's always DNS.</p>
<p><strong>Level:</strong> Hard</p>
<p><strong>Description:</strong> Can't ping google.com. It returns ping: google.com: Name or service not known. Expected is being able to resolve the hostname. (Note: currently the VMs can't ping outside so there's no automated check for the solution).</p>
<p><strong>OS:</strong> Ubuntu 22.04 LTS</p>
</blockquote>
<p>根据题目知道是 dns 出了问题，/etc/resolv.conf 里的配置都没啥问题。而且整个 sadservers 是不能连接外网的，所以大概只能用本机的了。搜索了一下 dns 相关的配置文件，看了一圈发现 /etc/nsswitch.conf 里的 hosts 配置有问题：
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>hosts:          files
</code></pre></div>
而网上的例子里都有 dns，所以在 files 后面加一个 dns 就可以了：
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>ubuntu@ip-172-31-42-233:/$ ping google.com
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>PING google.com (142.250.191.174) 56(84) bytes of data.
</code></pre></div></p>
<hr />
<h2 id="bern">"Bern"<a class="headerlink" href="#bern" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Bern": Docker web container can't connect to db container.</p>
<p><strong>Level:</strong> Hard</p>
<p><strong>Description:</strong> There are two Docker containers running, a web application (Wordpress or WP) and a database (MariaDB) as back-end, but if we look at the web page, we see that it cannot connect to the database. curl -s localhost:80 |tail -4 returns:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">&lt;</span><span class="nt">body</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;error-page&quot;</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;wp-die-message&quot;</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Error establishing a database connection<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">body</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>This is not a Wordpress code issue (the image is :latest with some network utilities added). What you need to know is that WP uses "WORDPRESS_DB_" environment variables to create the MySQL connection string. See the ./html/wp-config.php WP config file for example (from /home/admin).</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>docker ps -a 可以看到有两个容器在运行。根据题目的 test 可以知道 mysql 的账号密码是 root:password。</p>
<p>WordPress 启动会从环境变量读取配置，所以在 wordpress 的容器中查一下 env：
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>admin@ip-172-31-19-232:/$ sudo docker exec wordpress env |grep WORDPRESS_DB_
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>WORDPRESS_DB_PASSWORD=password
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>WORDPRESS_DB_USER=root
</code></pre></div>
可以看出用户名和密码设置的是正确的。但是 NAME 和 HOST 使用的就是 wp-config.php 中默认的了，也就是 wordpress 和 mysql，NAME 的话在 mariadb 容器里可以看到确实是 wordpress，但 HOST 是 mysql，就连接不到了。</p>
<p>而题给的 test 一定要在 wordpress 容器里打开 mysqladmin，连接 host mysql。不知道怎么搞 qwq，hint 没再接着写了，八会 qwq。</p>
<hr />
<h2 id="singara">"Singara"<a class="headerlink" href="#singara" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Singara": Docker and Kubernetes web app not working.</p>
<p><strong>Level:</strong> Hard</p>
<p><strong>Description:</strong> There's a k3s Kubernetes install you can access with kubectl. The Kubernetes YAML manifests under /home/admin have been applied. The objective is to access from the host the "webapp" web server deployed and find what message it serves (it's a name of a town or city btw). In order to pass the check, the webapp Docker container should not be run separately outside Kubernetes as a shortcut.</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>先看一下 k3s 的配置文件：</p>
<details class="example">
<summary>配置文件</summary>
<p><div class="highlight"><span class="filename">deployment.yml</span><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span><span class="w"></span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"></span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp-deployment</span><span class="w"></span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class="w"></span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">imagePullPolicy</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span><span class="w"></span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8880</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><span class="filename">namespace.yml</span><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span><span class="w"></span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><span class="filename">nodeport.yml</span><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class="w"></span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp-service</span><span class="w"></span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class="w"></span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span><span class="w"></span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="nt">selector</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span><span class="w"></span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span><span class="w"></span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30007</span><span class="w"></span>
</code></pre></div></p>
</details>
<p>然后检查一下 k3s 各部分的状态：
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>admin@ip-10-0-0-64:~$ kubectl get all -n web
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>NAME                                     READY   STATUS             RESTARTS   AGE
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>pod/webapp-deployment-666b67994b-5sffz   0/1     ImagePullBackOff   0          46d
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>NAME                     TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>service/webapp-service   NodePort   10.43.35.97   &lt;none&gt;        80:30007/TCP   46d
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>deployment.apps/webapp-deployment   0/1     1            0           46d
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>NAME                                           DESIRED   CURRENT   READY   AGE
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>replicaset.apps/webapp-deployment-666b67994b   1         1         0       46d
</code></pre></div>
可以发现 webapp-deployment 的镜像拉取失败了。因为它会从网络拉取 webapp 镜像而不是本地，而整个 sadservers 不能连接外部网络，所以自然会拉取失败。</p>
<p>这个状态和前一阵办 ZJUCTF 校赛很像，大概就是 k3s 拉取镜像的问题。当时是自建了一个 registry 来搞的。所以查一下本地的镜像：
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>admin@ip-10-0-0-64:~$ sudo docker images
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>REPOSITORY   TAG        IMAGE ID       CREATED        SIZE
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>webapp       latest     9c082e2983bc   6 weeks ago    135MB
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>python       3.7-slim   c1d0bab51bbf   7 weeks ago    123MB
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>registry     2          3a0f7b0a13ef   2 months ago   24.1MB
</code></pre></div>
发现正好有 registry 镜像。所以本地起一个 registry 然后将 webapp 上传：
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>admin@ip-10-0-0-64:~$ sudo docker run -d -p 5000:5000 registry:2
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>...
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>admin@ip-10-0-0-64:~$ sudo docker tag webapp localhost:5000/webapp
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>admin@ip-10-0-0-64:~$ sudo docker push localhost:5000/webapp
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>Using default tag: latest
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>The push refers to repository [localhost:5000/webapp]
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>...
</code></pre></div>
然后改一下 deployment.yml：
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nn">...</span><span class="w"></span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="nt">template</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webapp</span><span class="w"></span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost:5000/webapp</span><span class="w"> </span><span class="c1"># 这里</span><span class="w"></span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span><span class="w"></span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span><span class="w"> </span><span class="c1"># 和这里</span><span class="w"></span>
</code></pre></div>
然后应用：
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>admin@ip-10-0-0-64:~$ kubectl apply -f deployment.yml 
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>deployment.apps/webapp-deployment configured
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>admin@ip-10-0-0-64:~$ kubectl get pods -n web
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>NAME                                 READY   STATUS        RESTARTS   AGE
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>webapp-deployment-666b67994b-5sffz   0/1     Terminating   0          46d
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>webapp-deployment-8f869f757-g2m7n    1/1     Running       0          12s
</code></pre></div>
可以发现成功启动了，接下来的就是将其中的 8888 端口转发出来：
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>admin@ip-10-0-0-64:~$ kubectl port-forward deployments/webapp-deployment 8888 -n web &amp;
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>Forwarding from 127.0.0.1:8888 -&gt; 8888
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>Forwarding from [::1]:8888 -&gt; 8888
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>...
</code></pre></div>
然后在另一个终端里 curl localhost:8888 就可以得到正常结果了。</p>
<hr />
<h2 id="karakorum">"Karakorum"<a class="headerlink" href="#karakorum" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Karakorum": WTFIT – What The Fun Is This?</p>
<p><strong>Level:</strong> Hard</p>
<p><strong>Description:</strong> There's a binary at /home/admin/wtfit that nobody knows how it works or what it does ("what the fun is this"). Someone remembers something about wtfit needing to communicate to a service in order to start. Run this wtfit program so it doesn't exit with an error, fixing or working around things that you need but are broken in this server. (Note that you can open more than one web "terminal").</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>ls -l 可以看出来 wtfit 没有运行权限。所以先 chmod，但 chmod 会报错 bash: /usr/bin/chmod: Permission denied。经过检查可以发现是 /usr/bin/chmod 自身也没有运行权限：
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>admin@ip-172-31-46-91:/$ ls -l /usr/bin/chmod
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>-rw-r--r-- 1 root root 64448 Sep 24  2020 /usr/bin/chmod
</code></pre></div>
可以搜索到<a href="https://www.cnblogs.com/chuckzhang/p/9277268.html">一些解决办法</a>：
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>admin@ip-172-31-46-91:/$ sudo su
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>root@ip-172-31-46-91:/# /lib64/ld-linux-x86-64.so.2 /bin/chmod 755 /bin/chmod
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>root@ip-172-31-46-91:/# cd /home/admin/
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>root@ip-172-31-46-91:/home/admin# chmod +x wtfit
</code></pre></div>
运行 wtfit 出错：ERROR: can't open config file。根据提示通过 strace 来跟踪得到错误的详细消息：
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>admin@ip-172-31-46-91:~$ strace ./wtfit
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>...
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>openat(AT_FDCWD, &quot;/home/admin/wtfitconfig.conf&quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>...
</code></pre></div>
在这个位置创建一个空的配置文件。然后再运行，还是出错：ERROR: can't connect to server。同样 strace 可以得到：
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>admin@ip-172-31-46-91:~$ strace ./wtfit
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>...
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>connect(3, {sa_family=AF_INET, sin_port=htons(7777), sin_addr=inet_addr(&quot;127.0.0.1&quot;)}, 16) = -1 EINPROGRESS (Operation now in progress)
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>...
</code></pre></div>
所以可以看出它在试图连接 localhost:7777。开一个新的 terminal 然后监听一下 7777 端口，运行 wtfit：
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>admin@ip-172-31-46-91:/$ nc -lvvp 7777
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>Listening on 0.0.0.0 7777
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>Connection received on localhost 54756
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>GET / HTTP/1.1
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>Host: localhost:7777
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>User-Agent: Go-http-client/1.1
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>Accept-Encoding: gzip
</code></pre></div>
可以发现就是简单的 GET，所以 python 起一个 http server，然后运行：
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>admin@ip-172-31-46-91:/$ python3 -m http.server 7777
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>Serving HTTP on 0.0.0.0 port 7777 (http://0.0.0.0:7777/) ...
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>127.0.0.1 - - [03/Nov/2022 12:58:30] &quot;GET / HTTP/1.1&quot; 200 -
</code></pre></div>
这时 wtfit 就可以正常运行结束了。</p>
<hr />
<h2 id="hong-kong">"Hong-Kong"<a class="headerlink" href="#hong-kong" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Hong-Kong": can't write data into database.</p>
<p><strong>Level:</strong> Hard</p>
<p><strong>Description:</strong> (Similar to "Manhattan" scenario but harder). Your objective is to be able to insert a row in an existing Postgres database. The issue is not specific to Postgres and you don't need to know details about it (although it may help).</p>
<p>Postgres information: it's a service that listens to a port (:5432) and writes to disk in a data directory, the location of which is defined in the data_directory parameter of the configuration file /etc/postgresql/14/main/postgresql.conf. In our case Postgres is managed by systemd as a unit with name postgresql.</p>
<p><strong>OS:</strong> Debian 10</p>
</blockquote>
<p>和前面的 "Manhattan" 类似。还是先检查状态没异常，重启没异常，查看 /var/log/syslog，发现：
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Nov  3 11:52:20 ip-172-31-25-11 systemd[1]: Starting PostgreSQL Cluster 14-main...
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>Nov  3 11:52:20 ip-172-31-25-11 postgresql@14-main[1318]: Error: /opt/pgdata/main is not accessible or does not exist
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>Nov  3 11:52:20 ip-172-31-25-11 systemd[1]: postgresql@14-main.service: Can&#39;t open PID file /run/postgresql/14-main.pid (yet?) after start: No such file or directory
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>Nov  3 11:52:20 ip-172-31-25-11 systemd[1]: postgresql@14-main.service: Failed with result &#39;protocol&#39;.
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>Nov  3 11:52:20 ip-172-31-25-11 systemd[1]: Failed to start PostgreSQL Cluster 14-main.
</code></pre></div></p>
<p>找不到 /opt/pgdata/main，ls 一下 /opt/pgdata 也没有。再往前看 syslog 可以发现：
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>Nov  3 11:47:54 ip-172-31-25-11 systemd[1]: dev-xvdb.device: Job dev-xvdb.device/start timed out.
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>Nov  3 11:47:54 ip-172-31-25-11 systemd[1]: Timed out waiting for device /dev/xvdb.
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>Nov  3 11:47:54 ip-172-31-25-11 systemd[1]: Dependency failed for /opt/pgdata.
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>Nov  3 11:47:54 ip-172-31-25-11 systemd[1]: opt-pgdata.mount: Job opt-pgdata.mount/start failed with result &#39;dependency&#39;.
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>Nov  3 11:47:54 ip-172-31-25-11 systemd[1]: Startup finished in 2.669s (kernel) + 1min 31.106s (userspace) = 1min 33.776s.
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>Nov  3 11:47:54 ip-172-31-25-11 systemd[1]: dev-xvdb.device: Job dev-xvdb.device/start failed with result &#39;timeout&#39;.
</code></pre></div>
可以发现挂载设备超时了。</p>
<p>fdisk 看一下：
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>root@ip-172-31-25-11:/# fdisk -l
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>Disk /dev/nvme0n1: 8 GiB, 8589934592 bytes, 16777216 sectors
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>Disk model: Amazon Elastic Block Store              
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>Units: sectors of 1 * 512 = 512 bytes
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>Sector size (logical/physical): 512 bytes / 512 bytes
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>I/O size (minimum/optimal): 512 bytes / 512 bytes
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>Disk /dev/nvme1n1: 8 GiB, 8589934592 bytes, 16777216 sectors
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>Disk model: Amazon Elastic Block Store              
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>Units: sectors of 1 * 512 = 512 bytes
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>Sector size (logical/physical): 512 bytes / 512 bytes
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>I/O size (minimum/optimal): 512 bytes / 512 bytes
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>Disklabel type: gpt
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>Disk identifier: 56507B41-5D22-1349-81AD-C628BA074922
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>Device           Start      End  Sectors  Size Type
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>/dev/nvme1n1p1  262144 16777182 16515039  7.9G Linux filesystem
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>/dev/nvme1n1p14   2048     8191     6144    3M BIOS boot
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>/dev/nvme1n1p15   8192   262143   253952  124M EFI System
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>Partition table entries are not in disk order.
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>root@ip-172-31-25-11:/# df
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>Filesystem      1K-blocks    Used Available Use% Mounted on
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a>udev               228728       0    228728   0% /dev
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>tmpfs               47568    1524     46044   4% /run
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a>/dev/nvme1n1p1    8026128 1230452   6366420  17% /
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a>tmpfs              237828       0    237828   0% /dev/shm
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a>tmpfs                5120       0      5120   0% /run/lock
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a>tmpfs              237828       0    237828   0% /sys/fs/cgroup
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a>/dev/nvme1n1p15    126710     278    126432   1% /boot/efi
</code></pre></div>
可以发现 /dev/nvme0n1 没有挂载上，根据前面题目可以推测这个设备里面是 /opt/pgdata 的内容。</p>
<p><code>mount /dev/nvme0n1 /opt/pgdata</code> 尝试挂载，没有报错，但仍旧没有东西。看一下 /var/log/syslog 发现：
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>Nov  3 12:02:06 ip-172-31-25-11 kernel: [  945.914667] SGI XFS with ACLs, security attributes, realtime, no debug enabled
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>Nov  3 12:02:06 ip-172-31-25-11 kernel: [  945.925395] XFS (nvme0n1): Mounting V5 Filesystem
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>Nov  3 12:02:07 ip-172-31-25-11 kernel: [  946.092049] XFS (nvme0n1): Ending clean mount
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>Nov  3 12:02:07 ip-172-31-25-11 systemd[1]: opt-pgdata.mount: Unit is bound to inactive unit dev-xvdb.device. Stopping, too.
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>Nov  3 12:02:07 ip-172-31-25-11 systemd[1]: Unmounting /opt/pgdata...
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a>Nov  3 12:02:07 ip-172-31-25-11 kernel: [  946.124665] XFS (nvme0n1): Unmounting Filesystem
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>Nov  3 12:02:07 ip-172-31-25-11 systemd[1]: opt-pgdata.mount: Succeeded.
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>Nov  3 12:02:07 ip-172-31-25-11 systemd[1]: Unmounted /opt/pgdata.
</code></pre></div></p>
<p>可以看出 systemd 不让我们挂载到 /opt/pgdata 上，因为它和 /dev/xvdb 设备关联了。这个关联是在 /etc/fstab 文件中的：
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a># /etc/fstab: static file system information
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>UUID=5db68868-2d70-449f-8b1d-f3c769ec01c7 / ext4 rw,discard,errors=remount-ro,x-systemd.growfs 0 1
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>UUID=72C9-F191 /boot/efi vfat defaults 0 0
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>/dev/xvdb /opt/pgdata xfs defaults,nofail 0 0
</code></pre></div>
把里面的 /dev/xvdb 换成 /dev/nvme0n1，然后 systemctl daemon-reload 重新加载配置文件。之后就可以正常 mount 了：
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>root@ip-172-31-25-11:/# systemctl daemon-reload
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>root@ip-172-31-25-11:/# ls /opt/pgdata
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>root@ip-172-31-25-11:/# mount /dev/nvme0n1 /opt/pgdata
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>root@ip-172-31-25-11:/# ls /opt/pgdata
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>deleteme  file1.bk  file2.bk  file3.bk  main
</code></pre></div>
同样，这些 .bk 文件占满了空间，删掉然后重启 postgresql，就可以正常使用了：
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>root@ip-172-31-25-11:/# ls -l /opt/pgdata
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>total 8285620
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>-rw-r--r--  1 root     root             69 May 21 22:20 deleteme
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>-rw-r--r--  1 root     root     7516192768 May 21 22:06 file1.bk
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>-rw-r--r--  1 root     root      967774208 May 21 22:17 file2.bk
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>-rw-r--r--  1 root     root         499712 May 21 22:23 file3.bk
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>drwx------ 19 postgres postgres       4096 May 21 22:24 main
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>root@ip-172-31-25-11:/# rm /opt/pgdata/file*.bk
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>root@ip-172-31-25-11:/# sudo systemctl start postgresql
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>root@ip-172-31-25-11:/# sudo -u postgres psql -c &quot;insert into persons(name) values (&#39;jane smith&#39;);&quot; -d dt
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>INSERT 0 1
</code></pre></div></p>
<hr />
<h2 id="venice">"Venice"<a class="headerlink" href="#venice" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Scenario:</strong> "Venice": Am I in a container?</p>
<p><strong>Level:</strong> Medium</p>
<p><strong>Description:</strong> Try and figure out if you are inside a container (like a Docker one for example) or inside a Virtual Machine (like in the other scenarios).</p>
<p><strong>OS:</strong> Debian 11</p>
</blockquote>
<p>emmm，ps -aux 看到：
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>root@ip-172-31-33-228:/# ps -aux
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>root           1  0.4  2.0 100712  9600 ?        Ss   12:14   0:01 /sbin/init
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>root          22  0.0  1.4  26728  6912 ?        Ss   12:14   0:00 /lib/systemd/systemd-journald
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>message+      47  0.0  0.7   8268  3700 ?        Ss   12:14   0:00 /usr/bin/dbus-daemon --system --addres
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>root          49  0.0  1.1  13404  5532 ?        Ss   12:14   0:00 /lib/systemd/systemd-logind
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>root          71  0.0  2.4 1230092 11584 ?       S&lt;sl 12:14   0:00 /usr/local/gotty --permit-write --reco
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>root          91  0.0  0.7   6056  3652 pts/0    S&lt;s  12:18   0:00 bash
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>root          92  0.0  0.7   8840  3416 pts/0    R&lt;+  12:18   0:00 ps -aux
</code></pre></div>
和其它题目实例里面不一样，没有 kernel thread，所以是容器而不是虚拟机。（就这？</p>
<details class="success">
<summary>题给答案</summary>
<blockquote>
<p><strong>Solution:</strong> This is in fact a Podman container :-)<br />
You can get the image: docker.io/fduran/venice.</p>
<p>A way of checking is by looking at the environment of the PID=1 process and see if there's a container variable, for ex: cat /proc/1/environ|tr "\0" "\n"|grep container , in our case would be container=podman but I changed its value.</p>
<p>An indicator is to look at the running processes and see that there are no kernel threads like [kthreadd].</p>
</blockquote>
</details>

  
    <hr>
<div class="md-source-file">
  <small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2022年11月3日 21:05:30</span>
      
        <br>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2022年11月3日 21:05:30</span>
      
    
  </small>
</div>
  

                  
                    <script src="https://giscus.app/client.js"
                            data-repo="TonyCrane/note"
                            data-repo-id="R_kgDOGnfbUQ"
                            data-category="General"
                            data-category-id="DIC_kwDOGnfbUc4CPrf4"
                            data-mapping="pathname"
                            data-reactions-enabled="1"
                            data-emit-metadata="0"
                            data-input-position="bottom"
                            data-theme="light"
                            data-lang="zh-CN"
                            crossorigin="anonymous"
                            async>
                    </script>
                    <script>
                      if (document.querySelector("body").getAttribute("data-md-color-scheme") === "slate") {
                        var giscus = document.querySelector("script[src*=giscus]")
                        giscus.setAttribute("data-theme", "https://gcore.jsdelivr.net/gh/TonyCrane/note/docs/css/giscus.css") 
                      }
                    </script>
                  
                
              </article>
            </div>
          </div>
          
            <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
              回到页面顶部
            </a>
          
        </main>
        
          <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="页脚">
      
        
        <a href="../SecurityInnovation/" class="md-footer__link md-footer__link--prev" aria-label="上一页: Security Innovation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                上一页
              </span>
              Security Innovation
            </div>
          </div>
        </a>
      
      
        
        <a href="../AAA/" class="md-footer__link md-footer__link--next" aria-label="下一页: 🔒 AAA School Bus" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                下一页
              </span>
              🔒 AAA School Bus
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 <a href="https://github.com/TonyCrane"  target="_blank" rel="noopener">TonyCrane</a>
    </div>
  
  
    Powered by
    <a href="https://www.mkdocs.org/" target="_blank" rel="noopener">
      MkDocs
    </a>
    with theme
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material
    </a>
    modified by
    <a href="https://github.com/TonyCrane" target="_blank" rel="noopener">
      TonyCrane
    </a>
  
</div>
  
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/TonyCrane/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://blog.tonycrane.cc/" target="_blank" rel="noopener" title="blog.tonycrane.cc" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://tonycrane.cc/" target="_blank" rel="noopener" title="tonycrane.cc" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26 96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47 488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
        
      </div>
      <div class="md-dialog" data-md-component="dialog">
        <div class="md-dialog__inner md-typeset"></div>
      </div>
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top"], "search": "../../assets/javascripts/workers/search.361d90f1.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
      
      
        <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
        
          <script src="https://gcore.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
        
          <script src="../../js/katex.js"></script>
        
      
    </body>
  </html>
  